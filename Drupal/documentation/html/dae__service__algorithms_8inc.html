<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DAEDrupalInterface: modules/services/dae_algorithms/dae_service_algorithms.inc File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DAEDrupalInterface
   &#160;<span id="projectnumber">1.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">modules/services/dae_algorithms/dae_service_algorithms.inc File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="dae__service__algorithms_8inc_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aee0fe32993e3a353eb690c5142c75b77"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#aee0fe32993e3a353eb690c5142c75b77">files_identical</a> ($fn1, $fn2)</td></tr>
<tr class="memitem:a42144ea79ed3da423fa751e50321f4cc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#a42144ea79ed3da423fa751e50321f4cc">createDataItem</a> ($data, $dataType, $flag)</td></tr>
<tr class="memitem:ae3c92df5fecebdf192d72f8495b0f66f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#ae3c92df5fecebdf192d72f8495b0f66f">localCopy</a> ($value, $localname)</td></tr>
<tr class="memitem:a884daac4bab3284843ca957a07caf7a6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#a884daac4bab3284843ca957a07caf7a6">registerDataItem</a> ($dataType, $dataTypeId, $dataId, $value, $remoteData=false)</td></tr>
<tr class="memitem:a47c3b6ab26d87386019896ac855c14c3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#a47c3b6ab26d87386019896ac855c14c3">findDataItemToRegister</a> ($dataType, $dataTypeId, $dataId, $value, $runId)</td></tr>
<tr class="memitem:a73554be1e83e1c110a1c5334597f0620"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#a73554be1e83e1c110a1c5334597f0620">registerProvenanceStart</a> ($algoId, &amp;$callParameters, $quarantainedExecutionProxy=null)</td></tr>
<tr class="memitem:a2cd33a4cacd4e10b7744b17aff52c4cb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#a2cd33a4cacd4e10b7744b17aff52c4cb">registerProvenanceFailure</a> ($inserted_id, $algoId)</td></tr>
<tr class="memitem:abc05dd5e1cbde7f18b907923908450af"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#abc05dd5e1cbde7f18b907923908450af">registerProvenanceStop</a> ($inserted_id, $algoId, &amp;$callParameters)</td></tr>
<tr class="memitem:a26c3aa6703f4a604cd815e4a8d3e53fb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#a26c3aa6703f4a604cd815e4a8d3e53fb">hook_algorithm</a> ($aid, $aname, $args1, $args2=null)</td></tr>
<tr class="memitem:ab62b940b91d3cf0bcc80e4e52cbf5740"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#ab62b940b91d3cf0bcc80e4e52cbf5740">checkForCloneExecution</a> ($runId)</td></tr>
<tr class="memitem:a00e8b5020b46b06f9ecf1aaa030f3f89"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#a00e8b5020b46b06f9ecf1aaa030f3f89">callback</a> ($callbackArguments=array(), $username, $password)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a907d78797a1b764e913b0c565a5097b0"><td class="memItemLeft" align="right" valign="top">global&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dae__service__algorithms_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a00e8b5020b46b06f9ecf1aaa030f3f89"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#a00e8b5020b46b06f9ecf1aaa030f3f89">callback</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>callbackArguments</em> = <code>array()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>password</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This is a generic callback through which all web-service calls are routed.</p>
<p>This function relies on a session variable $_SESSION['algoId'] to determine which is the actual algorithm web service it will eventually call.</p>
<p>The session variable is set in <a class="el" href="dae__service__algorithms_8module.html#ab7074441fe1f308c67d6666d1c9bf753">dae_service_algorithms_auth()</a> at the invocation of the service.</p>
<p>This callback function prepares all input and output data to conform to the DAE data model standards, registers provenance and reformats data to fit with remote or quarantained services.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">$callbackArguments</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">$username</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">$password</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>algorithm outputs </dd></dl>
<p>If the algorithm is a standard, DAE hosted application: generate the access path URL by using the algorithm_service_host Drupal variable and $algoHTMLString</p>
<p>! This may be the source of difficult to identify bugs. When the following error message is logged 'wsdl error: Bad path to WSDL file XYZ' this may mean that the $algoInfo['PATH'] value stored in the database, is wrong (e.g. due to case sensitivity or typos) </p>
<div class="fragment"><pre class="fragment">     </pre></div><p>If the algorithm is NOT a standard, DAE hosted application, it is either a remotely hosted application or a quarantained DAE hosted application.</p>
<p>The algorithm is a quarantained DAE hosted application if its URL lies within the defined quarantaine network.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000077">Todo:</a></b></dt><dd>Get the nusoap error handling right and raise appropriate exceptions ... everywhere (not only here) ! </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000078">Todo:</a></b></dt><dd>the database retrieved Input/Output parameters should be checked to the published WSDL information </dd></dl>
<p>While the current callback's WSDL input/output description (and subsequent hierarchical structure of the $callbackArguments associative array) has a complex naming scheme combining DATA.name, DATA.id as well as DATA_TYPE.name and DATA_TYPE.id values, the actual webservice executing the algorithm has a 'flat' WSDL input/output structure in which the argument names identical to DATA.name.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000079">Todo:</a></b></dt><dd>We're assuming all array keys are unique ... check if this is actually the case 100% of the time </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000080">Todo:</a></b></dt><dd>We're assuming composite types only have one component ... check if this is actually the case 100% of the time </dd></dl>
<p>Once all input arguments have been retrieved and have been associated wth their corresponding DATA.id we resister a new ALGORITHM_RUN.id ($runId) and store and associate input provenance in the DAE Oracle database.</p>
<p>If the run is quarantained, we also need to copy the input to the quarantaine proxy and translate input value URLs to this new location so that the quarantained web services can access the data.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000081">Todo:</a></b></dt><dd>check for possible execution failures of the above webservice call. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000082">Todo:</a></b></dt><dd>We're assuming all array keys are unique ... check if this is actually the case 100% of the time </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000083">Todo:</a></b></dt><dd>Check following 2 lines of code... it looks like there's some redundancy here </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000084">Todo:</a></b></dt><dd>We're assuming composite types only have one component ... check if this is actually the case 100% of the time </dd></dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00937">937</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>References <a class="el" href="services_2examples_2authenticated__service_2soap__server__test_8php_source.html#l00017">$client</a>, <a class="el" href="services_2examples_2authenticated__service_2soap__server__test_8php_source.html#l00045">$result</a>, <a class="el" href="algorithms__run_8inc_source.html#l00029">$user</a>, <a class="el" href="dae__service__algorithms_8inc_source.html#l00864">checkForCloneExecution()</a>, <a class="el" href="daedatabase__db_8inc_source.html#l00053">getDAEDatabase()</a>, <a class="el" href="dae__service__algorithms_8inc_source.html#l00812">hook_algorithm()</a>, <a class="el" href="dae__service__algorithms_8inc_source.html#l00718">registerProvenanceFailure()</a>, <a class="el" href="dae__service__algorithms_8inc_source.html#l00581">registerProvenanceStart()</a>, <a class="el" href="dae__service__algorithms_8inc_source.html#l00740">registerProvenanceStop()</a>, <a class="el" href="daedatabase__db_8inc_source.html#l00874">retrieveAlgorithmSOAPOutputTypes()</a>, and <a class="el" href="daedatabase__db_8inc_source.html#l00866">retrieveAlgortithmInfo()</a>.</p>

</div>
</div>
<a class="anchor" id="ab62b940b91d3cf0bcc80e4e52cbf5740"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#ab62b940b91d3cf0bcc80e4e52cbf5740">checkForCloneExecution</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>runId</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function will check if the ALGORTITHM_RUN with id <em>$runId</em> has a 'clone' (i.e. the execution of the same algorithm with the exact same input parameters)</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">$runId</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>the ALGORTITHM_RUN.id of a clone if one exists</dd></dl>
<p>Behavior is undefined if multiple clones exist, but a valid id will allways be returned in that case. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000076">Todo:</a></b></dt><dd>Finding the clone executions is currently only partially working. Since the framework doesn't register foreign input parameters, and since we can have optional parameters as well, there is an ambiguity as to know whether an algorithm was run with default arguments or whether some of these arguments were exeternal parameters. </dd></dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00864">864</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>References <a class="el" href="daedatabase__db_8inc_source.html#l00053">getDAEDatabase()</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00937">callback()</a>.</p>

</div>
</div>
<a class="anchor" id="a42144ea79ed3da423fa751e50321f4cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#a42144ea79ed3da423fa751e50321f4cc">createDataItem</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>dataType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enter description here ... </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">unknown_type</td><td class="paramname">$data</td><td></td></tr>
    <tr><td class="paramtype">unknown_type</td><td class="paramname">$dataType</td><td></td></tr>
    <tr><td class="paramtype">unknown_type</td><td class="paramname">$flag</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000045">Todo:</a></b></dt><dd>This function should also register a standard Copyright value. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000046">Todo:</a></b></dt><dd>Associate contributor information to newly generated data using the 'contribute' relation </dd></dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00062">62</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>References <a class="el" href="daedatabase__db_8inc_source.html#l00053">getDAEDatabase()</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00136">registerDataItem()</a>.</p>

</div>
</div>
<a class="anchor" id="aee0fe32993e3a353eb690c5142c75b77"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#aee0fe32993e3a353eb690c5142c75b77">files_identical</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>fn1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>fn2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The following code was taken from <a href="http://php.net/manual/en/function.md5-file.php">http://php.net/manual/en/function.md5-file.php</a></p>
<p>Enter description here ... </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">unknown_type</td><td class="paramname">$fn1</td><td></td></tr>
    <tr><td class="paramtype">unknown_type</td><td class="paramname">$fn2</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00022">22</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00277">findDataItemToRegister()</a>.</p>

</div>
</div>
<a class="anchor" id="a47c3b6ab26d87386019896ac855c14c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#a47c3b6ab26d87386019896ac855c14c3">findDataItemToRegister</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>dataType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>dataTypeId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>dataId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>runId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function is called when a registered web service is executed. It is called once for each individual input argument to the web service.</p>
<p>The input parameters of this fuction define the given input argument to the web service. It checks whether the argument is already existant (registered) in the DAE database and returns its data_item.id value if it is. The function returns -1 if the argument is currently unregistered in the database.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$dataType</td><td>contains the class of data (page_image, files, argument ...) as per datatype.data_item_type </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$dataTypeId</td><td>contains the ID of the datatype under consideration </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$dataId</td><td>contains the ID of the data under consideration </td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$value</td><td>contains the value of the data_item under consideration </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$runId</td><td>the Oracle database identifier of the currenr algorithm run</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>the data_item.id value if the specified parameters correspond to an existing object in the DAE database; returns -1 if they don't correspond to an existing object; returns NULL if an error occurs. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000062">Todo:</a></b></dt><dd>find out what to do when algorithms are run on remote data and how to store the information</dd></dl>
<p>One of the possible things would be to check if the referenced image path (URL) is already stored in the database. Register it if it isn't, and then use it as a local reference.</p>
<p>The major question here is 'Copyright'. Although we do not store the image locally (only the URL pointing to it) derived content may eventually get stored.</p>
<p>Also, there is no guarantee that the referenced URL remains accessible for the remaining duration of the whole platform's life. </p>
<div class="fragment"><pre class="fragment">            </pre></div><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000063">Todo:</a></b></dt><dd>Make '/dae/database' appear somewhere in the configuration variables </dd></dl>
<p>Second -</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000064">Todo:</a></b></dt><dd>check its type validity </dd></dl>
<p>The data_item is present in the database but has no registered links with the required data or datatype values</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000065">Todo:</a></b></dt><dd>decide on a coherent policy to handle strangely referenced inputs.</dd></dl>
<p>Currently we'll just log a message and return the id</p>
<p>This configuration should be impossible ... how can a registered algorithm argument not belong to a valid 'dataType' ?</p>
<p>Currently we're assuming in this case that this means that the argument is of type 'argument'</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000066">Todo:</a></b></dt><dd>implement the 'argument' insertion when running an algorithm. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000067">Todo:</a></b></dt><dd>raise an exception </dd></dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00277">277</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>References <a class="el" href="dae__service__algorithms_8inc_source.html#l00022">files_identical()</a>, <a class="el" href="daedatabase__db_8inc_source.html#l00053">getDAEDatabase()</a>, and <a class="el" href="dae__service__algorithms_8inc_source.html#l00103">localCopy()</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00581">registerProvenanceStart()</a>.</p>

</div>
</div>
<a class="anchor" id="a26c3aa6703f4a604cd815e4a8d3e53fb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#a26c3aa6703f4a604cd815e4a8d3e53fb">hook_algorithm</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>aid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>aname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>args1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>args2</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Looks for and calls hooks for the specified algorithm based on both the name of the algorithm and the algorithm's ID.</p>
<p>Example: For $aid = 124 and $aname = "Kanungo Degradation_1.0", this function will call hook_124 AND hook_kanungo_degradation_1_0. Keep this in mind when writing functions.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">$aid</td><td>- the integer ID of the algorithm </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">$aname</td><td>- the name of the algorithm with _&lt;version&gt; </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">$args1</td><td>- argument(s) for the hook function hook_&lt;name&gt; and hook_&lt;id&gt; if $args2 is not specified </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">$args2</td><td>- argument(s) for the hook function if different for hook_&lt;id&gt;</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>true if a hook is called, false if no hook is found </dd></dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00812">812</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00937">callback()</a>.</p>

</div>
</div>
<a class="anchor" id="ae3c92df5fecebdf192d72f8495b0f66f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#ae3c92df5fecebdf192d72f8495b0f66f">localCopy</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>localname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This is a workaround to some restriction on the Solaris CSW PhP version, not being able to have remote copy() execution. This fuction copies <em>$value</em> (presumably remote, but not necessary) to <em>$localname</em>. It first tries to invoke the standard copy() function. If that fails it makes a call to <em>wget</em> using a system() call.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">$value</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">$localname</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>Name of localy created file</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000047">Todo:</a></b></dt><dd>Make this function a bit more secure by checking the parameters correctly, as well as checking the correct execution and the result of each step. </dd></dl>
<p>Note that the "allow_url_fopen = On" should be set in php.ini for copy to work accross the network (and even then you still can get surprises)</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000048">Todo:</a></b></dt><dd>Get rid of this hard coded /opt/csw/bin path </dd></dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00103">103</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00277">findDataItemToRegister()</a>, <a class="el" href="dae__service__algorithms_8inc_source.html#l00136">registerDataItem()</a>, and <a class="el" href="dae__service__algorithms_8inc_source.html#l00581">registerProvenanceStart()</a>.</p>

</div>
</div>
<a class="anchor" id="a884daac4bab3284843ca957a07caf7a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#a884daac4bab3284843ca957a07caf7a6">registerDataItem</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>dataType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>dataTypeId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>dataId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>remoteData</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$dataType</td><td></td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$dataTypeId</td><td></td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$dataId</td><td></td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$value</td><td></td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$remoteData</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000049">Todo:</a></b></dt><dd>All folowing code should be put in coherence with existing Oracle triggers and procedures used for uploading datasets </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000050">Todo:</a></b></dt><dd>Make '/dae/database' appear somewhere in the configuration variables </dd></dl>
<p>Note that the "allow_url_fopen = On" should be set in php.ini for copy to work accross the network (and even then you still can get surprises)</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000051">Todo:</a></b></dt><dd>Check parameters for malevolant actions like passing /etc/passwd </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000052">Todo:</a></b></dt><dd>check whether this insert does not return any error ! </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000053">Todo:</a></b></dt><dd>check whether this insert does not return any error ! </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000054">Todo:</a></b></dt><dd>generate the thumbnails in the database </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000055">Todo:</a></b></dt><dd>Also store the 'mime' field obtained from getimagesize as a datatype associated to the page_image </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000056">Todo:</a></b></dt><dd>Manage page_element insertion after execution </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000057">Todo:</a></b></dt><dd>All folowing code should be put in coherence with existing Oracle triggers and procedures used for uploading datasets </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000058">Todo:</a></b></dt><dd>Make '/dae/database' appear somewhere in the configuration variables </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000059">Todo:</a></b></dt><dd>Check parameters for malevolant actions like passing /etc/passwd </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000060">Todo:</a></b></dt><dd>Manage dataset insertion after execution </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000061">Todo:</a></b></dt><dd>Manage page_element_property_value insertion after execution </dd></dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00136">136</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>References <a class="el" href="dae__service__algorithms_8inc_source.html#l00062">createDataItem()</a>, <a class="el" href="daedatabase__db_8inc_source.html#l00053">getDAEDatabase()</a>, and <a class="el" href="dae__service__algorithms_8inc_source.html#l00103">localCopy()</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00740">registerProvenanceStop()</a>.</p>

</div>
</div>
<a class="anchor" id="a2cd33a4cacd4e10b7744b17aff52c4cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#a2cd33a4cacd4e10b7744b17aff52c4cb">registerProvenanceFailure</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>inserted_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>algoId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">$insertedId</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">$algoId</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00718">718</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>References <a class="el" href="daedatabase__db_8inc_source.html#l00053">getDAEDatabase()</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00937">callback()</a>.</p>

</div>
</div>
<a class="anchor" id="a73554be1e83e1c110a1c5334597f0620"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#a73554be1e83e1c110a1c5334597f0620">registerProvenanceStart</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>algoId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;$&#160;</td>
          <td class="paramname"><em>callParameters</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>quarantainedExecutionProxy</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Registers all provenance information with respect of the staring of a run of the algorithm defined by <em>$algoId</em> and with input parameters <em>$callParameters</em>.</p>
<p>This function will check if the $callParameters are already present in the DAE Oracle database, and will update the following tables:</p>
<ul>
<li>ALGORITHM_RUN</li>
<li>ALGORITHM_RUN_OF</li>
<li>EXECUTES_RUN</li>
<li>ALGORITHM_RUN_INPUT</li>
<li>INPUT_CONFIGURATION</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000068">Todo:</a></b></dt><dd><p class="startdd">Currently, the INSTANCE_OF table is not updated. </p>
<p class="enddd">Currently, input data of type <em>dataset</em>, <em>page_element</em>, <em>page_element_property_value</em> are not handled appropriately (actually ... they are ignored)</p>
</dd></dl>
<p>If execution is to be quarantained, the input data referenced in <em>$callParameters</em> is copied to the quarantaine exchange area, and paths/URLs in <em>$callParameters</em> are updated accordingly.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">$algoId</td><td><em>string</em> indentifier of algorithm being run </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">$callParameters</td><td><em>mixed</em> associative array of input values, indexed by DATA.id </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">$quarantainedExecutionProxy</td><td><em>boolean</em> (default = <em>NULL</em>) flag indicating if execution is quarantained </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000069">Todo:</a></b></dt><dd>We're assuming here there will be at most one row returned by this query (i.e. any data has at most one datatype) We should check if this is always true ! </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000070">Todo:</a></b></dt><dd>Adapt to new data model with input_configuration and remove references to ALGORITHM_RUN_INPUT (obsoleted) </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000071">Todo:</a></b></dt><dd>Check existence in INSTANCE_OF table and update with following instruction if necessary (i.e. not already present) </dd></dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00581">581</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>References <a class="el" href="algorithms__run_8inc_source.html#l00029">$user</a>, <a class="el" href="dae__service__algorithms_8inc_source.html#l00277">findDataItemToRegister()</a>, <a class="el" href="daedatabase__db_8inc_source.html#l00053">getDAEDatabase()</a>, <a class="el" href="dae__data__person_8inc_source.html#l00055">getPID()</a>, and <a class="el" href="dae__service__algorithms_8inc_source.html#l00103">localCopy()</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00937">callback()</a>.</p>

</div>
</div>
<a class="anchor" id="abc05dd5e1cbde7f18b907923908450af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dae__service__algorithms_8inc.html#abc05dd5e1cbde7f18b907923908450af">registerProvenanceStop</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>inserted_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>algoId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;$&#160;</td>
          <td class="paramname"><em>callParameters</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">$insertedId</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">$algoId</td><td></td></tr>
    <tr><td class="paramdir"></td><td class="paramname">[in/out]</td><td>&amp;$callParameters</td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000072">Todo:</a></b></dt><dd>Getting this function right is far more complex than it might seem. One has to take into account two kinds of situations. The first case concerns all-local input data; in which case output data should be stored into the data base with full provenance. The second case is partially local data or completely external data (non-locally hosted), in which case it is tricky to store the results and full provenance (mainly for Copyright reasons). </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000073">Todo:</a></b></dt><dd>We're assuming here there will be at most one row returned by this query (i.e. any data has at most one datatype) We should check if this is always true ! </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000074">Todo:</a></b></dt><dd>Adapt to new data model with input_configuration and remove references to ALGORITHM_RUN_OUTPUT (obsoleted) </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000075">Todo:</a></b></dt><dd>Check existence in INSTANCE_OF table and update with following instruction if necessary (i.e. not already present) </dd></dl>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00740">740</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

<p>References <a class="el" href="daedatabase__db_8inc_source.html#l00053">getDAEDatabase()</a>, and <a class="el" href="dae__service__algorithms_8inc_source.html#l00136">registerDataItem()</a>.</p>

<p>Referenced by <a class="el" href="dae__service__algorithms_8inc_source.html#l00937">callback()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a907d78797a1b764e913b0c565a5097b0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">global $db</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Access a DAE algorithm by wsdl. </p>

<p>Definition at line <a class="el" href="dae__service__algorithms_8inc_source.html#l00008">8</a> of file <a class="el" href="dae__service__algorithms_8inc_source.html">dae_service_algorithms.inc</a>.</p>

</div>
</div>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 9 2012 10:33:42 for DAEDrupalInterface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
