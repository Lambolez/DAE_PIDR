<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DAEDrupalInterface: modules/dae_data/dae_data_browse.inc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DAEDrupalInterface
   &#160;<span id="projectnumber">1.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">modules/dae_data/dae_data_browse.inc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="dae__data__browse_8inc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00029"></a>00029 require_once(<span class="stringliteral">&quot;./&quot;</span>.drupal_get_path(<span class="stringliteral">&#39;module&#39;</span>,<span class="stringliteral">&#39;dae_data&#39;</span>).<span class="stringliteral">&quot;/dae_data_operations.inc&quot;</span>);
<a name="l00030"></a>00030 
<a name="l00053"></a><a class="code" href="dae__data__browse_8inc.html#ae66f86323341361635459f06bda55db5">00053</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#ae66f86323341361635459f06bda55db5">dae_data_browse</a>()
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055         <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a> = <a class="code" href="daedatabase__db_8inc.html#a87f09fb608629e6696b53ec65183dd2b" title="Get access to the current DAEDatabase instance.">getDAEDatabase</a>();
<a name="l00056"></a>00056         $filter = $_GET[<span class="stringliteral">&#39;filter&#39;</span>]; <span class="comment">//Only show datasets, root datasets, etc</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058         $pagination = <a class="code" href="dae__data__browse_8inc.html#a89b7d8e00ab32d4580ff425ce71d7ee9">dae_data_pagination</a>(variable_get(<span class="stringliteral">&#39;dae_data_per_page&#39;</span>, 10)); <span class="comment">//gets requested per_page and page number or uses defaults</span>
<a name="l00059"></a>00059         extract($pagination);
<a name="l00060"></a>00060         
<a name="l00061"></a>00061         $browse_by = arg(1);
<a name="l00062"></a>00062         $page_limit = <span class="stringliteral">&quot;WHERE RN &gt; &quot;</span>.($per*($page-1)).<span class="stringliteral">&quot; AND RN &lt;= &quot;</span>.$per*$page;
<a name="l00063"></a>00063         $variables = array();
<a name="l00064"></a>00064 
<a name="l00065"></a>00065         <span class="keywordflow">switch</span>($browse_by) {
<a name="l00066"></a>00066                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;top-rated&quot;</span>:
<a name="l00067"></a>00067                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;SELECT&#39;</span>]        = <span class="stringliteral">&quot;SELECT DATA_ITEM, NAME, SUM(RATING)/COUNT(RATING) AS AVG_RATING, &#39;DATASET&#39; AS TYPE&quot;</span>;
<a name="l00068"></a>00068                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;FROM&#39;</span>]          = <span class="stringliteral">&quot;FROM DAE_DATAITEM_RATING JOIN DATASET ON DATA_ITEM = ID&quot;</span>;
<a name="l00069"></a>00069                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;GROUP&#39;</span>]         = <span class="stringliteral">&quot;GROUP BY DATA_ITEM, NAME&quot;</span>;
<a name="l00070"></a>00070                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]         = <span class="stringliteral">&quot;WHERE NAME IS NOT NULL&quot;</span>;
<a name="l00071"></a>00071                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;ORDER&#39;</span>]                 = <span class="stringliteral">&quot;ORDER BY AVG_RATING DESC&quot;</span>; 
<a name="l00072"></a>00072                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;SELECT&#39;</span>] = <span class="stringliteral">&quot;SELECT DATA_ITEM, PATH AS NAME, SUM(RATING)/COUNT(RATING) AS AVG_RATING, &#39;PAGE_IMAGE&#39; AS TYPE&quot;</span>;
<a name="l00073"></a>00073                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;FROM&#39;</span>]   = <span class="stringliteral">&quot;FROM DAE_DATAITEM_RATING JOIN PAGE_IMAGE ON DATA_ITEM = ID&quot;</span>;
<a name="l00074"></a>00074                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]  = <span class="stringliteral">&quot;WHERE PATH IS NOT NULL&quot;</span>;
<a name="l00075"></a>00075                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;GROUP&#39;</span>]  = <span class="stringliteral">&quot;GROUP BY DATA_ITEM, PATH&quot;</span>; 
<a name="l00076"></a>00076                         $queries[<span class="stringliteral">&#39;ROOTS&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]       = <span class="stringliteral">&quot;WHERE ID NOT IN (SELECT ASSOCIATING_DATASET_ID FROM ASSOCIATE_DATASET) AND NAME IS NOT NULL&quot;</span>; <span class="comment">//clause when querying root datasets</span>
<a name="l00077"></a>00077                         $queries[<span class="stringliteral">&#39;ROW_NUMBERED&#39;</span>]         = <span class="stringliteral">&quot;SELECT DATA_ITEM, NAME, AVG_RATING, TYPE, ROW_NUMBER() OVER(ORDER BY AVG_RATING DESC) AS RN FROM(&quot;</span>;
<a name="l00078"></a>00078                         <span class="keywordflow">break</span>;
<a name="l00079"></a>00079                         
<a name="l00080"></a>00080                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;popular&quot;</span>: 
<a name="l00081"></a>00081                         
<a name="l00082"></a>00082                         $days = <a class="code" href="dae__data__browse_8inc.html#ac15beea641a3bce21baf54430897809d">dae_data_popular_interval</a>($default = 30); <span class="comment">//get interval to measure over</span>
<a name="l00083"></a>00083                         settype($days,<span class="stringliteral">&#39;integer&#39;</span>);
<a name="l00084"></a>00084                         
<a name="l00085"></a>00085                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;SELECT&#39;</span>]        = <span class="stringliteral">&quot;SELECT DATA_ITEM, NAME, SUM(ACTIVITY) AS TOTAL, &#39;DATASET&#39; AS TYPE&quot;</span>;
<a name="l00086"></a>00086                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;FROM&#39;</span>]          = <span class="stringliteral">&quot;FROM DAE_DATAITEM_POPULAR JOIN DATASET ON DATA_ITEM = ID&quot;</span>;
<a name="l00087"></a>00087                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;GROUP&#39;</span>]         = <span class="stringliteral">&quot;GROUP BY DATA_ITEM, NAME&quot;</span>;
<a name="l00088"></a>00088                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]         = <span class="stringliteral">&quot;WHERE ROUND(SYSDATE-POPULAR_DATE) &lt; $days&quot;</span>;
<a name="l00089"></a>00089                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;ORDER&#39;</span>]                 = <span class="stringliteral">&quot;ORDER BY TOTAL DESC&quot;</span>;
<a name="l00090"></a>00090                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;SELECT&#39;</span>] = <span class="stringliteral">&quot;SELECT DATA_ITEM, PATH AS NAME, SUM(ACTIVITY) AS TOTAL, &#39;PAGE_IMAGE&#39; AS TYPE&quot;</span>;
<a name="l00091"></a>00091                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;FROM&#39;</span>]   = <span class="stringliteral">&quot;FROM DAE_DATAITEM_POPULAR JOIN PAGE_IMAGE ON DATA_ITEM = ID&quot;</span>;
<a name="l00092"></a>00092                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]  = <span class="stringliteral">&quot;WHERE ROUND(SYSDATE-POPULAR_DATE) &lt; $days AND PATH IS NOT NULL&quot;</span>;
<a name="l00093"></a>00093                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;GROUP&#39;</span>]  = <span class="stringliteral">&quot;GROUP BY DATA_ITEM, PATH&quot;</span>;
<a name="l00094"></a>00094                         $queries[<span class="stringliteral">&#39;ROOTS&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]       = <span class="stringliteral">&quot;WHERE ID NOT IN (SELECT ASSOCIATING_DATASET_ID FROM ASSOCIATE_DATASET) AND ROUND(SYSDATE-POPULAR_DATE) &lt; $days AND NAME IS NOT NULL&quot;</span>;
<a name="l00095"></a>00095                         $queries[<span class="stringliteral">&#39;ROW_NUMBERED&#39;</span>]         = <span class="stringliteral">&quot;SELECT DATA_ITEM, NAME, TOTAL, TYPE, ROW_NUMBER() OVER(ORDER BY TOTAL DESC) AS RN FROM(&quot;</span>;
<a name="l00096"></a>00096                         
<a name="l00097"></a>00097                         <span class="keywordflow">break</span>;
<a name="l00098"></a>00098                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;tags&quot;</span>:
<a name="l00099"></a>00099                         $tag = check_plain(arg(2));
<a name="l00100"></a>00100                         drupal_set_title(t(<span class="stringliteral">&quot;Browse Data with Tag %t&quot;</span>, array(<span class="stringliteral">&quot;%t&quot;</span> =&gt; $tag)));
<a name="l00101"></a>00101                         $browse_by = <span class="stringliteral">&quot;tags/$tag&quot;</span>;
<a name="l00102"></a>00102                         
<a name="l00103"></a>00103                         $variables[<span class="stringliteral">&#39;:tag&#39;</span>] = $tag;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;SELECT&#39;</span>]        = <span class="stringliteral">&quot;SELECT DATASET.ID AS DATA_ITEM, NAME, &#39;DATASET&#39; AS TYPE&quot;</span>;
<a name="l00106"></a>00106                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;FROM&#39;</span>]          = <span class="stringliteral">&quot;FROM TAG JOIN ASSOCIATE_DATA_ITEM_TAG ON TAG.ID = TAG_ID JOIN DATASET ON DATASET.ID = DATA_ITEM_ID&quot;</span>;
<a name="l00107"></a>00107                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;GROUP&#39;</span>]         = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00108"></a>00108                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]         = <span class="stringliteral">&quot;WHERE VALUE = :tag AND NAME IS NOT NULL&quot;</span>;
<a name="l00109"></a>00109                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;ORDER&#39;</span>]                 = <span class="stringliteral">&quot;ORDER BY NAME&quot;</span>;
<a name="l00110"></a>00110                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;SELECT&#39;</span>] = <span class="stringliteral">&quot;SELECT DATA_ITEM_ID AS DATA_ITEM, PATH AS NAME, &#39;PAGE_IMAGE&#39; AS TYPE&quot;</span>;
<a name="l00111"></a>00111                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;FROM&#39;</span>]   = <span class="stringliteral">&quot;FROM TAG JOIN ASSOCIATE_DATA_ITEM_TAG ON TAG.ID = TAG_ID JOIN PAGE_IMAGE ON DATA_ITEM_ID = PAGE_IMAGE.ID&quot;</span>;
<a name="l00112"></a>00112                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;GROUP&#39;</span>]  = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00113"></a>00113                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]  = <span class="stringliteral">&quot;WHERE VALUE = :tag AND PATH IS NOT NULL&quot;</span>;
<a name="l00114"></a>00114                         $queries[<span class="stringliteral">&#39;ROOTS&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]       = <span class="stringliteral">&quot;WHERE VALUE = :tag AND ID NOT IN (SELECT ASSOCIATING_DATASET_ID FROM ASSOCIATE_DATASET) AND NAME IS NOT NULL&quot;</span>;
<a name="l00115"></a>00115                         $queries[<span class="stringliteral">&#39;ROW_NUMBERED&#39;</span>]         = <span class="stringliteral">&quot;SELECT DATA_ITEM, NAME, TYPE, ROW_NUMBER() OVER(ORDER BY DATA_ITEM DESC) AS RN FROM(&quot;</span>;
<a name="l00116"></a>00116                         <span class="keywordflow">break</span>;
<a name="l00117"></a>00117                 <span class="keywordflow">default</span>:
<a name="l00118"></a>00118                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;new&quot;</span>:
<a name="l00119"></a>00119                         $browse_by = <span class="stringliteral">&quot;new&quot;</span>;
<a name="l00120"></a>00120                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;SELECT&#39;</span>]        = <span class="stringliteral">&quot;SELECT ID AS DATA_ITEM, NAME, &#39;DATASET&#39; AS TYPE&quot;</span>;
<a name="l00121"></a>00121                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;FROM&#39;</span>]          = <span class="stringliteral">&quot;FROM DATASET&quot;</span>;
<a name="l00122"></a>00122                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;GROUP&#39;</span>]         = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00123"></a>00123                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]         = <span class="stringliteral">&quot;WHERE NAME IS NOT NULL&quot;</span>;
<a name="l00124"></a>00124                         $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;ORDER&#39;</span>]                 = <span class="stringliteral">&quot;ORDER BY DATA_ITEM DESC&quot;</span>;
<a name="l00125"></a>00125                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;SELECT&#39;</span>] = <span class="stringliteral">&quot;SELECT ID AS DATA_ITEM, PATH AS NAME, &#39;PAGE_IMAGE&#39; AS TYPE&quot;</span>;
<a name="l00126"></a>00126                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;FROM&#39;</span>]   = <span class="stringliteral">&quot;FROM PAGE_IMAGE&quot;</span>;
<a name="l00127"></a>00127                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]  = <span class="stringliteral">&quot;WHERE PATH IS NOT NULL&quot;</span>;
<a name="l00128"></a>00128                         $queries[<span class="stringliteral">&#39;PAGE_IMAGE&#39;</span>][<span class="stringliteral">&#39;GROUP&#39;</span>]  = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00129"></a>00129                         $queries[<span class="stringliteral">&#39;ROOTS&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]       = <span class="stringliteral">&quot;WHERE ID NOT IN (SELECT ASSOCIATING_DATASET_ID FROM ASSOCIATE_DATASET) AND NAME IS NOT NULL&quot;</span>;
<a name="l00130"></a>00130                         $queries[<span class="stringliteral">&#39;ROW_NUMBERED&#39;</span>]         = <span class="stringliteral">&quot;SELECT DATA_ITEM, NAME, TYPE, ROW_NUMBER() OVER(ORDER BY DATA_ITEM DESC) AS RN FROM(&quot;</span>;
<a name="l00131"></a>00131                         <span class="keywordflow">break</span>;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133         
<a name="l00134"></a>00134         <span class="keywordflow">switch</span>($filter)
<a name="l00135"></a>00135         {
<a name="l00136"></a>00136                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;roots&#39;</span>:
<a name="l00137"></a>00137                         $types = array(<span class="stringliteral">&quot;ROOTS&quot;</span>);
<a name="l00138"></a>00138                         <span class="keywordflow">break</span>;
<a name="l00139"></a>00139                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;datasets&#39;</span>:
<a name="l00140"></a>00140                         $types = array(<span class="stringliteral">&quot;DATASET&quot;</span>);
<a name="l00141"></a>00141                         <span class="keywordflow">break</span>;
<a name="l00142"></a>00142                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;page_images&#39;</span>:
<a name="l00143"></a>00143                         $types = array(<span class="stringliteral">&quot;PAGE_IMAGE&quot;</span>);
<a name="l00144"></a>00144                         <span class="keywordflow">break</span>;
<a name="l00145"></a>00145                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;all&#39;</span>:
<a name="l00146"></a>00146                         $types = array(<span class="stringliteral">&quot;DATASET&quot;</span>,<span class="stringliteral">&quot;PAGE_IMAGE&quot;</span>);
<a name="l00147"></a>00147                         <span class="keywordflow">break</span>;
<a name="l00148"></a>00148                 <span class="keywordflow">default</span>:
<a name="l00149"></a>00149                         <span class="keywordflow">if</span>($browse_by == <span class="stringliteral">&quot;new&quot;</span>)
<a name="l00150"></a>00150                                 $types = array(<span class="stringliteral">&quot;ROOTS&quot;</span>);
<a name="l00151"></a>00151                         <span class="keywordflow">else</span>
<a name="l00152"></a>00152                                 $types = array(<span class="stringliteral">&quot;DATASET&quot;</span>,<span class="stringliteral">&quot;PAGE_IMAGE&quot;</span>); <span class="comment">//List of queries to build</span>
<a name="l00153"></a>00153                         <span class="keywordflow">break</span>;
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155         
<a name="l00156"></a>00156         <span class="keywordflow">foreach</span>($types as $type):
<a name="l00157"></a>00157                 $query[] .= (!empty($queries[$type][<span class="stringliteral">&#39;SELECT&#39;</span>])?$queries[$type][<span class="stringliteral">&#39;SELECT&#39;</span>]:$queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;SELECT&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>.
<a name="l00158"></a>00158                                     (!empty($queries[$type][<span class="stringliteral">&#39;FROM&#39;</span>])?$queries[$type][<span class="stringliteral">&#39;FROM&#39;</span>]:$queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;FROM&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>.
<a name="l00159"></a>00159                                     (!empty($queries[$type][<span class="stringliteral">&#39;WHERE&#39;</span>])?$queries[$type][<span class="stringliteral">&#39;WHERE&#39;</span>]:$queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;WHERE&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>.
<a name="l00160"></a>00160                                     (!empty($queries[$type][<span class="stringliteral">&#39;GROUP&#39;</span>])?$queries[$type][<span class="stringliteral">&#39;GROUP&#39;</span>]:$queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;GROUP&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>;
<a name="l00161"></a>00161         endforeach;
<a name="l00162"></a>00162         
<a name="l00163"></a>00163         $query = implode(<span class="stringliteral">&quot;UNION &quot;</span>,$query) . $queries[<span class="stringliteral">&#39;ALL&#39;</span>][<span class="stringliteral">&#39;ORDER&#39;</span>]; <span class="comment">//turn array of queries into a single unioned query</span>
<a name="l00164"></a>00164         
<a name="l00166"></a>00166         $count = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;r(<span class="stringliteral">&quot;SELECT COUNT(*) FROM (&quot;</span> . $query . <span class="stringliteral">&quot;)&quot;</span>,$variables); <span class="comment">//build a query that counts the unioned array for the total number of items</span>
<a name="l00167"></a>00167         
<a name="l00168"></a>00168         $paged_query = <span class="stringliteral">&quot;SELECT * FROM (&quot;</span> . $queries[<span class="stringliteral">&#39;ROW_NUMBERED&#39;</span>] . $query . <span class="stringliteral">&quot;) )&quot;</span> . $page_limit; <span class="comment">//select only the items for the given page</span>
<a name="l00169"></a>00169         
<a name="l00170"></a>00170         $pagination = array(<span class="stringliteral">&#39;count&#39;</span> =&gt; $count, <span class="stringliteral">&#39;per&#39;</span> =&gt; $per, <span class="stringliteral">&#39;page&#39;</span> =&gt; $page, <span class="stringliteral">&#39;browse_by&#39;</span> =&gt; $browse_by.<span class="stringliteral">&quot;/&quot;</span>.arg(2));
<a name="l00171"></a>00171         
<a name="l00172"></a>00172         $results[] = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;q($paged_query,$variables);
<a name="l00173"></a>00173         
<a name="l00174"></a>00174         <span class="keywordflow">return</span> <a class="code" href="dae__data__browse_8inc.html#a1ab5d81ede0078b56e0369f43fec333e">dae_data_display_datasets</a>($results,<a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>,$set[<span class="stringliteral">&#39;ordered_array&#39;</span>],$pagination);
<a name="l00175"></a>00175 }
<a name="l00185"></a><a class="code" href="dae__data__browse_8inc.html#ab83c6ca9c818474604a99ef7818ab880">00185</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#ab83c6ca9c818474604a99ef7818ab880">dae_data_get_drupal_db_list</a>(<a class="code" href="services_2examples_2authenticated__service_2soap__server__test_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>)
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187         $set = array();
<a name="l00188"></a>00188         <span class="keywordflow">while</span>($row = db_fetch_array(<a class="code" href="services_2examples_2authenticated__service_2soap__server__test_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>)):
<a name="l00189"></a>00189                 $set[] = $row[<span class="stringliteral">&#39;data_item&#39;</span>];
<a name="l00190"></a>00190         endwhile;
<a name="l00191"></a>00191         $output = array(<span class="stringliteral">&#39;ordered_array&#39;</span> =&gt; $set,<span class="stringliteral">&#39;query_text&#39;</span> =&gt; implode(<span class="stringliteral">&quot;,&quot;</span>,$set));
<a name="l00192"></a>00192         <span class="keywordflow">if</span>(empty($output[<span class="stringliteral">&#39;query_text&#39;</span>]))
<a name="l00193"></a>00193                 $output[<span class="stringliteral">&#39;query_text&#39;</span>] = 0;
<a name="l00194"></a>00194         <span class="keywordflow">return</span> $output;
<a name="l00195"></a>00195 }
<a name="l00206"></a><a class="code" href="dae__data__browse_8inc.html#a89b7d8e00ab32d4580ff425ce71d7ee9">00206</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#a89b7d8e00ab32d4580ff425ce71d7ee9">dae_data_pagination</a>($default_limit = 10)
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208         $page = $_GET[<span class="stringliteral">&#39;page&#39;</span>];
<a name="l00209"></a>00209         $per = $_GET[<span class="stringliteral">&#39;per_page&#39;</span>];
<a name="l00210"></a>00210         
<a name="l00211"></a>00211         <span class="keywordflow">if</span>(is_numeric($page) &amp;&amp; is_numeric($per) &amp;&amp; $page &gt; 0 &amp;&amp; $per &gt; 0 &amp;&amp; $per &lt; 101)
<a name="l00212"></a>00212                 <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;per&#39;</span> =&gt; $per,<span class="stringliteral">&#39;page&#39;</span> =&gt; $page);
<a name="l00213"></a>00213         elseif(is_numeric($per) &amp;&amp; $per &gt; 0 &amp;&amp; $per &lt; 101)
<a name="l00214"></a>00214                 <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;per&#39;</span> =&gt; $per,<span class="stringliteral">&#39;page&#39;</span> =&gt; 1);
<a name="l00215"></a>00215         elseif(is_numeric($page) &amp;&amp; $page &gt; 0)
<a name="l00216"></a>00216                 <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;per&#39;</span> =&gt; $default_limit,<span class="stringliteral">&#39;page&#39;</span> =&gt; $page);
<a name="l00217"></a>00217         <span class="keywordflow">else</span>
<a name="l00218"></a>00218                 <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;per&#39;</span> =&gt; $default_limit, <span class="stringliteral">&#39;page&#39;</span> =&gt; 1);
<a name="l00219"></a>00219 }
<a name="l00227"></a><a class="code" href="dae__data__browse_8inc.html#ac15beea641a3bce21baf54430897809d">00227</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#ac15beea641a3bce21baf54430897809d">dae_data_popular_interval</a>($default = 30)
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229         $interval = arg(2);
<a name="l00230"></a>00230         <span class="keywordflow">switch</span>($interval)
<a name="l00231"></a>00231         {
<a name="l00232"></a>00232                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;today&quot;</span>:
<a name="l00233"></a>00233                         <span class="keywordflow">return</span> 1;
<a name="l00234"></a>00234                         <span class="keywordflow">break</span>;
<a name="l00235"></a>00235                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;week&quot;</span>:
<a name="l00236"></a>00236                         <span class="keywordflow">return</span> 7;
<a name="l00237"></a>00237                         <span class="keywordflow">break</span>;
<a name="l00238"></a>00238                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;month&quot;</span>:
<a name="l00239"></a>00239                         <span class="keywordflow">return</span> 30;
<a name="l00240"></a>00240                         <span class="keywordflow">break</span>;
<a name="l00241"></a>00241                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;year&quot;</span>:
<a name="l00242"></a>00242                         <span class="keywordflow">return</span> 365;
<a name="l00243"></a>00243                         <span class="keywordflow">break</span>;
<a name="l00244"></a>00244                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;all-time&quot;</span>:
<a name="l00245"></a>00245                         <span class="keywordflow">return</span> 1000000;
<a name="l00246"></a>00246                         <span class="keywordflow">break</span>;
<a name="l00247"></a>00247                 <span class="keywordflow">default</span>:
<a name="l00248"></a>00248                         <span class="keywordflow">return</span> $default;
<a name="l00249"></a>00249                         <span class="keywordflow">break</span>;
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00264"></a><a class="code" href="dae__data__browse_8inc.html#aa630b07c564d649dcb83e6d8075d393c">00264</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#aa630b07c564d649dcb83e6d8075d393c">dae_data_browse_get_results</a>($data_items,$filter)
<a name="l00265"></a>00265 {
<a name="l00266"></a>00266         <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a> = <a class="code" href="daedatabase__db_8inc.html#a87f09fb608629e6696b53ec65183dd2b" title="Get access to the current DAEDatabase instance.">getDAEDatabase</a>();
<a name="l00267"></a>00267         
<a name="l00268"></a>00268         $variables[<span class="stringliteral">&#39;:dataitems&#39;</span>] = $data_items;
<a name="l00269"></a>00269         
<a name="l00270"></a>00270         <span class="keywordflow">switch</span>($filter)
<a name="l00271"></a>00271         {
<a name="l00272"></a>00272                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;datasets&quot;</span>:
<a name="l00273"></a>00273                         $results[] = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;q(<span class="stringliteral">&#39;select distinct NAME,ID from DATASET where ID in(:dataitems) and NAME is not null&#39;</span>, $variables);
<a name="l00274"></a>00274                         <span class="keywordflow">break</span>;
<a name="l00275"></a>00275                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;roots&quot;</span>:
<a name="l00276"></a>00276                         $results[] = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;q(<span class="stringliteral">&#39;select distinct NAME,ID from DATASET where ID not in (select ASSOCIATING_DATASET_ID from ASSOCIATE_DATASET) and ID in (:dataitems)  and NAME is not null&#39;</span>, $variables);
<a name="l00277"></a>00277                         <span class="keywordflow">break</span>;
<a name="l00278"></a>00278                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;page_images&quot;</span>:
<a name="l00279"></a>00279                         $results[] = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;q(<span class="stringliteral">&#39;select distinct PATH,ID from PAGE_IMAGE where ID in(:dataitems) and PATH is not null&#39;</span>, $variables);
<a name="l00280"></a>00280                         <span class="keywordflow">break</span>;
<a name="l00281"></a>00281                 <span class="keywordflow">default</span>:
<a name="l00282"></a>00282                         $results[] = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;q(<span class="stringliteral">&#39;select distinct NAME,ID from DATASET where ID in(:dataitems) and NAME is not null&#39;</span>, $variables);
<a name="l00283"></a>00283                         $results[] = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;q(<span class="stringliteral">&#39;select distinct PATH,ID from PAGE_IMAGE where ID in(:dataitems) and PATH is not null&#39;</span>, $variables);
<a name="l00284"></a>00284                         <span class="keywordflow">break</span>;
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286         <span class="keywordflow">return</span> $results;
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a><a class="code" href="dae__data__browse_8inc.html#a1b4ccc7beb2c97f8639968fa4257c4f9">00289</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#a1b4ccc7beb2c97f8639968fa4257c4f9">human_readable</a>($size) {
<a name="l00290"></a>00290  
<a name="l00291"></a>00291     $newsize = $size;
<a name="l00292"></a>00292     
<a name="l00293"></a>00293     $units = array(<span class="charliteral">&#39;B&#39;</span>,<span class="stringliteral">&#39;KB&#39;</span>,<span class="stringliteral">&#39;MB&#39;</span>,<span class="stringliteral">&#39;GB&#39;</span>,<span class="stringliteral">&#39;TB&#39;</span>);
<a name="l00294"></a>00294     <span class="keywordflow">for</span> ($i = 0; $newsize &gt; 1024; $i++) {
<a name="l00295"></a>00295         $newsize /= 1024;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     
<a name="l00298"></a>00298     <span class="keywordflow">return</span> round($newsize) . $units[$i];
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00311"></a><a class="code" href="dae__data__browse_8inc.html#a1ab5d81ede0078b56e0369f43fec333e">00311</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#a1ab5d81ede0078b56e0369f43fec333e">dae_data_display_datasets</a>(&amp;$results,&amp;<a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>,$order = array(),&amp;$pagination = array())
<a name="l00312"></a>00312 {
<a name="l00313"></a>00313         $i = 0;
<a name="l00314"></a>00314         require_once(drupal_get_path(<span class="stringliteral">&#39;module&#39;</span>,<span class="stringliteral">&#39;dae_data&#39;</span>).<span class="stringliteral">&quot;/dae_data_search.inc&quot;</span>);
<a name="l00315"></a>00315         <span class="comment">//$ui = new DataUI(drupal_get_form(&quot;dae_data_search_page&quot;),$pagination);</span>
<a name="l00316"></a>00316         
<a name="l00317"></a>00317         <span class="comment">//added by yil308 for dropdown list.</span>
<a name="l00318"></a>00318         <a class="code" href="dae__annotations__display_8inc.html#a688bb9e9ce51fd0b16bd9ff1d2094dd3">$ui</a> = <span class="keyword">new</span> <a class="code" href="classDataUI.html">DataUI</a>(drupal_get_form(<span class="stringliteral">&quot;dae_data_search_page_select&quot;</span>),$pagination);
<a name="l00319"></a>00319         
<a name="l00320"></a>00320         <span class="keywordflow">foreach</span>($results as <a class="code" href="services_2examples_2authenticated__service_2soap__server__test_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>):
<a name="l00321"></a>00321         
<a name="l00322"></a>00322                 <span class="keywordflow">while</span>($row = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;fetch_array($result)):
<a name="l00323"></a>00323                         
<a name="l00324"></a>00324                         <span class="keywordflow">if</span>(empty($row[<span class="stringliteral">&#39;VALUE&#39;</span>])){
<a name="l00325"></a>00325         $id = $row[<span class="stringliteral">&#39;DATA_ITEM&#39;</span>];
<a name="l00326"></a>00326         $name = $row[<span class="stringliteral">&#39;NAME&#39;</span>];
<a name="l00327"></a>00327         $activity = number_format(<a class="code" href="dae__data__browse_8inc.html#a467410bfd97127dcacfe10a8b9e00efb">dae_data_get_activity</a>($id,<a class="code" href="dae__data__browse_8inc.html#ac15beea641a3bce21baf54430897809d">dae_data_popular_interval</a>()));
<a name="l00328"></a>00328                                 <span class="keywordflow">if</span>($row[<span class="stringliteral">&#39;TYPE&#39;</span>] == <span class="stringliteral">&quot;DATASET&quot;</span>):
<a name="l00329"></a>00329           $s = <span class="keyword">new</span> <a class="code" href="classStarRating.html">StarRating</a>($id,<a class="code" href="dae__data_8module.html#ac3705e737824c4f6c2474c0715a7a7f9">dae_data_get_rating</a>($id,<span class="keyword">false</span>),<span class="keyword">false</span>,<span class="keyword">false</span>);
<a name="l00330"></a>00330           $stars = $s-&gt;getOutput();
<a name="l00331"></a>00331           $tags = <a class="code" href="dae__data__browse_8inc.html#a329871e7b65c7f2870543b9f1d915860">dae_data_get_tags</a>($id);
<a name="l00332"></a>00332                                         $info[<span class="stringliteral">&#39;output&#39;</span>] =
<a name="l00333"></a>00333             <span class="stringliteral">&quot;&lt;li class=\&quot;data-home-list-item\&quot; id=\&quot;&quot;</span>.$id.<span class="stringliteral">&quot;\&quot;&gt;</span>
<a name="l00334"></a>00334 <span class="stringliteral">              &lt;div class=\&quot;dae-data-browse-thumb\&quot;&gt;</span>
<a name="l00335"></a>00335 <span class="stringliteral">                                        &lt;div class=\&quot;dae-data-browse-thumb-align\&quot;&gt;&quot;</span>.
<a name="l00336"></a>00336                                                 l(<span class="stringliteral">&quot;&lt;img src=\&quot;&quot;</span>.drupal_get_path(<span class="stringliteral">&quot;module&quot;</span>,<span class="stringliteral">&quot;dae_ui&quot;</span>).
<a name="l00337"></a>00337                     <span class="stringliteral">&quot;/images/dae_data/dataset-thumb.jpg\&quot; alt=\&quot;\&quot; /&gt;&quot;</span>,<span class="stringliteral">&quot;browse/dataitem/&quot;</span>.$id,array(<span class="stringliteral">&#39;html&#39;</span> =&gt; <span class="keyword">true</span>)).<span class="stringliteral">&quot;</span>
<a name="l00338"></a>00338 <span class="stringliteral">                                        &lt;/div&gt;</span>
<a name="l00339"></a>00339 <span class="stringliteral">                                &lt;/div&gt;</span>
<a name="l00340"></a>00340 <span class="stringliteral">                                &lt;h3&gt;&quot;</span>.l($name, <span class="stringliteral">&quot;browse/dataitem/&quot;</span>.$id).<span class="stringliteral">&quot;&lt;/h3&gt;&lt;br&gt;&quot;</span>
<a name="l00341"></a>00341               .dae_dataset_preview($id).
<a name="l00342"></a>00342                                   $stars.
<a name="l00343"></a>00343                                 <span class="stringliteral">&quot;&lt;div class=\&quot;dae-data-activity\&quot;&gt;&quot;</span>.
<a name="l00344"></a>00344                                         $activity
<a name="l00345"></a>00345                                 .<span class="stringliteral">&quot;&lt;/div&gt;</span>
<a name="l00346"></a>00346 <span class="stringliteral">                                &lt;div class=\&quot;dae-data-tags\&quot;&gt;</span>
<a name="l00347"></a>00347 <span class="stringliteral">                                        &lt;h6&gt;TAGS: &lt;/h6&gt;&quot;</span>.
<a name="l00348"></a>00348                                         $tags
<a name="l00349"></a>00349                                 .<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>.
<a name="l00350"></a>00350                         <span class="stringliteral">&quot;&lt;/li&gt;&quot;</span>;
<a name="l00351"></a>00351                           elseif($row[<span class="stringliteral">&#39;TYPE&#39;</span>] == <span class="stringliteral">&quot;PAGE_IMAGE&quot;</span>):
<a name="l00352"></a>00352           $info[<span class="stringliteral">&#39;output&#39;</span>] =
<a name="l00353"></a>00353           <span class="stringliteral">&quot;&lt;div id=\&quot;dataitem-&quot;</span>.$id.<span class="stringliteral">&quot;\&quot; class=\&quot;dataset-item single-item\&quot;&gt;&quot;</span>.
<a name="l00354"></a>00354             <span class="stringliteral">&quot;&lt;div class=\&quot;item-container\&quot;&gt;&quot;</span>.
<a name="l00355"></a>00355               <span class="stringliteral">&quot;&lt;a class=\&quot;item-link\&quot; href=\&quot;&quot;</span>.base_path().<span class="stringliteral">&quot;?q=browse/dataitem/&quot;</span>.$id.<span class="stringliteral">&quot;\&quot;&gt;</span>
<a name="l00356"></a>00356 <span class="stringliteral">              &lt;img src=\&quot;&quot;</span>.<a class="code" href="dae__data_8module.html#a19a20dfcca0620d7fff6735ca5452053">dae_data_get_thumb_uri</a>($id, <span class="stringliteral">&#39;medium&#39;</span>).<span class="stringliteral">&quot;\&quot; alt=\&quot;\&quot; /&gt;</span>
<a name="l00357"></a>00357 <span class="stringliteral">              &lt;/a&gt;</span>
<a name="l00358"></a>00358 <span class="stringliteral">            &lt;span id=\&quot;name-&quot;</span>.$id.<span class="stringliteral">&quot;\&quot; title=\&quot;&quot;</span>.basename($name).<span class="stringliteral">&quot;\&quot; class=\&quot;item-title\&quot;&gt;&quot;</span>.basename($name).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>.
<a name="l00359"></a>00359             <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>.
<a name="l00360"></a>00360             <span class="stringliteral">&quot;&lt;div class=\&quot;item-info\&quot;&gt;&quot;</span>.
<a name="l00361"></a>00361               <span class="stringliteral">&quot;&lt;img src=\&quot;&quot;</span>.drupal_get_path(<span class="stringliteral">&quot;module&quot;</span>,<span class="stringliteral">&quot;dae_ui&quot;</span>).<span class="stringliteral">&quot;/images/ajax.gif\&quot;&gt;&quot;</span>.
<a name="l00362"></a>00362             <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>.
<a name="l00363"></a>00363           <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;
<a name="l00364"></a>00364                                 endif;
<a name="l00365"></a>00365                                 $info[<span class="stringliteral">&#39;id&#39;</span>] = $id;
<a name="l00366"></a>00366                                 $info[<span class="stringliteral">&#39;tags&#39;</span>] = $tags;
<a name="l00367"></a>00367                                 $info[<span class="stringliteral">&#39;activity&#39;</span>] = $activity;
<a name="l00368"></a>00368                                 $info[<span class="stringliteral">&#39;rating&#39;</span>] = <a class="code" href="dae__data_8module.html#ac3705e737824c4f6c2474c0715a7a7f9">dae_data_get_rating</a>($row[<span class="stringliteral">&#39;DATA_ITEM&#39;</span>],<span class="keyword">false</span>);
<a name="l00369"></a>00369                                 $info[<span class="stringliteral">&#39;stars&#39;</span>] = $stars;
<a name="l00370"></a>00370                                 
<a name="l00371"></a>00371                                 <a class="code" href="dae__annotations__display_8inc.html#a688bb9e9ce51fd0b16bd9ff1d2094dd3">$ui</a>-&gt;addDataitemRecord($info);
<a name="l00372"></a>00372                         }
<a name="l00373"></a>00373                         <span class="keywordflow">else</span>{
<a name="l00374"></a>00374                                 $info[<span class="stringliteral">&#39;name&#39;</span>] = l($row[<span class="stringliteral">&#39;VALUE&#39;</span>],<span class="stringliteral">&quot;browse/tags/&quot;</span>.$row[<span class="stringliteral">&#39;VALUE&#39;</span>]);
<a name="l00375"></a>00375                                 $info[<span class="stringliteral">&#39;id&#39;</span>] = $row[<span class="stringliteral">&#39;VALUE&#39;</span>];
<a name="l00376"></a>00376                                 $info[<span class="stringliteral">&#39;thumb_source&#39;</span>] = drupal_get_path(<span class="stringliteral">&quot;module&quot;</span>,<span class="stringliteral">&quot;dae_ui&quot;</span>).<span class="stringliteral">&quot;/images/dae_data/tag-thumb.jpg&quot;</span>;
<a name="l00377"></a>00377                                 <a class="code" href="dae__annotations__display_8inc.html#a688bb9e9ce51fd0b16bd9ff1d2094dd3">$ui</a>-&gt;addTagRecord($info);
<a name="l00378"></a>00378                         }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380                         unset($info);
<a name="l00381"></a>00381                 
<a name="l00382"></a>00382                 endwhile;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384         endforeach;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386         <span class="keywordflow">return</span> <a class="code" href="dae__annotations__display_8inc.html#a688bb9e9ce51fd0b16bd9ff1d2094dd3">$ui</a>-&gt;getOutput($order);
<a name="l00387"></a>00387 }
<a name="l00396"></a><a class="code" href="dae__data__browse_8inc.html#a467410bfd97127dcacfe10a8b9e00efb">00396</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#a467410bfd97127dcacfe10a8b9e00efb">dae_data_get_activity</a>($dataitem,$days)
<a name="l00397"></a>00397 {
<a name="l00398"></a>00398         <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a> = <a class="code" href="daedatabase__db_8inc.html#a87f09fb608629e6696b53ec65183dd2b" title="Get access to the current DAEDatabase instance.">getDAEDatabase</a>();
<a name="l00399"></a>00399         
<a name="l00400"></a>00400         settype($dataitem, <span class="stringliteral">&#39;integer&#39;</span>);
<a name="l00401"></a>00401         settype($days, <span class="stringliteral">&#39;integer&#39;</span>);
<a name="l00402"></a>00402         
<a name="l00403"></a>00403         $q = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;q(<span class="stringliteral">&quot;SELECT sum(ACTIVITY) A </span>
<a name="l00404"></a>00404 <span class="stringliteral">                                 FROM DAE_DATAITEM_POPULAR</span>
<a name="l00405"></a>00405 <span class="stringliteral">                                 WHERE ROUND(SYSDATE-POPULAR_DATE) &lt; $days AND DATA_ITEM = $dataitem </span>
<a name="l00406"></a>00406 <span class="stringliteral">                                 GROUP BY DATA_ITEM&quot;</span>,array());
<a name="l00407"></a>00407         $act = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;fetch_array($q);
<a name="l00408"></a>00408         <span class="keywordflow">if</span>(empty($act[<span class="charliteral">&#39;A&#39;</span>]))
<a name="l00409"></a>00409                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;0&quot;</span>;
<a name="l00410"></a>00410         <span class="keywordflow">else</span>
<a name="l00411"></a>00411                 <span class="keywordflow">return</span> $act[<span class="charliteral">&#39;A&#39;</span>];
<a name="l00412"></a>00412         
<a name="l00413"></a>00413 }
<a name="l00421"></a><a class="code" href="dae__data__browse_8inc.html#a329871e7b65c7f2870543b9f1d915860">00421</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#a329871e7b65c7f2870543b9f1d915860">dae_data_get_tags</a>($dataitem)
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423                 <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a> = <a class="code" href="daedatabase__db_8inc.html#a87f09fb608629e6696b53ec65183dd2b" title="Get access to the current DAEDatabase instance.">getDAEDatabase</a>();
<a name="l00424"></a>00424                 settype($dataitem, <span class="stringliteral">&#39;integer&#39;</span>);
<a name="l00425"></a>00425                 $tags = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;q(<span class="stringliteral">&quot;select VALUE from TAG join ASSOCIATE_DATA_ITEM_TAG on TAG_ID = ID where DATA_ITEM_ID = $dataitem&quot;</span>,array());
<a name="l00426"></a>00426                 
<a name="l00427"></a>00427                 <span class="keywordflow">while</span>($tagrow = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;fetch_array($tags)):
<a name="l00428"></a>00428                         $taglist[] = l($tagrow[<span class="stringliteral">&#39;VALUE&#39;</span>],<span class="stringliteral">&quot;browse/tags/&quot;</span>.$tagrow[<span class="stringliteral">&#39;VALUE&#39;</span>]);
<a name="l00429"></a>00429                 endwhile;
<a name="l00430"></a>00430                 
<a name="l00431"></a>00431                 <span class="keywordflow">if</span>(!count($taglist))
<a name="l00432"></a>00432                         $taglist = array(<span class="stringliteral">&#39;No Tags Yet&#39;</span>);
<a name="l00433"></a>00433                 
<a name="l00434"></a>00434                 <span class="keywordflow">return</span> implode(<span class="stringliteral">&quot;, &quot;</span>,$taglist);
<a name="l00435"></a>00435 }
<a name="l00442"></a><a class="code" href="dae__data__browse_8inc.html#a721b75fdc16059d7a5e233f636a2654a">00442</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#a721b75fdc16059d7a5e233f636a2654a">dae_data_browse_subset</a>()
<a name="l00443"></a>00443 {
<a name="l00444"></a>00444         <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a> = <a class="code" href="daedatabase__db_8inc.html#a87f09fb608629e6696b53ec65183dd2b" title="Get access to the current DAEDatabase instance.">getDAEDatabase</a>();
<a name="l00445"></a>00445         <a class="code" href="dae__annotations__display_8inc.html#a688bb9e9ce51fd0b16bd9ff1d2094dd3">$ui</a> = <span class="keyword">new</span> <a class="code" href="classDataUI.html">DataUI</a>(<span class="stringliteral">&quot;dae_data&quot;</span>);
<a name="l00446"></a>00446         
<a name="l00447"></a>00447         $subset = arg(2);
<a name="l00448"></a>00448         
<a name="l00449"></a>00449         <span class="keywordflow">if</span>(!<a class="code" href="dae__data_8module.html#a905c51e9581a4be53dbf28b948202baa">check_dataset_id</a>($subset))
<a name="l00450"></a>00450                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00451"></a>00451                 
<a name="l00452"></a>00452         settype($subset, <span class="stringliteral">&#39;integer&#39;</span>);
<a name="l00453"></a>00453         <a class="code" href="services_2examples_2authenticated__service_2soap__server__test_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;q(<span class="stringliteral">&quot;select distinct NAME,ID from DATASET,ASSOCIATE_DATASET where ASSOCIATING_DATASET_ID=ID and DATASET_ID=&quot;</span> . $subset,array());
<a name="l00454"></a>00454         
<a name="l00455"></a>00455         echo <a class="code" href="dae__data__browse_8inc.html#a1ab5d81ede0078b56e0369f43fec333e">dae_data_display_datasets</a>(<a class="code" href="services_2examples_2authenticated__service_2soap__server__test_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>,<a class="code" href="dae__annotations__display_8inc.html#a688bb9e9ce51fd0b16bd9ff1d2094dd3">$ui</a>,<a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>,$color);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 }
<a name="l00463"></a><a class="code" href="dae__data__browse_8inc.html#a200480267b2082e1c0a5525d5f026fb7">00463</a> <span class="keyword">function</span> <a class="code" href="dae__data__browse_8inc.html#a200480267b2082e1c0a5525d5f026fb7">dae_data_search_results_page</a>()
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465         $search = check_plain($_GET[<span class="charliteral">&#39;s&#39;</span>]);
<a name="l00466"></a>00466         
<a name="l00467"></a>00467         drupal_set_title(t(<span class="stringliteral">&quot;Search Results for %s&quot;</span>,array(<span class="stringliteral">&#39;%s&#39;</span> =&gt; $search)));
<a name="l00468"></a>00468         drupal_add_js(<span class="stringliteral">&quot;var search = &#39;$search&#39;;&quot;</span>,<span class="stringliteral">&#39;inline&#39;</span>);
<a name="l00469"></a>00469         <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a> = <a class="code" href="daedatabase__db_8inc.html#a87f09fb608629e6696b53ec65183dd2b" title="Get access to the current DAEDatabase instance.">getDAEDatabase</a>();
<a name="l00470"></a>00470         <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;page&#39;</span>] &lt;= 1)
<a name="l00471"></a>00471                 $results[] = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;searchTable(<span class="stringliteral">&#39;result&#39;</span>,$search,<span class="stringliteral">&quot;VALUE&quot;</span>,array(<span class="stringliteral">&quot;ID AS DATA_ITEM&quot;</span>, <span class="stringliteral">&quot;VALUE&quot;</span>, <span class="stringliteral">&quot;&#39;TAG&#39; AS TYPE&quot;</span>),<span class="stringliteral">&quot;TAG&quot;</span>,0,0);
<a name="l00472"></a>00472         $count = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;searchTable(<span class="stringliteral">&#39;count&#39;</span>,$search,<span class="stringliteral">&quot;NAME&quot;</span>,array(<span class="stringliteral">&quot;ID AS DATA_ITEM&quot;</span>, <span class="stringliteral">&quot;NAME&quot;</span>, <span class="stringliteral">&quot;&#39;TAG&#39; AS TYPE&quot;</span>),<span class="stringliteral">&quot;DATASET&quot;</span>,0,0,array(<span class="stringliteral">&#39;start&#39;</span> =&gt; <span class="keyword">true</span>, <span class="stringliteral">&#39;end&#39;</span> =&gt; <span class="keyword">true</span>));
<a name="l00473"></a>00473         $pagination = <a class="code" href="dae__data__browse_8inc.html#a89b7d8e00ab32d4580ff425ce71d7ee9">dae_data_pagination</a>(variable_get(<span class="stringliteral">&#39;dae_data_per_page&#39;</span>, 10));
<a name="l00474"></a>00474         extract($pagination);
<a name="l00475"></a>00475         $pagination = array(<span class="stringliteral">&#39;count&#39;</span> =&gt; $count, <span class="stringliteral">&#39;per&#39;</span> =&gt; $per, <span class="stringliteral">&#39;page&#39;</span> =&gt; $page, <span class="stringliteral">&#39;browse_by&#39;</span> =&gt; check_plain(arg(1).<span class="stringliteral">&quot;/&quot;</span>.arg(2)));
<a name="l00476"></a>00476         $results[] = <a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>-&gt;searchTable(<span class="stringliteral">&#39;result&#39;</span>,$search,<span class="stringliteral">&quot;NAME&quot;</span>,array(<span class="stringliteral">&quot;ID AS DATA_ITEM&quot;</span>, <span class="stringliteral">&quot;NAME&quot;</span>, <span class="stringliteral">&quot;&#39;DATASET&#39; AS TYPE&quot;</span>),<span class="stringliteral">&quot;DATASET&quot;</span>,($page-1)*$per,$page*$per,array(<span class="stringliteral">&#39;start&#39;</span> =&gt; <span class="keyword">true</span>, <span class="stringliteral">&#39;end&#39;</span> =&gt; <span class="keyword">true</span>));
<a name="l00477"></a>00477         <span class="keywordflow">return</span> <a class="code" href="dae__data__browse_8inc.html#a1ab5d81ede0078b56e0369f43fec333e">dae_data_display_datasets</a>($results,<a class="code" href="algorithms__execute_8inc.html#a907d78797a1b764e913b0c565a5097b0">$db</a>,null,$pagination);
<a name="l00478"></a>00478         
<a name="l00479"></a>00479 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 9 2012 10:33:42 for DAEDrupalInterface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
