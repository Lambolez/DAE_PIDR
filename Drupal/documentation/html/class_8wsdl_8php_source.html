<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>DAEDrupalInterface: modules/dae_wsdl/lib/class.wsdl.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>modules/dae_wsdl/lib/class.wsdl.php</h1><a href="class_8wsdl_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 
<a name="l00015"></a><a class="code" href="classwsdl.html">00015</a> <span class="keyword">class </span><a class="code" href="classwsdl.html">wsdl</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__base.html">nusoap_base</a> {
<a name="l00016"></a>00016         <span class="comment">// URL or filename of the root of this WSDL</span>
<a name="l00017"></a><a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">00017</a>     var <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>; 
<a name="l00018"></a>00018     <span class="comment">// define internal arrays of bindings, ports, operations, messages, etc.</span>
<a name="l00019"></a><a class="code" href="classwsdl.html#ad080272d3605cb3a38d26962c2e278dd">00019</a>     var <a class="code" href="classwsdl.html#ad080272d3605cb3a38d26962c2e278dd">$schemas</a> = array();
<a name="l00020"></a><a class="code" href="classwsdl.html#a186097f9496b1773db133ead2cffe32d">00020</a>     var <a class="code" href="classwsdl.html#a186097f9496b1773db133ead2cffe32d">$currentSchema</a>;
<a name="l00021"></a><a class="code" href="classwsdl.html#aa2b59468dff3a034248f2b535a1de097">00021</a>     var <a class="code" href="classwsdl.html#aa2b59468dff3a034248f2b535a1de097">$message</a> = array();
<a name="l00022"></a><a class="code" href="classwsdl.html#ad413198f9389cd71544be0e07debbf15">00022</a>     var <a class="code" href="classwsdl.html#ad413198f9389cd71544be0e07debbf15">$complexTypes</a> = array();
<a name="l00023"></a><a class="code" href="classwsdl.html#a5c57457ea9526d46d677cfb1027e4f97">00023</a>     var <a class="code" href="classwsdl.html#a5c57457ea9526d46d677cfb1027e4f97">$messages</a> = array();
<a name="l00024"></a><a class="code" href="classwsdl.html#a01242b72d1706c165c0c35667dbf7bd1">00024</a>     var <a class="code" href="classwsdl.html#a01242b72d1706c165c0c35667dbf7bd1">$currentMessage</a>;
<a name="l00025"></a><a class="code" href="classwsdl.html#a5a19e7bf907954b227e65e6ad2f1dbb2">00025</a>     var <a class="code" href="classwsdl.html#a5a19e7bf907954b227e65e6ad2f1dbb2">$currentOperation</a>;
<a name="l00026"></a><a class="code" href="classwsdl.html#a58ca918633989e8fa6bfba61e48087ee">00026</a>     var <a class="code" href="classwsdl.html#a58ca918633989e8fa6bfba61e48087ee">$portTypes</a> = array();
<a name="l00027"></a><a class="code" href="classwsdl.html#a2655c21706b6482adc13e33f7914297d">00027</a>     var <a class="code" href="classwsdl.html#a2655c21706b6482adc13e33f7914297d">$currentPortType</a>;
<a name="l00028"></a><a class="code" href="classwsdl.html#a69fb53ca70e0a06213aba6efe703fda3">00028</a>     var <a class="code" href="classwsdl.html#a69fb53ca70e0a06213aba6efe703fda3">$bindings</a> = array();
<a name="l00029"></a><a class="code" href="classwsdl.html#af4a53d9d40636f2f465eeb4bc4be4239">00029</a>     var <a class="code" href="classwsdl.html#af4a53d9d40636f2f465eeb4bc4be4239">$currentBinding</a>;
<a name="l00030"></a><a class="code" href="classwsdl.html#a0d3d7f9336d54e8294e3be42b2286e64">00030</a>     var <a class="code" href="classwsdl.html#a0d3d7f9336d54e8294e3be42b2286e64">$ports</a> = array();
<a name="l00031"></a><a class="code" href="classwsdl.html#ad39ca436b722e162295d3e58a074e317">00031</a>     var <a class="code" href="classwsdl.html#ad39ca436b722e162295d3e58a074e317">$currentPort</a>;
<a name="l00032"></a><a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">00032</a>     var <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a> = array();
<a name="l00033"></a><a class="code" href="classwsdl.html#a3a27b7fd67cea14c6a802d1cb4ce678d">00033</a>     var <a class="code" href="classwsdl.html#a3a27b7fd67cea14c6a802d1cb4ce678d">$status</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00034"></a><a class="code" href="classwsdl.html#a90e868755e79fd7f8c37ec8345167952">00034</a>     var <a class="code" href="classwsdl.html#a90e868755e79fd7f8c37ec8345167952">$documentation</a> = <span class="keyword">false</span>;
<a name="l00035"></a><a class="code" href="classwsdl.html#a8661410d035aa806a04997ed0a229b74">00035</a>     var <a class="code" href="classwsdl.html#a8661410d035aa806a04997ed0a229b74">$endpoint</a> = <span class="stringliteral">&#39;&#39;</span>; 
<a name="l00036"></a>00036     <span class="comment">// array of wsdl docs to import</span>
<a name="l00037"></a><a class="code" href="classwsdl.html#a01554a70869c02bdf1d423cf3f74633f">00037</a>     var <a class="code" href="classwsdl.html#a01554a70869c02bdf1d423cf3f74633f">$import</a> = array(); 
<a name="l00038"></a>00038     <span class="comment">// parser vars</span>
<a name="l00039"></a><a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">00039</a>     var <a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>;
<a name="l00040"></a><a class="code" href="classwsdl.html#acad521fa206d4aa342ed90dc04bef4ef">00040</a>     var <a class="code" href="classwsdl.html#acad521fa206d4aa342ed90dc04bef4ef">$position</a> = 0;
<a name="l00041"></a><a class="code" href="classwsdl.html#a691f58222b4f45f166bd86b322167c74">00041</a>     var <a class="code" href="classwsdl.html#a691f58222b4f45f166bd86b322167c74">$depth</a> = 0;
<a name="l00042"></a><a class="code" href="classwsdl.html#abfb5ed7d1824cd3cd6a3a6460acf88f3">00042</a>     var <a class="code" href="classwsdl.html#abfb5ed7d1824cd3cd6a3a6460acf88f3">$depth_array</a> = array();
<a name="l00043"></a>00043         <span class="comment">// for getting wsdl</span>
<a name="l00044"></a><a class="code" href="classwsdl.html#a108b5bea71b554398ff845f538b18388">00044</a>         var <a class="code" href="classwsdl.html#a108b5bea71b554398ff845f538b18388">$proxyhost</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00045"></a><a class="code" href="classwsdl.html#aaddf7e68a36ab38d81379d94172574c3">00045</a>     var <a class="code" href="classwsdl.html#aaddf7e68a36ab38d81379d94172574c3">$proxyport</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00046"></a><a class="code" href="classwsdl.html#a87d216a60f34a55e343fbcf0249bd554">00046</a>         var <a class="code" href="classwsdl.html#a87d216a60f34a55e343fbcf0249bd554">$proxyusername</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00047"></a><a class="code" href="classwsdl.html#a46c27fa0bea5678345cc3505a94b5988">00047</a>         var <a class="code" href="classwsdl.html#a46c27fa0bea5678345cc3505a94b5988">$proxypassword</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00048"></a><a class="code" href="classwsdl.html#a77db04ebe7b299466caa2f9e2e5ad545">00048</a>         var <a class="code" href="classwsdl.html#a77db04ebe7b299466caa2f9e2e5ad545">$timeout</a> = 0;
<a name="l00049"></a><a class="code" href="classwsdl.html#ae54ca6c0a8cf901640cddbdc59eaabd4">00049</a>         var <a class="code" href="classwsdl.html#ae54ca6c0a8cf901640cddbdc59eaabd4">$response_timeout</a> = 30;
<a name="l00050"></a><a class="code" href="classwsdl.html#ad8e4cb335b9e62fd8affb23790ad9882">00050</a>         var <a class="code" href="classwsdl.html#ad8e4cb335b9e62fd8affb23790ad9882">$curl_options</a> = array();    <span class="comment">// User-specified cURL options</span>
<a name="l00051"></a><a class="code" href="classwsdl.html#a86e4f6d4d20f35a558b1a1a904567053">00051</a>         var <a class="code" href="classwsdl.html#a86e4f6d4d20f35a558b1a1a904567053">$use_curl</a> = <span class="keyword">false</span>;                  <span class="comment">// whether to always try to use cURL</span>
<a name="l00052"></a>00052         <span class="comment">// for HTTP authentication</span>
<a name="l00053"></a><a class="code" href="classwsdl.html#a02a050652e5d9f5315532c4197598463">00053</a>         var <a class="code" href="classwsdl.html#a02a050652e5d9f5315532c4197598463">$username</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// Username for HTTP authentication</span>
<a name="l00054"></a><a class="code" href="classwsdl.html#a672c75b3581df84b5998b52aaeced9f4">00054</a>         var <a class="code" href="classwsdl.html#a672c75b3581df84b5998b52aaeced9f4">$password</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// Password for HTTP authentication</span>
<a name="l00055"></a><a class="code" href="classwsdl.html#ab0e009f97d9a7be261c3cbf373938ca0">00055</a>         var <a class="code" href="classwsdl.html#ab0e009f97d9a7be261c3cbf373938ca0">$authtype</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// Type of HTTP authentication</span>
<a name="l00056"></a><a class="code" href="classwsdl.html#a50b3268de8446e1033882bf4b96efd47">00056</a>         var <a class="code" href="classwsdl.html#a50b3268de8446e1033882bf4b96efd47">$certRequest</a> = array();             <span class="comment">// Certificate for HTTP SSL authentication</span>
<a name="l00057"></a>00057 
<a name="l00072"></a><a class="code" href="classwsdl.html#ad304343ce214bae1f772509daa9f79fb">00072</a>     function <a class="code" href="classwsdl.html#ad304343ce214bae1f772509daa9f79fb">wsdl</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a> = <span class="stringliteral">&#39;&#39;</span>,<a class="code" href="classwsdl.html#a108b5bea71b554398ff845f538b18388">$proxyhost</a>=<span class="keyword">false</span>,<a class="code" href="classwsdl.html#aaddf7e68a36ab38d81379d94172574c3">$proxyport</a>=<span class="keyword">false</span>,<a class="code" href="classwsdl.html#a87d216a60f34a55e343fbcf0249bd554">$proxyusername</a>=<span class="keyword">false</span>,<a class="code" href="classwsdl.html#a46c27fa0bea5678345cc3505a94b5988">$proxypassword</a>=<span class="keyword">false</span>,<a class="code" href="classwsdl.html#a77db04ebe7b299466caa2f9e2e5ad545">$timeout</a>=0,<a class="code" href="classwsdl.html#ae54ca6c0a8cf901640cddbdc59eaabd4">$response_timeout</a>=30,<a class="code" href="classwsdl.html#ad8e4cb335b9e62fd8affb23790ad9882">$curl_options</a>=null,<a class="code" href="classwsdl.html#a86e4f6d4d20f35a558b1a1a904567053">$use_curl</a>=<span class="keyword">false</span>){
<a name="l00073"></a>00073                 <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">parent::nusoap_base</a>();
<a name="l00074"></a>00074                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;ctor wsdl=$wsdl timeout=$timeout response_timeout=$response_timeout&quot;</span>);
<a name="l00075"></a>00075         $this-&gt;proxyhost = <a class="code" href="classwsdl.html#a108b5bea71b554398ff845f538b18388">$proxyhost</a>;
<a name="l00076"></a>00076         $this-&gt;proxyport = <a class="code" href="classwsdl.html#aaddf7e68a36ab38d81379d94172574c3">$proxyport</a>;
<a name="l00077"></a>00077                 $this-&gt;proxyusername = <a class="code" href="classwsdl.html#a87d216a60f34a55e343fbcf0249bd554">$proxyusername</a>;
<a name="l00078"></a>00078                 $this-&gt;proxypassword = <a class="code" href="classwsdl.html#a46c27fa0bea5678345cc3505a94b5988">$proxypassword</a>;
<a name="l00079"></a>00079                 $this-&gt;timeout = <a class="code" href="classwsdl.html#a77db04ebe7b299466caa2f9e2e5ad545">$timeout</a>;
<a name="l00080"></a>00080                 $this-&gt;response_timeout = <a class="code" href="classwsdl.html#ae54ca6c0a8cf901640cddbdc59eaabd4">$response_timeout</a>;
<a name="l00081"></a>00081                 <span class="keywordflow">if</span> (is_array(<a class="code" href="classwsdl.html#ad8e4cb335b9e62fd8affb23790ad9882">$curl_options</a>))
<a name="l00082"></a>00082                         $this-&gt;curl_options = <a class="code" href="classwsdl.html#ad8e4cb335b9e62fd8affb23790ad9882">$curl_options</a>;
<a name="l00083"></a>00083                 $this-&gt;use_curl = <a class="code" href="classwsdl.html#a86e4f6d4d20f35a558b1a1a904567053">$use_curl</a>;
<a name="l00084"></a>00084                 $this-&gt;<a class="code" href="classwsdl.html#a63abea316d9ae351a891c7a0082b1617">fetchWSDL</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>);
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086 
<a name="l00092"></a><a class="code" href="classwsdl.html#a63abea316d9ae351a891c7a0082b1617">00092</a>         function <a class="code" href="classwsdl.html#a63abea316d9ae351a891c7a0082b1617">fetchWSDL</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>) {
<a name="l00093"></a>00093                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;parse and process WSDL path=$wsdl&quot;</span>);
<a name="l00094"></a>00094                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a> = <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>;
<a name="l00095"></a>00095         <span class="comment">// parse wsdl file</span>
<a name="l00096"></a>00096         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classwsdl.html">wsdl</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00097"></a>00097             $this-&gt;<a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">parseWSDL</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>);
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099         <span class="comment">// imports</span>
<a name="l00100"></a>00100         <span class="comment">// TODO: handle imports more properly, grabbing them in-line and nesting them</span>
<a name="l00101"></a>00101         $imported_urls = array();
<a name="l00102"></a>00102         $imported = 1;
<a name="l00103"></a>00103         <span class="keywordflow">while</span> ($imported &gt; 0) {
<a name="l00104"></a>00104                 $imported = 0;
<a name="l00105"></a>00105                 <span class="comment">// Schema imports</span>
<a name="l00106"></a>00106                 <span class="keywordflow">foreach</span> ($this-&gt;schemas as $ns =&gt; $list) {
<a name="l00107"></a>00107                         <span class="keywordflow">foreach</span> ($list as $xs) {
<a name="l00108"></a>00108                                         $wsdlparts = parse_url($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>);    <span class="comment">// this is bogusly simple!</span>
<a name="l00109"></a>00109                             <span class="keywordflow">foreach</span> ($xs-&gt;imports as $ns2 =&gt; $list2) {
<a name="l00110"></a>00110                                 <span class="keywordflow">for</span> ($ii = 0; $ii &lt; count($list2); $ii++) {
<a name="l00111"></a>00111                                         <span class="keywordflow">if</span> (! $list2[$ii][<span class="stringliteral">&#39;loaded&#39;</span>]) {
<a name="l00112"></a>00112                                                 $this-&gt;schemas[$ns]-&gt;imports[$ns2][$ii][<span class="stringliteral">&#39;loaded&#39;</span>] = <span class="keyword">true</span>;
<a name="l00113"></a>00113                                                 $url = $list2[$ii][<span class="stringliteral">&#39;location&#39;</span>];
<a name="l00114"></a>00114                                                                 <span class="keywordflow">if</span> ($url != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00115"></a>00115                                                                         $urlparts = parse_url($url);
<a name="l00116"></a>00116                                                                         <span class="keywordflow">if</span> (!isset($urlparts[<span class="stringliteral">&#39;host&#39;</span>])) {
<a name="l00117"></a>00117                                                                                 $url = $wsdlparts[<span class="stringliteral">&#39;scheme&#39;</span>] . <span class="stringliteral">&#39;://&#39;</span> . $wsdlparts[<span class="stringliteral">&#39;host&#39;</span>] . (isset($wsdlparts[<span class="stringliteral">&#39;port&#39;</span>]) ? <span class="charliteral">&#39;:&#39;</span> .$wsdlparts[<span class="stringliteral">&#39;port&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>) .
<a name="l00118"></a>00118                                                                                                 substr($wsdlparts[<span class="stringliteral">&#39;path&#39;</span>],0,strrpos($wsdlparts[<span class="stringliteral">&#39;path&#39;</span>],<span class="charliteral">&#39;/&#39;</span>) + 1) .$urlparts[<span class="stringliteral">&#39;path&#39;</span>];
<a name="l00119"></a>00119                                                                         }
<a name="l00120"></a>00120                                                                         <span class="keywordflow">if</span> (! in_array($url, $imported_urls)) {
<a name="l00121"></a>00121                                                                 $this-&gt;<a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">parseWSDL</a>($url);
<a name="l00122"></a>00122                                                                 $imported++;
<a name="l00123"></a>00123                                                                 $imported_urls[] = $url;
<a name="l00124"></a>00124                                                         }
<a name="l00125"></a>00125                                                                 } <span class="keywordflow">else</span> {
<a name="l00126"></a>00126                                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Unexpected scenario: empty URL for unloaded import&quot;</span>);
<a name="l00127"></a>00127                                                                 }
<a name="l00128"></a>00128                                                         }
<a name="l00129"></a>00129                                                 }
<a name="l00130"></a>00130                             } 
<a name="l00131"></a>00131                         }
<a name="l00132"></a>00132                 }
<a name="l00133"></a>00133                 <span class="comment">// WSDL imports</span>
<a name="l00134"></a>00134                         $wsdlparts = parse_url($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>);    <span class="comment">// this is bogusly simple!</span>
<a name="l00135"></a>00135             <span class="keywordflow">foreach</span> ($this-&gt;<span class="keyword">import</span> as $ns =&gt; $list) {
<a name="l00136"></a>00136                 <span class="keywordflow">for</span> ($ii = 0; $ii &lt; count($list); $ii++) {
<a name="l00137"></a>00137                         <span class="keywordflow">if</span> (! $list[$ii][<span class="stringliteral">&#39;loaded&#39;</span>]) {
<a name="l00138"></a>00138                                 $this-&gt;<span class="keyword">import</span>[$ns][$ii][<span class="stringliteral">&#39;loaded&#39;</span>] = <span class="keyword">true</span>;
<a name="l00139"></a>00139                                 $url = $list[$ii][<span class="stringliteral">&#39;location&#39;</span>];
<a name="l00140"></a>00140                                                 <span class="keywordflow">if</span> ($url != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00141"></a>00141                                                         $urlparts = parse_url($url);
<a name="l00142"></a>00142                                                         <span class="keywordflow">if</span> (!isset($urlparts[<span class="stringliteral">&#39;host&#39;</span>])) {
<a name="l00143"></a>00143                                                                 $url = $wsdlparts[<span class="stringliteral">&#39;scheme&#39;</span>] . <span class="stringliteral">&#39;://&#39;</span> . $wsdlparts[<span class="stringliteral">&#39;host&#39;</span>] . (isset($wsdlparts[<span class="stringliteral">&#39;port&#39;</span>]) ? <span class="charliteral">&#39;:&#39;</span> . $wsdlparts[<span class="stringliteral">&#39;port&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>) .
<a name="l00144"></a>00144                                                                                 substr($wsdlparts[<span class="stringliteral">&#39;path&#39;</span>],0,strrpos($wsdlparts[<span class="stringliteral">&#39;path&#39;</span>],<span class="charliteral">&#39;/&#39;</span>) + 1) .$urlparts[<span class="stringliteral">&#39;path&#39;</span>];
<a name="l00145"></a>00145                                                         }
<a name="l00146"></a>00146                                                         <span class="keywordflow">if</span> (! in_array($url, $imported_urls)) {
<a name="l00147"></a>00147                                                 $this-&gt;<a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">parseWSDL</a>($url);
<a name="l00148"></a>00148                                                 $imported++;
<a name="l00149"></a>00149                                                 $imported_urls[] = $url;
<a name="l00150"></a>00150                                         }
<a name="l00151"></a>00151                                                 } <span class="keywordflow">else</span> {
<a name="l00152"></a>00152                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Unexpected scenario: empty URL for unloaded import&quot;</span>);
<a name="l00153"></a>00153                                                 }
<a name="l00154"></a>00154                                         }
<a name="l00155"></a>00155                                 }
<a name="l00156"></a>00156             } 
<a name="l00157"></a>00157                 }
<a name="l00158"></a>00158         <span class="comment">// add new data to operation data</span>
<a name="l00159"></a>00159         <span class="keywordflow">foreach</span>($this-&gt;bindings as $binding =&gt; $bindingData) {
<a name="l00160"></a>00160             <span class="keywordflow">if</span> (isset($bindingData[<span class="stringliteral">&#39;operations&#39;</span>]) &amp;&amp; is_array($bindingData[<span class="stringliteral">&#39;operations&#39;</span>])) {
<a name="l00161"></a>00161                 <span class="keywordflow">foreach</span>($bindingData[<span class="stringliteral">&#39;operations&#39;</span>] as $operation =&gt; $data) {
<a name="l00162"></a>00162                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;post-parse data gathering for &#39;</span> . $operation);
<a name="l00163"></a>00163                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>] = 
<a name="l00164"></a>00164                                                 isset($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>]) ? 
<a name="l00165"></a>00165                                                 array_merge($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>], $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;input&#39;</span>]) :
<a name="l00166"></a>00166                                                 $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;input&#39;</span>];
<a name="l00167"></a>00167                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>] = 
<a name="l00168"></a>00168                                                 isset($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>]) ?
<a name="l00169"></a>00169                                                 array_merge($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>], $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;output&#39;</span>]) :
<a name="l00170"></a>00170                                                 $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;output&#39;</span>];
<a name="l00171"></a>00171                     <span class="keywordflow">if</span>(isset($this-&gt;messages[ $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] ])){
<a name="l00172"></a>00172                                                 $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;parts&#39;</span>] = $this-&gt;messages[ $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] ];
<a name="l00173"></a>00173                                         }
<a name="l00174"></a>00174                                         <span class="keywordflow">if</span>(isset($this-&gt;messages[ $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] ])){
<a name="l00175"></a>00175                                 $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;parts&#39;</span>] = $this-&gt;messages[ $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] ];
<a name="l00176"></a>00176                     }
<a name="l00177"></a>00177                     <span class="comment">// Set operation style if necessary, but do not override one already provided</span>
<a name="l00178"></a>00178                                         <span class="keywordflow">if</span> (isset($bindingData[<span class="stringliteral">&#39;style&#39;</span>]) &amp;&amp; !isset($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;style&#39;</span>])) {
<a name="l00179"></a>00179                         $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;style&#39;</span>] = $bindingData[<span class="stringliteral">&#39;style&#39;</span>];
<a name="l00180"></a>00180                     }
<a name="l00181"></a>00181                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;transport&#39;</span>] = isset($bindingData[<span class="stringliteral">&#39;transport&#39;</span>]) ? $bindingData[<span class="stringliteral">&#39;transport&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00182"></a>00182                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;documentation&#39;</span>] = isset($this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;documentation&#39;</span>]) ? $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;documentation&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00183"></a>00183                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;endpoint&#39;</span>] = isset($bindingData[<span class="stringliteral">&#39;endpoint&#39;</span>]) ? $bindingData[<span class="stringliteral">&#39;endpoint&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00184"></a>00184                 } 
<a name="l00185"></a>00185             } 
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187         }
<a name="l00188"></a>00188 
<a name="l00195"></a><a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">00195</a>     function <a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">parseWSDL</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a> = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00196"></a>00196                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;parse WSDL at path=$wsdl&quot;</span>);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         <span class="keywordflow">if</span> (<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a> == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00199"></a>00199             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no wsdl passed to parseWSDL()!!&#39;</span>);
<a name="l00200"></a>00200             $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;no wsdl passed to parseWSDL()!!&#39;</span>);
<a name="l00201"></a>00201             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00202"></a>00202         }
<a name="l00203"></a>00203         
<a name="l00204"></a>00204         <span class="comment">// parse $wsdl for url format</span>
<a name="l00205"></a>00205         $wsdl_props = parse_url(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         <span class="keywordflow">if</span> (isset($wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>]) &amp;&amp; ($wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>] == <span class="stringliteral">&#39;http&#39;</span> || $wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>] == <span class="stringliteral">&#39;https&#39;</span>)) {
<a name="l00208"></a>00208             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;getting WSDL http(s) URL &#39;</span> . <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>);
<a name="l00209"></a>00209                 <span class="comment">// get wsdl</span>
<a name="l00210"></a>00210                 $tr = <span class="keyword">new</span> <a class="code" href="classsoap__transport__http.html">soap_transport_http</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>, $this-&gt;curl_options, $this-&gt;use_curl);
<a name="l00211"></a>00211                         $tr-&gt;request_method = <span class="stringliteral">&#39;GET&#39;</span>;
<a name="l00212"></a>00212                         $tr-&gt;useSOAPAction = <span class="keyword">false</span>;
<a name="l00213"></a>00213                         <span class="keywordflow">if</span>($this-&gt;proxyhost &amp;&amp; $this-&gt;proxyport){
<a name="l00214"></a>00214                                 $tr-&gt;setProxy($this-&gt;proxyhost,$this-&gt;proxyport,$this-&gt;proxyusername,$this-&gt;proxypassword);
<a name="l00215"></a>00215                         }
<a name="l00216"></a>00216                         <span class="keywordflow">if</span> ($this-&gt;authtype != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00217"></a>00217                                 $tr-&gt;setCredentials($this-&gt;username, $this-&gt;password, $this-&gt;authtype, array(), $this-&gt;certRequest);
<a name="l00218"></a>00218                         }
<a name="l00219"></a>00219                         $tr-&gt;setEncoding(<span class="stringliteral">&#39;gzip, deflate&#39;</span>);
<a name="l00220"></a>00220                         $wsdl_string = $tr-&gt;send(<span class="stringliteral">&#39;&#39;</span>, $this-&gt;timeout, $this-&gt;response_timeout);
<a name="l00221"></a>00221                         <span class="comment">//$this-&gt;debug(&quot;WSDL request\n&quot; . $tr-&gt;outgoing_payload);</span>
<a name="l00222"></a>00222                         <span class="comment">//$this-&gt;debug(&quot;WSDL response\n&quot; . $tr-&gt;incoming_payload);</span>
<a name="l00223"></a>00223                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($tr-&gt;getDebug());
<a name="l00224"></a>00224                         <span class="comment">// catch errors</span>
<a name="l00225"></a>00225                         <span class="keywordflow">if</span>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a> = $tr-&gt;getError() ){
<a name="l00226"></a>00226                                 $errstr = <span class="stringliteral">&#39;Getting &#39;</span> . <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a> . <span class="stringliteral">&#39; - HTTP ERROR: &#39;</span>.$err;
<a name="l00227"></a>00227                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($errstr);
<a name="l00228"></a>00228                     $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($errstr);
<a name="l00229"></a>00229                                 unset($tr);
<a name="l00230"></a>00230                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00231"></a>00231                         }
<a name="l00232"></a>00232                         unset($tr);
<a name="l00233"></a>00233                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;got WSDL URL&quot;</span>);
<a name="l00234"></a>00234         } <span class="keywordflow">else</span> {
<a name="l00235"></a>00235             <span class="comment">// $wsdl is not http(s), so treat it as a file URL or plain file path</span>
<a name="l00236"></a>00236                 <span class="keywordflow">if</span> (isset($wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>]) &amp;&amp; ($wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>] == <span class="stringliteral">&#39;file&#39;</span>) &amp;&amp; isset($wsdl_props[<span class="stringliteral">&#39;path&#39;</span>])) {
<a name="l00237"></a>00237                         $path = isset($wsdl_props[<span class="stringliteral">&#39;host&#39;</span>]) ? ($wsdl_props[<span class="stringliteral">&#39;host&#39;</span>] . <span class="charliteral">&#39;:&#39;</span> . $wsdl_props[<span class="stringliteral">&#39;path&#39;</span>]) : $wsdl_props[<span class="stringliteral">&#39;path&#39;</span>];
<a name="l00238"></a>00238                 } <span class="keywordflow">else</span> {
<a name="l00239"></a>00239                         $path = <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>;
<a name="l00240"></a>00240                 }
<a name="l00241"></a>00241             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;getting WSDL file &#39;</span> . $path);
<a name="l00242"></a>00242             <span class="keywordflow">if</span> ($fp = @fopen($path, <span class="charliteral">&#39;r&#39;</span>)) {
<a name="l00243"></a>00243                 $wsdl_string = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00244"></a>00244                 <span class="keywordflow">while</span> ($data = fread($fp, 32768)) {
<a name="l00245"></a>00245                     $wsdl_string .= $data;
<a name="l00246"></a>00246                 } 
<a name="l00247"></a>00247                 fclose($fp);
<a name="l00248"></a>00248             } <span class="keywordflow">else</span> {
<a name="l00249"></a>00249                 $errstr = <span class="stringliteral">&quot;Bad path to WSDL file $path&quot;</span>;
<a name="l00250"></a>00250                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($errstr);
<a name="l00251"></a>00251                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($errstr);
<a name="l00252"></a>00252                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00253"></a>00253             } 
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Parse WSDL&#39;</span>);
<a name="l00256"></a>00256         <span class="comment">// end new code added</span>
<a name="l00257"></a>00257         <span class="comment">// Create an XML parser.</span>
<a name="l00258"></a>00258         $this-&gt;parser = xml_parser_create(); 
<a name="l00259"></a>00259         <span class="comment">// Set the options for parsing the XML data.</span>
<a name="l00260"></a>00260         <span class="comment">// xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);</span>
<a name="l00261"></a>00261         xml_parser_set_option($this-&gt;parser, XML_OPTION_CASE_FOLDING, 0); 
<a name="l00262"></a>00262         <span class="comment">// Set the object for the parser.</span>
<a name="l00263"></a>00263         xml_set_object($this-&gt;parser, $this); 
<a name="l00264"></a>00264         <span class="comment">// Set the element handlers for the parser.</span>
<a name="l00265"></a>00265         xml_set_element_handler($this-&gt;parser, <span class="stringliteral">&#39;start_element&#39;</span>, <span class="stringliteral">&#39;end_element&#39;</span>);
<a name="l00266"></a>00266         xml_set_character_data_handler($this-&gt;parser, <span class="stringliteral">&#39;character_data&#39;</span>);
<a name="l00267"></a>00267         <span class="comment">// Parse the XML file.</span>
<a name="l00268"></a>00268         <span class="keywordflow">if</span> (!xml_parse($this-&gt;parser, $wsdl_string, <span class="keyword">true</span>)) {
<a name="l00269"></a>00269             <span class="comment">// Display an error message.</span>
<a name="l00270"></a>00270             $errstr = sprintf(
<a name="l00271"></a>00271                                 <span class="stringliteral">&#39;XML error parsing WSDL from %s on line %d: %s&#39;</span>,
<a name="l00272"></a>00272                                 <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>,
<a name="l00273"></a>00273                 xml_get_current_line_number($this-&gt;parser),
<a name="l00274"></a>00274                 xml_error_string(xml_get_error_code($this-&gt;parser))
<a name="l00275"></a>00275                 );
<a name="l00276"></a>00276             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($errstr);
<a name="l00277"></a>00277                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;XML payload:\n&quot;</span> . $wsdl_string);
<a name="l00278"></a>00278             $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($errstr);
<a name="l00279"></a>00279             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00280"></a>00280         } 
<a name="l00281"></a>00281                 <span class="comment">// free the parser</span>
<a name="l00282"></a>00282         xml_parser_free($this-&gt;parser);
<a name="l00283"></a>00283         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Parsing WSDL done&#39;</span>);
<a name="l00284"></a>00284                 <span class="comment">// catch wsdl parse errors</span>
<a name="l00285"></a>00285                 <span class="keywordflow">if</span>($this-&gt;<a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>()){
<a name="l00286"></a>00286                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00287"></a>00287                 }
<a name="l00288"></a>00288         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00289"></a>00289     } 
<a name="l00290"></a>00290 
<a name="l00299"></a><a class="code" href="classwsdl.html#aa92be510a5de3bfbd60fcf144712ab21">00299</a>     function <a class="code" href="classwsdl.html#aa92be510a5de3bfbd60fcf144712ab21">start_element</a>(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name, $attrs)
<a name="l00300"></a>00300     {
<a name="l00301"></a>00301         <span class="keywordflow">if</span> ($this-&gt;status == <span class="stringliteral">&#39;schema&#39;</span>) {
<a name="l00302"></a>00302             $this-&gt;currentSchema-&gt;schemaStartElement(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name, $attrs);
<a name="l00303"></a>00303             $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;currentSchema-&gt;getDebug());
<a name="l00304"></a>00304             $this-&gt;currentSchema-&gt;clearDebug();
<a name="l00305"></a>00305         } elseif (preg_match(<span class="stringliteral">&#39;/schema$/&#39;</span>, $name)) {
<a name="l00306"></a>00306                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Parsing WSDL schema&#39;</span>);
<a name="l00307"></a>00307             <span class="comment">// $this-&gt;debug(&quot;startElement for $name ($attrs[name]). status = $this-&gt;status (&quot;.$this-&gt;getLocalPart($name).&quot;)&quot;);</span>
<a name="l00308"></a>00308             $this-&gt;status = <span class="stringliteral">&#39;schema&#39;</span>;
<a name="l00309"></a>00309             $this-&gt;currentSchema = <span class="keyword">new</span> <a class="code" href="classnusoap__xmlschema.html">nusoap_xmlschema</a>(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $this-&gt;namespaces);
<a name="l00310"></a>00310             $this-&gt;currentSchema-&gt;schemaStartElement(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name, $attrs);
<a name="l00311"></a>00311             $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;currentSchema-&gt;getDebug());
<a name="l00312"></a>00312             $this-&gt;currentSchema-&gt;clearDebug();
<a name="l00313"></a>00313         } <span class="keywordflow">else</span> {
<a name="l00314"></a>00314             <span class="comment">// position in the total number of elements, starting from 0</span>
<a name="l00315"></a>00315             $pos = $this-&gt;position++;
<a name="l00316"></a>00316             <a class="code" href="classwsdl.html#a691f58222b4f45f166bd86b322167c74">$depth</a> = $this-&gt;depth++; 
<a name="l00317"></a>00317             <span class="comment">// set self as current value for this depth</span>
<a name="l00318"></a>00318             $this-&gt;depth_array[<a class="code" href="classwsdl.html#a691f58222b4f45f166bd86b322167c74">$depth</a>] = $pos;
<a name="l00319"></a>00319             $this-&gt;message[$pos] = array(<span class="stringliteral">&#39;cdata&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>); 
<a name="l00320"></a>00320             <span class="comment">// process attributes</span>
<a name="l00321"></a>00321             <span class="keywordflow">if</span> (count($attrs) &gt; 0) {
<a name="l00322"></a>00322                                 <span class="comment">// register namespace declarations</span>
<a name="l00323"></a>00323                 <span class="keywordflow">foreach</span>($attrs as $k =&gt; $v) {
<a name="l00324"></a>00324                     <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^xmlns/&#39;</span>,$k)) {
<a name="l00325"></a>00325                         <span class="keywordflow">if</span> ($ns_prefix = substr(strrchr($k, <span class="charliteral">&#39;:&#39;</span>), 1)) {
<a name="l00326"></a>00326                             $this-&gt;namespaces[$ns_prefix] = $v;
<a name="l00327"></a>00327                         } <span class="keywordflow">else</span> {
<a name="l00328"></a>00328                             $this-&gt;namespaces[<span class="stringliteral">&#39;ns&#39;</span> . (count($this-&gt;namespaces) + 1)] = $v;
<a name="l00329"></a>00329                         } 
<a name="l00330"></a>00330                         <span class="keywordflow">if</span> ($v == <span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span> || $v == <span class="stringliteral">&#39;http://www.w3.org/1999/XMLSchema&#39;</span> || $v == <span class="stringliteral">&#39;http://www.w3.org/2000/10/XMLSchema&#39;</span>) {
<a name="l00331"></a>00331                             $this-&gt;XMLSchemaVersion = $v;
<a name="l00332"></a>00332                             $this-&gt;namespaces[<span class="stringliteral">&#39;xsi&#39;</span>] = $v . <span class="stringliteral">&#39;-instance&#39;</span>;
<a name="l00333"></a>00333                         } 
<a name="l00334"></a>00334                     }
<a name="l00335"></a>00335                 }
<a name="l00336"></a>00336                 <span class="comment">// expand each attribute prefix to its namespace</span>
<a name="l00337"></a>00337                 <span class="keywordflow">foreach</span>($attrs as $k =&gt; $v) {
<a name="l00338"></a>00338                     $k = strpos($k, <span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($k) : $k;
<a name="l00339"></a>00339                     <span class="keywordflow">if</span> ($k != <span class="stringliteral">&#39;location&#39;</span> &amp;&amp; $k != <span class="stringliteral">&#39;soapAction&#39;</span> &amp;&amp; $k != <span class="stringliteral">&#39;namespace&#39;</span>) {
<a name="l00340"></a>00340                         $v = strpos($v, <span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($v) : $v;
<a name="l00341"></a>00341                     } 
<a name="l00342"></a>00342                     $eAttrs[$k] = $v;
<a name="l00343"></a>00343                 } 
<a name="l00344"></a>00344                 $attrs = $eAttrs;
<a name="l00345"></a>00345             } <span class="keywordflow">else</span> {
<a name="l00346"></a>00346                 $attrs = array();
<a name="l00347"></a>00347             } 
<a name="l00348"></a>00348             <span class="comment">// get element prefix, namespace and name</span>
<a name="l00349"></a>00349             <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/:/&#39;</span>, $name)) {
<a name="l00350"></a>00350                 <span class="comment">// get ns prefix</span>
<a name="l00351"></a>00351                 $prefix = substr($name, 0, strpos($name, <span class="charliteral">&#39;:&#39;</span>)); 
<a name="l00352"></a>00352                 <span class="comment">// get ns</span>
<a name="l00353"></a>00353                 $namespace = isset($this-&gt;namespaces[$prefix]) ? $this-&gt;namespaces[$prefix] : <span class="stringliteral">&#39;&#39;</span>; 
<a name="l00354"></a>00354                 <span class="comment">// get unqualified name</span>
<a name="l00355"></a>00355                 $name = substr(strstr($name, <span class="charliteral">&#39;:&#39;</span>), 1);
<a name="l00356"></a>00356             } 
<a name="l00357"></a>00357                         <span class="comment">// process attributes, expanding any prefixes to namespaces</span>
<a name="l00358"></a>00358             <span class="comment">// find status, register data</span>
<a name="l00359"></a>00359             <span class="keywordflow">switch</span> ($this-&gt;status) {
<a name="l00360"></a>00360                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;message&#39;</span>:
<a name="l00361"></a>00361                     <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;part&#39;</span>) {
<a name="l00362"></a>00362                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l00363"></a>00363                                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;msg &quot;</span> . $this-&gt;currentMessage . <span class="stringliteral">&quot;: found part (with type) $attrs[name]: &quot;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, $attrs));
<a name="l00364"></a>00364                                     $this-&gt;messages[$this-&gt;currentMessage][$attrs[<span class="stringliteral">&#39;name&#39;</span>]] = $attrs[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l00365"></a>00365                                 } 
<a name="l00366"></a>00366                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;element&#39;</span>])) {
<a name="l00367"></a>00367                                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;msg &quot;</span> . $this-&gt;currentMessage . <span class="stringliteral">&quot;: found part (with element) $attrs[name]: &quot;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, $attrs));
<a name="l00368"></a>00368                                         $this-&gt;messages[$this-&gt;currentMessage][$attrs[<span class="stringliteral">&#39;name&#39;</span>]] = $attrs[<span class="stringliteral">&#39;element&#39;</span>] . <span class="charliteral">&#39;^&#39;</span>;
<a name="l00369"></a>00369                                     } 
<a name="l00370"></a>00370                                 } 
<a name="l00371"></a>00371                                 <span class="keywordflow">break</span>;
<a name="l00372"></a>00372                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;portType&#39;</span>:
<a name="l00373"></a>00373                                 <span class="keywordflow">switch</span> ($name) {
<a name="l00374"></a>00374                                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;operation&#39;</span>:
<a name="l00375"></a>00375                                         $this-&gt;currentPortOperation = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00376"></a>00376                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;portType $this-&gt;currentPortType operation: $this-&gt;currentPortOperation&quot;</span>);
<a name="l00377"></a>00377                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;parameterOrder&#39;</span>])) {
<a name="l00378"></a>00378                                                 $this-&gt;portTypes[$this-&gt;currentPortType][$attrs[<span class="stringliteral">&#39;name&#39;</span>]][<span class="stringliteral">&#39;parameterOrder&#39;</span>] = $attrs[<span class="stringliteral">&#39;parameterOrder&#39;</span>];
<a name="l00379"></a>00379                                                 } 
<a name="l00380"></a>00380                                                 <span class="keywordflow">break</span>;
<a name="l00381"></a>00381                                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;documentation&#39;</span>:
<a name="l00382"></a>00382                                                 $this-&gt;documentation = <span class="keyword">true</span>;
<a name="l00383"></a>00383                                                 <span class="keywordflow">break</span>; 
<a name="l00384"></a>00384                                             <span class="comment">// merge input/output data</span>
<a name="l00385"></a>00385                                             <span class="keywordflow">default</span>:
<a name="l00386"></a>00386                                                 $m = isset($attrs[<span class="stringliteral">&#39;message&#39;</span>]) ? $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($attrs[<span class="stringliteral">&#39;message&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00387"></a>00387                                                 $this-&gt;portTypes[$this-&gt;currentPortType][$this-&gt;currentPortOperation][$name][<span class="stringliteral">&#39;message&#39;</span>] = $m;
<a name="l00388"></a>00388                                                 <span class="keywordflow">break</span>;
<a name="l00389"></a>00389                                         } 
<a name="l00390"></a>00390                                 <span class="keywordflow">break</span>;
<a name="l00391"></a>00391                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;binding&#39;</span>:
<a name="l00392"></a>00392                                     <span class="keywordflow">switch</span> ($name) {
<a name="l00393"></a>00393                                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;binding&#39;</span>: 
<a name="l00394"></a>00394                                             <span class="comment">// get ns prefix</span>
<a name="l00395"></a>00395                                             <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;style&#39;</span>])) {
<a name="l00396"></a>00396                                             $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;prefix&#39;</span>] = $prefix;
<a name="l00397"></a>00397                                                 } 
<a name="l00398"></a>00398                                                 $this-&gt;bindings[$this-&gt;currentBinding] = array_merge($this-&gt;bindings[$this-&gt;currentBinding], $attrs);
<a name="l00399"></a>00399                                                 <span class="keywordflow">break</span>;
<a name="l00400"></a>00400                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;header&#39;</span>:
<a name="l00401"></a>00401                                                     $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus][<span class="stringliteral">&#39;headers&#39;</span>][] = $attrs;
<a name="l00402"></a>00402                                                     <span class="keywordflow">break</span>;
<a name="l00403"></a>00403                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;operation&#39;</span>:
<a name="l00404"></a>00404                                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;soapAction&#39;</span>])) {
<a name="l00405"></a>00405                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;soapAction&#39;</span>] = $attrs[<span class="stringliteral">&#39;soapAction&#39;</span>];
<a name="l00406"></a>00406                                                     } 
<a name="l00407"></a>00407                                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;style&#39;</span>])) {
<a name="l00408"></a>00408                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;style&#39;</span>] = $attrs[<span class="stringliteral">&#39;style&#39;</span>];
<a name="l00409"></a>00409                                                     } 
<a name="l00410"></a>00410                                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;name&#39;</span>])) {
<a name="l00411"></a>00411                                                         $this-&gt;currentOperation = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00412"></a>00412                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;current binding operation: $this-&gt;currentOperation&quot;</span>);
<a name="l00413"></a>00413                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;name&#39;</span>] = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00414"></a>00414                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;binding&#39;</span>] = $this-&gt;currentBinding;
<a name="l00415"></a>00415                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;endpoint&#39;</span>] = isset($this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;endpoint&#39;</span>]) ? $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;endpoint&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00416"></a>00416                                                     } 
<a name="l00417"></a>00417                                                     <span class="keywordflow">break</span>;
<a name="l00418"></a>00418                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;input&#39;</span>:
<a name="l00419"></a>00419                                                     $this-&gt;opStatus = <span class="stringliteral">&#39;input&#39;</span>;
<a name="l00420"></a>00420                                                     <span class="keywordflow">break</span>;
<a name="l00421"></a>00421                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;output&#39;</span>:
<a name="l00422"></a>00422                                                     $this-&gt;opStatus = <span class="stringliteral">&#39;output&#39;</span>;
<a name="l00423"></a>00423                                                     <span class="keywordflow">break</span>;
<a name="l00424"></a>00424                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;body&#39;</span>:
<a name="l00425"></a>00425                                                     <span class="keywordflow">if</span> (isset($this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus])) {
<a name="l00426"></a>00426                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus] = array_merge($this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus], $attrs);
<a name="l00427"></a>00427                                                     } <span class="keywordflow">else</span> {
<a name="l00428"></a>00428                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus] = $attrs;
<a name="l00429"></a>00429                                                     } 
<a name="l00430"></a>00430                                                     <span class="keywordflow">break</span>;
<a name="l00431"></a>00431                                         } 
<a name="l00432"></a>00432                                         <span class="keywordflow">break</span>;
<a name="l00433"></a>00433                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;service&#39;</span>:
<a name="l00434"></a>00434                                         <span class="keywordflow">switch</span> ($name) {
<a name="l00435"></a>00435                                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;port&#39;</span>:
<a name="l00436"></a>00436                                                 $this-&gt;currentPort = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00437"></a>00437                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;current port: &#39;</span> . $this-&gt;currentPort);
<a name="l00438"></a>00438                                                 $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;binding&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($attrs[<span class="stringliteral">&#39;binding&#39;</span>]);
<a name="l00439"></a>00439                                         
<a name="l00440"></a>00440                                                 <span class="keywordflow">break</span>;
<a name="l00441"></a>00441                                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;address&#39;</span>:
<a name="l00442"></a>00442                                                 $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;location&#39;</span>] = $attrs[<span class="stringliteral">&#39;location&#39;</span>];
<a name="l00443"></a>00443                                                 $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;bindingType&#39;</span>] = $namespace;
<a name="l00444"></a>00444                                                 $this-&gt;bindings[ $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;bindingType&#39;</span>] = $namespace;
<a name="l00445"></a>00445                                                 $this-&gt;bindings[ $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;endpoint&#39;</span>] = $attrs[<span class="stringliteral">&#39;location&#39;</span>];
<a name="l00446"></a>00446                                                 <span class="keywordflow">break</span>;
<a name="l00447"></a>00447                                         } 
<a name="l00448"></a>00448                                         <span class="keywordflow">break</span>;
<a name="l00449"></a>00449                         } 
<a name="l00450"></a>00450                 <span class="comment">// set status</span>
<a name="l00451"></a>00451                 <span class="keywordflow">switch</span> ($name) {
<a name="l00452"></a>00452                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;import&#39;</span>:
<a name="l00453"></a>00453                             <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;location&#39;</span>])) {
<a name="l00454"></a>00454                     $this-&gt;<span class="keyword">import</span>[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]][] = array(<span class="stringliteral">&#39;location&#39;</span> =&gt; $attrs[<span class="stringliteral">&#39;location&#39;</span>], <span class="stringliteral">&#39;loaded&#39;</span> =&gt; <span class="keyword">false</span>);
<a name="l00455"></a>00455                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;parsing import &#39;</span> . $attrs[<span class="stringliteral">&#39;namespace&#39;</span>]. <span class="stringliteral">&#39; - &#39;</span> . $attrs[<span class="stringliteral">&#39;location&#39;</span>] . <span class="stringliteral">&#39; (&#39;</span> . count($this-&gt;<span class="keyword">import</span>[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]]).<span class="charliteral">&#39;)&#39;</span>);
<a name="l00456"></a>00456                                 } <span class="keywordflow">else</span> {
<a name="l00457"></a>00457                     $this-&gt;<span class="keyword">import</span>[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]][] = array(<span class="stringliteral">&#39;location&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;loaded&#39;</span> =&gt; <span class="keyword">true</span>);
<a name="l00458"></a>00458                                         <span class="keywordflow">if</span> (! $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($attrs[<span class="stringliteral">&#39;namespace&#39;</span>])) {
<a name="l00459"></a>00459                                                 $this-&gt;namespaces[<span class="stringliteral">&#39;ns&#39;</span>.(count($this-&gt;namespaces)+1)] = $attrs[<span class="stringliteral">&#39;namespace&#39;</span>];
<a name="l00460"></a>00460                                         }
<a name="l00461"></a>00461                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;parsing import &#39;</span> . $attrs[<span class="stringliteral">&#39;namespace&#39;</span>]. <span class="stringliteral">&#39; - [no location] (&#39;</span> . count($this-&gt;<span class="keyword">import</span>[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]]).<span class="charliteral">&#39;)&#39;</span>);
<a name="l00462"></a>00462                                 }
<a name="l00463"></a>00463                                 <span class="keywordflow">break</span>;
<a name="l00464"></a>00464                         <span class="comment">//wait for schema</span>
<a name="l00465"></a>00465                         <span class="comment">//case &#39;types&#39;:</span>
<a name="l00466"></a>00466                         <span class="comment">//      $this-&gt;status = &#39;schema&#39;;</span>
<a name="l00467"></a>00467                         <span class="comment">//      break;</span>
<a name="l00468"></a>00468                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;message&#39;</span>:
<a name="l00469"></a>00469                                 $this-&gt;status = <span class="stringliteral">&#39;message&#39;</span>;
<a name="l00470"></a>00470                                 $this-&gt;messages[$attrs[<span class="stringliteral">&#39;name&#39;</span>]] = array();
<a name="l00471"></a>00471                                 $this-&gt;currentMessage = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00472"></a>00472                                 <span class="keywordflow">break</span>;
<a name="l00473"></a>00473                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;portType&#39;</span>:
<a name="l00474"></a>00474                                 $this-&gt;status = <span class="stringliteral">&#39;portType&#39;</span>;
<a name="l00475"></a>00475                                 $this-&gt;portTypes[$attrs[<span class="stringliteral">&#39;name&#39;</span>]] = array();
<a name="l00476"></a>00476                                 $this-&gt;currentPortType = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00477"></a>00477                                 <span class="keywordflow">break</span>;
<a name="l00478"></a>00478                         <span class="keywordflow">case</span> <span class="stringliteral">&quot;binding&quot;</span>:
<a name="l00479"></a>00479                                 <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;name&#39;</span>])) {
<a name="l00480"></a>00480                                 <span class="comment">// get binding name</span>
<a name="l00481"></a>00481                                         <span class="keywordflow">if</span> (strpos($attrs[<span class="stringliteral">&#39;name&#39;</span>], <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l00482"></a>00482                                         $this-&gt;currentBinding = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($attrs[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l00483"></a>00483                                         } <span class="keywordflow">else</span> {
<a name="l00484"></a>00484                                         $this-&gt;currentBinding = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00485"></a>00485                                         } 
<a name="l00486"></a>00486                                         $this-&gt;status = <span class="stringliteral">&#39;binding&#39;</span>;
<a name="l00487"></a>00487                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;portType&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($attrs[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l00488"></a>00488                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;current binding: $this-&gt;currentBinding of portType: &quot;</span> . $attrs[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l00489"></a>00489                                 } 
<a name="l00490"></a>00490                                 <span class="keywordflow">break</span>;
<a name="l00491"></a>00491                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;service&#39;</span>:
<a name="l00492"></a>00492                                 $this-&gt;serviceName = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00493"></a>00493                                 $this-&gt;status = <span class="stringliteral">&#39;service&#39;</span>;
<a name="l00494"></a>00494                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;current service: &#39;</span> . $this-&gt;serviceName);
<a name="l00495"></a>00495                                 <span class="keywordflow">break</span>;
<a name="l00496"></a>00496                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;definitions&#39;</span>:
<a name="l00497"></a>00497                                 <span class="keywordflow">foreach</span> ($attrs as $name =&gt; $value) {
<a name="l00498"></a>00498                                         $this-&gt;wsdl_info[$name] = $value;
<a name="l00499"></a>00499                                 } 
<a name="l00500"></a>00500                                 <span class="keywordflow">break</span>;
<a name="l00501"></a>00501                         } 
<a name="l00502"></a>00502                 } 
<a name="l00503"></a>00503         } 
<a name="l00504"></a>00504 
<a name="l00512"></a><a class="code" href="classwsdl.html#ab35a9bdfa733a195ba1f47b4efbc6035">00512</a>         function <a class="code" href="classwsdl.html#ab35a9bdfa733a195ba1f47b4efbc6035">end_element</a>(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name){ 
<a name="l00513"></a>00513                 <span class="comment">// unset schema status</span>
<a name="l00514"></a>00514                 <span class="keywordflow">if</span> (<span class="comment">/*preg_match(&#39;/types$/&#39;, $name) ||*/</span> preg_match(<span class="stringliteral">&#39;/schema$/&#39;</span>, $name)) {
<a name="l00515"></a>00515                         $this-&gt;status = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00516"></a>00516             $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;currentSchema-&gt;getDebug());
<a name="l00517"></a>00517             $this-&gt;currentSchema-&gt;clearDebug();
<a name="l00518"></a>00518                         $this-&gt;schemas[$this-&gt;currentSchema-&gt;schemaTargetNamespace][] = $this-&gt;currentSchema;
<a name="l00519"></a>00519                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Parsing WSDL schema done&#39;</span>);
<a name="l00520"></a>00520                 } 
<a name="l00521"></a>00521                 <span class="keywordflow">if</span> ($this-&gt;status == <span class="stringliteral">&#39;schema&#39;</span>) {
<a name="l00522"></a>00522                         $this-&gt;currentSchema-&gt;schemaEndElement(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name);
<a name="l00523"></a>00523                 } <span class="keywordflow">else</span> {
<a name="l00524"></a>00524                         <span class="comment">// bring depth down a notch</span>
<a name="l00525"></a>00525                         $this-&gt;depth--;
<a name="l00526"></a>00526                 } 
<a name="l00527"></a>00527                 <span class="comment">// end documentation</span>
<a name="l00528"></a>00528                 <span class="keywordflow">if</span> ($this-&gt;documentation) {
<a name="l00529"></a>00529                         <span class="comment">//TODO: track the node to which documentation should be assigned; it can be a part, message, etc.</span>
<a name="l00530"></a>00530                         <span class="comment">//$this-&gt;portTypes[$this-&gt;currentPortType][$this-&gt;currentPortOperation][&#39;documentation&#39;] = $this-&gt;documentation;</span>
<a name="l00531"></a>00531                         $this-&gt;documentation = <span class="keyword">false</span>;
<a name="l00532"></a>00532                 } 
<a name="l00533"></a>00533         } 
<a name="l00534"></a>00534 
<a name="l00542"></a><a class="code" href="classwsdl.html#a1224fed86a5e11d97db35156ff857e7b">00542</a>         function <a class="code" href="classwsdl.html#a1224fed86a5e11d97db35156ff857e7b">character_data</a>(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $data)
<a name="l00543"></a>00543         {
<a name="l00544"></a>00544                 $pos = isset($this-&gt;depth_array[$this-&gt;depth]) ? $this-&gt;depth_array[$this-&gt;depth] : 0;
<a name="l00545"></a>00545                 <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>])) {
<a name="l00546"></a>00546                         $this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>] .= $data;
<a name="l00547"></a>00547                 } 
<a name="l00548"></a>00548                 <span class="keywordflow">if</span> ($this-&gt;documentation) {
<a name="l00549"></a>00549                         $this-&gt;documentation .= $data;
<a name="l00550"></a>00550                 } 
<a name="l00551"></a>00551         } 
<a name="l00552"></a>00552 
<a name="l00562"></a><a class="code" href="classwsdl.html#a56c7f5a57209c4fa5e46d14c58f8d259">00562</a>         function <a class="code" href="classwsdl.html#a56c7f5a57209c4fa5e46d14c58f8d259">setCredentials</a>(<a class="code" href="classwsdl.html#a02a050652e5d9f5315532c4197598463">$username</a>, <a class="code" href="classwsdl.html#a672c75b3581df84b5998b52aaeced9f4">$password</a>, <a class="code" href="classwsdl.html#ab0e009f97d9a7be261c3cbf373938ca0">$authtype</a> = <span class="stringliteral">&#39;basic&#39;</span>, <a class="code" href="classwsdl.html#a50b3268de8446e1033882bf4b96efd47">$certRequest</a> = array()) {
<a name="l00563"></a>00563                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setCredentials username=$username authtype=$authtype certRequest=&quot;</span>);
<a name="l00564"></a>00564                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classwsdl.html#a50b3268de8446e1033882bf4b96efd47">$certRequest</a>));
<a name="l00565"></a>00565                 $this-&gt;username = <a class="code" href="classwsdl.html#a02a050652e5d9f5315532c4197598463">$username</a>;
<a name="l00566"></a>00566                 $this-&gt;password = <a class="code" href="classwsdl.html#a672c75b3581df84b5998b52aaeced9f4">$password</a>;
<a name="l00567"></a>00567                 $this-&gt;authtype = <a class="code" href="classwsdl.html#ab0e009f97d9a7be261c3cbf373938ca0">$authtype</a>;
<a name="l00568"></a>00568                 $this-&gt;certRequest = <a class="code" href="classwsdl.html#a50b3268de8446e1033882bf4b96efd47">$certRequest</a>;
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570         
<a name="l00571"></a><a class="code" href="classwsdl.html#a1cd144d0ac89b1e36b6bbc6097bab0a9">00571</a>         function <a class="code" href="classwsdl.html#a1cd144d0ac89b1e36b6bbc6097bab0a9">getBindingData</a>($binding)
<a name="l00572"></a>00572         {
<a name="l00573"></a>00573                 <span class="keywordflow">if</span> (is_array($this-&gt;bindings[$binding])) {
<a name="l00574"></a>00574                         <span class="keywordflow">return</span> $this-&gt;bindings[$binding];
<a name="l00575"></a>00575                 } 
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577         
<a name="l00586"></a><a class="code" href="classwsdl.html#a96c36ce86df41e3b054eafb16b184cbd">00586</a>         function <a class="code" href="classwsdl.html#a96c36ce86df41e3b054eafb16b184cbd">getOperations</a>($portName = <span class="stringliteral">&#39;&#39;</span>, $bindingType = <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l00587"></a>00587                 $ops = array();
<a name="l00588"></a>00588                 <span class="keywordflow">if</span> ($bindingType == <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l00589"></a>00589                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap/&#39;</span>;
<a name="l00590"></a>00590                 } elseif ($bindingType == <span class="stringliteral">&#39;soap12&#39;</span>) {
<a name="l00591"></a>00591                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap12/&#39;</span>;
<a name="l00592"></a>00592                 } <span class="keywordflow">else</span> {
<a name="l00593"></a>00593                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations bindingType $bindingType may not be supported&quot;</span>);
<a name="l00594"></a>00594                 }
<a name="l00595"></a>00595                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations for port &#39;$portName&#39; bindingType $bindingType&quot;</span>);
<a name="l00596"></a>00596                 <span class="comment">// loop thru ports</span>
<a name="l00597"></a>00597                 <span class="keywordflow">foreach</span>($this-&gt;ports as $port =&gt; $portData) {
<a name="l00598"></a>00598                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations checking port $port bindingType &quot;</span> . $portData[<span class="stringliteral">&#39;bindingType&#39;</span>]);
<a name="l00599"></a>00599                         <span class="keywordflow">if</span> ($portName == <span class="stringliteral">&#39;&#39;</span> || $port == $portName) {
<a name="l00600"></a>00600                                 <span class="comment">// binding type of port matches parameter</span>
<a name="l00601"></a>00601                                 <span class="keywordflow">if</span> ($portData[<span class="stringliteral">&#39;bindingType&#39;</span>] == $bindingType) {
<a name="l00602"></a>00602                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations found port $port bindingType $bindingType&quot;</span>);
<a name="l00603"></a>00603                                         <span class="comment">//$this-&gt;debug(&quot;port data: &quot; . $this-&gt;varDump($portData));</span>
<a name="l00604"></a>00604                                         <span class="comment">//$this-&gt;debug(&quot;bindings: &quot; . $this-&gt;varDump($this-&gt;bindings[ $portData[&#39;binding&#39;] ]));</span>
<a name="l00605"></a>00605                                         <span class="comment">// merge bindings</span>
<a name="l00606"></a>00606                                         <span class="keywordflow">if</span> (isset($this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>])) {
<a name="l00607"></a>00607                                                 $ops = array_merge ($ops, $this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>]);
<a name="l00608"></a>00608                                         }
<a name="l00609"></a>00609                                 }
<a name="l00610"></a>00610                         }
<a name="l00611"></a>00611                 }
<a name="l00612"></a>00612                 <span class="keywordflow">if</span> (count($ops) == 0) {
<a name="l00613"></a>00613                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations found no operations for port &#39;$portName&#39; bindingType $bindingType&quot;</span>);
<a name="l00614"></a>00614                 }
<a name="l00615"></a>00615                 <span class="keywordflow">return</span> $ops;
<a name="l00616"></a>00616         } 
<a name="l00617"></a>00617         
<a name="l00626"></a><a class="code" href="classwsdl.html#a67a91d9d9f62574149c609c62849664d">00626</a>         function <a class="code" href="classwsdl.html#a67a91d9d9f62574149c609c62849664d">getOperationData</a>($operation, $bindingType = <span class="stringliteral">&#39;soap&#39;</span>)
<a name="l00627"></a>00627         {
<a name="l00628"></a>00628                 <span class="keywordflow">if</span> ($bindingType == <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l00629"></a>00629                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap/&#39;</span>;
<a name="l00630"></a>00630                 } elseif ($bindingType == <span class="stringliteral">&#39;soap12&#39;</span>) {
<a name="l00631"></a>00631                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap12/&#39;</span>;
<a name="l00632"></a>00632                 }
<a name="l00633"></a>00633                 <span class="comment">// loop thru ports</span>
<a name="l00634"></a>00634                 <span class="keywordflow">foreach</span>($this-&gt;ports as $port =&gt; $portData) {
<a name="l00635"></a>00635                         <span class="comment">// binding type of port matches parameter</span>
<a name="l00636"></a>00636                         <span class="keywordflow">if</span> ($portData[<span class="stringliteral">&#39;bindingType&#39;</span>] == $bindingType) {
<a name="l00637"></a>00637                                 <span class="comment">// get binding</span>
<a name="l00638"></a>00638                                 <span class="comment">//foreach($this-&gt;bindings[ $portData[&#39;binding&#39;] ][&#39;operations&#39;] as $bOperation =&gt; $opData) {</span>
<a name="l00639"></a>00639                                 <span class="keywordflow">foreach</span>(array_keys($this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>]) as $bOperation) {
<a name="l00640"></a>00640                                         <span class="comment">// note that we could/should also check the namespace here</span>
<a name="l00641"></a>00641                                         <span class="keywordflow">if</span> ($operation == $bOperation) {
<a name="l00642"></a>00642                                                 <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a> = $this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>][$operation];
<a name="l00643"></a>00643                                             <span class="keywordflow">return</span> <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>;
<a name="l00644"></a>00644                                         } 
<a name="l00645"></a>00645                                 } 
<a name="l00646"></a>00646                         }
<a name="l00647"></a>00647                 } 
<a name="l00648"></a>00648         }
<a name="l00649"></a>00649         
<a name="l00658"></a><a class="code" href="classwsdl.html#aa62364fe0857d5a0eb423c1e1dad97da">00658</a>         function <a class="code" href="classwsdl.html#aa62364fe0857d5a0eb423c1e1dad97da">getOperationDataForSoapAction</a>($soapAction, $bindingType = <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l00659"></a>00659                 <span class="keywordflow">if</span> ($bindingType == <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l00660"></a>00660                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap/&#39;</span>;
<a name="l00661"></a>00661                 } elseif ($bindingType == <span class="stringliteral">&#39;soap12&#39;</span>) {
<a name="l00662"></a>00662                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap12/&#39;</span>;
<a name="l00663"></a>00663                 }
<a name="l00664"></a>00664                 <span class="comment">// loop thru ports</span>
<a name="l00665"></a>00665                 <span class="keywordflow">foreach</span>($this-&gt;ports as $port =&gt; $portData) {
<a name="l00666"></a>00666                         <span class="comment">// binding type of port matches parameter</span>
<a name="l00667"></a>00667                         <span class="keywordflow">if</span> ($portData[<span class="stringliteral">&#39;bindingType&#39;</span>] == $bindingType) {
<a name="l00668"></a>00668                                 <span class="comment">// loop through operations for the binding</span>
<a name="l00669"></a>00669                                 <span class="keywordflow">foreach</span> ($this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>] as $bOperation =&gt; <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>) {
<a name="l00670"></a>00670                                         <span class="keywordflow">if</span> (<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;soapAction&#39;</span>] == $soapAction) {
<a name="l00671"></a>00671                                             <span class="keywordflow">return</span> <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>;
<a name="l00672"></a>00672                                         } 
<a name="l00673"></a>00673                                 } 
<a name="l00674"></a>00674                         }
<a name="l00675"></a>00675                 } 
<a name="l00676"></a>00676         }
<a name="l00677"></a>00677         
<a name="l00696"></a><a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">00696</a>         function <a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($type, $ns) {
<a name="l00697"></a>00697                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: type=$type, ns=$ns&quot;</span>);
<a name="l00698"></a>00698                 <span class="keywordflow">if</span> ((! $ns) &amp;&amp; isset($this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>])) {
<a name="l00699"></a>00699                         $ns = $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>];
<a name="l00700"></a>00700                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: type namespace forced to $ns&quot;</span>);
<a name="l00701"></a>00701                 }
<a name="l00702"></a>00702                 <span class="keywordflow">if</span> (!isset($this-&gt;schemas[$ns])) {
<a name="l00703"></a>00703                         <span class="keywordflow">foreach</span> ($this-&gt;schemas as $ns0 =&gt; $schema0) {
<a name="l00704"></a>00704                                 <span class="keywordflow">if</span> (strcasecmp($ns, $ns0) == 0) {
<a name="l00705"></a>00705                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: replacing schema namespace $ns with $ns0&quot;</span>);
<a name="l00706"></a>00706                                         $ns = $ns0;
<a name="l00707"></a>00707                                         <span class="keywordflow">break</span>;
<a name="l00708"></a>00708                                 }
<a name="l00709"></a>00709                         }
<a name="l00710"></a>00710                 }
<a name="l00711"></a>00711                 <span class="keywordflow">if</span> (isset($this-&gt;schemas[$ns])) {
<a name="l00712"></a>00712                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: have schema for namespace $ns&quot;</span>);
<a name="l00713"></a>00713                         <span class="keywordflow">for</span> (<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0; <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt; count($this-&gt;schemas[$ns]); <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {
<a name="l00714"></a>00714                                 $xs = &amp;$this-&gt;schemas[$ns][<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>];
<a name="l00715"></a>00715                                 $t = $xs-&gt;getTypeDef($type);
<a name="l00716"></a>00716                                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($xs-&gt;getDebug());
<a name="l00717"></a>00717                                 $xs-&gt;clearDebug();
<a name="l00718"></a>00718                                 <span class="keywordflow">if</span> ($t) {
<a name="l00719"></a>00719                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: found type $type&quot;</span>);
<a name="l00720"></a>00720                                         <span class="keywordflow">if</span> (!isset($t[<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l00721"></a>00721                                                 <span class="comment">// get info for type to tack onto the element</span>
<a name="l00722"></a>00722                                                 $uqType = substr($t[<span class="stringliteral">&#39;type&#39;</span>], strrpos($t[<span class="stringliteral">&#39;type&#39;</span>], <span class="charliteral">&#39;:&#39;</span>) + 1);
<a name="l00723"></a>00723                                                 $ns = substr($t[<span class="stringliteral">&#39;type&#39;</span>], 0, strrpos($t[<span class="stringliteral">&#39;type&#39;</span>], <span class="charliteral">&#39;:&#39;</span>));
<a name="l00724"></a>00724                                                 $etype = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqType, $ns);
<a name="l00725"></a>00725                                                 <span class="keywordflow">if</span> ($etype) {
<a name="l00726"></a>00726                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;found type for [element] $type:&quot;</span>);
<a name="l00727"></a>00727                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($etype));
<a name="l00728"></a>00728                                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l00729"></a>00729                                                                 $t[<span class="stringliteral">&#39;phpType&#39;</span>] = $etype[<span class="stringliteral">&#39;phpType&#39;</span>];
<a name="l00730"></a>00730                                                         }
<a name="l00731"></a>00731                                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;elements&#39;</span>])) {
<a name="l00732"></a>00732                                                                 $t[<span class="stringliteral">&#39;elements&#39;</span>] = $etype[<span class="stringliteral">&#39;elements&#39;</span>];
<a name="l00733"></a>00733                                                         }
<a name="l00734"></a>00734                                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;attrs&#39;</span>])) {
<a name="l00735"></a>00735                                                                 $t[<span class="stringliteral">&#39;attrs&#39;</span>] = $etype[<span class="stringliteral">&#39;attrs&#39;</span>];
<a name="l00736"></a>00736                                                         }
<a name="l00737"></a>00737                                                 } <span class="keywordflow">else</span> {
<a name="l00738"></a>00738                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;did not find type for [element] $type&quot;</span>);
<a name="l00739"></a>00739                                                 }
<a name="l00740"></a>00740                                         }
<a name="l00741"></a>00741                                         <span class="keywordflow">return</span> $t;
<a name="l00742"></a>00742                                 }
<a name="l00743"></a>00743                         }
<a name="l00744"></a>00744                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: did not find type $type&quot;</span>);
<a name="l00745"></a>00745                 } <span class="keywordflow">else</span> {
<a name="l00746"></a>00746                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: do not have schema for namespace $ns&quot;</span>);
<a name="l00747"></a>00747                 }
<a name="l00748"></a>00748                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00749"></a>00749         }
<a name="l00750"></a>00750 
<a name="l00756"></a><a class="code" href="classwsdl.html#a929c11102abae3e6a01cae35f73b85c2">00756</a>     function <a class="code" href="classwsdl.html#a929c11102abae3e6a01cae35f73b85c2">webDescription</a>(){
<a name="l00757"></a>00757         global $HTTP_SERVER_VARS;
<a name="l00758"></a>00758 
<a name="l00759"></a>00759                 <span class="keywordflow">if</span> (isset($_SERVER)) {
<a name="l00760"></a>00760                         $PHP_SELF = $_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>];
<a name="l00761"></a>00761                 } elseif (isset($HTTP_SERVER_VARS)) {
<a name="l00762"></a>00762                         $PHP_SELF = $HTTP_SERVER_VARS[<span class="stringliteral">&#39;PHP_SELF&#39;</span>];
<a name="l00763"></a>00763                 } <span class="keywordflow">else</span> {
<a name="l00764"></a>00764                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;Neither _SERVER nor HTTP_SERVER_VARS is available&quot;</span>);
<a name="l00765"></a>00765                 }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767                 $b = <span class="stringliteral">&#39;</span>
<a name="l00768"></a>00768 <span class="stringliteral">                &lt;html&gt;&lt;head&gt;&lt;title&gt;NuSOAP: &#39;</span>.$this-&gt;serviceName.<span class="stringliteral">&#39;&lt;/title&gt;</span>
<a name="l00769"></a>00769 <span class="stringliteral">                &lt;style type=&quot;text/css&quot;&gt;</span>
<a name="l00770"></a>00770 <span class="stringliteral">                    body    { font-family: arial; color: #000000; background-color: #ffffff; margin: 0px 0px 0px 0px; }</span>
<a name="l00771"></a>00771 <span class="stringliteral">                    p       { font-family: arial; color: #000000; margin-top: 0px; margin-bottom: 12px; }</span>
<a name="l00772"></a>00772 <span class="stringliteral">                    pre { background-color: silver; padding: 5px; font-family: Courier New; font-size: x-small; color: #000000;}</span>
<a name="l00773"></a>00773 <span class="stringliteral">                    ul      { margin-top: 10px; margin-left: 20px; }</span>
<a name="l00774"></a>00774 <span class="stringliteral">                    li      { list-style-type: none; margin-top: 10px; color: #000000; }</span>
<a name="l00775"></a>00775 <span class="stringliteral">                    .content{</span>
<a name="l00776"></a>00776 <span class="stringliteral">                        margin-left: 0px; padding-bottom: 2em; }</span>
<a name="l00777"></a>00777 <span class="stringliteral">                    .nav {</span>
<a name="l00778"></a>00778 <span class="stringliteral">                        padding-top: 10px; padding-bottom: 10px; padding-left: 15px; font-size: .70em;</span>
<a name="l00779"></a>00779 <span class="stringliteral">                        margin-top: 10px; margin-left: 0px; color: #000000;</span>
<a name="l00780"></a>00780 <span class="stringliteral">                        background-color: #ccccff; width: 20%; margin-left: 20px; margin-top: 20px; }</span>
<a name="l00781"></a>00781 <span class="stringliteral">                    .title {</span>
<a name="l00782"></a>00782 <span class="stringliteral">                        font-family: arial; font-size: 26px; color: #ffffff;</span>
<a name="l00783"></a>00783 <span class="stringliteral">                        background-color: #999999; width: 100%;</span>
<a name="l00784"></a>00784 <span class="stringliteral">                        margin-left: 0px; margin-right: 0px;</span>
<a name="l00785"></a>00785 <span class="stringliteral">                        padding-top: 10px; padding-bottom: 10px;}</span>
<a name="l00786"></a>00786 <span class="stringliteral">                    .hidden {</span>
<a name="l00787"></a>00787 <span class="stringliteral">                        position: absolute; visibility: hidden; z-index: 200; left: 250px; top: 100px;</span>
<a name="l00788"></a>00788 <span class="stringliteral">                        font-family: arial; overflow: hidden; width: 600;</span>
<a name="l00789"></a>00789 <span class="stringliteral">                        padding: 20px; font-size: 10px; background-color: #999999;</span>
<a name="l00790"></a>00790 <span class="stringliteral">                        layer-background-color:#FFFFFF; }</span>
<a name="l00791"></a>00791 <span class="stringliteral">                    a,a:active  { color: charcoal; font-weight: bold; }</span>
<a name="l00792"></a>00792 <span class="stringliteral">                    a:visited   { color: #666666; font-weight: bold; }</span>
<a name="l00793"></a>00793 <span class="stringliteral">                    a:hover     { color: cc3300; font-weight: bold; }</span>
<a name="l00794"></a>00794 <span class="stringliteral">                &lt;/style&gt;</span>
<a name="l00795"></a>00795 <span class="stringliteral">                &lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;</span>
<a name="l00796"></a>00796 <span class="stringliteral">                &lt;!--</span>
<a name="l00797"></a>00797 <span class="stringliteral">                // POP-UP CAPTIONS...</span>
<a name="l00798"></a>00798 <span class="stringliteral">                function lib_bwcheck(){ //Browsercheck (needed)</span>
<a name="l00799"></a>00799 <span class="stringliteral">                    this.ver=navigator.appVersion</span>
<a name="l00800"></a>00800 <span class="stringliteral">                    this.agent=navigator.userAgent</span>
<a name="l00801"></a>00801 <span class="stringliteral">                    this.dom=document.getElementById?1:0</span>
<a name="l00802"></a>00802 <span class="stringliteral">                    this.opera5=this.agent.indexOf(&quot;Opera 5&quot;)&gt;-1</span>
<a name="l00803"></a>00803 <span class="stringliteral">                    this.ie5=(this.ver.indexOf(&quot;MSIE 5&quot;)&gt;-1 &amp;&amp; this.dom &amp;&amp; !this.opera5)?1:0;</span>
<a name="l00804"></a>00804 <span class="stringliteral">                    this.ie6=(this.ver.indexOf(&quot;MSIE 6&quot;)&gt;-1 &amp;&amp; this.dom &amp;&amp; !this.opera5)?1:0;</span>
<a name="l00805"></a>00805 <span class="stringliteral">                    this.ie4=(document.all &amp;&amp; !this.dom &amp;&amp; !this.opera5)?1:0;</span>
<a name="l00806"></a>00806 <span class="stringliteral">                    this.ie=this.ie4||this.ie5||this.ie6</span>
<a name="l00807"></a>00807 <span class="stringliteral">                    this.mac=this.agent.indexOf(&quot;Mac&quot;)&gt;-1</span>
<a name="l00808"></a>00808 <span class="stringliteral">                    this.ns6=(this.dom &amp;&amp; parseInt(this.ver) &gt;= 5) ?1:0;</span>
<a name="l00809"></a>00809 <span class="stringliteral">                    this.ns4=(document.layers &amp;&amp; !this.dom)?1:0;</span>
<a name="l00810"></a>00810 <span class="stringliteral">                    this.bw=(this.ie6 || this.ie5 || this.ie4 || this.ns4 || this.ns6 || this.opera5)</span>
<a name="l00811"></a>00811 <span class="stringliteral">                    return this</span>
<a name="l00812"></a>00812 <span class="stringliteral">                }</span>
<a name="l00813"></a>00813 <span class="stringliteral">                var bw = new lib_bwcheck()</span>
<a name="l00814"></a>00814 <span class="stringliteral">                //Makes crossbrowser object.</span>
<a name="l00815"></a>00815 <span class="stringliteral">                function makeObj(obj){</span>
<a name="l00816"></a>00816 <span class="stringliteral">                    this.evnt=bw.dom? document.getElementById(obj):bw.ie4?document.all[obj]:bw.ns4?document.layers[obj]:0;</span>
<a name="l00817"></a>00817 <span class="stringliteral">                    if(!this.evnt) return false</span>
<a name="l00818"></a>00818 <span class="stringliteral">                    this.css=bw.dom||bw.ie4?this.evnt.style:bw.ns4?this.evnt:0;</span>
<a name="l00819"></a>00819 <span class="stringliteral">                    this.wref=bw.dom||bw.ie4?this.evnt:bw.ns4?this.css.document:0;</span>
<a name="l00820"></a>00820 <span class="stringliteral">                    this.writeIt=b_writeIt;</span>
<a name="l00821"></a>00821 <span class="stringliteral">                    return this</span>
<a name="l00822"></a>00822 <span class="stringliteral">                }</span>
<a name="l00823"></a>00823 <span class="stringliteral">                // A unit of measure that will be added when setting the position of a layer.</span>
<a name="l00824"></a>00824 <span class="stringliteral">                //var px = bw.ns4||window.opera?&quot;&quot;:&quot;px&quot;;</span>
<a name="l00825"></a>00825 <span class="stringliteral">                function b_writeIt(text){</span>
<a name="l00826"></a>00826 <span class="stringliteral">                    if (bw.ns4){this.wref.write(text);this.wref.close()}</span>
<a name="l00827"></a>00827 <span class="stringliteral">                    else this.wref.innerHTML = text</span>
<a name="l00828"></a>00828 <span class="stringliteral">                }</span>
<a name="l00829"></a>00829 <span class="stringliteral">                //Shows the messages</span>
<a name="l00830"></a>00830 <span class="stringliteral">                var oDesc;</span>
<a name="l00831"></a>00831 <span class="stringliteral">                function popup(divid){</span>
<a name="l00832"></a>00832 <span class="stringliteral">                    if(oDesc = new makeObj(divid)){</span>
<a name="l00833"></a>00833 <span class="stringliteral">                        oDesc.css.visibility = &quot;visible&quot;</span>
<a name="l00834"></a>00834 <span class="stringliteral">                    }</span>
<a name="l00835"></a>00835 <span class="stringliteral">                }</span>
<a name="l00836"></a>00836 <span class="stringliteral">                function popout(){ // Hides message</span>
<a name="l00837"></a>00837 <span class="stringliteral">                    if(oDesc) oDesc.css.visibility = &quot;hidden&quot;</span>
<a name="l00838"></a>00838 <span class="stringliteral">                }</span>
<a name="l00839"></a>00839 <span class="stringliteral">                //--&gt;</span>
<a name="l00840"></a>00840 <span class="stringliteral">                &lt;/script&gt;</span>
<a name="l00841"></a>00841 <span class="stringliteral">                &lt;/head&gt;</span>
<a name="l00842"></a>00842 <span class="stringliteral">                &lt;body&gt;</span>
<a name="l00843"></a>00843 <span class="stringliteral">                &lt;div class=content&gt;</span>
<a name="l00844"></a>00844 <span class="stringliteral">                        &lt;br&gt;&lt;br&gt;</span>
<a name="l00845"></a>00845 <span class="stringliteral">                        &lt;div class=title&gt;&#39;</span>.$this-&gt;serviceName.<span class="stringliteral">&#39;&lt;/div&gt;</span>
<a name="l00846"></a>00846 <span class="stringliteral">                        &lt;div class=nav&gt;</span>
<a name="l00847"></a>00847 <span class="stringliteral">                                &lt;p&gt;View the &lt;a href=&quot;&#39;</span>.$PHP_SELF.<span class="stringliteral">&#39;?wsdl&quot;&gt;WSDL&lt;/a&gt; for the service.</span>
<a name="l00848"></a>00848 <span class="stringliteral">                                Click on an operation name to view it&amp;apos;s details.&lt;/p&gt;</span>
<a name="l00849"></a>00849 <span class="stringliteral">                                &lt;ul&gt;&#39;</span>;
<a name="l00850"></a>00850                                 <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="classwsdl.html#a96c36ce86df41e3b054eafb16b184cbd">getOperations</a>() as $op =&gt; $data){
<a name="l00851"></a>00851                                     $b .= <span class="stringliteral">&quot;&lt;li&gt;&lt;a href=&#39;#&#39; onclick=\&quot;popout();popup(&#39;$op&#39;)\&quot;&gt;$op&lt;/a&gt;&lt;/li&gt;&quot;</span>;
<a name="l00852"></a>00852                                     <span class="comment">// create hidden div</span>
<a name="l00853"></a>00853                                     $b .= <span class="stringliteral">&quot;&lt;div id=&#39;$op&#39; class=&#39;hidden&#39;&gt;</span>
<a name="l00854"></a>00854 <span class="stringliteral">                                    &lt;a href=&#39;#&#39; onclick=&#39;popout()&#39;&gt;&lt;font color=&#39;#ffffff&#39;&gt;Close&lt;/font&gt;&lt;/a&gt;&lt;br&gt;&lt;br&gt;&quot;</span>;
<a name="l00855"></a>00855                                     <span class="keywordflow">foreach</span>($data as $donnie =&gt; $marie){ <span class="comment">// loop through opdata</span>
<a name="l00856"></a>00856                                                 <span class="keywordflow">if</span>($donnie == <span class="stringliteral">&#39;input&#39;</span> || $donnie == <span class="stringliteral">&#39;output&#39;</span>){ <span class="comment">// show input/output data</span>
<a name="l00857"></a>00857                                                     $b .= <span class="stringliteral">&quot;&lt;font color=&#39;white&#39;&gt;&quot;</span>.ucfirst($donnie).<span class="stringliteral">&#39;:&lt;/font&gt;&lt;br&gt;&#39;</span>;
<a name="l00858"></a>00858                                                     <span class="keywordflow">foreach</span>($marie as $captain =&gt; $tenille){ <span class="comment">// loop through data</span>
<a name="l00859"></a>00859                                                                 <span class="keywordflow">if</span>($captain == <span class="stringliteral">&#39;parts&#39;</span>){ <span class="comment">// loop thru parts</span>
<a name="l00860"></a>00860                                                                     $b .= <span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;$captain:&lt;br&gt;&quot;</span>;
<a name="l00861"></a>00861                                                         <span class="comment">//if(is_array($tenille)){</span>
<a name="l00862"></a>00862                                                                         <span class="keywordflow">foreach</span>($tenille as $joanie =&gt; $chachi){
<a name="l00863"></a>00863                                                                                         $b .= <span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$joanie: $chachi&lt;br&gt;&quot;</span>;
<a name="l00864"></a>00864                                                                         }
<a name="l00865"></a>00865                                                                 <span class="comment">//}</span>
<a name="l00866"></a>00866                                                                 } <span class="keywordflow">else</span> {
<a name="l00867"></a>00867                                                                     $b .= <span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;$captain: $tenille&lt;br&gt;&quot;</span>;
<a name="l00868"></a>00868                                                                 }
<a name="l00869"></a>00869                                                     }
<a name="l00870"></a>00870                                                 } <span class="keywordflow">else</span> {
<a name="l00871"></a>00871                                                     $b .= <span class="stringliteral">&quot;&lt;font color=&#39;white&#39;&gt;&quot;</span>.ucfirst($donnie).<span class="stringliteral">&quot;:&lt;/font&gt; $marie&lt;br&gt;&quot;</span>;
<a name="l00872"></a>00872                                                 }
<a name="l00873"></a>00873                                     }
<a name="l00874"></a>00874                                         $b .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;
<a name="l00875"></a>00875                                 }
<a name="l00876"></a>00876                                 $b .= <span class="stringliteral">&#39;</span>
<a name="l00877"></a>00877 <span class="stringliteral">                                &lt;ul&gt;</span>
<a name="l00878"></a>00878 <span class="stringliteral">                        &lt;/div&gt;</span>
<a name="l00879"></a>00879 <span class="stringliteral">                &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span>;
<a name="l00880"></a>00880                 <span class="keywordflow">return</span> $b;
<a name="l00881"></a>00881     }
<a name="l00882"></a>00882 
<a name="l00890"></a><a class="code" href="classwsdl.html#a76a90258f66d3c465af1290abf687343">00890</a>         function <a class="code" href="classwsdl.html#a76a90258f66d3c465af1290abf687343">serialize</a>($debug = 0)
<a name="l00891"></a>00891         {
<a name="l00892"></a>00892                 $xml = <span class="stringliteral">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&#39;</span>;
<a name="l00893"></a>00893                 $xml .= <span class="stringliteral">&quot;\n&lt;definitions&quot;</span>;
<a name="l00894"></a>00894                 <span class="keywordflow">foreach</span>($this-&gt;namespaces as $k =&gt; $v) {
<a name="l00895"></a>00895                         $xml .= <span class="stringliteral">&quot; xmlns:$k=\&quot;$v\&quot;&quot;</span>;
<a name="l00896"></a>00896                 } 
<a name="l00897"></a>00897                 <span class="comment">// 10.9.02 - add poulter fix for wsdl and tns declarations</span>
<a name="l00898"></a>00898                 <span class="keywordflow">if</span> (isset($this-&gt;namespaces[<span class="stringliteral">&#39;wsdl&#39;</span>])) {
<a name="l00899"></a>00899                         $xml .= <span class="stringliteral">&quot; xmlns=\&quot;&quot;</span> . $this-&gt;namespaces[<span class="stringliteral">&#39;wsdl&#39;</span>] . <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00900"></a>00900                 } 
<a name="l00901"></a>00901                 <span class="keywordflow">if</span> (isset($this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>])) {
<a name="l00902"></a>00902                         $xml .= <span class="stringliteral">&quot; targetNamespace=\&quot;&quot;</span> . $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>] . <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00903"></a>00903                 } 
<a name="l00904"></a>00904                 $xml .= <span class="charliteral">&#39;&gt;&#39;</span>; 
<a name="l00905"></a>00905                 <span class="comment">// imports</span>
<a name="l00906"></a>00906                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>($this-&gt;<span class="keyword">import</span>) &gt; 0) {
<a name="l00907"></a>00907                         <span class="keywordflow">foreach</span>($this-&gt;<span class="keyword">import</span> as $ns =&gt; $list) {
<a name="l00908"></a>00908                                 <span class="keywordflow">foreach</span> ($list as $ii) {
<a name="l00909"></a>00909                                         <span class="keywordflow">if</span> ($ii[<span class="stringliteral">&#39;location&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00910"></a>00910                                                 $xml .= <span class="stringliteral">&#39;&lt;import location=&quot;&#39;</span> . $ii[<span class="stringliteral">&#39;location&#39;</span>] . <span class="stringliteral">&#39;&quot; namespace=&quot;&#39;</span> . $ns . <span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;
<a name="l00911"></a>00911                                         } <span class="keywordflow">else</span> {
<a name="l00912"></a>00912                                                 $xml .= <span class="stringliteral">&#39;&lt;import namespace=&quot;&#39;</span> . $ns . <span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;
<a name="l00913"></a>00913                                         }
<a name="l00914"></a>00914                                 }
<a name="l00915"></a>00915                         } 
<a name="l00916"></a>00916                 } 
<a name="l00917"></a>00917                 <span class="comment">// types</span>
<a name="l00918"></a>00918                 <span class="keywordflow">if</span> (count($this-&gt;schemas)&gt;=1) {
<a name="l00919"></a>00919                         $xml .= <span class="stringliteral">&quot;\n&lt;types&gt;\n&quot;</span>;
<a name="l00920"></a>00920                         <span class="keywordflow">foreach</span> ($this-&gt;schemas as $ns =&gt; $list) {
<a name="l00921"></a>00921                                 <span class="keywordflow">foreach</span> ($list as $xs) {
<a name="l00922"></a>00922                                         $xml .= $xs-&gt;serializeSchema();
<a name="l00923"></a>00923                                 }
<a name="l00924"></a>00924                         }
<a name="l00925"></a>00925                         $xml .= <span class="stringliteral">&#39;&lt;/types&gt;&#39;</span>;
<a name="l00926"></a>00926                 } 
<a name="l00927"></a>00927                 <span class="comment">// messages</span>
<a name="l00928"></a>00928                 <span class="keywordflow">if</span> (count($this-&gt;messages) &gt;= 1) {
<a name="l00929"></a>00929                         <span class="keywordflow">foreach</span>($this-&gt;messages as $msgName =&gt; $msgParts) {
<a name="l00930"></a>00930                                 $xml .= <span class="stringliteral">&quot;\n&lt;message name=\&quot;&quot;</span> . $msgName . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l00931"></a>00931                                 <span class="keywordflow">if</span>(is_array($msgParts)){
<a name="l00932"></a>00932                                         <span class="keywordflow">foreach</span>($msgParts as $partName =&gt; $partType) {
<a name="l00933"></a>00933                                                 <span class="comment">// print &#39;serializing &#39;.$partType.&#39;, sv: &#39;.$this-&gt;XMLSchemaVersion.&#39;&lt;br&gt;&#39;;</span>
<a name="l00934"></a>00934                                                 <span class="keywordflow">if</span> (strpos($partType, <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l00935"></a>00935                                                     $typePrefix = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($partType));
<a name="l00936"></a>00936                                                 } elseif (isset($this-&gt;typemap[$this-&gt;namespaces[<span class="stringliteral">&#39;xsd&#39;</span>]][$partType])) {
<a name="l00937"></a>00937                                                     <span class="comment">// print &#39;checking typemap: &#39;.$this-&gt;XMLSchemaVersion.&#39;&lt;br&gt;&#39;;</span>
<a name="l00938"></a>00938                                                     $typePrefix = <span class="stringliteral">&#39;xsd&#39;</span>;
<a name="l00939"></a>00939                                                 } <span class="keywordflow">else</span> {
<a name="l00940"></a>00940                                                     <span class="keywordflow">foreach</span>($this-&gt;typemap as $ns =&gt; $types) {
<a name="l00941"></a>00941                                                         <span class="keywordflow">if</span> (isset($types[$partType])) {
<a name="l00942"></a>00942                                                             $typePrefix = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns);
<a name="l00943"></a>00943                                                         } 
<a name="l00944"></a>00944                                                     } 
<a name="l00945"></a>00945                                                     <span class="keywordflow">if</span> (!isset($typePrefix)) {
<a name="l00946"></a>00946                                                         die(<span class="stringliteral">&quot;$partType has no namespace!&quot;</span>);
<a name="l00947"></a>00947                                                     } 
<a name="l00948"></a>00948                                                 }
<a name="l00949"></a>00949                                                 $ns = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($typePrefix);
<a name="l00950"></a>00950                                                 $localPart = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($partType);
<a name="l00951"></a>00951                                                 $typeDef = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($localPart, $ns);
<a name="l00952"></a>00952                                                 <span class="keywordflow">if</span> ($typeDef[<span class="stringliteral">&#39;typeClass&#39;</span>] == <span class="stringliteral">&#39;element&#39;</span>) {
<a name="l00953"></a>00953                                                         $elementortype = <span class="stringliteral">&#39;element&#39;</span>;
<a name="l00954"></a>00954                                                         <span class="keywordflow">if</span> (substr($localPart, -1) == <span class="charliteral">&#39;^&#39;</span>) {
<a name="l00955"></a>00955                                                                 $localPart = substr($localPart, 0, -1);
<a name="l00956"></a>00956                                                         }
<a name="l00957"></a>00957                                                 } <span class="keywordflow">else</span> {
<a name="l00958"></a>00958                                                         $elementortype = <span class="stringliteral">&#39;type&#39;</span>;
<a name="l00959"></a>00959                                                 }
<a name="l00960"></a>00960                                                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;part name=&quot;&#39;</span> . $partName . <span class="stringliteral">&#39;&quot; &#39;</span> . $elementortype . <span class="stringliteral">&#39;=&quot;&#39;</span> . $typePrefix . <span class="charliteral">&#39;:&#39;</span> . $localPart . <span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;
<a name="l00961"></a>00961                                         }
<a name="l00962"></a>00962                                 }
<a name="l00963"></a>00963                                 $xml .= <span class="stringliteral">&#39;&lt;/message&gt;&#39;</span>;
<a name="l00964"></a>00964                         } 
<a name="l00965"></a>00965                 } 
<a name="l00966"></a>00966                 <span class="comment">// bindings &amp; porttypes</span>
<a name="l00967"></a>00967                 <span class="keywordflow">if</span> (count($this-&gt;bindings) &gt;= 1) {
<a name="l00968"></a>00968                         $binding_xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00969"></a>00969                         $portType_xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00970"></a>00970                         <span class="keywordflow">foreach</span>($this-&gt;bindings as $bindingName =&gt; $attrs) {
<a name="l00971"></a>00971                                 $binding_xml .= <span class="stringliteral">&quot;\n&lt;binding name=\&quot;&quot;</span> . $bindingName . <span class="stringliteral">&#39;&quot; type=&quot;tns:&#39;</span> . $attrs[<span class="stringliteral">&#39;portType&#39;</span>] . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l00972"></a>00972                                 $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;soap:binding style=&quot;&#39;</span> . $attrs[<span class="stringliteral">&#39;style&#39;</span>] . <span class="stringliteral">&#39;&quot; transport=&quot;&#39;</span> . $attrs[<span class="stringliteral">&#39;transport&#39;</span>] . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l00973"></a>00973                                 $portType_xml .= <span class="stringliteral">&quot;\n&lt;portType name=\&quot;&quot;</span> . $attrs[<span class="stringliteral">&#39;portType&#39;</span>] . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l00974"></a>00974                                 <span class="keywordflow">foreach</span>($attrs[<span class="stringliteral">&#39;operations&#39;</span>] as $opName =&gt; $opParts) {
<a name="l00975"></a>00975                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;operation name=&quot;&#39;</span> . $opName . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l00976"></a>00976                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;soap:operation soapAction=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;soapAction&#39;</span>] . <span class="stringliteral">&#39;&quot; style=&quot;&#39;</span>. $opParts[<span class="stringliteral">&#39;style&#39;</span>] . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l00977"></a>00977                                         <span class="keywordflow">if</span> (isset($opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00978"></a>00978                                                 $enc_style = <span class="stringliteral">&#39; encodingStyle=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00979"></a>00979                                         } <span class="keywordflow">else</span> {
<a name="l00980"></a>00980                                                 $enc_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00981"></a>00981                                         }
<a name="l00982"></a>00982                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;input&gt;&lt;soap:body use=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;use&#39;</span>] . <span class="stringliteral">&#39;&quot; namespace=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;namespace&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span> . $enc_style . <span class="stringliteral">&#39;/&gt;&lt;/input&gt;&#39;</span>;
<a name="l00983"></a>00983                                         <span class="keywordflow">if</span> (isset($opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00984"></a>00984                                                 $enc_style = <span class="stringliteral">&#39; encodingStyle=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00985"></a>00985                                         } <span class="keywordflow">else</span> {
<a name="l00986"></a>00986                                                 $enc_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00987"></a>00987                                         }
<a name="l00988"></a>00988                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;output&gt;&lt;soap:body use=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;use&#39;</span>] . <span class="stringliteral">&#39;&quot; namespace=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;namespace&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span> . $enc_style . <span class="stringliteral">&#39;/&gt;&lt;/output&gt;&#39;</span>;
<a name="l00989"></a>00989                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;/operation&gt;&#39;</span>;
<a name="l00990"></a>00990                                         $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;operation name=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;name&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00991"></a>00991                                         <span class="keywordflow">if</span> (isset($opParts[<span class="stringliteral">&#39;parameterOrder&#39;</span>])) {
<a name="l00992"></a>00992                                             $portType_xml .= <span class="stringliteral">&#39; parameterOrder=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;parameterOrder&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00993"></a>00993                                         } 
<a name="l00994"></a>00994                                         $portType_xml .= <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l00995"></a>00995                                         <span class="keywordflow">if</span>(isset($opParts[<span class="stringliteral">&#39;documentation&#39;</span>]) &amp;&amp; $opParts[<span class="stringliteral">&#39;documentation&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00996"></a>00996                                                 $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;documentation&gt;&#39;</span> . htmlspecialchars($opParts[<span class="stringliteral">&#39;documentation&#39;</span>]) . <span class="stringliteral">&#39;&lt;/documentation&gt;&#39;</span>;
<a name="l00997"></a>00997                                         }
<a name="l00998"></a>00998                                         $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;input message=&quot;tns:&#39;</span> . $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l00999"></a>00999                                         $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;output message=&quot;tns:&#39;</span> . $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l01000"></a>01000                                         $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;/operation&gt;&#39;</span>;
<a name="l01001"></a>01001                                 } 
<a name="l01002"></a>01002                                 $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;&lt;/portType&gt;&#39;</span>;
<a name="l01003"></a>01003                                 $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;&lt;/binding&gt;&#39;</span>;
<a name="l01004"></a>01004                         } 
<a name="l01005"></a>01005                         $xml .= $portType_xml . $binding_xml;
<a name="l01006"></a>01006                 } 
<a name="l01007"></a>01007                 <span class="comment">// services</span>
<a name="l01008"></a>01008                 $xml .= <span class="stringliteral">&quot;\n&lt;service name=\&quot;&quot;</span> . $this-&gt;serviceName . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l01009"></a>01009                 <span class="keywordflow">if</span> (count($this-&gt;ports) &gt;= 1) {
<a name="l01010"></a>01010                         <span class="keywordflow">foreach</span>($this-&gt;ports as $pName =&gt; $attrs) {
<a name="l01011"></a>01011                                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;port name=&quot;&#39;</span> . $pName . <span class="stringliteral">&#39;&quot; binding=&quot;tns:&#39;</span> . $attrs[<span class="stringliteral">&#39;binding&#39;</span>] . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l01012"></a>01012                                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;soap:address location=&quot;&#39;</span> . $attrs[<span class="stringliteral">&#39;location&#39;</span>] . ($debug ? <span class="stringliteral">&#39;?debug=1&#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l01013"></a>01013                                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;/port&gt;&#39;</span>;
<a name="l01014"></a>01014                         } 
<a name="l01015"></a>01015                 } 
<a name="l01016"></a>01016                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;&lt;/service&gt;&#39;</span>;
<a name="l01017"></a>01017                 <span class="keywordflow">return</span> $xml . <span class="stringliteral">&quot;\n&lt;/definitions&gt;&quot;</span>;
<a name="l01018"></a>01018         } 
<a name="l01019"></a>01019 
<a name="l01029"></a><a class="code" href="classwsdl.html#aa84db420c2c8b34a2c148ea69bd02322">01029</a>         function <a class="code" href="classwsdl.html#aa84db420c2c8b34a2c148ea69bd02322">parametersMatchWrapped</a>($type, &amp;$parameters) {
<a name="l01030"></a>01030                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped type=$type, parameters=&quot;</span>);
<a name="l01031"></a>01031                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($parameters));
<a name="l01032"></a>01032 
<a name="l01033"></a>01033                 <span class="comment">// split type into namespace:unqualified-type</span>
<a name="l01034"></a>01034                 <span class="keywordflow">if</span> (strpos($type, <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l01035"></a>01035                         $uqType = substr($type, strrpos($type, <span class="charliteral">&#39;:&#39;</span>) + 1);
<a name="l01036"></a>01036                         $ns = substr($type, 0, strrpos($type, <span class="charliteral">&#39;:&#39;</span>));
<a name="l01037"></a>01037                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: got a prefixed type: $uqType, $ns&quot;</span>);
<a name="l01038"></a>01038                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($ns)) {
<a name="l01039"></a>01039                                 $ns = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($ns);
<a name="l01040"></a>01040                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: expanded prefixed type: $uqType, $ns&quot;</span>);
<a name="l01041"></a>01041                         }
<a name="l01042"></a>01042                 } <span class="keywordflow">else</span> {
<a name="l01043"></a>01043                         <span class="comment">// TODO: should the type be compared to types in XSD, and the namespace</span>
<a name="l01044"></a>01044                         <span class="comment">// set to XSD if the type matches?</span>
<a name="l01045"></a>01045                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: No namespace for type $type&quot;</span>);
<a name="l01046"></a>01046                         $ns = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01047"></a>01047                         $uqType = $type;
<a name="l01048"></a>01048                 }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050                 <span class="comment">// get the type information</span>
<a name="l01051"></a>01051                 <span class="keywordflow">if</span> (!$typeDef = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqType, $ns)) {
<a name="l01052"></a>01052                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: $type ($uqType) is not a supported type.&quot;</span>);
<a name="l01053"></a>01053                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01054"></a>01054                 }
<a name="l01055"></a>01055                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: found typeDef=&quot;</span>);
<a name="l01056"></a>01056                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($typeDef));
<a name="l01057"></a>01057                 <span class="keywordflow">if</span> (substr($uqType, -1) == <span class="charliteral">&#39;^&#39;</span>) {
<a name="l01058"></a>01058                         $uqType = substr($uqType, 0, -1);
<a name="l01059"></a>01059                 }
<a name="l01060"></a>01060                 $phpType = $typeDef[<span class="stringliteral">&#39;phpType&#39;</span>];
<a name="l01061"></a>01061                 $arrayType = (isset($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]) ? $typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l01062"></a>01062                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: uqType: $uqType, ns: $ns, phptype: $phpType, arrayType: $arrayType&quot;</span>);
<a name="l01063"></a>01063                 
<a name="l01064"></a>01064                 <span class="comment">// we expect a complexType or element of complexType</span>
<a name="l01065"></a>01065                 <span class="keywordflow">if</span> ($phpType != <span class="stringliteral">&#39;struct&#39;</span>) {
<a name="l01066"></a>01066                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: not a struct&quot;</span>);
<a name="l01067"></a>01067                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01068"></a>01068                 }
<a name="l01069"></a>01069 
<a name="l01070"></a>01070                 <span class="comment">// see whether the parameter names match the elements</span>
<a name="l01071"></a>01071                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;elements&#39;</span>]) &amp;&amp; is_array($typeDef[<span class="stringliteral">&#39;elements&#39;</span>])) {
<a name="l01072"></a>01072                         $elements = 0;
<a name="l01073"></a>01073                         $matches = 0;
<a name="l01074"></a>01074                         <span class="keywordflow">foreach</span> ($typeDef[<span class="stringliteral">&#39;elements&#39;</span>] as $name =&gt; $attrs) {
<a name="l01075"></a>01075                                 <span class="keywordflow">if</span> (isset($parameters[$name])) {
<a name="l01076"></a>01076                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: have parameter named $name&quot;</span>);
<a name="l01077"></a>01077                                         $matches++;
<a name="l01078"></a>01078                                 } <span class="keywordflow">else</span> {
<a name="l01079"></a>01079                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: do not have parameter named $name&quot;</span>);
<a name="l01080"></a>01080                                 }
<a name="l01081"></a>01081                                 $elements++;
<a name="l01082"></a>01082                         }
<a name="l01083"></a>01083 
<a name="l01084"></a>01084                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: $matches parameter names match $elements wrapped parameter names&quot;</span>);
<a name="l01085"></a>01085                         <span class="keywordflow">if</span> ($matches == 0) {
<a name="l01086"></a>01086                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01087"></a>01087                         }
<a name="l01088"></a>01088                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01089"></a>01089                 }
<a name="l01090"></a>01090 
<a name="l01091"></a>01091                 <span class="comment">// since there are no elements for the type, if the user passed no</span>
<a name="l01092"></a>01092                 <span class="comment">// parameters, the parameters match wrapped.</span>
<a name="l01093"></a>01093                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: no elements type $ns:$uqType&quot;</span>);
<a name="l01094"></a>01094                 <span class="keywordflow">return</span> count($parameters) == 0;
<a name="l01095"></a>01095         }
<a name="l01096"></a>01096 
<a name="l01112"></a><a class="code" href="classwsdl.html#a172cd927fe399da9285a022aad8b47b7">01112</a>         function <a class="code" href="classwsdl.html#a172cd927fe399da9285a022aad8b47b7">serializeRPCParameters</a>($operation, $direction, $parameters, $bindingType = <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l01113"></a>01113                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeRPCParameters: operation=$operation, direction=$direction, XMLSchemaVersion=$this-&gt;XMLSchemaVersion, bindingType=$bindingType&quot;</span>);
<a name="l01114"></a>01114                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;parameters=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($parameters));
<a name="l01115"></a>01115                 
<a name="l01116"></a>01116                 <span class="keywordflow">if</span> ($direction != <span class="stringliteral">&#39;input&#39;</span> &amp;&amp; $direction != <span class="stringliteral">&#39;output&#39;</span>) {
<a name="l01117"></a>01117                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The value of the \$direction argument needs to be either &quot;input&quot; or &quot;output&quot;&#39;</span>);
<a name="l01118"></a>01118                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;The value of the \$direction argument needs to be either &quot;input&quot; or &quot;output&quot;&#39;</span>);
<a name="l01119"></a>01119                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01120"></a>01120                 } 
<a name="l01121"></a>01121                 <span class="keywordflow">if</span> (!<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a> = $this-&gt;<a class="code" href="classwsdl.html#a67a91d9d9f62574149c609c62849664d">getOperationData</a>($operation, $bindingType)) {
<a name="l01122"></a>01122                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Unable to retrieve WSDL data for operation: &#39;</span> . $operation . <span class="stringliteral">&#39; bindingType: &#39;</span> . $bindingType);
<a name="l01123"></a>01123                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Unable to retrieve WSDL data for operation: &#39;</span> . $operation . <span class="stringliteral">&#39; bindingType: &#39;</span> . $bindingType);
<a name="l01124"></a>01124                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01125"></a>01125                 }
<a name="l01126"></a>01126                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeRPCParameters: opData:&#39;</span>);
<a name="l01127"></a>01127                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>));
<a name="l01128"></a>01128 
<a name="l01129"></a>01129                 <span class="comment">// Get encoding style for output and set to current</span>
<a name="l01130"></a>01130                 $encodingStyle = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>;
<a name="l01131"></a>01131                 <span class="keywordflow">if</span>(($direction == <span class="stringliteral">&#39;input&#39;</span>) &amp;&amp; isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; (<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] != $encodingStyle)) {
<a name="l01132"></a>01132                         $encodingStyle = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>];
<a name="l01133"></a>01133                         $enc_style = $encodingStyle;
<a name="l01134"></a>01134                 }
<a name="l01135"></a>01135 
<a name="l01136"></a>01136                 <span class="comment">// set input params</span>
<a name="l01137"></a>01137                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01138"></a>01138                 <span class="keywordflow">if</span> (isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) &amp;&amp; <span class="keyword">sizeof</span>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) &gt; 0) {
<a name="l01139"></a>01139                         $parts = &amp;<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>];
<a name="l01140"></a>01140                         $part_count = <span class="keyword">sizeof</span>($parts);
<a name="l01141"></a>01141                         $style = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;style&#39;</span>];
<a name="l01142"></a>01142                         $use = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;use&#39;</span>];
<a name="l01143"></a>01143                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;have $part_count part(s) to serialize using $style/$use&quot;</span>);
<a name="l01144"></a>01144                         <span class="keywordflow">if</span> (is_array($parameters)) {
<a name="l01145"></a>01145                                 $parametersArrayType = $this-&gt;<a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">isArraySimpleOrStruct</a>($parameters);
<a name="l01146"></a>01146                                 $parameter_count = count($parameters);
<a name="l01147"></a>01147                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;have $parameter_count parameter(s) provided as $parametersArrayType to serialize&quot;</span>);
<a name="l01148"></a>01148                                 <span class="comment">// check for Microsoft-style wrapped parameters</span>
<a name="l01149"></a>01149                                 <span class="keywordflow">if</span> ($style == <span class="stringliteral">&#39;document&#39;</span> &amp;&amp; $use == <span class="stringliteral">&#39;literal&#39;</span> &amp;&amp; $part_count == 1 &amp;&amp; isset($parts[<span class="stringliteral">&#39;parameters&#39;</span>])) {
<a name="l01150"></a>01150                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;check whether the caller has wrapped the parameters&#39;</span>);
<a name="l01151"></a>01151                                         <span class="keywordflow">if</span> ($direction == <span class="stringliteral">&#39;output&#39;</span> &amp;&amp; $parametersArrayType == <span class="stringliteral">&#39;arraySimple&#39;</span> &amp;&amp; $parameter_count == 1) {
<a name="l01152"></a>01152                                                 <span class="comment">// TODO: consider checking here for double-wrapping, when</span>
<a name="l01153"></a>01153                                                 <span class="comment">// service function wraps, then NuSOAP wraps again</span>
<a name="l01154"></a>01154                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;change simple array to associative with &#39;parameters&#39; element&quot;</span>);
<a name="l01155"></a>01155                                                 $parameters[<span class="stringliteral">&#39;parameters&#39;</span>] = $parameters[0];
<a name="l01156"></a>01156                                                 unset($parameters[0]);
<a name="l01157"></a>01157                                         }
<a name="l01158"></a>01158                                         <span class="keywordflow">if</span> (($parametersArrayType == <span class="stringliteral">&#39;arrayStruct&#39;</span> || $parameter_count == 0) &amp;&amp; !isset($parameters[<span class="stringliteral">&#39;parameters&#39;</span>])) {
<a name="l01159"></a>01159                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;check whether caller\&#39;s parameters match the wrapped ones&#39;</span>);
<a name="l01160"></a>01160                                                 <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classwsdl.html#aa84db420c2c8b34a2c148ea69bd02322">parametersMatchWrapped</a>($parts[<span class="stringliteral">&#39;parameters&#39;</span>], $parameters)) {
<a name="l01161"></a>01161                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;wrap the parameters for the caller&#39;</span>);
<a name="l01162"></a>01162                                                         $parameters = array(<span class="stringliteral">&#39;parameters&#39;</span> =&gt; $parameters);
<a name="l01163"></a>01163                                                         $parameter_count = 1;
<a name="l01164"></a>01164                                                 }
<a name="l01165"></a>01165                                         }
<a name="l01166"></a>01166                                 }
<a name="l01167"></a>01167                                 <span class="keywordflow">foreach</span> ($parts as $name =&gt; $type) {
<a name="l01168"></a>01168                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing part $name of type $type&quot;</span>);
<a name="l01169"></a>01169                                         <span class="comment">// Track encoding style</span>
<a name="l01170"></a>01170                                         <span class="keywordflow">if</span> (isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; $encodingStyle != <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) {
<a name="l01171"></a>01171                                                 $encodingStyle = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>];                  
<a name="l01172"></a>01172                                                 $enc_style = $encodingStyle;
<a name="l01173"></a>01173                                         } <span class="keywordflow">else</span> {
<a name="l01174"></a>01174                                                 $enc_style = <span class="keyword">false</span>;
<a name="l01175"></a>01175                                         }
<a name="l01176"></a>01176                                         <span class="comment">// NOTE: add error handling here</span>
<a name="l01177"></a>01177                                         <span class="comment">// if serializeType returns false, then catch global error and fault</span>
<a name="l01178"></a>01178                                         <span class="keywordflow">if</span> ($parametersArrayType == <span class="stringliteral">&#39;arraySimple&#39;</span>) {
<a name="l01179"></a>01179                                                 $p = array_shift($parameters);
<a name="l01180"></a>01180                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/indexed param&#39;</span>);
<a name="l01181"></a>01181                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $p, $use, $enc_style);
<a name="l01182"></a>01182                                         } elseif (isset($parameters[$name])) {
<a name="l01183"></a>01183                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/named param&#39;</span>);
<a name="l01184"></a>01184                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $parameters[$name], $use, $enc_style);
<a name="l01185"></a>01185                                         } <span class="keywordflow">else</span> {
<a name="l01186"></a>01186                                                 <span class="comment">// TODO: only send nillable</span>
<a name="l01187"></a>01187                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/null param&#39;</span>);
<a name="l01188"></a>01188                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, null, $use, $enc_style);
<a name="l01189"></a>01189                                         }
<a name="l01190"></a>01190                                 }
<a name="l01191"></a>01191                         } <span class="keywordflow">else</span> {
<a name="l01192"></a>01192                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no parameters passed.&#39;</span>);
<a name="l01193"></a>01193                         }
<a name="l01194"></a>01194                 }
<a name="l01195"></a>01195                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializeRPCParameters returning: $xml&quot;</span>);
<a name="l01196"></a>01196                 <span class="keywordflow">return</span> $xml;
<a name="l01197"></a>01197         } 
<a name="l01198"></a>01198         
<a name="l01213"></a><a class="code" href="classwsdl.html#a5de2338b860901c2c5c1a6cf726b1d7f">01213</a>         function <a class="code" href="classwsdl.html#a5de2338b860901c2c5c1a6cf726b1d7f">serializeParameters</a>($operation, $direction, $parameters)
<a name="l01214"></a>01214         {
<a name="l01215"></a>01215                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeParameters: operation=$operation, direction=$direction, XMLSchemaVersion=$this-&gt;XMLSchemaVersion&quot;</span>); 
<a name="l01216"></a>01216                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;parameters=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($parameters));
<a name="l01217"></a>01217                 
<a name="l01218"></a>01218                 <span class="keywordflow">if</span> ($direction != <span class="stringliteral">&#39;input&#39;</span> &amp;&amp; $direction != <span class="stringliteral">&#39;output&#39;</span>) {
<a name="l01219"></a>01219                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The value of the \$direction argument needs to be either &quot;input&quot; or &quot;output&quot;&#39;</span>);
<a name="l01220"></a>01220                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;The value of the \$direction argument needs to be either &quot;input&quot; or &quot;output&quot;&#39;</span>);
<a name="l01221"></a>01221                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01222"></a>01222                 } 
<a name="l01223"></a>01223                 <span class="keywordflow">if</span> (!<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a> = $this-&gt;<a class="code" href="classwsdl.html#a67a91d9d9f62574149c609c62849664d">getOperationData</a>($operation)) {
<a name="l01224"></a>01224                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Unable to retrieve WSDL data for operation: &#39;</span> . $operation);
<a name="l01225"></a>01225                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Unable to retrieve WSDL data for operation: &#39;</span> . $operation);
<a name="l01226"></a>01226                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01227"></a>01227                 }
<a name="l01228"></a>01228                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;opData:&#39;</span>);
<a name="l01229"></a>01229                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>));
<a name="l01230"></a>01230                 
<a name="l01231"></a>01231                 <span class="comment">// Get encoding style for output and set to current</span>
<a name="l01232"></a>01232                 $encodingStyle = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>;
<a name="l01233"></a>01233                 <span class="keywordflow">if</span>(($direction == <span class="stringliteral">&#39;input&#39;</span>) &amp;&amp; isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; (<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] != $encodingStyle)) {
<a name="l01234"></a>01234                         $encodingStyle = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>];
<a name="l01235"></a>01235                         $enc_style = $encodingStyle;
<a name="l01236"></a>01236                 }
<a name="l01237"></a>01237                 
<a name="l01238"></a>01238                 <span class="comment">// set input params</span>
<a name="l01239"></a>01239                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01240"></a>01240                 <span class="keywordflow">if</span> (isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) &amp;&amp; <span class="keyword">sizeof</span>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) &gt; 0) {
<a name="l01241"></a>01241                         
<a name="l01242"></a>01242                         $use = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;use&#39;</span>];
<a name="l01243"></a>01243                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;use=$use&quot;</span>);
<a name="l01244"></a>01244                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got &#39;</span> . count(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) . <span class="stringliteral">&#39; part(s)&#39;</span>);
<a name="l01245"></a>01245                         <span class="keywordflow">if</span> (is_array($parameters)) {
<a name="l01246"></a>01246                                 $parametersArrayType = $this-&gt;<a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">isArraySimpleOrStruct</a>($parameters);
<a name="l01247"></a>01247                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;have &#39;</span> . $parametersArrayType . <span class="stringliteral">&#39; parameters&#39;</span>);
<a name="l01248"></a>01248                                 <span class="keywordflow">foreach</span>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>] as $name =&gt; $type) {
<a name="l01249"></a>01249                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;serializing part &quot;&#39;</span>.$name.<span class="stringliteral">&#39;&quot; of type &quot;&#39;</span>.$type.<span class="charliteral">&#39;&quot;&#39;</span>);
<a name="l01250"></a>01250                                         <span class="comment">// Track encoding style</span>
<a name="l01251"></a>01251                                         <span class="keywordflow">if</span>(isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; $encodingStyle != <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) {
<a name="l01252"></a>01252                                                 $encodingStyle = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>];                  
<a name="l01253"></a>01253                                                 $enc_style = $encodingStyle;
<a name="l01254"></a>01254                                         } <span class="keywordflow">else</span> {
<a name="l01255"></a>01255                                                 $enc_style = <span class="keyword">false</span>;
<a name="l01256"></a>01256                                         }
<a name="l01257"></a>01257                                         <span class="comment">// NOTE: add error handling here</span>
<a name="l01258"></a>01258                                         <span class="comment">// if serializeType returns false, then catch global error and fault</span>
<a name="l01259"></a>01259                                         <span class="keywordflow">if</span> ($parametersArrayType == <span class="stringliteral">&#39;arraySimple&#39;</span>) {
<a name="l01260"></a>01260                                                 $p = array_shift($parameters);
<a name="l01261"></a>01261                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/indexed param&#39;</span>);
<a name="l01262"></a>01262                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $p, $use, $enc_style);
<a name="l01263"></a>01263                                         } elseif (isset($parameters[$name])) {
<a name="l01264"></a>01264                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/named param&#39;</span>);
<a name="l01265"></a>01265                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $parameters[$name], $use, $enc_style);
<a name="l01266"></a>01266                                         } <span class="keywordflow">else</span> {
<a name="l01267"></a>01267                                                 <span class="comment">// TODO: only send nillable</span>
<a name="l01268"></a>01268                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/null param&#39;</span>);
<a name="l01269"></a>01269                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, null, $use, $enc_style);
<a name="l01270"></a>01270                                         }
<a name="l01271"></a>01271                                 }
<a name="l01272"></a>01272                         } <span class="keywordflow">else</span> {
<a name="l01273"></a>01273                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no parameters passed.&#39;</span>);
<a name="l01274"></a>01274                         }
<a name="l01275"></a>01275                 }
<a name="l01276"></a>01276                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializeParameters returning: $xml&quot;</span>);
<a name="l01277"></a>01277                 <span class="keywordflow">return</span> $xml;
<a name="l01278"></a>01278         } 
<a name="l01279"></a>01279         
<a name="l01292"></a><a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">01292</a>         function <a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $value, $use=<span class="stringliteral">&#39;encoded&#39;</span>, $encodingStyle=<span class="keyword">false</span>, $unqualified=<span class="keyword">false</span>)
<a name="l01293"></a>01293         {
<a name="l01294"></a>01294                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: name=$name, type=$type, use=$use, encodingStyle=$encodingStyle, unqualified=&quot;</span> . ($unqualified ? <span class="stringliteral">&quot;unqualified&quot;</span> : <span class="stringliteral">&quot;qualified&quot;</span>));
<a name="l01295"></a>01295                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&quot;value=&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($value));
<a name="l01296"></a>01296                 <span class="keywordflow">if</span>($use == <span class="stringliteral">&#39;encoded&#39;</span> &amp;&amp; $encodingStyle) {
<a name="l01297"></a>01297                         $encodingStyle = <span class="stringliteral">&#39; SOAP-ENV:encodingStyle=&quot;&#39;</span> . $encodingStyle . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01298"></a>01298                 }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300                 <span class="comment">// if a soapval has been supplied, let its type override the WSDL</span>
<a name="l01301"></a>01301         <span class="keywordflow">if</span> (is_object($value) &amp;&amp; get_class($value) == <span class="stringliteral">&#39;soapval&#39;</span>) {
<a name="l01302"></a>01302                 <span class="keywordflow">if</span> ($value-&gt;type_ns) {
<a name="l01303"></a>01303                         $type = $value-&gt;type_ns . <span class="charliteral">&#39;:&#39;</span> . $value-&gt;type;
<a name="l01304"></a>01304                         $forceType = <span class="keyword">true</span>;
<a name="l01305"></a>01305                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval overrides type to $type&quot;</span>);
<a name="l01306"></a>01306                 } elseif ($value-&gt;type) {
<a name="l01307"></a>01307                         $type = $value-&gt;type;
<a name="l01308"></a>01308                         $forceType = <span class="keyword">true</span>;
<a name="l01309"></a>01309                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval overrides type to $type&quot;</span>);
<a name="l01310"></a>01310                 } <span class="keywordflow">else</span> {
<a name="l01311"></a>01311                         $forceType = <span class="keyword">false</span>;
<a name="l01312"></a>01312                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval does not override type&quot;</span>);
<a name="l01313"></a>01313                 }
<a name="l01314"></a>01314                 $attrs = $value-&gt;attributes;
<a name="l01315"></a>01315                 $value = $value-&gt;value;
<a name="l01316"></a>01316                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval overrides value to $value&quot;</span>);
<a name="l01317"></a>01317                 <span class="keywordflow">if</span> ($attrs) {
<a name="l01318"></a>01318                         <span class="keywordflow">if</span> (!is_array($value)) {
<a name="l01319"></a>01319                                 $value[<span class="charliteral">&#39;!&#39;</span>] = $value;
<a name="l01320"></a>01320                         }
<a name="l01321"></a>01321                         <span class="keywordflow">foreach</span> ($attrs as $n =&gt; $v) {
<a name="l01322"></a>01322                                 $value[<span class="charliteral">&#39;!&#39;</span> . $n] = $v;
<a name="l01323"></a>01323                         }
<a name="l01324"></a>01324                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval provides attributes&quot;</span>);
<a name="l01325"></a>01325                     }
<a name="l01326"></a>01326         } <span class="keywordflow">else</span> {
<a name="l01327"></a>01327                 $forceType = <span class="keyword">false</span>;
<a name="l01328"></a>01328         }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01331"></a>01331                 <span class="keywordflow">if</span> (strpos($type, <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l01332"></a>01332                         $uqType = substr($type, strrpos($type, <span class="charliteral">&#39;:&#39;</span>) + 1);
<a name="l01333"></a>01333                         $ns = substr($type, 0, strrpos($type, <span class="charliteral">&#39;:&#39;</span>));
<a name="l01334"></a>01334                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: got a prefixed type: $uqType, $ns&quot;</span>);
<a name="l01335"></a>01335                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($ns)) {
<a name="l01336"></a>01336                                 $ns = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($ns);
<a name="l01337"></a>01337                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: expanded prefixed type: $uqType, $ns&quot;</span>);
<a name="l01338"></a>01338                         }
<a name="l01339"></a>01339 
<a name="l01340"></a>01340                         <span class="keywordflow">if</span>($ns == $this-&gt;XMLSchemaVersion || $ns == <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>){
<a name="l01341"></a>01341                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeType: type namespace indicates XML Schema or SOAP Encoding type&#39;</span>);
<a name="l01342"></a>01342                                 <span class="keywordflow">if</span> ($unqualified &amp;&amp; $use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l01343"></a>01343                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l01344"></a>01344                                 } <span class="keywordflow">else</span> {
<a name="l01345"></a>01345                                         $elementNS = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01346"></a>01346                                 }
<a name="l01347"></a>01347                                 <span class="keywordflow">if</span> (is_null($value)) {
<a name="l01348"></a>01348                                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l01349"></a>01349                                                 <span class="comment">// TODO: depends on minOccurs</span>
<a name="l01350"></a>01350                                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS/&gt;&quot;</span>;
<a name="l01351"></a>01351                                         } <span class="keywordflow">else</span> {
<a name="l01352"></a>01352                                                 <span class="comment">// TODO: depends on nillable, which should be checked before calling this method</span>
<a name="l01353"></a>01353                                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:nil=\&quot;true\&quot; xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;/&gt;&quot;</span>;
<a name="l01354"></a>01354                                         }
<a name="l01355"></a>01355                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l01356"></a>01356                                         <span class="keywordflow">return</span> $xml;
<a name="l01357"></a>01357                                 }
<a name="l01358"></a>01358                                 <span class="keywordflow">if</span> ($uqType == <span class="stringliteral">&#39;Array&#39;</span>) {
<a name="l01359"></a>01359                                         <span class="comment">// JBoss/Axis does this sometimes</span>
<a name="l01360"></a>01360                                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($value, $name, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, $use);
<a name="l01361"></a>01361                                 }
<a name="l01362"></a>01362                         <span class="keywordflow">if</span> ($uqType == <span class="stringliteral">&#39;boolean&#39;</span>) {
<a name="l01363"></a>01363                                 <span class="keywordflow">if</span> ((is_string($value) &amp;&amp; $value == <span class="stringliteral">&#39;false&#39;</span>) || (! $value)) {
<a name="l01364"></a>01364                                                 $value = <span class="stringliteral">&#39;false&#39;</span>;
<a name="l01365"></a>01365                                         } <span class="keywordflow">else</span> {
<a name="l01366"></a>01366                                                 $value = <span class="stringliteral">&#39;true&#39;</span>;
<a name="l01367"></a>01367                                         }
<a name="l01368"></a>01368                                 } 
<a name="l01369"></a>01369                                 <span class="keywordflow">if</span> ($uqType == <span class="stringliteral">&#39;string&#39;</span> &amp;&amp; gettype($value) == <span class="stringliteral">&#39;string&#39;</span>) {
<a name="l01370"></a>01370                                         $value = $this-&gt;<a class="code" href="classnusoap__base.html#aa05581a9628de0f46b30dd67b5578cef">expandEntities</a>($value);
<a name="l01371"></a>01371                                 }
<a name="l01372"></a>01372                                 <span class="keywordflow">if</span> (($uqType == <span class="stringliteral">&#39;long&#39;</span> || $uqType == <span class="stringliteral">&#39;unsignedLong&#39;</span>) &amp;&amp; gettype($value) == <span class="stringliteral">&#39;double&#39;</span>) {
<a name="l01373"></a>01373                                         $value = sprintf(<span class="stringliteral">&quot;%.0lf&quot;</span>, $value);
<a name="l01374"></a>01374                                 }
<a name="l01375"></a>01375                                 <span class="comment">// it&#39;s a scalar</span>
<a name="l01376"></a>01376                                 <span class="comment">// TODO: what about null/nil values?</span>
<a name="l01377"></a>01377                                 <span class="comment">// check type isn&#39;t a custom type extending xmlschema namespace</span>
<a name="l01378"></a>01378                                 <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqType, $ns)) {
<a name="l01379"></a>01379                                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l01380"></a>01380                                                 <span class="keywordflow">if</span> ($forceType) {
<a name="l01381"></a>01381                                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l01382"></a>01382                                                 } <span class="keywordflow">else</span> {
<a name="l01383"></a>01383                                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l01384"></a>01384                                                 }
<a name="l01385"></a>01385                                         } <span class="keywordflow">else</span> {
<a name="l01386"></a>01386                                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;$encodingStyle&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l01387"></a>01387                                         }
<a name="l01388"></a>01388                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l01389"></a>01389                                         <span class="keywordflow">return</span> $xml;
<a name="l01390"></a>01390                                 }
<a name="l01391"></a>01391                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;custom type extends XML Schema or SOAP Encoding namespace (yuck)&#39;</span>);
<a name="l01392"></a>01392                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($ns == <span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>) {
<a name="l01393"></a>01393                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeType: appears to be Apache SOAP type&#39;</span>);
<a name="l01394"></a>01394                                 <span class="keywordflow">if</span> ($uqType == <span class="stringliteral">&#39;Map&#39;</span>) {
<a name="l01395"></a>01395                                         $tt_prefix = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>);
<a name="l01396"></a>01396                                         <span class="keywordflow">if</span> (! $tt_prefix) {
<a name="l01397"></a>01397                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeType: Add namespace for Apache SOAP type&#39;</span>);
<a name="l01398"></a>01398                                                 $tt_prefix = <span class="stringliteral">&#39;ns&#39;</span> . rand(1000, 9999);
<a name="l01399"></a>01399                                                 $this-&gt;namespaces[$tt_prefix] = <span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>;
<a name="l01400"></a>01400                                                 <span class="comment">// force this to be added to usedNamespaces</span>
<a name="l01401"></a>01401                                                 $tt_prefix = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>);
<a name="l01402"></a>01402                                         }
<a name="l01403"></a>01403                                         $contents = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01404"></a>01404                                         <span class="keywordflow">foreach</span>($value as $k =&gt; $v) {
<a name="l01405"></a>01405                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing map element: key $k, value $v&quot;</span>);
<a name="l01406"></a>01406                                                 $contents .= <span class="stringliteral">&#39;&lt;item&gt;&#39;</span>;
<a name="l01407"></a>01407                                                 $contents .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($k,<span class="stringliteral">&#39;key&#39;</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l01408"></a>01408                                                 $contents .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v,<span class="stringliteral">&#39;value&#39;</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l01409"></a>01409                                                 $contents .= <span class="stringliteral">&#39;&lt;/item&gt;&#39;</span>;
<a name="l01410"></a>01410                                         }
<a name="l01411"></a>01411                                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l01412"></a>01412                                                 <span class="keywordflow">if</span> ($forceType) {
<a name="l01413"></a>01413                                                         $xml = <span class="stringliteral">&quot;&lt;$name xsi:type=\&quot;&quot;</span> . $tt_prefix . <span class="stringliteral">&quot;:$uqType\&quot;&gt;$contents&lt;/$name&gt;&quot;</span>;
<a name="l01414"></a>01414                                                 } <span class="keywordflow">else</span> {
<a name="l01415"></a>01415                                                         $xml = <span class="stringliteral">&quot;&lt;$name&gt;$contents&lt;/$name&gt;&quot;</span>;
<a name="l01416"></a>01416                                                 }
<a name="l01417"></a>01417                                         } <span class="keywordflow">else</span> {
<a name="l01418"></a>01418                                                 $xml = <span class="stringliteral">&quot;&lt;$name xsi:type=\&quot;&quot;</span> . $tt_prefix . <span class="stringliteral">&quot;:$uqType\&quot;$encodingStyle&gt;$contents&lt;/$name&gt;&quot;</span>;
<a name="l01419"></a>01419                                         }
<a name="l01420"></a>01420                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l01421"></a>01421                                         <span class="keywordflow">return</span> $xml;
<a name="l01422"></a>01422                                 }
<a name="l01423"></a>01423                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeType: Apache SOAP type, but only support Map&#39;</span>);
<a name="l01424"></a>01424                         }
<a name="l01425"></a>01425                 } <span class="keywordflow">else</span> {
<a name="l01426"></a>01426                         <span class="comment">// TODO: should the type be compared to types in XSD, and the namespace</span>
<a name="l01427"></a>01427                         <span class="comment">// set to XSD if the type matches?</span>
<a name="l01428"></a>01428                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: No namespace for type $type&quot;</span>);
<a name="l01429"></a>01429                         $ns = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01430"></a>01430                         $uqType = $type;
<a name="l01431"></a>01431                 }
<a name="l01432"></a>01432                 <span class="keywordflow">if</span>(!$typeDef = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqType, $ns)){
<a name="l01433"></a>01433                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;$type ($uqType) is not a supported type.&quot;</span>);
<a name="l01434"></a>01434                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: $type ($uqType) is not a supported type.&quot;</span>);
<a name="l01435"></a>01435                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01436"></a>01436                 } <span class="keywordflow">else</span> {
<a name="l01437"></a>01437                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: found typeDef&quot;</span>);
<a name="l01438"></a>01438                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;typeDef=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($typeDef));
<a name="l01439"></a>01439                         <span class="keywordflow">if</span> (substr($uqType, -1) == <span class="charliteral">&#39;^&#39;</span>) {
<a name="l01440"></a>01440                                 $uqType = substr($uqType, 0, -1);
<a name="l01441"></a>01441                         }
<a name="l01442"></a>01442                 }
<a name="l01443"></a>01443                 <span class="keywordflow">if</span> (!isset($typeDef[<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l01444"></a>01444                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;$type ($uqType) has no phpType.&quot;</span>);
<a name="l01445"></a>01445                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: $type ($uqType) has no phpType.&quot;</span>);
<a name="l01446"></a>01446                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01447"></a>01447                 }
<a name="l01448"></a>01448                 $phpType = $typeDef[<span class="stringliteral">&#39;phpType&#39;</span>];
<a name="l01449"></a>01449                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: uqType: $uqType, ns: $ns, phptype: $phpType, arrayType: &quot;</span> . (isset($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]) ? $typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>) ); 
<a name="l01450"></a>01450                 <span class="comment">// if php type == struct, map value to the &lt;all&gt; element names</span>
<a name="l01451"></a>01451                 <span class="keywordflow">if</span> ($phpType == <span class="stringliteral">&#39;struct&#39;</span>) {
<a name="l01452"></a>01452                         <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;typeClass&#39;</span>]) &amp;&amp; $typeDef[<span class="stringliteral">&#39;typeClass&#39;</span>] == <span class="stringliteral">&#39;element&#39;</span>) {
<a name="l01453"></a>01453                                 $elementName = $uqType;
<a name="l01454"></a>01454                                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;form&#39;</span>]) &amp;&amp; ($typeDef[<span class="stringliteral">&#39;form&#39;</span>] == <span class="stringliteral">&#39;qualified&#39;</span>)) {
<a name="l01455"></a>01455                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;$ns\&quot;&quot;</span>;
<a name="l01456"></a>01456                                 } <span class="keywordflow">else</span> {
<a name="l01457"></a>01457                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l01458"></a>01458                                 }
<a name="l01459"></a>01459                         } <span class="keywordflow">else</span> {
<a name="l01460"></a>01460                                 $elementName = $name;
<a name="l01461"></a>01461                                 <span class="keywordflow">if</span> ($unqualified) {
<a name="l01462"></a>01462                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l01463"></a>01463                                 } <span class="keywordflow">else</span> {
<a name="l01464"></a>01464                                         $elementNS = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01465"></a>01465                                 }
<a name="l01466"></a>01466                         }
<a name="l01467"></a>01467                         <span class="keywordflow">if</span> (is_null($value)) {
<a name="l01468"></a>01468                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l01469"></a>01469                                         <span class="comment">// TODO: depends on minOccurs and nillable</span>
<a name="l01470"></a>01470                                         $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS/&gt;&quot;</span>;
<a name="l01471"></a>01471                                 } <span class="keywordflow">else</span> {
<a name="l01472"></a>01472                                         $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS xsi:nil=\&quot;true\&quot; xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;/&gt;&quot;</span>;
<a name="l01473"></a>01473                                 }
<a name="l01474"></a>01474                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l01475"></a>01475                                 <span class="keywordflow">return</span> $xml;
<a name="l01476"></a>01476                         }
<a name="l01477"></a>01477                         <span class="keywordflow">if</span> (is_object($value)) {
<a name="l01478"></a>01478                                 $value = get_object_vars($value);
<a name="l01479"></a>01479                         }
<a name="l01480"></a>01480                         <span class="keywordflow">if</span> (is_array($value)) {
<a name="l01481"></a>01481                                 $elementAttrs = $this-&gt;<a class="code" href="classwsdl.html#a1462b76a3892e9e088da94720b19c4cb">serializeComplexTypeAttributes</a>($typeDef, $value, $ns, $uqType);
<a name="l01482"></a>01482                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l01483"></a>01483                                         <span class="keywordflow">if</span> ($forceType) {
<a name="l01484"></a>01484                                                 $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS$elementAttrs xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;&gt;&quot;</span>;
<a name="l01485"></a>01485                                         } <span class="keywordflow">else</span> {
<a name="l01486"></a>01486                                                 $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS$elementAttrs&gt;&quot;</span>;
<a name="l01487"></a>01487                                         }
<a name="l01488"></a>01488                                 } <span class="keywordflow">else</span> {
<a name="l01489"></a>01489                                         $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS$elementAttrs xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;$encodingStyle&gt;&quot;</span>;
<a name="l01490"></a>01490                                 }
<a name="l01491"></a>01491 
<a name="l01492"></a>01492                                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;simpleContent&#39;</span>]) &amp;&amp; $typeDef[<span class="stringliteral">&#39;simpleContent&#39;</span>] == <span class="stringliteral">&#39;true&#39;</span>) {
<a name="l01493"></a>01493                                         <span class="keywordflow">if</span> (isset($value[<span class="charliteral">&#39;!&#39;</span>])) {
<a name="l01494"></a>01494                                                 $xml .= $value[<span class="charliteral">&#39;!&#39;</span>];
<a name="l01495"></a>01495                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: serialized simpleContent for type $type&quot;</span>);
<a name="l01496"></a>01496                                         } <span class="keywordflow">else</span> {
<a name="l01497"></a>01497                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: no simpleContent to serialize for type $type&quot;</span>);
<a name="l01498"></a>01498                                         }
<a name="l01499"></a>01499                                 } <span class="keywordflow">else</span> {
<a name="l01500"></a>01500                                         <span class="comment">// complexContent</span>
<a name="l01501"></a>01501                                         $xml .= $this-&gt;<a class="code" href="classwsdl.html#aca47f23c5d0405f4b8d860c3ea125445">serializeComplexTypeElements</a>($typeDef, $value, $ns, $uqType, $use, $encodingStyle);
<a name="l01502"></a>01502                                 }
<a name="l01503"></a>01503                                 $xml .= <span class="stringliteral">&quot;&lt;/$elementName&gt;&quot;</span>;
<a name="l01504"></a>01504                         } <span class="keywordflow">else</span> {
<a name="l01505"></a>01505                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: phpType is struct, but value is not an array&quot;</span>);
<a name="l01506"></a>01506                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;phpType is struct, but value is not an array: see debug output for details&quot;</span>);
<a name="l01507"></a>01507                                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01508"></a>01508                         }
<a name="l01509"></a>01509                 } elseif ($phpType == <span class="stringliteral">&#39;array&#39;</span>) {
<a name="l01510"></a>01510                         <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;form&#39;</span>]) &amp;&amp; ($typeDef[<span class="stringliteral">&#39;form&#39;</span>] == <span class="stringliteral">&#39;qualified&#39;</span>)) {
<a name="l01511"></a>01511                                 $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;$ns\&quot;&quot;</span>;
<a name="l01512"></a>01512                         } <span class="keywordflow">else</span> {
<a name="l01513"></a>01513                                 <span class="keywordflow">if</span> ($unqualified) {
<a name="l01514"></a>01514                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l01515"></a>01515                                 } <span class="keywordflow">else</span> {
<a name="l01516"></a>01516                                         $elementNS = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01517"></a>01517                                 }
<a name="l01518"></a>01518                         }
<a name="l01519"></a>01519                         <span class="keywordflow">if</span> (is_null($value)) {
<a name="l01520"></a>01520                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l01521"></a>01521                                         <span class="comment">// TODO: depends on minOccurs</span>
<a name="l01522"></a>01522                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS/&gt;&quot;</span>;
<a name="l01523"></a>01523                                 } <span class="keywordflow">else</span> {
<a name="l01524"></a>01524                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:nil=\&quot;true\&quot; xsi:type=\&quot;&quot;</span> .
<a name="l01525"></a>01525                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>) .
<a name="l01526"></a>01526                                                 <span class="stringliteral">&quot;:Array\&quot; &quot;</span> .
<a name="l01527"></a>01527                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>) .
<a name="l01528"></a>01528                                                 <span class="stringliteral">&#39;:arrayType=&quot;&#39;</span> .
<a name="l01529"></a>01529                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>])) .
<a name="l01530"></a>01530                                                 <span class="charliteral">&#39;:&#39;</span> .
<a name="l01531"></a>01531                                                 $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]).<span class="stringliteral">&quot;[0]\&quot;/&gt;&quot;</span>;
<a name="l01532"></a>01532                                 }
<a name="l01533"></a>01533                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l01534"></a>01534                                 <span class="keywordflow">return</span> $xml;
<a name="l01535"></a>01535                         }
<a name="l01536"></a>01536                         <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;multidimensional&#39;</span>])) {
<a name="l01537"></a>01537                                 $nv = array();
<a name="l01538"></a>01538                                 <span class="keywordflow">foreach</span>($value as $v) {
<a name="l01539"></a>01539                                         $cols = <span class="charliteral">&#39;,&#39;</span> . <span class="keyword">sizeof</span>($v);
<a name="l01540"></a>01540                                         $nv = array_merge($nv, $v);
<a name="l01541"></a>01541                                 } 
<a name="l01542"></a>01542                                 $value = $nv;
<a name="l01543"></a>01543                         } <span class="keywordflow">else</span> {
<a name="l01544"></a>01544                                 $cols = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01545"></a>01545                         } 
<a name="l01546"></a>01546                         <span class="keywordflow">if</span> (is_array($value) &amp;&amp; <span class="keyword">sizeof</span>($value) &gt;= 1) {
<a name="l01547"></a>01547                                 $rows = <span class="keyword">sizeof</span>($value);
<a name="l01548"></a>01548                                 $contents = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01549"></a>01549                                 <span class="keywordflow">foreach</span>($value as $k =&gt; $v) {
<a name="l01550"></a>01550                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing array element: $k, $v of type: $typeDef[arrayType]&quot;</span>);
<a name="l01551"></a>01551                                         <span class="comment">//if (strpos($typeDef[&#39;arrayType&#39;], &#39;:&#39;) ) {</span>
<a name="l01552"></a>01552                                         <span class="keywordflow">if</span> (!in_array($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>],$this-&gt;typemap[<span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span>])) {
<a name="l01553"></a>01553                                             $contents .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>(<span class="stringliteral">&#39;item&#39;</span>, $typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>], $v, $use);
<a name="l01554"></a>01554                                         } <span class="keywordflow">else</span> {
<a name="l01555"></a>01555                                             $contents .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v, <span class="stringliteral">&#39;item&#39;</span>, $typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>], null, $this-&gt;XMLSchemaVersion, <span class="keyword">false</span>, $use);
<a name="l01556"></a>01556                                         } 
<a name="l01557"></a>01557                                 }
<a name="l01558"></a>01558                         } <span class="keywordflow">else</span> {
<a name="l01559"></a>01559                                 $rows = 0;
<a name="l01560"></a>01560                                 $contents = null;
<a name="l01561"></a>01561                         }
<a name="l01562"></a>01562                         <span class="comment">// TODO: for now, an empty value will be serialized as a zero element</span>
<a name="l01563"></a>01563                         <span class="comment">// array.  Revisit this when coding the handling of null/nil values.</span>
<a name="l01564"></a>01564                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l01565"></a>01565                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS&gt;&quot;</span>
<a name="l01566"></a>01566                                         .$contents
<a name="l01567"></a>01567                                         .<span class="stringliteral">&quot;&lt;/$name&gt;&quot;</span>;
<a name="l01568"></a>01568                         } <span class="keywordflow">else</span> {
<a name="l01569"></a>01569                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span>.$this-&gt;getPrefixFromNamespace(<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>).<span class="stringliteral">&#39;:Array&quot; &#39;</span>.
<a name="l01570"></a>01570                                         $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>)
<a name="l01571"></a>01571                                         .<span class="stringliteral">&#39;:arrayType=&quot;&#39;</span>
<a name="l01572"></a>01572                                         .$this-&gt;getPrefixFromNamespace($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]))
<a name="l01573"></a>01573                                         .<span class="stringliteral">&quot;:&quot;</span>.$this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]).<span class="stringliteral">&quot;[$rows$cols]\&quot;&gt;&quot;</span>
<a name="l01574"></a>01574                                         .$contents
<a name="l01575"></a>01575                                         .<span class="stringliteral">&quot;&lt;/$name&gt;&quot;</span>;
<a name="l01576"></a>01576                         }
<a name="l01577"></a>01577                 } elseif ($phpType == <span class="stringliteral">&#39;scalar&#39;</span>) {
<a name="l01578"></a>01578                         <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;form&#39;</span>]) &amp;&amp; ($typeDef[<span class="stringliteral">&#39;form&#39;</span>] == <span class="stringliteral">&#39;qualified&#39;</span>)) {
<a name="l01579"></a>01579                                 $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;$ns\&quot;&quot;</span>;
<a name="l01580"></a>01580                         } <span class="keywordflow">else</span> {
<a name="l01581"></a>01581                                 <span class="keywordflow">if</span> ($unqualified) {
<a name="l01582"></a>01582                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l01583"></a>01583                                 } <span class="keywordflow">else</span> {
<a name="l01584"></a>01584                                         $elementNS = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01585"></a>01585                                 }
<a name="l01586"></a>01586                         }
<a name="l01587"></a>01587                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l01588"></a>01588                                 <span class="keywordflow">if</span> ($forceType) {
<a name="l01589"></a>01589                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l01590"></a>01590                                 } <span class="keywordflow">else</span> {
<a name="l01591"></a>01591                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l01592"></a>01592                                 }
<a name="l01593"></a>01593                         } <span class="keywordflow">else</span> {
<a name="l01594"></a>01594                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;$encodingStyle&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l01595"></a>01595                         }
<a name="l01596"></a>01596                 }
<a name="l01597"></a>01597                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l01598"></a>01598                 <span class="keywordflow">return</span> $xml;
<a name="l01599"></a>01599         }
<a name="l01600"></a>01600         
<a name="l01611"></a><a class="code" href="classwsdl.html#a1462b76a3892e9e088da94720b19c4cb">01611</a>         function <a class="code" href="classwsdl.html#a1462b76a3892e9e088da94720b19c4cb">serializeComplexTypeAttributes</a>($typeDef, $value, $ns, $uqType) {
<a name="l01612"></a>01612                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializeComplexTypeAttributes for XML Schema type $ns:$uqType&quot;</span>);
<a name="l01613"></a>01613                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01614"></a>01614                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>])) {
<a name="l01615"></a>01615                         $nsx = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>]);
<a name="l01616"></a>01616                         $uqTypex = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>]);
<a name="l01617"></a>01617                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($nsx)) {
<a name="l01618"></a>01618                                 $nsx = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($nsx);
<a name="l01619"></a>01619                         }
<a name="l01620"></a>01620                         <span class="keywordflow">if</span> ($typeDefx = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqTypex, $nsx)) {
<a name="l01621"></a>01621                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize attributes for extension base $nsx:$uqTypex&quot;</span>);
<a name="l01622"></a>01622                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a1462b76a3892e9e088da94720b19c4cb">serializeComplexTypeAttributes</a>($typeDefx, $value, $nsx, $uqTypex);
<a name="l01623"></a>01623                         } <span class="keywordflow">else</span> {
<a name="l01624"></a>01624                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;extension base $nsx:$uqTypex is not a supported type&quot;</span>);
<a name="l01625"></a>01625                         }
<a name="l01626"></a>01626                 }
<a name="l01627"></a>01627                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;attrs&#39;</span>]) &amp;&amp; is_array($typeDef[<span class="stringliteral">&#39;attrs&#39;</span>])) {
<a name="l01628"></a>01628                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize attributes for XML Schema type $ns:$uqType&quot;</span>);
<a name="l01629"></a>01629                         <span class="keywordflow">if</span> (is_array($value)) {
<a name="l01630"></a>01630                                 $xvalue = $value;
<a name="l01631"></a>01631                         } elseif (is_object($value)) {
<a name="l01632"></a>01632                                 $xvalue = get_object_vars($value);
<a name="l01633"></a>01633                         } <span class="keywordflow">else</span> {
<a name="l01634"></a>01634                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;value is neither an array nor an object for XML Schema type $ns:$uqType&quot;</span>);
<a name="l01635"></a>01635                                 $xvalue = array();
<a name="l01636"></a>01636                         }
<a name="l01637"></a>01637                         <span class="keywordflow">foreach</span> ($typeDef[<span class="stringliteral">&#39;attrs&#39;</span>] as $aName =&gt; $attrs) {
<a name="l01638"></a>01638                                 <span class="keywordflow">if</span> (isset($xvalue[<span class="charliteral">&#39;!&#39;</span> . $aName])) {
<a name="l01639"></a>01639                                         $xname = <span class="charliteral">&#39;!&#39;</span> . $aName;
<a name="l01640"></a>01640                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;value provided for attribute $aName with key $xname&quot;</span>);
<a name="l01641"></a>01641                                 } elseif (isset($xvalue[$aName])) {
<a name="l01642"></a>01642                                         $xname = $aName;
<a name="l01643"></a>01643                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;value provided for attribute $aName with key $xname&quot;</span>);
<a name="l01644"></a>01644                                 } elseif (isset($attrs[<span class="stringliteral">&#39;default&#39;</span>])) {
<a name="l01645"></a>01645                                         $xname = <span class="charliteral">&#39;!&#39;</span> . $aName;
<a name="l01646"></a>01646                                         $xvalue[$xname] = $attrs[<span class="stringliteral">&#39;default&#39;</span>];
<a name="l01647"></a>01647                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;use default value of &#39;</span> . $xvalue[$aName] . <span class="stringliteral">&#39; for attribute &#39;</span> . $aName);
<a name="l01648"></a>01648                                 } <span class="keywordflow">else</span> {
<a name="l01649"></a>01649                                         $xname = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01650"></a>01650                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;no value provided for attribute $aName&quot;</span>);
<a name="l01651"></a>01651                                 }
<a name="l01652"></a>01652                                 <span class="keywordflow">if</span> ($xname) {
<a name="l01653"></a>01653                                         $xml .=  <span class="stringliteral">&quot; $aName=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#aa05581a9628de0f46b30dd67b5578cef">expandEntities</a>($xvalue[$xname]) . <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l01654"></a>01654                                 }
<a name="l01655"></a>01655                         } 
<a name="l01656"></a>01656                 } <span class="keywordflow">else</span> {
<a name="l01657"></a>01657                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;no attributes to serialize for XML Schema type $ns:$uqType&quot;</span>);
<a name="l01658"></a>01658                 }
<a name="l01659"></a>01659                 <span class="keywordflow">return</span> $xml;
<a name="l01660"></a>01660         }
<a name="l01661"></a>01661 
<a name="l01674"></a><a class="code" href="classwsdl.html#aca47f23c5d0405f4b8d860c3ea125445">01674</a>         function <a class="code" href="classwsdl.html#aca47f23c5d0405f4b8d860c3ea125445">serializeComplexTypeElements</a>($typeDef, $value, $ns, $uqType, $use=<span class="stringliteral">&#39;encoded&#39;</span>, $encodingStyle=<span class="keyword">false</span>) {
<a name="l01675"></a>01675                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeComplexTypeElements for XML Schema type $ns:$uqType&quot;</span>);
<a name="l01676"></a>01676                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01677"></a>01677                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>])) {
<a name="l01678"></a>01678                         $nsx = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>]);
<a name="l01679"></a>01679                         $uqTypex = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>]);
<a name="l01680"></a>01680                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($nsx)) {
<a name="l01681"></a>01681                                 $nsx = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($nsx);
<a name="l01682"></a>01682                         }
<a name="l01683"></a>01683                         <span class="keywordflow">if</span> ($typeDefx = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqTypex, $nsx)) {
<a name="l01684"></a>01684                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize elements for extension base $nsx:$uqTypex&quot;</span>);
<a name="l01685"></a>01685                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#aca47f23c5d0405f4b8d860c3ea125445">serializeComplexTypeElements</a>($typeDefx, $value, $nsx, $uqTypex, $use, $encodingStyle);
<a name="l01686"></a>01686                         } <span class="keywordflow">else</span> {
<a name="l01687"></a>01687                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;extension base $nsx:$uqTypex is not a supported type&quot;</span>);
<a name="l01688"></a>01688                         }
<a name="l01689"></a>01689                 }
<a name="l01690"></a>01690                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;elements&#39;</span>]) &amp;&amp; is_array($typeDef[<span class="stringliteral">&#39;elements&#39;</span>])) {
<a name="l01691"></a>01691                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeComplexTypeElements, serialize elements for XML Schema type $ns:$uqType&quot;</span>);
<a name="l01692"></a>01692                         <span class="keywordflow">if</span> (is_array($value)) {
<a name="l01693"></a>01693                                 $xvalue = $value;
<a name="l01694"></a>01694                         } elseif (is_object($value)) {
<a name="l01695"></a>01695                                 $xvalue = get_object_vars($value);
<a name="l01696"></a>01696                         } <span class="keywordflow">else</span> {
<a name="l01697"></a>01697                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;value is neither an array nor an object for XML Schema type $ns:$uqType&quot;</span>);
<a name="l01698"></a>01698                                 $xvalue = array();
<a name="l01699"></a>01699                         }
<a name="l01700"></a>01700                         <span class="comment">// toggle whether all elements are present - ideally should validate against schema</span>
<a name="l01701"></a>01701                         <span class="keywordflow">if</span> (count($typeDef[<span class="stringliteral">&#39;elements&#39;</span>]) != count($xvalue)){
<a name="l01702"></a>01702                                 $optionals = <span class="keyword">true</span>;
<a name="l01703"></a>01703                         }
<a name="l01704"></a>01704                         <span class="keywordflow">foreach</span> ($typeDef[<span class="stringliteral">&#39;elements&#39;</span>] as $eName =&gt; $attrs) {
<a name="l01705"></a>01705                                 <span class="keywordflow">if</span> (!isset($xvalue[$eName])) {
<a name="l01706"></a>01706                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;default&#39;</span>])) {
<a name="l01707"></a>01707                                                 $xvalue[$eName] = $attrs[<span class="stringliteral">&#39;default&#39;</span>];
<a name="l01708"></a>01708                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;use default value of &#39;</span> . $xvalue[$eName] . <span class="stringliteral">&#39; for element &#39;</span> . $eName);
<a name="l01709"></a>01709                                         }
<a name="l01710"></a>01710                                 }
<a name="l01711"></a>01711                                 <span class="comment">// if user took advantage of a minOccurs=0, then only serialize named parameters</span>
<a name="l01712"></a>01712                                 <span class="keywordflow">if</span> (isset($optionals)
<a name="l01713"></a>01713                                     &amp;&amp; (!isset($xvalue[$eName])) 
<a name="l01714"></a>01714                                         &amp;&amp; ( (!isset($attrs[<span class="stringliteral">&#39;nillable&#39;</span>])) || $attrs[<span class="stringliteral">&#39;nillable&#39;</span>] != <span class="stringliteral">&#39;true&#39;</span>)
<a name="l01715"></a>01715                                         ){
<a name="l01716"></a>01716                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>]) &amp;&amp; $attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>] &lt;&gt; <span class="charliteral">&#39;0&#39;</span>) {
<a name="l01717"></a>01717                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;apparent error: no value provided for element $eName with minOccurs=&quot;</span> . $attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>]);
<a name="l01718"></a>01718                                         }
<a name="l01719"></a>01719                                         <span class="comment">// do nothing</span>
<a name="l01720"></a>01720                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;no value provided for complexType element $eName and element is not nillable, so serialize nothing&quot;</span>);
<a name="l01721"></a>01721                                 } <span class="keywordflow">else</span> {
<a name="l01722"></a>01722                                         <span class="comment">// get value</span>
<a name="l01723"></a>01723                                         <span class="keywordflow">if</span> (isset($xvalue[$eName])) {
<a name="l01724"></a>01724                                             $v = $xvalue[$eName];
<a name="l01725"></a>01725                                         } <span class="keywordflow">else</span> {
<a name="l01726"></a>01726                                             $v = null;
<a name="l01727"></a>01727                                         }
<a name="l01728"></a>01728                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;form&#39;</span>])) {
<a name="l01729"></a>01729                                                 $unqualified = ($attrs[<span class="stringliteral">&#39;form&#39;</span>] == <span class="stringliteral">&#39;unqualified&#39;</span>);
<a name="l01730"></a>01730                                         } <span class="keywordflow">else</span> {
<a name="l01731"></a>01731                                                 $unqualified = <span class="keyword">false</span>;
<a name="l01732"></a>01732                                         }
<a name="l01733"></a>01733                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;maxOccurs&#39;</span>]) &amp;&amp; ($attrs[<span class="stringliteral">&#39;maxOccurs&#39;</span>] == <span class="stringliteral">&#39;unbounded&#39;</span> || $attrs[<span class="stringliteral">&#39;maxOccurs&#39;</span>] &gt; 1) &amp;&amp; isset($v) &amp;&amp; is_array($v) &amp;&amp; $this-&gt;<a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">isArraySimpleOrStruct</a>($v) == <span class="stringliteral">&#39;arraySimple&#39;</span>) {
<a name="l01734"></a>01734                                                 $vv = $v;
<a name="l01735"></a>01735                                                 <span class="keywordflow">foreach</span> ($vv as $k =&gt; $v) {
<a name="l01736"></a>01736                                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) || isset($attrs[<span class="stringliteral">&#39;ref&#39;</span>])) {
<a name="l01737"></a>01737                                                                 <span class="comment">// serialize schema-defined type</span>
<a name="l01738"></a>01738                                                             $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($eName, isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) ? $attrs[<span class="stringliteral">&#39;type&#39;</span>] : $attrs[<span class="stringliteral">&#39;ref&#39;</span>], $v, $use, $encodingStyle, $unqualified);
<a name="l01739"></a>01739                                                         } <span class="keywordflow">else</span> {
<a name="l01740"></a>01740                                                                 <span class="comment">// serialize generic type (can this ever really happen?)</span>
<a name="l01741"></a>01741                                                             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;calling serialize_val() for $v, $eName, false, false, false, false, $use&quot;</span>);
<a name="l01742"></a>01742                                                             $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v, $eName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, $use);
<a name="l01743"></a>01743                                                         }
<a name="l01744"></a>01744                                                 }
<a name="l01745"></a>01745                                         } <span class="keywordflow">else</span> {
<a name="l01746"></a>01746                                                 <span class="keywordflow">if</span> (is_null($v) &amp;&amp; isset($attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>]) &amp;&amp; $attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>] == <span class="charliteral">&#39;0&#39;</span>) {
<a name="l01747"></a>01747                                                         <span class="comment">// do nothing</span>
<a name="l01748"></a>01748                                                 } elseif (is_null($v) &amp;&amp; isset($attrs[<span class="stringliteral">&#39;nillable&#39;</span>]) &amp;&amp; $attrs[<span class="stringliteral">&#39;nillable&#39;</span>] == <span class="stringliteral">&#39;true&#39;</span>) {
<a name="l01749"></a>01749                                                         <span class="comment">// TODO: serialize a nil correctly, but for now serialize schema-defined type</span>
<a name="l01750"></a>01750                                                     $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($eName, isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) ? $attrs[<span class="stringliteral">&#39;type&#39;</span>] : $attrs[<span class="stringliteral">&#39;ref&#39;</span>], $v, $use, $encodingStyle, $unqualified);
<a name="l01751"></a>01751                                                 } elseif (isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) || isset($attrs[<span class="stringliteral">&#39;ref&#39;</span>])) {
<a name="l01752"></a>01752                                                         <span class="comment">// serialize schema-defined type</span>
<a name="l01753"></a>01753                                                     $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($eName, isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) ? $attrs[<span class="stringliteral">&#39;type&#39;</span>] : $attrs[<span class="stringliteral">&#39;ref&#39;</span>], $v, $use, $encodingStyle, $unqualified);
<a name="l01754"></a>01754                                                 } <span class="keywordflow">else</span> {
<a name="l01755"></a>01755                                                         <span class="comment">// serialize generic type (can this ever really happen?)</span>
<a name="l01756"></a>01756                                                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;calling serialize_val() for $v, $eName, false, false, false, false, $use&quot;</span>);
<a name="l01757"></a>01757                                                     $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v, $eName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, $use);
<a name="l01758"></a>01758                                                 }
<a name="l01759"></a>01759                                         }
<a name="l01760"></a>01760                                 }
<a name="l01761"></a>01761                         } 
<a name="l01762"></a>01762                 } <span class="keywordflow">else</span> {
<a name="l01763"></a>01763                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;no elements to serialize for XML Schema type $ns:$uqType&quot;</span>);
<a name="l01764"></a>01764                 }
<a name="l01765"></a>01765                 <span class="keywordflow">return</span> $xml;
<a name="l01766"></a>01766         }
<a name="l01767"></a>01767 
<a name="l01782"></a><a class="code" href="classwsdl.html#ae5a20be9e2b68cca5a1425f905340ceb">01782</a>         function <a class="code" href="classwsdl.html#ae5a20be9e2b68cca5a1425f905340ceb">addComplexType</a>($name,$typeClass=<span class="stringliteral">&#39;complexType&#39;</span>,$phpType=<span class="stringliteral">&#39;array&#39;</span>,$compositor=<span class="stringliteral">&#39;&#39;</span>,$restrictionBase=<span class="stringliteral">&#39;&#39;</span>,$elements=array(),$attrs=array(),$arrayType=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l01783"></a>01783                 <span class="keywordflow">if</span> (count($elements) &gt; 0) {
<a name="l01784"></a>01784                         $eElements = array();
<a name="l01785"></a>01785                 <span class="keywordflow">foreach</span>($elements as $n =&gt; $e){
<a name="l01786"></a>01786                     <span class="comment">// expand each element</span>
<a name="l01787"></a>01787                     $ee = array();
<a name="l01788"></a>01788                     <span class="keywordflow">foreach</span> ($e as $k =&gt; $v) {
<a name="l01789"></a>01789                             $k = strpos($k,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($k) : $k;
<a name="l01790"></a>01790                             $v = strpos($v,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($v) : $v;
<a name="l01791"></a>01791                             $ee[$k] = $v;
<a name="l01792"></a>01792                         }
<a name="l01793"></a>01793                         $eElements[$n] = $ee;
<a name="l01794"></a>01794                 }
<a name="l01795"></a>01795                 $elements = $eElements;
<a name="l01796"></a>01796                 }
<a name="l01797"></a>01797                 
<a name="l01798"></a>01798                 <span class="keywordflow">if</span> (count($attrs) &gt; 0) {
<a name="l01799"></a>01799                 <span class="keywordflow">foreach</span>($attrs as $n =&gt; $a){
<a name="l01800"></a>01800                     <span class="comment">// expand each attribute</span>
<a name="l01801"></a>01801                     <span class="keywordflow">foreach</span> ($a as $k =&gt; $v) {
<a name="l01802"></a>01802                             $k = strpos($k,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($k) : $k;
<a name="l01803"></a>01803                             $v = strpos($v,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($v) : $v;
<a name="l01804"></a>01804                             $aa[$k] = $v;
<a name="l01805"></a>01805                         }
<a name="l01806"></a>01806                         $eAttrs[$n] = $aa;
<a name="l01807"></a>01807                 }
<a name="l01808"></a>01808                 $attrs = $eAttrs;
<a name="l01809"></a>01809                 }
<a name="l01810"></a>01810 
<a name="l01811"></a>01811                 $restrictionBase = strpos($restrictionBase,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($restrictionBase) : $restrictionBase;
<a name="l01812"></a>01812                 $arrayType = strpos($arrayType,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($arrayType) : $arrayType;
<a name="l01813"></a>01813 
<a name="l01814"></a>01814                 $typens = isset($this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>]) ? $this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>] : $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>];
<a name="l01815"></a>01815                 $this-&gt;schemas[$typens][0]-&gt;addComplexType($name,$typeClass,$phpType,$compositor,$restrictionBase,$elements,$attrs,$arrayType);
<a name="l01816"></a>01816         }
<a name="l01817"></a>01817 
<a name="l01829"></a><a class="code" href="classwsdl.html#a68cb89426925948d7364741d925eb3ad">01829</a>         function <a class="code" href="classwsdl.html#a68cb89426925948d7364741d925eb3ad">addSimpleType</a>($name, $restrictionBase=<span class="stringliteral">&#39;&#39;</span>, $typeClass=<span class="stringliteral">&#39;simpleType&#39;</span>, $phpType=<span class="stringliteral">&#39;scalar&#39;</span>, $enumeration=array()) {
<a name="l01830"></a>01830                 $restrictionBase = strpos($restrictionBase,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($restrictionBase) : $restrictionBase;
<a name="l01831"></a>01831 
<a name="l01832"></a>01832                 $typens = isset($this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>]) ? $this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>] : $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>];
<a name="l01833"></a>01833                 $this-&gt;schemas[$typens][0]-&gt;addSimpleType($name, $restrictionBase, $typeClass, $phpType, $enumeration);
<a name="l01834"></a>01834         }
<a name="l01835"></a>01835 
<a name="l01843"></a><a class="code" href="classwsdl.html#a3216aae8de447e692223d256db744e37">01843</a>         function <a class="code" href="classwsdl.html#a3216aae8de447e692223d256db744e37">addElement</a>($attrs) {
<a name="l01844"></a>01844                 $typens = isset($this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>]) ? $this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>] : $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>];
<a name="l01845"></a>01845                 $this-&gt;schemas[$typens][0]-&gt;addElement($attrs);
<a name="l01846"></a>01846         }
<a name="l01847"></a>01847 
<a name="l01862"></a><a class="code" href="classwsdl.html#a1cd01992e1d4bacaf47e728df2b8bd84">01862</a>         function <a class="code" href="classwsdl.html#a1cd01992e1d4bacaf47e728df2b8bd84">addOperation</a>($name, $in = <span class="keyword">false</span>, $out = <span class="keyword">false</span>, $namespace = <span class="keyword">false</span>, $soapaction = <span class="keyword">false</span>, $style = <span class="stringliteral">&#39;rpc&#39;</span>, $use = <span class="stringliteral">&#39;encoded&#39;</span>, <a class="code" href="classwsdl.html#a90e868755e79fd7f8c37ec8345167952">$documentation</a> = <span class="stringliteral">&#39;&#39;</span>, $encodingStyle = <span class="stringliteral">&#39;&#39;</span>){
<a name="l01863"></a>01863                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;encoded&#39;</span> &amp;&amp; $encodingStyle == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01864"></a>01864                         $encodingStyle = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>;
<a name="l01865"></a>01865                 }
<a name="l01866"></a>01866 
<a name="l01867"></a>01867                 <span class="keywordflow">if</span> ($style == <span class="stringliteral">&#39;document&#39;</span>) {
<a name="l01868"></a>01868                         $elements = array();
<a name="l01869"></a>01869                         <span class="keywordflow">foreach</span> ($in as $n =&gt; $t) {
<a name="l01870"></a>01870                                 $elements[$n] = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $n, <span class="stringliteral">&#39;type&#39;</span> =&gt; $t, <span class="stringliteral">&#39;form&#39;</span> =&gt; <span class="stringliteral">&#39;unqualified&#39;</span>);
<a name="l01871"></a>01871                         }
<a name="l01872"></a>01872                         $this-&gt;<a class="code" href="classwsdl.html#ae5a20be9e2b68cca5a1425f905340ceb">addComplexType</a>($name . <span class="stringliteral">&#39;RequestType&#39;</span>, <span class="stringliteral">&#39;complexType&#39;</span>, <span class="stringliteral">&#39;struct&#39;</span>, <span class="stringliteral">&#39;all&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $elements);
<a name="l01873"></a>01873                         $this-&gt;<a class="code" href="classwsdl.html#a3216aae8de447e692223d256db744e37">addElement</a>(array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $name, <span class="stringliteral">&#39;type&#39;</span> =&gt; $name . <span class="stringliteral">&#39;RequestType&#39;</span>));
<a name="l01874"></a>01874                         $in = array(<span class="stringliteral">&#39;parameters&#39;</span> =&gt; <span class="stringliteral">&#39;tns:&#39;</span> . $name . <span class="charliteral">&#39;^&#39;</span>);
<a name="l01875"></a>01875 
<a name="l01876"></a>01876                         $elements = array();
<a name="l01877"></a>01877                         <span class="keywordflow">foreach</span> ($out as $n =&gt; $t) {
<a name="l01878"></a>01878                                 $elements[$n] = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $n, <span class="stringliteral">&#39;type&#39;</span> =&gt; $t, <span class="stringliteral">&#39;form&#39;</span> =&gt; <span class="stringliteral">&#39;unqualified&#39;</span>);
<a name="l01879"></a>01879                         }
<a name="l01880"></a>01880                         $this-&gt;<a class="code" href="classwsdl.html#ae5a20be9e2b68cca5a1425f905340ceb">addComplexType</a>($name . <span class="stringliteral">&#39;ResponseType&#39;</span>, <span class="stringliteral">&#39;complexType&#39;</span>, <span class="stringliteral">&#39;struct&#39;</span>, <span class="stringliteral">&#39;all&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $elements);
<a name="l01881"></a>01881                         $this-&gt;<a class="code" href="classwsdl.html#a3216aae8de447e692223d256db744e37">addElement</a>(array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $name . <span class="stringliteral">&#39;Response&#39;</span>, <span class="stringliteral">&#39;type&#39;</span> =&gt; $name . <span class="stringliteral">&#39;ResponseType&#39;</span>, <span class="stringliteral">&#39;form&#39;</span> =&gt; <span class="stringliteral">&#39;qualified&#39;</span>));
<a name="l01882"></a>01882                         $out = array(<span class="stringliteral">&#39;parameters&#39;</span> =&gt; <span class="stringliteral">&#39;tns:&#39;</span> . $name . <span class="stringliteral">&#39;Response&#39;</span> . <span class="charliteral">&#39;^&#39;</span>);
<a name="l01883"></a>01883                 }
<a name="l01884"></a>01884 
<a name="l01885"></a>01885                 <span class="comment">// get binding</span>
<a name="l01886"></a>01886                 $this-&gt;bindings[ $this-&gt;serviceName . <span class="stringliteral">&#39;Binding&#39;</span> ][<span class="stringliteral">&#39;operations&#39;</span>][$name] =
<a name="l01887"></a>01887                 array(
<a name="l01888"></a>01888                 <span class="stringliteral">&#39;name&#39;</span> =&gt; $name,
<a name="l01889"></a>01889                 <span class="stringliteral">&#39;binding&#39;</span> =&gt; $this-&gt;serviceName . <span class="stringliteral">&#39;Binding&#39;</span>,
<a name="l01890"></a>01890                 <span class="stringliteral">&#39;endpoint&#39;</span> =&gt; $this-&gt;endpoint,
<a name="l01891"></a>01891                 <span class="stringliteral">&#39;soapAction&#39;</span> =&gt; $soapaction,
<a name="l01892"></a>01892                 <span class="stringliteral">&#39;style&#39;</span> =&gt; $style,
<a name="l01893"></a>01893                 <span class="stringliteral">&#39;input&#39;</span> =&gt; array(
<a name="l01894"></a>01894                         <span class="stringliteral">&#39;use&#39;</span> =&gt; $use,
<a name="l01895"></a>01895                         <span class="stringliteral">&#39;namespace&#39;</span> =&gt; $namespace,
<a name="l01896"></a>01896                         <span class="stringliteral">&#39;encodingStyle&#39;</span> =&gt; $encodingStyle,
<a name="l01897"></a>01897                         <span class="stringliteral">&#39;message&#39;</span> =&gt; $name . <span class="stringliteral">&#39;Request&#39;</span>,
<a name="l01898"></a>01898                         <span class="stringliteral">&#39;parts&#39;</span> =&gt; $in),
<a name="l01899"></a>01899                 <span class="stringliteral">&#39;output&#39;</span> =&gt; array(
<a name="l01900"></a>01900                         <span class="stringliteral">&#39;use&#39;</span> =&gt; $use,
<a name="l01901"></a>01901                         <span class="stringliteral">&#39;namespace&#39;</span> =&gt; $namespace,
<a name="l01902"></a>01902                         <span class="stringliteral">&#39;encodingStyle&#39;</span> =&gt; $encodingStyle,
<a name="l01903"></a>01903                         <span class="stringliteral">&#39;message&#39;</span> =&gt; $name . <span class="stringliteral">&#39;Response&#39;</span>,
<a name="l01904"></a>01904                         <span class="stringliteral">&#39;parts&#39;</span> =&gt; $out),
<a name="l01905"></a>01905                 <span class="stringliteral">&#39;namespace&#39;</span> =&gt; $namespace,
<a name="l01906"></a>01906                 <span class="stringliteral">&#39;transport&#39;</span> =&gt; <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/http&#39;</span>,
<a name="l01907"></a>01907                 <span class="stringliteral">&#39;documentation&#39;</span> =&gt; <a class="code" href="classwsdl.html#a90e868755e79fd7f8c37ec8345167952">$documentation</a>); 
<a name="l01908"></a>01908                 <span class="comment">// add portTypes</span>
<a name="l01909"></a>01909                 <span class="comment">// add messages</span>
<a name="l01910"></a>01910                 <span class="keywordflow">if</span>($in)
<a name="l01911"></a>01911                 {
<a name="l01912"></a>01912                         <span class="keywordflow">foreach</span>($in as $pName =&gt; $pType)
<a name="l01913"></a>01913                         {
<a name="l01914"></a>01914                                 <span class="keywordflow">if</span>(strpos($pType,<span class="charliteral">&#39;:&#39;</span>)) {
<a name="l01915"></a>01915                                         $pType = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($pType)).<span class="stringliteral">&quot;:&quot;</span>.$this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($pType);
<a name="l01916"></a>01916                                 }
<a name="l01917"></a>01917                                 $this-&gt;messages[$name.<span class="stringliteral">&#39;Request&#39;</span>][$pName] = $pType;
<a name="l01918"></a>01918                         }
<a name="l01919"></a>01919                 } <span class="keywordflow">else</span> {
<a name="l01920"></a>01920             $this-&gt;messages[$name.<span class="stringliteral">&#39;Request&#39;</span>]= <span class="charliteral">&#39;0&#39;</span>;
<a name="l01921"></a>01921         }
<a name="l01922"></a>01922                 <span class="keywordflow">if</span>($out)
<a name="l01923"></a>01923                 {
<a name="l01924"></a>01924                         <span class="keywordflow">foreach</span>($out as $pName =&gt; $pType)
<a name="l01925"></a>01925                         {
<a name="l01926"></a>01926                                 <span class="keywordflow">if</span>(strpos($pType,<span class="charliteral">&#39;:&#39;</span>)) {
<a name="l01927"></a>01927                                         $pType = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($pType)).<span class="stringliteral">&quot;:&quot;</span>.$this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($pType);
<a name="l01928"></a>01928                                 }
<a name="l01929"></a>01929                                 $this-&gt;messages[$name.<span class="stringliteral">&#39;Response&#39;</span>][$pName] = $pType;
<a name="l01930"></a>01930                         }
<a name="l01931"></a>01931                 } <span class="keywordflow">else</span> {
<a name="l01932"></a>01932             $this-&gt;messages[$name.<span class="stringliteral">&#39;Response&#39;</span>]= <span class="charliteral">&#39;0&#39;</span>;
<a name="l01933"></a>01933         }
<a name="l01934"></a>01934                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01935"></a>01935         } 
<a name="l01936"></a>01936 }
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 ?&gt;
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Dec 1 11:39:30 2010 for DAEDrupalInterface by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
