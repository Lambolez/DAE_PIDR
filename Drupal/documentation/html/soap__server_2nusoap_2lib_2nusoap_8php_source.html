<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>DAEDrupalInterface: modules/soap_server/nusoap/lib/nusoap.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>modules/soap_server/nusoap/lib/nusoap.php</h1><a href="soap__server_2nusoap_2lib_2nusoap_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment">$Id: nusoap.php,v 1.123 2010/04/26 20:15:08 snichol Exp $</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">NuSOAP - Web Services Toolkit for PHP</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">Copyright (c) 2002 NuSphere Corporation</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">This library is free software; you can redistribute it and/or</span>
<a name="l00011"></a>00011 <span class="comment">modify it under the terms of the GNU Lesser General Public</span>
<a name="l00012"></a>00012 <span class="comment">License as published by the Free Software Foundation; either</span>
<a name="l00013"></a>00013 <span class="comment">version 2.1 of the License, or (at your option) any later version.</span>
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment">This library is distributed in the hope that it will be useful,</span>
<a name="l00016"></a>00016 <span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00017"></a>00017 <span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00018"></a>00018 <span class="comment">Lesser General Public License for more details.</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">You should have received a copy of the GNU Lesser General Public</span>
<a name="l00021"></a>00021 <span class="comment">License along with this library; if not, write to the Free Software</span>
<a name="l00022"></a>00022 <span class="comment">Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">The NuSOAP project home is:</span>
<a name="l00025"></a>00025 <span class="comment">http://sourceforge.net/projects/nusoap/</span>
<a name="l00026"></a>00026 <span class="comment"></span>
<a name="l00027"></a>00027 <span class="comment">The primary support for NuSOAP is the Help forum on the project home page.</span>
<a name="l00028"></a>00028 <span class="comment"></span>
<a name="l00029"></a>00029 <span class="comment">If you have any questions or comments, please email:</span>
<a name="l00030"></a>00030 <span class="comment"></span>
<a name="l00031"></a>00031 <span class="comment">Dietrich Ayala</span>
<a name="l00032"></a>00032 <span class="comment">dietrich@ganx4.com</span>
<a name="l00033"></a>00033 <span class="comment">http://dietrich.ganx4.com/nusoap</span>
<a name="l00034"></a>00034 <span class="comment"></span>
<a name="l00035"></a>00035 <span class="comment">NuSphere Corporation</span>
<a name="l00036"></a>00036 <span class="comment">http://www.nusphere.com</span>
<a name="l00037"></a>00037 <span class="comment"></span>
<a name="l00038"></a>00038 <span class="comment">*/</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="comment">/*</span>
<a name="l00041"></a>00041 <span class="comment"> *      Some of the standards implmented in whole or part by NuSOAP:</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> *      SOAP 1.1 (http://www.w3.org/TR/2000/NOTE-SOAP-20000508/)</span>
<a name="l00044"></a>00044 <span class="comment"> *      WSDL 1.1 (http://www.w3.org/TR/2001/NOTE-wsdl-20010315)</span>
<a name="l00045"></a>00045 <span class="comment"> *      SOAP Messages With Attachments (http://www.w3.org/TR/SOAP-attachments)</span>
<a name="l00046"></a>00046 <span class="comment"> *      XML 1.0 (http://www.w3.org/TR/2006/REC-xml-20060816/)</span>
<a name="l00047"></a>00047 <span class="comment"> *      Namespaces in XML 1.0 (http://www.w3.org/TR/2006/REC-xml-names-20060816/)</span>
<a name="l00048"></a>00048 <span class="comment"> *      XML Schema 1.0 (http://www.w3.org/TR/xmlschema-0/)</span>
<a name="l00049"></a>00049 <span class="comment"> *      RFC 2045 Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</span>
<a name="l00050"></a>00050 <span class="comment"> *      RFC 2068 Hypertext Transfer Protocol -- HTTP/1.1</span>
<a name="l00051"></a>00051 <span class="comment"> *      RFC 2617 HTTP Authentication: Basic and Digest Access Authentication</span>
<a name="l00052"></a>00052 <span class="comment"> */</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">/* load classes</span>
<a name="l00055"></a>00055 <span class="comment"></span>
<a name="l00056"></a>00056 <span class="comment">// necessary classes</span>
<a name="l00057"></a>00057 <span class="comment">require_once(&#39;class.soapclient.php&#39;);</span>
<a name="l00058"></a>00058 <span class="comment">require_once(&#39;class.soap_val.php&#39;);</span>
<a name="l00059"></a>00059 <span class="comment">require_once(&#39;class.soap_parser.php&#39;);</span>
<a name="l00060"></a>00060 <span class="comment">require_once(&#39;class.soap_fault.php&#39;);</span>
<a name="l00061"></a>00061 <span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">// transport classes</span>
<a name="l00063"></a>00063 <span class="comment">require_once(&#39;class.soap_transport_http.php&#39;);</span>
<a name="l00064"></a>00064 <span class="comment"></span>
<a name="l00065"></a>00065 <span class="comment">// optional add-on classes</span>
<a name="l00066"></a>00066 <span class="comment">require_once(&#39;class.xmlschema.php&#39;);</span>
<a name="l00067"></a>00067 <span class="comment">require_once(&#39;class.wsdl.php&#39;);</span>
<a name="l00068"></a>00068 <span class="comment"></span>
<a name="l00069"></a>00069 <span class="comment">// server class</span>
<a name="l00070"></a>00070 <span class="comment">require_once(&#39;class.soap_server.php&#39;);*/</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">// class variable emulation</span>
<a name="l00073"></a>00073 <span class="comment">// cf. http://www.webkreator.com/php/techniques/php-static-class-variables.html</span>
<a name="l00074"></a><a class="code" href="soap__server_2nusoap_2lib_2nusoap_8php.html#a8581b61f0ccce82123a43934d044f729">00074</a> <a class="code" href="dae__wsdl_2lib_2class_8nusoap__base_8php.html#a8581b61f0ccce82123a43934d044f729">$GLOBALS</a>[<span class="stringliteral">&#39;_transient&#39;</span>][<span class="stringliteral">&#39;static&#39;</span>][<span class="stringliteral">&#39;nusoap_base&#39;</span>][<span class="stringliteral">&#39;globalDebugLevel&#39;</span>] = 9;
<a name="l00075"></a>00075 
<a name="l00085"></a>00085 <span class="keyword">class </span><a class="code" href="classnusoap__base.html">nusoap_base</a> {
<a name="l00092"></a>00092         var <a class="code" href="classnusoap__base.html#a817eacdc4c6a28bf0017fd2054c35989">$title</a> = <span class="stringliteral">&#39;NuSOAP&#39;</span>;
<a name="l00099"></a>00099         var <a class="code" href="classnusoap__base.html#a0d6d00a043bb2bd105afa0ee9ea0dfc9">$version</a> = <span class="stringliteral">&#39;0.9.5&#39;</span>;
<a name="l00106"></a>00106         var <a class="code" href="classnusoap__base.html#a70c2a01eb0cb88716ed6beb3d2787729">$revision</a> = <span class="stringliteral">&#39;$Revision: 1.123 $&#39;</span>;
<a name="l00113"></a>00113         var <a class="code" href="classnusoap__base.html#ab929dc26708dca55f64ed1ed71eb0ffb">$error_str</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00120"></a>00120     var <a class="code" href="classnusoap__base.html#ab205c30522b616ba6441613a09a6a5d6">$debug_str</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00128"></a>00128         var <a class="code" href="classnusoap__base.html#a83c4f655c9def8e6c83f663ca482cd25">$charencoding</a> = <span class="keyword">true</span>;
<a name="l00135"></a>00135         var <a class="code" href="classnusoap__base.html#a7523d80592269f5d504e47bbc99abcf1">$debugLevel</a>;
<a name="l00136"></a>00136 
<a name="l00143"></a>00143         var <a class="code" href="classnusoap__base.html#ab1acea7d157757313e44d96a999135d8">$XMLSchemaVersion</a> = <span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span>;
<a name="l00144"></a>00144         
<a name="l00151"></a>00151     var <a class="code" href="classnusoap__base.html#aa4f4e01fd8bfce6d40f618b5536c86f9">$soap_defencoding</a> = <span class="stringliteral">&#39;ISO-8859-1&#39;</span>;
<a name="l00152"></a>00152         <span class="comment">//var $soap_defencoding = &#39;UTF-8&#39;;</span>
<a name="l00153"></a>00153 
<a name="l00162"></a>00162         var <a class="code" href="classnusoap__base.html#a5d0c5f71681b592cb9b05898508c0b27">$namespaces</a> = array(
<a name="l00163"></a>00163                 <span class="stringliteral">&#39;SOAP-ENV&#39;</span> =&gt; <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/envelope/&#39;</span>,
<a name="l00164"></a>00164                 <span class="stringliteral">&#39;xsd&#39;</span> =&gt; <span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span>,
<a name="l00165"></a>00165                 <span class="stringliteral">&#39;xsi&#39;</span> =&gt; <span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema-instance&#39;</span>,
<a name="l00166"></a>00166                 <span class="stringliteral">&#39;SOAP-ENC&#39;</span> =&gt; <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>
<a name="l00167"></a>00167                 );
<a name="l00168"></a>00168 
<a name="l00175"></a>00175         var <a class="code" href="classnusoap__base.html#aa00bbae327f1af845ce260e23e43fdb6">$usedNamespaces</a> = array();
<a name="l00176"></a>00176 
<a name="l00184"></a>00184         var <a class="code" href="classnusoap__base.html#ae4ebc59b387f0e1768a86bbb106963af">$typemap</a> = array(
<a name="l00185"></a>00185         <span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span> =&gt; array(
<a name="l00186"></a>00186                 <span class="stringliteral">&#39;string&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;boolean&#39;</span>=&gt;<span class="stringliteral">&#39;boolean&#39;</span>,<span class="stringliteral">&#39;float&#39;</span>=&gt;<span class="stringliteral">&#39;double&#39;</span>,<span class="stringliteral">&#39;double&#39;</span>=&gt;<span class="stringliteral">&#39;double&#39;</span>,<span class="stringliteral">&#39;decimal&#39;</span>=&gt;<span class="stringliteral">&#39;double&#39;</span>,
<a name="l00187"></a>00187                 <span class="stringliteral">&#39;duration&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;dateTime&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;time&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;date&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;gYearMonth&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,
<a name="l00188"></a>00188                 <span class="stringliteral">&#39;gYear&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;gMonthDay&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;gDay&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;gMonth&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;hexBinary&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;base64Binary&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,
<a name="l00189"></a>00189                 <span class="comment">// abstract &quot;any&quot; types</span>
<a name="l00190"></a>00190                 <span class="stringliteral">&#39;anyType&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;anySimpleType&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,
<a name="l00191"></a>00191                 <span class="comment">// derived datatypes</span>
<a name="l00192"></a>00192                 <span class="stringliteral">&#39;normalizedString&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;token&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;language&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;NMTOKEN&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;NMTOKENS&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;Name&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;NCName&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;ID&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,
<a name="l00193"></a>00193                 <span class="stringliteral">&#39;IDREF&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;IDREFS&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;ENTITY&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;ENTITIES&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;integer&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,<span class="stringliteral">&#39;nonPositiveInteger&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,
<a name="l00194"></a>00194                 <span class="stringliteral">&#39;negativeInteger&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,<span class="stringliteral">&#39;long&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,<span class="stringliteral">&#39;int&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,<span class="stringliteral">&#39;short&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,<span class="stringliteral">&#39;byte&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,<span class="stringliteral">&#39;nonNegativeInteger&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,
<a name="l00195"></a>00195                 <span class="stringliteral">&#39;unsignedLong&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;unsignedInt&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;unsignedShort&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;unsignedByte&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;positiveInteger&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>),
<a name="l00196"></a>00196         <span class="stringliteral">&#39;http://www.w3.org/2000/10/XMLSchema&#39;</span> =&gt; array(
<a name="l00197"></a>00197                 <span class="stringliteral">&#39;i4&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;int&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,<span class="stringliteral">&#39;boolean&#39;</span>=&gt;<span class="stringliteral">&#39;boolean&#39;</span>,<span class="stringliteral">&#39;string&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;double&#39;</span>=&gt;<span class="stringliteral">&#39;double&#39;</span>,
<a name="l00198"></a>00198                 <span class="stringliteral">&#39;float&#39;</span>=&gt;<span class="stringliteral">&#39;double&#39;</span>,<span class="stringliteral">&#39;dateTime&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,
<a name="l00199"></a>00199                 <span class="stringliteral">&#39;timeInstant&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;base64Binary&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;base64&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;ur-type&#39;</span>=&gt;<span class="stringliteral">&#39;array&#39;</span>),
<a name="l00200"></a>00200         <span class="stringliteral">&#39;http://www.w3.org/1999/XMLSchema&#39;</span> =&gt; array(
<a name="l00201"></a>00201                 <span class="stringliteral">&#39;i4&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;int&#39;</span>=&gt;<span class="stringliteral">&#39;integer&#39;</span>,<span class="stringliteral">&#39;boolean&#39;</span>=&gt;<span class="stringliteral">&#39;boolean&#39;</span>,<span class="stringliteral">&#39;string&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;double&#39;</span>=&gt;<span class="stringliteral">&#39;double&#39;</span>,
<a name="l00202"></a>00202                 <span class="stringliteral">&#39;float&#39;</span>=&gt;<span class="stringliteral">&#39;double&#39;</span>,<span class="stringliteral">&#39;dateTime&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,
<a name="l00203"></a>00203                 <span class="stringliteral">&#39;timeInstant&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;base64Binary&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;base64&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;ur-type&#39;</span>=&gt;<span class="stringliteral">&#39;array&#39;</span>),
<a name="l00204"></a>00204         <span class="stringliteral">&#39;http://soapinterop.org/xsd&#39;</span> =&gt; array(<span class="stringliteral">&#39;SOAPStruct&#39;</span>=&gt;<span class="stringliteral">&#39;struct&#39;</span>),
<a name="l00205"></a>00205         <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span> =&gt; array(<span class="stringliteral">&#39;base64&#39;</span>=&gt;<span class="stringliteral">&#39;string&#39;</span>,<span class="stringliteral">&#39;array&#39;</span>=&gt;<span class="stringliteral">&#39;array&#39;</span>,<span class="stringliteral">&#39;Array&#39;</span>=&gt;<span class="stringliteral">&#39;array&#39;</span>),
<a name="l00206"></a>00206     <span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span> =&gt; array(<span class="stringliteral">&#39;Map&#39;</span>)
<a name="l00207"></a>00207         );
<a name="l00208"></a>00208 
<a name="l00217"></a>00217         var <a class="code" href="classnusoap__base.html#a6d64d7e002f63d40855cbccd9ec12e39">$xmlEntities</a> = array(<span class="stringliteral">&#39;quot&#39;</span> =&gt; <span class="charliteral">&#39;&quot;&#39;</span>,<span class="stringliteral">&#39;amp&#39;</span> =&gt; <span class="charliteral">&#39;&amp;&#39;</span>,
<a name="l00218"></a>00218                 <span class="stringliteral">&#39;lt&#39;</span> =&gt; <span class="charliteral">&#39;&lt;&#39;</span>,<span class="stringliteral">&#39;gt&#39;</span> =&gt; <span class="charliteral">&#39;&gt;&#39;</span>,<span class="stringliteral">&#39;apos&#39;</span> =&gt; <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00219"></a>00219 
<a name="l00225"></a><a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">00225</a>         function <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">nusoap_base</a>() {
<a name="l00226"></a>00226                 $this-&gt;debugLevel = <a class="code" href="dae__wsdl_2lib_2class_8nusoap__base_8php.html#a8581b61f0ccce82123a43934d044f729">$GLOBALS</a>[<span class="stringliteral">&#39;_transient&#39;</span>][<span class="stringliteral">&#39;static&#39;</span>][<span class="stringliteral">&#39;nusoap_base&#39;</span>][<span class="stringliteral">&#39;globalDebugLevel&#39;</span>];
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228 
<a name="l00235"></a><a class="code" href="classnusoap__base.html#ae908fa7f244da9d9d049f3d3dd3e84cd">00235</a>         function <a class="code" href="classnusoap__base.html#ae908fa7f244da9d9d049f3d3dd3e84cd">getGlobalDebugLevel</a>() {
<a name="l00236"></a>00236                 <span class="keywordflow">return</span> <a class="code" href="dae__wsdl_2lib_2class_8nusoap__base_8php.html#a8581b61f0ccce82123a43934d044f729">$GLOBALS</a>[<span class="stringliteral">&#39;_transient&#39;</span>][<span class="stringliteral">&#39;static&#39;</span>][<span class="stringliteral">&#39;nusoap_base&#39;</span>][<span class="stringliteral">&#39;globalDebugLevel&#39;</span>];
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238 
<a name="l00245"></a><a class="code" href="classnusoap__base.html#a6d677a19eb0e5a95673eaab9a6e99c48">00245</a>         function <a class="code" href="classnusoap__base.html#a6d677a19eb0e5a95673eaab9a6e99c48">setGlobalDebugLevel</a>($level) {
<a name="l00246"></a>00246                 <a class="code" href="dae__wsdl_2lib_2class_8nusoap__base_8php.html#a8581b61f0ccce82123a43934d044f729">$GLOBALS</a>[<span class="stringliteral">&#39;_transient&#39;</span>][<span class="stringliteral">&#39;static&#39;</span>][<span class="stringliteral">&#39;nusoap_base&#39;</span>][<span class="stringliteral">&#39;globalDebugLevel&#39;</span>] = $level;
<a name="l00247"></a>00247         }
<a name="l00248"></a>00248 
<a name="l00255"></a><a class="code" href="classnusoap__base.html#a3daafdf50e4f3348256943400b9baff6">00255</a>         function <a class="code" href="classnusoap__base.html#a3daafdf50e4f3348256943400b9baff6">getDebugLevel</a>() {
<a name="l00256"></a>00256                 <span class="keywordflow">return</span> $this-&gt;debugLevel;
<a name="l00257"></a>00257         }
<a name="l00258"></a>00258 
<a name="l00265"></a><a class="code" href="classnusoap__base.html#abcb0fa408704b5d48c8ec4630bc4f9a5">00265</a>         function <a class="code" href="classnusoap__base.html#abcb0fa408704b5d48c8ec4630bc4f9a5">setDebugLevel</a>($level) {
<a name="l00266"></a>00266                 $this-&gt;debugLevel = $level;
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268 
<a name="l00275"></a><a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">00275</a>         function <a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($string){
<a name="l00276"></a>00276                 <span class="keywordflow">if</span> ($this-&gt;debugLevel &gt; 0) {
<a name="l00277"></a>00277                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#a1945b0481c5128c4126352f457a4c36a">getmicrotime</a>().<span class="charliteral">&#39; &#39;</span>.get_class($this).<span class="stringliteral">&quot;: $string\n&quot;</span>);
<a name="l00278"></a>00278                 }
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280 
<a name="l00287"></a><a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">00287</a>         function <a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($string){
<a name="l00288"></a>00288                 <span class="keywordflow">if</span> ($this-&gt;debugLevel &gt; 0) {
<a name="l00289"></a>00289                         <span class="comment">// it would be nice to use a memory stream here to use</span>
<a name="l00290"></a>00290                         <span class="comment">// memory more efficiently</span>
<a name="l00291"></a>00291                         $this-&gt;debug_str .= $string;
<a name="l00292"></a>00292                 }
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294 
<a name="l00300"></a><a class="code" href="classnusoap__base.html#a8e18ffd463ac8aad2095617e80c271c7">00300</a>         function <a class="code" href="classnusoap__base.html#a8e18ffd463ac8aad2095617e80c271c7">clearDebug</a>() {
<a name="l00301"></a>00301                 <span class="comment">// it would be nice to use a memory stream here to use</span>
<a name="l00302"></a>00302                 <span class="comment">// memory more efficiently</span>
<a name="l00303"></a>00303                 $this-&gt;debug_str = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00304"></a>00304         }
<a name="l00305"></a>00305 
<a name="l00312"></a><a class="code" href="classnusoap__base.html#a0ad5e3365040a6352f7064e107f3dab7">00312</a>         function &amp;<a class="code" href="classnusoap__base.html#a0ad5e3365040a6352f7064e107f3dab7">getDebug</a>() {
<a name="l00313"></a>00313                 <span class="comment">// it would be nice to use a memory stream here to use</span>
<a name="l00314"></a>00314                 <span class="comment">// memory more efficiently</span>
<a name="l00315"></a>00315                 <span class="keywordflow">return</span> $this-&gt;debug_str;
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317 
<a name="l00325"></a><a class="code" href="classnusoap__base.html#a1517d53fd8ffed1b61db074b038d1521">00325</a>         function &amp;<a class="code" href="classnusoap__base.html#a1517d53fd8ffed1b61db074b038d1521">getDebugAsXMLComment</a>() {
<a name="l00326"></a>00326                 <span class="comment">// it would be nice to use a memory stream here to use</span>
<a name="l00327"></a>00327                 <span class="comment">// memory more efficiently</span>
<a name="l00328"></a>00328                 <span class="keywordflow">while</span> (strpos($this-&gt;debug_str, <span class="stringliteral">&#39;--&#39;</span>)) {
<a name="l00329"></a>00329                         $this-&gt;debug_str = str_replace(<span class="stringliteral">&#39;--&#39;</span>, <span class="stringliteral">&#39;- -&#39;</span>, $this-&gt;debug_str);
<a name="l00330"></a>00330                 }
<a name="l00331"></a>00331                 $ret = <span class="stringliteral">&quot;&lt;!--\n&quot;</span> . $this-&gt;debug_str . <span class="stringliteral">&quot;\n--&gt;&quot;</span>;
<a name="l00332"></a>00332         <span class="keywordflow">return</span> $ret;
<a name="l00333"></a>00333         }
<a name="l00334"></a>00334 
<a name="l00341"></a><a class="code" href="classnusoap__base.html#aa05581a9628de0f46b30dd67b5578cef">00341</a>         function <a class="code" href="classnusoap__base.html#aa05581a9628de0f46b30dd67b5578cef">expandEntities</a>($val) {
<a name="l00342"></a>00342                 <span class="keywordflow">if</span> ($this-&gt;charencoding) {
<a name="l00343"></a>00343                 $val = str_replace(<span class="charliteral">&#39;&amp;&#39;</span>, <span class="stringliteral">&#39;&amp;amp;&#39;</span>, $val);
<a name="l00344"></a>00344                 $val = str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&#39;&amp;apos;&#39;</span>, $val);
<a name="l00345"></a>00345                 $val = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>, <span class="stringliteral">&#39;&amp;quot;&#39;</span>, $val);
<a name="l00346"></a>00346                 $val = str_replace(<span class="charliteral">&#39;&lt;&#39;</span>, <span class="stringliteral">&#39;&amp;lt;&#39;</span>, $val);
<a name="l00347"></a>00347                 $val = str_replace(<span class="charliteral">&#39;&gt;&#39;</span>, <span class="stringliteral">&#39;&amp;gt;&#39;</span>, $val);
<a name="l00348"></a>00348             }
<a name="l00349"></a>00349             <span class="keywordflow">return</span> $val;
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351 
<a name="l00358"></a><a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">00358</a>         function <a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>(){
<a name="l00359"></a>00359                 <span class="keywordflow">if</span>($this-&gt;error_str != <span class="stringliteral">&#39;&#39;</span>){
<a name="l00360"></a>00360                         <span class="keywordflow">return</span> $this-&gt;error_str;
<a name="l00361"></a>00361                 }
<a name="l00362"></a>00362                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00363"></a>00363         }
<a name="l00364"></a>00364 
<a name="l00371"></a><a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">00371</a>         function <a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($str){
<a name="l00372"></a>00372                 $this-&gt;error_str = $str;
<a name="l00373"></a>00373         }
<a name="l00374"></a>00374 
<a name="l00382"></a><a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">00382</a>         function <a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">isArraySimpleOrStruct</a>($val) {
<a name="l00383"></a>00383         $keyList = array_keys($val);
<a name="l00384"></a>00384                 <span class="keywordflow">foreach</span> ($keyList as $keyListValue) {
<a name="l00385"></a>00385                         <span class="keywordflow">if</span> (!is_int($keyListValue)) {
<a name="l00386"></a>00386                                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;arrayStruct&#39;</span>;
<a name="l00387"></a>00387                         }
<a name="l00388"></a>00388                 }
<a name="l00389"></a>00389                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;arraySimple&#39;</span>;
<a name="l00390"></a>00390         }
<a name="l00391"></a>00391 
<a name="l00407"></a><a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">00407</a>         function <a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($val,$name=<span class="keyword">false</span>,$type=<span class="keyword">false</span>,$name_ns=<span class="keyword">false</span>,$type_ns=<span class="keyword">false</span>,$attributes=<span class="keyword">false</span>,$use=<span class="stringliteral">&#39;encoded&#39;</span>,$soapval=<span class="keyword">false</span>) {
<a name="l00408"></a>00408                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serialize_val: name=$name, type=$type, name_ns=$name_ns, type_ns=$type_ns, use=$use, soapval=$soapval&quot;</span>);
<a name="l00409"></a>00409                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;value=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($val));
<a name="l00410"></a>00410                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;attributes=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($attributes));
<a name="l00411"></a>00411                 
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (is_object($val) &amp;&amp; get_class($val) == <span class="stringliteral">&#39;soapval&#39;</span> &amp;&amp; (! $soapval)) {
<a name="l00413"></a>00413                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize soapval&quot;</span>);
<a name="l00414"></a>00414                 $xml = $val-&gt;serialize($use);
<a name="l00415"></a>00415                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($val-&gt;getDebug());
<a name="l00416"></a>00416                         $val-&gt;clearDebug();
<a name="l00417"></a>00417                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val of soapval returning $xml&quot;</span>);
<a name="l00418"></a>00418                         <span class="keywordflow">return</span> $xml;
<a name="l00419"></a>00419         }
<a name="l00420"></a>00420                 <span class="comment">// force valid name if necessary</span>
<a name="l00421"></a>00421                 <span class="keywordflow">if</span> (is_numeric($name)) {
<a name="l00422"></a>00422                         $name = <span class="stringliteral">&#39;__numeric_&#39;</span> . $name;
<a name="l00423"></a>00423                 } elseif (! $name) {
<a name="l00424"></a>00424                         $name = <span class="stringliteral">&#39;noname&#39;</span>;
<a name="l00425"></a>00425                 }
<a name="l00426"></a>00426                 <span class="comment">// if name has ns, add ns prefix to name</span>
<a name="l00427"></a>00427                 $xmlns = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00428"></a>00428         <span class="keywordflow">if</span>($name_ns){
<a name="l00429"></a>00429                         $prefix = <span class="stringliteral">&#39;nu&#39;</span>.rand(1000,9999);
<a name="l00430"></a>00430                         $name = $prefix.<span class="charliteral">&#39;:&#39;</span>.$name;
<a name="l00431"></a>00431                         $xmlns .= <span class="stringliteral">&quot; xmlns:$prefix=\&quot;$name_ns\&quot;&quot;</span>;
<a name="l00432"></a>00432                 }
<a name="l00433"></a>00433                 <span class="comment">// if type is prefixed, create type prefix</span>
<a name="l00434"></a>00434                 <span class="keywordflow">if</span>($type_ns != <span class="stringliteral">&#39;&#39;</span> &amp;&amp; $type_ns == $this-&gt;namespaces[<span class="stringliteral">&#39;xsd&#39;</span>]){
<a name="l00435"></a>00435                         <span class="comment">// need to fix this. shouldn&#39;t default to xsd if no ns specified</span>
<a name="l00436"></a>00436                     <span class="comment">// w/o checking against typemap</span>
<a name="l00437"></a>00437                         $type_prefix = <span class="stringliteral">&#39;xsd&#39;</span>;
<a name="l00438"></a>00438                 } elseif($type_ns){
<a name="l00439"></a>00439                         $type_prefix = <span class="stringliteral">&#39;ns&#39;</span>.rand(1000,9999);
<a name="l00440"></a>00440                         $xmlns .= <span class="stringliteral">&quot; xmlns:$type_prefix=\&quot;$type_ns\&quot;&quot;</span>;
<a name="l00441"></a>00441                 }
<a name="l00442"></a>00442                 <span class="comment">// serialize attributes if present</span>
<a name="l00443"></a>00443                 $atts = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00444"></a>00444                 <span class="keywordflow">if</span>($attributes){
<a name="l00445"></a>00445                         <span class="keywordflow">foreach</span>($attributes as $k =&gt; $v){
<a name="l00446"></a>00446                                 $atts .= <span class="stringliteral">&quot; $k=\&quot;&quot;</span>.$this-&gt;expandEntities($v).<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00447"></a>00447                         }
<a name="l00448"></a>00448                 }
<a name="l00449"></a>00449                 <span class="comment">// serialize null value</span>
<a name="l00450"></a>00450                 <span class="keywordflow">if</span> (is_null($val)) {
<a name="l00451"></a>00451                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize null&quot;</span>);
<a name="l00452"></a>00452                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00453"></a>00453                                 <span class="comment">// TODO: depends on minOccurs</span>
<a name="l00454"></a>00454                                 $xml = <span class="stringliteral">&quot;&lt;$name$xmlns$atts/&gt;&quot;</span>;
<a name="l00455"></a>00455                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val returning $xml&quot;</span>);
<a name="l00456"></a>00456                         <span class="keywordflow">return</span> $xml;
<a name="l00457"></a>00457                 } <span class="keywordflow">else</span> {
<a name="l00458"></a>00458                                 <span class="keywordflow">if</span> (isset($type) &amp;&amp; isset($type_prefix)) {
<a name="l00459"></a>00459                                         $type_str = <span class="stringliteral">&quot; xsi:type=\&quot;$type_prefix:$type\&quot;&quot;</span>;
<a name="l00460"></a>00460                                 } <span class="keywordflow">else</span> {
<a name="l00461"></a>00461                                         $type_str = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00462"></a>00462                                 }
<a name="l00463"></a>00463                                 $xml = <span class="stringliteral">&quot;&lt;$name$xmlns$type_str$atts xsi:nil=\&quot;true\&quot;/&gt;&quot;</span>;
<a name="l00464"></a>00464                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val returning $xml&quot;</span>);
<a name="l00465"></a>00465                         <span class="keywordflow">return</span> $xml;
<a name="l00466"></a>00466                 }
<a name="l00467"></a>00467                 }
<a name="l00468"></a>00468         <span class="comment">// serialize if an xsd built-in primitive type</span>
<a name="l00469"></a>00469         <span class="keywordflow">if</span>($type != <span class="stringliteral">&#39;&#39;</span> &amp;&amp; isset($this-&gt;typemap[$this-&gt;XMLSchemaVersion][$type])){
<a name="l00470"></a>00470                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize xsd built-in primitive type&quot;</span>);
<a name="l00471"></a>00471                 <span class="keywordflow">if</span> (is_bool($val)) {
<a name="l00472"></a>00472                         <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;boolean&#39;</span>) {
<a name="l00473"></a>00473                                 $val = $val ? <span class="stringliteral">&#39;true&#39;</span> : <span class="stringliteral">&#39;false&#39;</span>;
<a name="l00474"></a>00474                         } elseif (! $val) {
<a name="l00475"></a>00475                                 $val = 0;
<a name="l00476"></a>00476                         }
<a name="l00477"></a>00477                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_string($val)) {
<a name="l00478"></a>00478                                 $val = $this-&gt;<a class="code" href="classnusoap__base.html#aa05581a9628de0f46b30dd67b5578cef">expandEntities</a>($val);
<a name="l00479"></a>00479                         }
<a name="l00480"></a>00480                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00481"></a>00481                                 $xml = <span class="stringliteral">&quot;&lt;$name$xmlns$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00482"></a>00482                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val returning $xml&quot;</span>);
<a name="l00483"></a>00483                         <span class="keywordflow">return</span> $xml;
<a name="l00484"></a>00484                 } <span class="keywordflow">else</span> {
<a name="l00485"></a>00485                                 $xml = <span class="stringliteral">&quot;&lt;$name$xmlns xsi:type=\&quot;xsd:$type\&quot;$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00486"></a>00486                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val returning $xml&quot;</span>);
<a name="l00487"></a>00487                         <span class="keywordflow">return</span> $xml;
<a name="l00488"></a>00488                 }
<a name="l00489"></a>00489         }
<a name="l00490"></a>00490                 <span class="comment">// detect type and serialize</span>
<a name="l00491"></a>00491                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00492"></a>00492                 <span class="keywordflow">switch</span>(<span class="keyword">true</span>) {
<a name="l00493"></a>00493                         <span class="keywordflow">case</span> (is_bool($val) || $type == <span class="stringliteral">&#39;boolean&#39;</span>):
<a name="l00494"></a>00494                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize boolean&quot;</span>);
<a name="l00495"></a>00495                         <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;boolean&#39;</span>) {
<a name="l00496"></a>00496                                 $val = $val ? <span class="stringliteral">&#39;true&#39;</span> : <span class="stringliteral">&#39;false&#39;</span>;
<a name="l00497"></a>00497                         } elseif (! $val) {
<a name="l00498"></a>00498                                 $val = 0;
<a name="l00499"></a>00499                         }
<a name="l00500"></a>00500                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00501"></a>00501                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00502"></a>00502                                 } <span class="keywordflow">else</span> {
<a name="l00503"></a>00503                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns xsi:type=\&quot;xsd:boolean\&quot;$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00504"></a>00504                                 }
<a name="l00505"></a>00505                                 <span class="keywordflow">break</span>;
<a name="l00506"></a>00506                         <span class="keywordflow">case</span> (is_int($val) || is_long($val) || $type == <span class="stringliteral">&#39;int&#39;</span>):
<a name="l00507"></a>00507                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize int&quot;</span>);
<a name="l00508"></a>00508                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00509"></a>00509                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00510"></a>00510                                 } <span class="keywordflow">else</span> {
<a name="l00511"></a>00511                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns xsi:type=\&quot;xsd:int\&quot;$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00512"></a>00512                                 }
<a name="l00513"></a>00513                                 <span class="keywordflow">break</span>;
<a name="l00514"></a>00514                         <span class="keywordflow">case</span> (is_float($val)|| is_double($val) || $type == <span class="stringliteral">&#39;float&#39;</span>):
<a name="l00515"></a>00515                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize float&quot;</span>);
<a name="l00516"></a>00516                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00517"></a>00517                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00518"></a>00518                                 } <span class="keywordflow">else</span> {
<a name="l00519"></a>00519                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns xsi:type=\&quot;xsd:float\&quot;$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00520"></a>00520                                 }
<a name="l00521"></a>00521                                 <span class="keywordflow">break</span>;
<a name="l00522"></a>00522                         <span class="keywordflow">case</span> (is_string($val) || $type == <span class="stringliteral">&#39;string&#39;</span>):
<a name="l00523"></a>00523                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize string&quot;</span>);
<a name="l00524"></a>00524                                 $val = $this-&gt;<a class="code" href="classnusoap__base.html#aa05581a9628de0f46b30dd67b5578cef">expandEntities</a>($val);
<a name="l00525"></a>00525                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00526"></a>00526                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00527"></a>00527                                 } <span class="keywordflow">else</span> {
<a name="l00528"></a>00528                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns xsi:type=\&quot;xsd:string\&quot;$atts&gt;$val&lt;/$name&gt;&quot;</span>;
<a name="l00529"></a>00529                                 }
<a name="l00530"></a>00530                                 <span class="keywordflow">break</span>;
<a name="l00531"></a>00531                         <span class="keywordflow">case</span> is_object($val):
<a name="l00532"></a>00532                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize object&quot;</span>);
<a name="l00533"></a>00533                         <span class="keywordflow">if</span> (get_class($val) == <span class="stringliteral">&#39;soapval&#39;</span>) {
<a name="l00534"></a>00534                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize soapval object&quot;</span>);
<a name="l00535"></a>00535                                 $pXml = $val-&gt;serialize($use);
<a name="l00536"></a>00536                                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($val-&gt;getDebug());
<a name="l00537"></a>00537                                         $val-&gt;clearDebug();
<a name="l00538"></a>00538                         } <span class="keywordflow">else</span> {
<a name="l00539"></a>00539                                         <span class="keywordflow">if</span> (! $name) {
<a name="l00540"></a>00540                                                 $name = get_class($val);
<a name="l00541"></a>00541                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In serialize_val, used class name $name as element name&quot;</span>);
<a name="l00542"></a>00542                                         } <span class="keywordflow">else</span> {
<a name="l00543"></a>00543                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In serialize_val, do not override name $name for element name for class &quot;</span> . get_class($val));
<a name="l00544"></a>00544                                         }
<a name="l00545"></a>00545                                         <span class="keywordflow">foreach</span>(get_object_vars($val) as $k =&gt; $v){
<a name="l00546"></a>00546                                                 $pXml = isset($pXml) ? $pXml.$this-&gt;serialize_val($v,$k,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use) : $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v,$k,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l00547"></a>00547                                         }
<a name="l00548"></a>00548                                 }
<a name="l00549"></a>00549                                 <span class="keywordflow">if</span>(isset($type) &amp;&amp; isset($type_prefix)){
<a name="l00550"></a>00550                                         $type_str = <span class="stringliteral">&quot; xsi:type=\&quot;$type_prefix:$type\&quot;&quot;</span>;
<a name="l00551"></a>00551                                 } <span class="keywordflow">else</span> {
<a name="l00552"></a>00552                                         $type_str = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00553"></a>00553                                 }
<a name="l00554"></a>00554                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00555"></a>00555                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns$atts&gt;$pXml&lt;/$name&gt;&quot;</span>;
<a name="l00556"></a>00556                                 } <span class="keywordflow">else</span> {
<a name="l00557"></a>00557                                         $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns$type_str$atts&gt;$pXml&lt;/$name&gt;&quot;</span>;
<a name="l00558"></a>00558                                 }
<a name="l00559"></a>00559                                 <span class="keywordflow">break</span>;
<a name="l00560"></a>00560                         <span class="keywordflow">break</span>;
<a name="l00561"></a>00561                         <span class="keywordflow">case</span> (is_array($val) || $type):
<a name="l00562"></a>00562                                 <span class="comment">// detect if struct or array</span>
<a name="l00563"></a>00563                                 $valueType = $this-&gt;<a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">isArraySimpleOrStruct</a>($val);
<a name="l00564"></a>00564                 <span class="keywordflow">if</span>($valueType==<span class="stringliteral">&#39;arraySimple&#39;</span> || preg_match(<span class="stringliteral">&#39;/^ArrayOf/&#39;</span>,$type)){
<a name="l00565"></a>00565                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize array&quot;</span>);
<a name="l00566"></a>00566                                         <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0;
<a name="l00567"></a>00567                                         <span class="keywordflow">if</span>(is_array($val) &amp;&amp; count($val)&gt; 0){
<a name="l00568"></a>00568                                                 <span class="keywordflow">foreach</span>($val as $v){
<a name="l00569"></a>00569                                 <span class="keywordflow">if</span>(is_object($v) &amp;&amp; get_class($v) ==  <span class="stringliteral">&#39;soapval&#39;</span>){
<a name="l00570"></a>00570                                                                 $tt_ns = $v-&gt;type_ns;
<a name="l00571"></a>00571                                                                 $tt = $v-&gt;type;
<a name="l00572"></a>00572                                                         } elseif (is_array($v)) {
<a name="l00573"></a>00573                                                                 $tt = $this-&gt;<a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">isArraySimpleOrStruct</a>($v);
<a name="l00574"></a>00574                                                         } <span class="keywordflow">else</span> {
<a name="l00575"></a>00575                                                                 $tt = gettype($v);
<a name="l00576"></a>00576                                 }
<a name="l00577"></a>00577                                                         $array_types[$tt] = 1;
<a name="l00578"></a>00578                                                         <span class="comment">// TODO: for literal, the name should be $name</span>
<a name="l00579"></a>00579                                                         $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v,<span class="stringliteral">&#39;item&#39;</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l00580"></a>00580                                                         ++<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>;
<a name="l00581"></a>00581                                                 }
<a name="l00582"></a>00582                                                 <span class="keywordflow">if</span>(count($array_types) &gt; 1){
<a name="l00583"></a>00583                                                         $array_typename = <span class="stringliteral">&#39;xsd:anyType&#39;</span>;
<a name="l00584"></a>00584                                                 } elseif(isset($tt) &amp;&amp; isset($this-&gt;typemap[$this-&gt;XMLSchemaVersion][$tt])) {
<a name="l00585"></a>00585                                                         <span class="keywordflow">if</span> ($tt == <span class="stringliteral">&#39;integer&#39;</span>) {
<a name="l00586"></a>00586                                                                 $tt = <span class="stringliteral">&#39;int&#39;</span>;
<a name="l00587"></a>00587                                                         }
<a name="l00588"></a>00588                                                         $array_typename = <span class="stringliteral">&#39;xsd:&#39;</span>.$tt;
<a name="l00589"></a>00589                                                 } elseif(isset($tt) &amp;&amp; $tt == <span class="stringliteral">&#39;arraySimple&#39;</span>){
<a name="l00590"></a>00590                                                         $array_typename = <span class="stringliteral">&#39;SOAP-ENC:Array&#39;</span>;
<a name="l00591"></a>00591                                                 } elseif(isset($tt) &amp;&amp; $tt == <span class="stringliteral">&#39;arrayStruct&#39;</span>){
<a name="l00592"></a>00592                                                         $array_typename = <span class="stringliteral">&#39;unnamed_struct_use_soapval&#39;</span>;
<a name="l00593"></a>00593                                                 } <span class="keywordflow">else</span> {
<a name="l00594"></a>00594                                                         <span class="comment">// if type is prefixed, create type prefix</span>
<a name="l00595"></a>00595                                                         <span class="keywordflow">if</span> ($tt_ns != <span class="stringliteral">&#39;&#39;</span> &amp;&amp; $tt_ns == $this-&gt;namespaces[<span class="stringliteral">&#39;xsd&#39;</span>]){
<a name="l00596"></a>00596                                                                  $array_typename = <span class="stringliteral">&#39;xsd:&#39;</span> . $tt;
<a name="l00597"></a>00597                                                         } elseif ($tt_ns) {
<a name="l00598"></a>00598                                                                 $tt_prefix = <span class="stringliteral">&#39;ns&#39;</span> . rand(1000, 9999);
<a name="l00599"></a>00599                                                                 $array_typename = <span class="stringliteral">&quot;$tt_prefix:$tt&quot;</span>;
<a name="l00600"></a>00600                                                                 $xmlns .= <span class="stringliteral">&quot; xmlns:$tt_prefix=\&quot;$tt_ns\&quot;&quot;</span>;
<a name="l00601"></a>00601                                                         } <span class="keywordflow">else</span> {
<a name="l00602"></a>00602                                                                 $array_typename = $tt;
<a name="l00603"></a>00603                                                         }
<a name="l00604"></a>00604                                                 }
<a name="l00605"></a>00605                                                 $array_type = <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>;
<a name="l00606"></a>00606                                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00607"></a>00607                                                         $type_str = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00608"></a>00608                                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($type) &amp;&amp; isset($type_prefix)) {
<a name="l00609"></a>00609                                                         $type_str = <span class="stringliteral">&quot; xsi:type=\&quot;$type_prefix:$type\&quot;&quot;</span>;
<a name="l00610"></a>00610                                                 } <span class="keywordflow">else</span> {
<a name="l00611"></a>00611                                                         $type_str = <span class="stringliteral">&quot; xsi:type=\&quot;SOAP-ENC:Array\&quot; SOAP-ENC:arrayType=\&quot;&quot;</span>.$array_typename.<span class="stringliteral">&quot;[$array_type]\&quot;&quot;</span>;
<a name="l00612"></a>00612                                                 }
<a name="l00613"></a>00613                                         <span class="comment">// empty array</span>
<a name="l00614"></a>00614                                         } <span class="keywordflow">else</span> {
<a name="l00615"></a>00615                                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00616"></a>00616                                                         $type_str = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00617"></a>00617                                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($type) &amp;&amp; isset($type_prefix)) {
<a name="l00618"></a>00618                                                         $type_str = <span class="stringliteral">&quot; xsi:type=\&quot;$type_prefix:$type\&quot;&quot;</span>;
<a name="l00619"></a>00619                                                 } <span class="keywordflow">else</span> {
<a name="l00620"></a>00620                                                         $type_str = <span class="stringliteral">&quot; xsi:type=\&quot;SOAP-ENC:Array\&quot; SOAP-ENC:arrayType=\&quot;xsd:anyType[0]\&quot;&quot;</span>;
<a name="l00621"></a>00621                                                 }
<a name="l00622"></a>00622                                         }
<a name="l00623"></a>00623                                         <span class="comment">// TODO: for array in literal, there is no wrapper here</span>
<a name="l00624"></a>00624                                         $xml = <span class="stringliteral">&quot;&lt;$name$xmlns$type_str$atts&gt;&quot;</span>.$xml.<span class="stringliteral">&quot;&lt;/$name&gt;&quot;</span>;
<a name="l00625"></a>00625                                 } <span class="keywordflow">else</span> {
<a name="l00626"></a>00626                                         <span class="comment">// got a struct</span>
<a name="l00627"></a>00627                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize struct&quot;</span>);
<a name="l00628"></a>00628                                         <span class="keywordflow">if</span>(isset($type) &amp;&amp; isset($type_prefix)){
<a name="l00629"></a>00629                                                 $type_str = <span class="stringliteral">&quot; xsi:type=\&quot;$type_prefix:$type\&quot;&quot;</span>;
<a name="l00630"></a>00630                                         } <span class="keywordflow">else</span> {
<a name="l00631"></a>00631                                                 $type_str = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00632"></a>00632                                         }
<a name="l00633"></a>00633                                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l00634"></a>00634                                                 $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns$atts&gt;&quot;</span>;
<a name="l00635"></a>00635                                         } <span class="keywordflow">else</span> {
<a name="l00636"></a>00636                                                 $xml .= <span class="stringliteral">&quot;&lt;$name$xmlns$type_str$atts&gt;&quot;</span>;
<a name="l00637"></a>00637                                         }
<a name="l00638"></a>00638                                         <span class="keywordflow">foreach</span>($val as $k =&gt; $v){
<a name="l00639"></a>00639                                                 <span class="comment">// Apache Map</span>
<a name="l00640"></a>00640                                                 <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;Map&#39;</span> &amp;&amp; $type_ns == <span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>) {
<a name="l00641"></a>00641                                                         $xml .= <span class="stringliteral">&#39;&lt;item&gt;&#39;</span>;
<a name="l00642"></a>00642                                                         $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($k,<span class="stringliteral">&#39;key&#39;</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l00643"></a>00643                                                         $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v,<span class="stringliteral">&#39;value&#39;</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l00644"></a>00644                                                         $xml .= <span class="stringliteral">&#39;&lt;/item&gt;&#39;</span>;
<a name="l00645"></a>00645                                                 } <span class="keywordflow">else</span> {
<a name="l00646"></a>00646                                                         $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v,$k,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l00647"></a>00647                                                 }
<a name="l00648"></a>00648                                         }
<a name="l00649"></a>00649                                         $xml .= <span class="stringliteral">&quot;&lt;/$name&gt;&quot;</span>;
<a name="l00650"></a>00650                                 }
<a name="l00651"></a>00651                                 <span class="keywordflow">break</span>;
<a name="l00652"></a>00652                         <span class="keywordflow">default</span>:
<a name="l00653"></a>00653                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val: serialize unknown&quot;</span>);
<a name="l00654"></a>00654                                 $xml .= <span class="stringliteral">&#39;not detected, got &#39;</span>.gettype($val).<span class="stringliteral">&#39; for &#39;</span>.$val;
<a name="l00655"></a>00655                                 <span class="keywordflow">break</span>;
<a name="l00656"></a>00656                 }
<a name="l00657"></a>00657                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize_val returning $xml&quot;</span>);
<a name="l00658"></a>00658                 <span class="keywordflow">return</span> $xml;
<a name="l00659"></a>00659         }
<a name="l00660"></a>00660 
<a name="l00673"></a><a class="code" href="classnusoap__base.html#a8940fff9aa5bc728be4fee5c5d319d5e">00673</a>     function <a class="code" href="classnusoap__base.html#a8940fff9aa5bc728be4fee5c5d319d5e">serializeEnvelope</a>($body,$headers=<span class="keyword">false</span>,<a class="code" href="classnusoap__base.html#a5d0c5f71681b592cb9b05898508c0b27">$namespaces</a>=array(),$style=<span class="stringliteral">&#39;rpc&#39;</span>,$use=<span class="stringliteral">&#39;encoded&#39;</span>,$encodingStyle=<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>){
<a name="l00674"></a>00674     <span class="comment">// TODO: add an option to automatically run utf8_encode on $body and $headers</span>
<a name="l00675"></a>00675     <span class="comment">// if $this-&gt;soap_defencoding is UTF-8.  Not doing this automatically allows</span>
<a name="l00676"></a>00676     <span class="comment">// one to send arbitrary UTF-8 characters, not just characters that map to ISO-8859-1</span>
<a name="l00677"></a>00677 
<a name="l00678"></a>00678         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In serializeEnvelope length=&quot;</span> . strlen($body) . <span class="stringliteral">&quot; body (max 1000 characters)=&quot;</span> . substr($body, 0, 1000) . <span class="stringliteral">&quot; style=$style use=$use encodingStyle=$encodingStyle&quot;</span>);
<a name="l00679"></a>00679         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;headers:&quot;</span>);
<a name="l00680"></a>00680         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($headers));
<a name="l00681"></a>00681         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;namespaces:&quot;</span>);
<a name="l00682"></a>00682         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classnusoap__base.html#a5d0c5f71681b592cb9b05898508c0b27">$namespaces</a>));
<a name="l00683"></a>00683 
<a name="l00684"></a>00684         <span class="comment">// serialize namespaces</span>
<a name="l00685"></a>00685     $ns_string = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00686"></a>00686         <span class="keywordflow">foreach</span>(array_merge($this-&gt;namespaces,<a class="code" href="classnusoap__base.html#a5d0c5f71681b592cb9b05898508c0b27">$namespaces</a>) as $k =&gt; $v){
<a name="l00687"></a>00687                 $ns_string .= <span class="stringliteral">&quot; xmlns:$k=\&quot;$v\&quot;&quot;</span>;
<a name="l00688"></a>00688         }
<a name="l00689"></a>00689         <span class="keywordflow">if</span>($encodingStyle) {
<a name="l00690"></a>00690                 $ns_string = <span class="stringliteral">&quot; SOAP-ENV:encodingStyle=\&quot;$encodingStyle\&quot;$ns_string&quot;</span>;
<a name="l00691"></a>00691         }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693         <span class="comment">// serialize headers</span>
<a name="l00694"></a>00694         <span class="keywordflow">if</span>($headers){
<a name="l00695"></a>00695                 <span class="keywordflow">if</span> (is_array($headers)) {
<a name="l00696"></a>00696                         $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00697"></a>00697                         <span class="keywordflow">foreach</span> ($headers as $k =&gt; $v) {
<a name="l00698"></a>00698                                 <span class="keywordflow">if</span> (is_object($v) &amp;&amp; get_class($v) == <span class="stringliteral">&#39;soapval&#39;</span>) {
<a name="l00699"></a>00699                                         $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, $use);
<a name="l00700"></a>00700                                 } <span class="keywordflow">else</span> {
<a name="l00701"></a>00701                                         $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v, $k, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, $use);
<a name="l00702"></a>00702                                 }
<a name="l00703"></a>00703                         }
<a name="l00704"></a>00704                         $headers = $xml;
<a name="l00705"></a>00705                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In serializeEnvelope, serialized array of headers to $headers&quot;</span>);
<a name="l00706"></a>00706                 }
<a name="l00707"></a>00707                 $headers = <span class="stringliteral">&quot;&lt;SOAP-ENV:Header&gt;&quot;</span>.$headers.<span class="stringliteral">&quot;&lt;/SOAP-ENV:Header&gt;&quot;</span>;
<a name="l00708"></a>00708         }
<a name="l00709"></a>00709         <span class="comment">// serialize envelope</span>
<a name="l00710"></a>00710         <span class="keywordflow">return</span>
<a name="l00711"></a>00711         <span class="stringliteral">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;&#39;</span>.$this-&gt;soap_defencoding .<span class="stringliteral">&#39;&quot;?&#39;</span>.<span class="stringliteral">&quot;&gt;&quot;</span>.
<a name="l00712"></a>00712         <span class="stringliteral">&#39;&lt;SOAP-ENV:Envelope&#39;</span>.$ns_string.<span class="stringliteral">&quot;&gt;&quot;</span>.
<a name="l00713"></a>00713         $headers.
<a name="l00714"></a>00714         <span class="stringliteral">&quot;&lt;SOAP-ENV:Body&gt;&quot;</span>.
<a name="l00715"></a>00715                 $body.
<a name="l00716"></a>00716         <span class="stringliteral">&quot;&lt;/SOAP-ENV:Body&gt;&quot;</span>.
<a name="l00717"></a>00717         <span class="stringliteral">&quot;&lt;/SOAP-ENV:Envelope&gt;&quot;</span>;
<a name="l00718"></a>00718     }
<a name="l00719"></a>00719 
<a name="l00728"></a><a class="code" href="classnusoap__base.html#aa24aac949e13c048be010bd04e99968c">00728</a>     function <a class="code" href="classnusoap__base.html#aa24aac949e13c048be010bd04e99968c">formatDump</a>($str){
<a name="l00729"></a>00729                 $str = htmlspecialchars($str);
<a name="l00730"></a>00730                 <span class="keywordflow">return</span> nl2br($str);
<a name="l00731"></a>00731     }
<a name="l00732"></a>00732 
<a name="l00740"></a><a class="code" href="classnusoap__base.html#a25269fad36da0e8d23df0c865e0bd29e">00740</a>         function <a class="code" href="classnusoap__base.html#a25269fad36da0e8d23df0c865e0bd29e">contractQname</a>($qname){
<a name="l00741"></a>00741                 <span class="comment">// get element namespace</span>
<a name="l00742"></a>00742                 <span class="comment">//$this-&gt;xdebug(&quot;Contract $qname&quot;);</span>
<a name="l00743"></a>00743                 <span class="keywordflow">if</span> (strrpos($qname, <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l00744"></a>00744                         <span class="comment">// get unqualified name</span>
<a name="l00745"></a>00745                         $name = substr($qname, strrpos($qname, <span class="charliteral">&#39;:&#39;</span>) + 1);
<a name="l00746"></a>00746                         <span class="comment">// get ns</span>
<a name="l00747"></a>00747                         $ns = substr($qname, 0, strrpos($qname, <span class="charliteral">&#39;:&#39;</span>));
<a name="l00748"></a>00748                         $p = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns);
<a name="l00749"></a>00749                         <span class="keywordflow">if</span> ($p) {
<a name="l00750"></a>00750                                 <span class="keywordflow">return</span> $p . <span class="charliteral">&#39;:&#39;</span> . $name;
<a name="l00751"></a>00751                         }
<a name="l00752"></a>00752                         <span class="keywordflow">return</span> $qname;
<a name="l00753"></a>00753                 } <span class="keywordflow">else</span> {
<a name="l00754"></a>00754                         <span class="keywordflow">return</span> $qname;
<a name="l00755"></a>00755                 }
<a name="l00756"></a>00756         }
<a name="l00757"></a>00757 
<a name="l00765"></a><a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">00765</a>         function <a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($qname){
<a name="l00766"></a>00766                 <span class="comment">// get element prefix</span>
<a name="l00767"></a>00767                 <span class="keywordflow">if</span>(strpos($qname,<span class="charliteral">&#39;:&#39;</span>) &amp;&amp; !preg_match(<span class="stringliteral">&#39;/^http:\/\//&#39;</span>,$qname)){
<a name="l00768"></a>00768                         <span class="comment">// get unqualified name</span>
<a name="l00769"></a>00769                         $name = substr(strstr($qname,<span class="charliteral">&#39;:&#39;</span>),1);
<a name="l00770"></a>00770                         <span class="comment">// get ns prefix</span>
<a name="l00771"></a>00771                         $prefix = substr($qname,0,strpos($qname,<span class="charliteral">&#39;:&#39;</span>));
<a name="l00772"></a>00772                         <span class="keywordflow">if</span>(isset($this-&gt;namespaces[$prefix])){
<a name="l00773"></a>00773                                 <span class="keywordflow">return</span> $this-&gt;namespaces[$prefix].<span class="charliteral">&#39;:&#39;</span>.$name;
<a name="l00774"></a>00774                         } <span class="keywordflow">else</span> {
<a name="l00775"></a>00775                                 <span class="keywordflow">return</span> $qname;
<a name="l00776"></a>00776                         }
<a name="l00777"></a>00777                 } <span class="keywordflow">else</span> {
<a name="l00778"></a>00778                         <span class="keywordflow">return</span> $qname;
<a name="l00779"></a>00779                 }
<a name="l00780"></a>00780         }
<a name="l00781"></a>00781 
<a name="l00790"></a><a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">00790</a>         function <a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($str){
<a name="l00791"></a>00791                 <span class="keywordflow">if</span>($sstr = strrchr($str,<span class="charliteral">&#39;:&#39;</span>)){
<a name="l00792"></a>00792                         <span class="comment">// get unqualified name</span>
<a name="l00793"></a>00793                         <span class="keywordflow">return</span> substr( $sstr, 1 );
<a name="l00794"></a>00794                 } <span class="keywordflow">else</span> {
<a name="l00795"></a>00795                         <span class="keywordflow">return</span> $str;
<a name="l00796"></a>00796                 }
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798 
<a name="l00807"></a><a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">00807</a>         function <a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($str){
<a name="l00808"></a>00808                 <span class="keywordflow">if</span>($pos = strrpos($str,<span class="charliteral">&#39;:&#39;</span>)){
<a name="l00809"></a>00809                         <span class="comment">// get prefix</span>
<a name="l00810"></a>00810                         <span class="keywordflow">return</span> substr($str,0,$pos);
<a name="l00811"></a>00811                 }
<a name="l00812"></a>00812                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00813"></a>00813         }
<a name="l00814"></a>00814 
<a name="l00822"></a><a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">00822</a>         function <a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($prefix){
<a name="l00823"></a>00823                 <span class="keywordflow">if</span> (isset($this-&gt;namespaces[$prefix])) {
<a name="l00824"></a>00824                         <span class="keywordflow">return</span> $this-&gt;namespaces[$prefix];
<a name="l00825"></a>00825                 }
<a name="l00826"></a>00826                 <span class="comment">//$this-&gt;setError(&quot;No namespace registered for prefix &#39;$prefix&#39;&quot;);</span>
<a name="l00827"></a>00827                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829 
<a name="l00838"></a><a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">00838</a>         function <a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) {
<a name="l00839"></a>00839                 <span class="keywordflow">foreach</span> ($this-&gt;namespaces as $p =&gt; $n) {
<a name="l00840"></a>00840                         <span class="keywordflow">if</span> ($ns == $n || $ns == $p) {
<a name="l00841"></a>00841                             $this-&gt;usedNamespaces[$p] = $n;
<a name="l00842"></a>00842                                 <span class="keywordflow">return</span> $p;
<a name="l00843"></a>00843                         }
<a name="l00844"></a>00844                 }
<a name="l00845"></a>00845                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00846"></a>00846         }
<a name="l00847"></a>00847 
<a name="l00854"></a><a class="code" href="classnusoap__base.html#a1945b0481c5128c4126352f457a4c36a">00854</a>         function <a class="code" href="classnusoap__base.html#a1945b0481c5128c4126352f457a4c36a">getmicrotime</a>() {
<a name="l00855"></a>00855                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;gettimeofday&#39;</span>)) {
<a name="l00856"></a>00856                         $tod = gettimeofday();
<a name="l00857"></a>00857                         $sec = $tod[<span class="stringliteral">&#39;sec&#39;</span>];
<a name="l00858"></a>00858                         $usec = $tod[<span class="stringliteral">&#39;usec&#39;</span>];
<a name="l00859"></a>00859                 } <span class="keywordflow">else</span> {
<a name="l00860"></a>00860                         $sec = time();
<a name="l00861"></a>00861                         $usec = 0;
<a name="l00862"></a>00862                 }
<a name="l00863"></a>00863                 <span class="keywordflow">return</span> strftime(<span class="stringliteral">&#39;%Y-%m-%d %H:%M:%S&#39;</span>, $sec) . <span class="charliteral">&#39;.&#39;</span> . sprintf(<span class="stringliteral">&#39;%06d&#39;</span>, $usec);
<a name="l00864"></a>00864         }
<a name="l00865"></a>00865 
<a name="l00873"></a><a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">00873</a>     function <a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($data) {
<a name="l00874"></a>00874                 ob_start();
<a name="l00875"></a>00875                 var_dump($data);
<a name="l00876"></a>00876                 $ret_val = ob_get_contents();
<a name="l00877"></a>00877                 ob_end_clean();
<a name="l00878"></a>00878                 <span class="keywordflow">return</span> $ret_val;
<a name="l00879"></a>00879         }
<a name="l00880"></a>00880 
<a name="l00887"></a><a class="code" href="classnusoap__base.html#ac17fe327109103b6acd5fd5a66f8a016">00887</a>         function <a class="code" href="classnusoap__base.html#ac17fe327109103b6acd5fd5a66f8a016">__toString</a>() {
<a name="l00888"></a>00888                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this);
<a name="l00889"></a>00889         }
<a name="l00890"></a>00890 }
<a name="l00891"></a>00891 
<a name="l00892"></a>00892 <span class="comment">// XML Schema Datatype Helper Functions</span>
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="comment">//xsd:dateTime helpers</span>
<a name="l00895"></a>00895 
<a name="l00904"></a><a class="code" href="soap__server_2nusoap_2lib_2nusoap_8php.html#ae9aac88f9bf83be961dd47d1b78b90d3">00904</a> function <a class="code" href="dae__wsdl_2lib_2class_8nusoap__base_8php.html#ae9aac88f9bf83be961dd47d1b78b90d3">timestamp_to_iso8601</a>($timestamp,$utc=<span class="keyword">true</span>){
<a name="l00905"></a>00905         $datestr = date(<span class="stringliteral">&#39;Y-m-d\TH:i:sO&#39;</span>,$timestamp);
<a name="l00906"></a>00906         $pos = strrpos($datestr, <span class="stringliteral">&quot;+&quot;</span>);
<a name="l00907"></a>00907         <span class="keywordflow">if</span> ($pos === FALSE) {
<a name="l00908"></a>00908                 $pos = strrpos($datestr, <span class="stringliteral">&quot;-&quot;</span>);
<a name="l00909"></a>00909         }
<a name="l00910"></a>00910         <span class="keywordflow">if</span> ($pos !== FALSE) {
<a name="l00911"></a>00911                 <span class="keywordflow">if</span> (strlen($datestr) == $pos + 5) {
<a name="l00912"></a>00912                         $datestr = substr($datestr, 0, $pos + 3) . <span class="charliteral">&#39;:&#39;</span> . substr($datestr, -2);
<a name="l00913"></a>00913                 }
<a name="l00914"></a>00914         }
<a name="l00915"></a>00915         <span class="keywordflow">if</span>($utc){
<a name="l00916"></a>00916                 $pattern = <span class="charliteral">&#39;/&#39;</span>.
<a name="l00917"></a>00917                 <span class="stringliteral">&#39;([0-9]{4})-&#39;</span>.  <span class="comment">// centuries &amp; years CCYY-</span>
<a name="l00918"></a>00918                 <span class="stringliteral">&#39;([0-9]{2})-&#39;</span>.  <span class="comment">// months MM-</span>
<a name="l00919"></a>00919                 <span class="stringliteral">&#39;([0-9]{2})&#39;</span>.   <span class="comment">// days DD</span>
<a name="l00920"></a>00920                 <span class="charliteral">&#39;T&#39;</span>.                    <span class="comment">// separator T</span>
<a name="l00921"></a>00921                 <span class="stringliteral">&#39;([0-9]{2}):&#39;</span>.  <span class="comment">// hours hh:</span>
<a name="l00922"></a>00922                 <span class="stringliteral">&#39;([0-9]{2}):&#39;</span>.  <span class="comment">// minutes mm:</span>
<a name="l00923"></a>00923                 <span class="stringliteral">&#39;([0-9]{2})(\.[0-9]*)?&#39;</span>. <span class="comment">// seconds ss.ss...</span>
<a name="l00924"></a>00924                 <span class="stringliteral">&#39;(Z|[+\-][0-9]{2}:?[0-9]{2})?&#39;</span>. <span class="comment">// Z to indicate UTC, -/+HH:MM:SS.SS... for local tz&#39;s</span>
<a name="l00925"></a>00925                 <span class="charliteral">&#39;/&#39;</span>;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927                 <span class="keywordflow">if</span>(preg_match($pattern,$datestr,$regs)){
<a name="l00928"></a>00928                         <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&#39;%04d-%02d-%02dT%02d:%02d:%02dZ&#39;</span>,$regs[1],$regs[2],$regs[3],$regs[4],$regs[5],$regs[6]);
<a name="l00929"></a>00929                 }
<a name="l00930"></a>00930                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00931"></a>00931         } <span class="keywordflow">else</span> {
<a name="l00932"></a>00932                 <span class="keywordflow">return</span> $datestr;
<a name="l00933"></a>00933         }
<a name="l00934"></a>00934 }
<a name="l00935"></a>00935 
<a name="l00943"></a><a class="code" href="soap__server_2nusoap_2lib_2nusoap_8php.html#a7458f4fe2e94892e63804807994fb5b9">00943</a> function <a class="code" href="dae__wsdl_2lib_2class_8nusoap__base_8php.html#a7458f4fe2e94892e63804807994fb5b9">iso8601_to_timestamp</a>($datestr){
<a name="l00944"></a>00944         $pattern = <span class="charliteral">&#39;/&#39;</span>.
<a name="l00945"></a>00945         <span class="stringliteral">&#39;([0-9]{4})-&#39;</span>.  <span class="comment">// centuries &amp; years CCYY-</span>
<a name="l00946"></a>00946         <span class="stringliteral">&#39;([0-9]{2})-&#39;</span>.  <span class="comment">// months MM-</span>
<a name="l00947"></a>00947         <span class="stringliteral">&#39;([0-9]{2})&#39;</span>.   <span class="comment">// days DD</span>
<a name="l00948"></a>00948         <span class="charliteral">&#39;T&#39;</span>.                    <span class="comment">// separator T</span>
<a name="l00949"></a>00949         <span class="stringliteral">&#39;([0-9]{2}):&#39;</span>.  <span class="comment">// hours hh:</span>
<a name="l00950"></a>00950         <span class="stringliteral">&#39;([0-9]{2}):&#39;</span>.  <span class="comment">// minutes mm:</span>
<a name="l00951"></a>00951         <span class="stringliteral">&#39;([0-9]{2})(\.[0-9]+)?&#39;</span>. <span class="comment">// seconds ss.ss...</span>
<a name="l00952"></a>00952         <span class="stringliteral">&#39;(Z|[+\-][0-9]{2}:?[0-9]{2})?&#39;</span>. <span class="comment">// Z to indicate UTC, -/+HH:MM:SS.SS... for local tz&#39;s</span>
<a name="l00953"></a>00953         <span class="charliteral">&#39;/&#39;</span>;
<a name="l00954"></a>00954         <span class="keywordflow">if</span>(preg_match($pattern,$datestr,$regs)){
<a name="l00955"></a>00955                 <span class="comment">// not utc</span>
<a name="l00956"></a>00956                 <span class="keywordflow">if</span>($regs[8] != <span class="charliteral">&#39;Z&#39;</span>){
<a name="l00957"></a>00957                         $op = substr($regs[8],0,1);
<a name="l00958"></a>00958                         $h = substr($regs[8],1,2);
<a name="l00959"></a>00959                         $m = substr($regs[8],strlen($regs[8])-2,2);
<a name="l00960"></a>00960                         <span class="keywordflow">if</span>($op == <span class="charliteral">&#39;-&#39;</span>){
<a name="l00961"></a>00961                                 $regs[4] = $regs[4] + $h;
<a name="l00962"></a>00962                                 $regs[5] = $regs[5] + $m;
<a name="l00963"></a>00963                         } elseif($op == <span class="charliteral">&#39;+&#39;</span>){
<a name="l00964"></a>00964                                 $regs[4] = $regs[4] - $h;
<a name="l00965"></a>00965                                 $regs[5] = $regs[5] - $m;
<a name="l00966"></a>00966                         }
<a name="l00967"></a>00967                 }
<a name="l00968"></a>00968                 <span class="keywordflow">return</span> gmmktime($regs[4], $regs[5], $regs[6], $regs[2], $regs[3], $regs[1]);
<a name="l00969"></a>00969 <span class="comment">//              return strtotime(&quot;$regs[1]-$regs[2]-$regs[3] $regs[4]:$regs[5]:$regs[6]Z&quot;);</span>
<a name="l00970"></a>00970         } <span class="keywordflow">else</span> {
<a name="l00971"></a>00971                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00972"></a>00972         }
<a name="l00973"></a>00973 }
<a name="l00974"></a>00974 
<a name="l00982"></a><a class="code" href="soap__server_2nusoap_2lib_2nusoap_8php.html#a0405bf74776f57039c31a3f01fd48a29">00982</a> function <a class="code" href="dae__wsdl_2lib_2class_8nusoap__base_8php.html#a0405bf74776f57039c31a3f01fd48a29">usleepWindows</a>($usec)
<a name="l00983"></a>00983 {
<a name="l00984"></a>00984         $start = gettimeofday();
<a name="l00985"></a>00985         
<a name="l00986"></a>00986         <span class="keywordflow">do</span>
<a name="l00987"></a>00987         {
<a name="l00988"></a>00988                 $stop = gettimeofday();
<a name="l00989"></a>00989                 $timePassed = 1000000 * ($stop[<span class="stringliteral">&#39;sec&#39;</span>] - $start[<span class="stringliteral">&#39;sec&#39;</span>])
<a name="l00990"></a>00990                 + $stop[<span class="stringliteral">&#39;usec&#39;</span>] - $start[<span class="stringliteral">&#39;usec&#39;</span>];
<a name="l00991"></a>00991         }
<a name="l00992"></a>00992         <span class="keywordflow">while</span> ($timePassed &lt; $usec);
<a name="l00993"></a>00993 }
<a name="l00994"></a>00994 
<a name="l00995"></a>00995 ?&gt;&lt;?php
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 
<a name="l00998"></a>00998 
<a name="l01007"></a>01007 <span class="keyword">class </span><a class="code" href="classnusoap__fault.html">nusoap_fault</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__base.html">nusoap_base</a> {
<a name="l01013"></a>01013         var <a class="code" href="classnusoap__fault.html#a983c10a5e6d8d3893896f62767413f92">$faultcode</a>;
<a name="l01019"></a>01019         var <a class="code" href="classnusoap__fault.html#a657121b953bc7cfb3369cea058a8f64b">$faultactor</a>;
<a name="l01025"></a>01025         var <a class="code" href="classnusoap__fault.html#a2436468f7e7f17cc9ef5d424f7cb88fb">$faultstring</a>;
<a name="l01031"></a>01031         var <a class="code" href="classnusoap__fault.html#a0e02683e7add14d2b06337bc94504777">$faultdetail</a>;
<a name="l01032"></a>01032 
<a name="l01041"></a><a class="code" href="classnusoap__fault.html#a3e93b8e71c3f76beb91f9231066f45b7">01041</a>         function <a class="code" href="classnusoap__fault.html#a3e93b8e71c3f76beb91f9231066f45b7">nusoap_fault</a>(<a class="code" href="classnusoap__fault.html#a983c10a5e6d8d3893896f62767413f92">$faultcode</a>,<a class="code" href="classnusoap__fault.html#a657121b953bc7cfb3369cea058a8f64b">$faultactor</a>=<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="classnusoap__fault.html#a2436468f7e7f17cc9ef5d424f7cb88fb">$faultstring</a>=<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="classnusoap__fault.html#a0e02683e7add14d2b06337bc94504777">$faultdetail</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l01042"></a>01042                 <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">parent::nusoap_base</a>();
<a name="l01043"></a>01043                 $this-&gt;faultcode = <a class="code" href="classnusoap__fault.html#a983c10a5e6d8d3893896f62767413f92">$faultcode</a>;
<a name="l01044"></a>01044                 $this-&gt;faultactor = <a class="code" href="classnusoap__fault.html#a657121b953bc7cfb3369cea058a8f64b">$faultactor</a>;
<a name="l01045"></a>01045                 $this-&gt;faultstring = <a class="code" href="classnusoap__fault.html#a2436468f7e7f17cc9ef5d424f7cb88fb">$faultstring</a>;
<a name="l01046"></a>01046                 $this-&gt;faultdetail = <a class="code" href="classnusoap__fault.html#a0e02683e7add14d2b06337bc94504777">$faultdetail</a>;
<a name="l01047"></a>01047         }
<a name="l01048"></a>01048 
<a name="l01055"></a><a class="code" href="classnusoap__fault.html#a0195b7a8f055d27609d2b41ff4bba724">01055</a>         function <a class="code" href="classnusoap__fault.html#a0195b7a8f055d27609d2b41ff4bba724">serialize</a>(){
<a name="l01056"></a>01056                 $ns_string = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01057"></a>01057                 <span class="keywordflow">foreach</span>($this-&gt;namespaces as $k =&gt; $v){
<a name="l01058"></a>01058                         $ns_string .= <span class="stringliteral">&quot;\n  xmlns:$k=\&quot;$v\&quot;&quot;</span>;
<a name="l01059"></a>01059                 }
<a name="l01060"></a>01060                 $return_msg =
<a name="l01061"></a>01061                         <span class="stringliteral">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;&#39;</span>.$this-&gt;soap_defencoding.<span class="stringliteral">&#39;&quot;?&gt;&#39;</span>.
<a name="l01062"></a>01062                         <span class="stringliteral">&#39;&lt;SOAP-ENV:Envelope SOAP-ENV:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&#39;</span>.$ns_string.<span class="stringliteral">&quot;&gt;\n&quot;</span>.
<a name="l01063"></a>01063                                 <span class="stringliteral">&#39;&lt;SOAP-ENV:Body&gt;&#39;</span>.
<a name="l01064"></a>01064                                 <span class="stringliteral">&#39;&lt;SOAP-ENV:Fault&gt;&#39;</span>.
<a name="l01065"></a>01065                                         $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($this-&gt;faultcode, <span class="stringliteral">&#39;faultcode&#39;</span>).
<a name="l01066"></a>01066                                         $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($this-&gt;faultactor, <span class="stringliteral">&#39;faultactor&#39;</span>).
<a name="l01067"></a>01067                                         $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($this-&gt;faultstring, <span class="stringliteral">&#39;faultstring&#39;</span>).
<a name="l01068"></a>01068                                         $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($this-&gt;faultdetail, <span class="stringliteral">&#39;detail&#39;</span>).
<a name="l01069"></a>01069                                 <span class="stringliteral">&#39;&lt;/SOAP-ENV:Fault&gt;&#39;</span>.
<a name="l01070"></a>01070                                 <span class="stringliteral">&#39;&lt;/SOAP-ENV:Body&gt;&#39;</span>.
<a name="l01071"></a>01071                         <span class="stringliteral">&#39;&lt;/SOAP-ENV:Envelope&gt;&#39;</span>;
<a name="l01072"></a>01072                 <span class="keywordflow">return</span> $return_msg;
<a name="l01073"></a>01073         }
<a name="l01074"></a>01074 }
<a name="l01075"></a>01075 
<a name="l01079"></a>01079 <span class="keyword">class </span><a class="code" href="classsoap__fault.html">soap_fault</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__fault.html">nusoap_fault</a> {
<a name="l01080"></a>01080 }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082 ?&gt;&lt;?php
<a name="l01083"></a>01083 
<a name="l01084"></a>01084 
<a name="l01085"></a>01085 
<a name="l01095"></a>01095 <span class="keyword">class </span><a class="code" href="classnusoap__xmlschema.html">nusoap_xmlschema</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__base.html">nusoap_base</a>  {
<a name="l01096"></a>01096         
<a name="l01097"></a>01097         <span class="comment">// files</span>
<a name="l01098"></a>01098         var <a class="code" href="classnusoap__xmlschema.html#ae54a8aefed88999095c69d476b45bf26">$schema</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01099"></a>01099         var <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01100"></a>01100         <span class="comment">// namespaces</span>
<a name="l01101"></a>01101         var <a class="code" href="classnusoap__xmlschema.html#a106cc644926c0b373f378b979296fef8">$enclosingNamespaces</a>;
<a name="l01102"></a>01102         <span class="comment">// schema info</span>
<a name="l01103"></a>01103         var <a class="code" href="classnusoap__xmlschema.html#ab235ab587f816316a56af001a43b9a21">$schemaInfo</a> = array();
<a name="l01104"></a>01104         var <a class="code" href="classnusoap__xmlschema.html#ac158d72bebfc9076d8f6a19aa042ba22">$schemaTargetNamespace</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01105"></a>01105         <span class="comment">// types, elements, attributes defined by the schema</span>
<a name="l01106"></a>01106         var <a class="code" href="classnusoap__xmlschema.html#ae0e33d3ca60649fc2aeece77b2a3e32c">$attributes</a> = array();
<a name="l01107"></a>01107         var <a class="code" href="classnusoap__xmlschema.html#a895407f70801f7e89cfff8f0327183b1">$complexTypes</a> = array();
<a name="l01108"></a>01108         var <a class="code" href="classnusoap__xmlschema.html#adbcb07f4139ac3547fd3392590af48cc">$complexTypeStack</a> = array();
<a name="l01109"></a>01109         var <a class="code" href="classnusoap__xmlschema.html#a8a7218e5665df6ce382b94096fde9e94">$currentComplexType</a> = null;
<a name="l01110"></a>01110         var <a class="code" href="classnusoap__xmlschema.html#ad551bb12a51da38e7e3d9ea79aed7d52">$elements</a> = array();
<a name="l01111"></a>01111         var <a class="code" href="classnusoap__xmlschema.html#a845bc40a652483b5224d22d68a7f2366">$elementStack</a> = array();
<a name="l01112"></a>01112         var <a class="code" href="classnusoap__xmlschema.html#a751c16b5c4141c30fc49c69f94e66fa4">$currentElement</a> = null;
<a name="l01113"></a>01113         var <a class="code" href="classnusoap__xmlschema.html#a79fe1f9c5bd9589de80b2d111cadd15f">$simpleTypes</a> = array();
<a name="l01114"></a>01114         var <a class="code" href="classnusoap__xmlschema.html#ac5837e32e92351b7b71d971174f7d629">$simpleTypeStack</a> = array();
<a name="l01115"></a>01115         var <a class="code" href="classnusoap__xmlschema.html#add2e52eabe728d612f3ea8f6e199e79e">$currentSimpleType</a> = null;
<a name="l01116"></a>01116         <span class="comment">// imports</span>
<a name="l01117"></a>01117         var <a class="code" href="classnusoap__xmlschema.html#a717117082e85ee65b0a8fc338f625505">$imports</a> = array();
<a name="l01118"></a>01118         <span class="comment">// parser vars</span>
<a name="l01119"></a>01119         var <a class="code" href="classnusoap__xmlschema.html#a5a923375f50a90ab2397e8b824c9c1e0">$parser</a>;
<a name="l01120"></a>01120         var <a class="code" href="classnusoap__xmlschema.html#a673f32c3eab194d12a930d0193452c4f">$position</a> = 0;
<a name="l01121"></a>01121         var <a class="code" href="classnusoap__xmlschema.html#a929ac5f08947b4adb10e781b8b6f1b78">$depth</a> = 0;
<a name="l01122"></a>01122         var <a class="code" href="classnusoap__xmlschema.html#a9fa54d04dd62bfa44b8172bb51c9b6d7">$depth_array</a> = array();
<a name="l01123"></a>01123         var <a class="code" href="classnusoap__xmlschema.html#ae5f17cc76bf8e3b35bc88fd857144073">$message</a> = array();
<a name="l01124"></a>01124         var <a class="code" href="classnusoap__xmlschema.html#a767621e14efbc2ccae969016a78722cf">$defaultNamespace</a> = array();
<a name="l01125"></a>01125     
<a name="l01134"></a><a class="code" href="classnusoap__xmlschema.html#ad6afbfc67e1bc10e0fb0f705b0faaf8e">01134</a>         function <a class="code" href="classnusoap__xmlschema.html#ad6afbfc67e1bc10e0fb0f705b0faaf8e">nusoap_xmlschema</a>(<a class="code" href="classnusoap__xmlschema.html#ae54a8aefed88999095c69d476b45bf26">$schema</a>=<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>=<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="classnusoap__base.html#a5d0c5f71681b592cb9b05898508c0b27">$namespaces</a>=array()){
<a name="l01135"></a>01135                 <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">parent::nusoap_base</a>();
<a name="l01136"></a>01136                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;nusoap_xmlschema class instantiated, inside constructor&#39;</span>);
<a name="l01137"></a>01137                 <span class="comment">// files</span>
<a name="l01138"></a>01138                 $this-&gt;schema = <a class="code" href="classnusoap__xmlschema.html#ae54a8aefed88999095c69d476b45bf26">$schema</a>;
<a name="l01139"></a>01139                 $this-&gt;xml = <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>;
<a name="l01140"></a>01140 
<a name="l01141"></a>01141                 <span class="comment">// namespaces</span>
<a name="l01142"></a>01142                 $this-&gt;enclosingNamespaces = <a class="code" href="classnusoap__base.html#a5d0c5f71681b592cb9b05898508c0b27">$namespaces</a>;
<a name="l01143"></a>01143                 $this-&gt;namespaces = array_merge($this-&gt;namespaces, <a class="code" href="classnusoap__base.html#a5d0c5f71681b592cb9b05898508c0b27">$namespaces</a>);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145                 <span class="comment">// parse schema file</span>
<a name="l01146"></a>01146                 <span class="keywordflow">if</span>(<a class="code" href="classnusoap__xmlschema.html#ae54a8aefed88999095c69d476b45bf26">$schema</a> != <span class="stringliteral">&#39;&#39;</span>){
<a name="l01147"></a>01147                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;initial schema file: &#39;</span>.<a class="code" href="classnusoap__xmlschema.html#ae54a8aefed88999095c69d476b45bf26">$schema</a>);
<a name="l01148"></a>01148                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#af2dc715dcf66c9f67d09018f31a20a50">parseFile</a>(<a class="code" href="classnusoap__xmlschema.html#ae54a8aefed88999095c69d476b45bf26">$schema</a>, <span class="stringliteral">&#39;schema&#39;</span>);
<a name="l01149"></a>01149                 }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151                 <span class="comment">// parse xml file</span>
<a name="l01152"></a>01152                 <span class="keywordflow">if</span>(<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> != <span class="stringliteral">&#39;&#39;</span>){
<a name="l01153"></a>01153                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;initial xml file: &#39;</span>.<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>);
<a name="l01154"></a>01154                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#af2dc715dcf66c9f67d09018f31a20a50">parseFile</a>(<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>, <span class="stringliteral">&#39;xml&#39;</span>);
<a name="l01155"></a>01155                 }
<a name="l01156"></a>01156 
<a name="l01157"></a>01157         }
<a name="l01158"></a>01158 
<a name="l01167"></a><a class="code" href="classnusoap__xmlschema.html#af2dc715dcf66c9f67d09018f31a20a50">01167</a>         function <a class="code" href="classnusoap__xmlschema.html#af2dc715dcf66c9f67d09018f31a20a50">parseFile</a>(<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>,$type){
<a name="l01168"></a>01168                 <span class="comment">// parse xml file</span>
<a name="l01169"></a>01169                 <span class="keywordflow">if</span>(<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> != <span class="stringliteral">&quot;&quot;</span>){
<a name="l01170"></a>01170                         $xmlStr = @join(<span class="stringliteral">&quot;&quot;</span>,@file(<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>));
<a name="l01171"></a>01171                         <span class="keywordflow">if</span>($xmlStr == <span class="stringliteral">&quot;&quot;</span>){
<a name="l01172"></a>01172                                 $msg = <span class="stringliteral">&#39;Error reading XML from &#39;</span>.$xml;
<a name="l01173"></a>01173                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($msg);
<a name="l01174"></a>01174                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($msg);
<a name="l01175"></a>01175                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01176"></a>01176                         } <span class="keywordflow">else</span> {
<a name="l01177"></a>01177                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;parsing $xml&quot;</span>);
<a name="l01178"></a>01178                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#abc875c10a8ab0da66c882b70b21add75">parseString</a>($xmlStr,$type);
<a name="l01179"></a>01179                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;done parsing $xml&quot;</span>);
<a name="l01180"></a>01180                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01181"></a>01181                         }
<a name="l01182"></a>01182                 }
<a name="l01183"></a>01183                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01184"></a>01184         }
<a name="l01185"></a>01185 
<a name="l01193"></a><a class="code" href="classnusoap__xmlschema.html#abc875c10a8ab0da66c882b70b21add75">01193</a>         function <a class="code" href="classnusoap__xmlschema.html#abc875c10a8ab0da66c882b70b21add75">parseString</a>(<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>,$type){
<a name="l01194"></a>01194                 <span class="comment">// parse xml string</span>
<a name="l01195"></a>01195                 <span class="keywordflow">if</span>(<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> != <span class="stringliteral">&quot;&quot;</span>){
<a name="l01196"></a>01196 
<a name="l01197"></a>01197                 <span class="comment">// Create an XML parser.</span>
<a name="l01198"></a>01198                 $this-&gt;parser = xml_parser_create();
<a name="l01199"></a>01199                 <span class="comment">// Set the options for parsing the XML data.</span>
<a name="l01200"></a>01200                 xml_parser_set_option($this-&gt;parser, XML_OPTION_CASE_FOLDING, 0);
<a name="l01201"></a>01201 
<a name="l01202"></a>01202                 <span class="comment">// Set the object for the parser.</span>
<a name="l01203"></a>01203                 xml_set_object($this-&gt;parser, $this);
<a name="l01204"></a>01204 
<a name="l01205"></a>01205                 <span class="comment">// Set the element handlers for the parser.</span>
<a name="l01206"></a>01206                         <span class="keywordflow">if</span>($type == <span class="stringliteral">&quot;schema&quot;</span>){
<a name="l01207"></a>01207                         xml_set_element_handler($this-&gt;parser, <span class="stringliteral">&#39;schemaStartElement&#39;</span>,<span class="stringliteral">&#39;schemaEndElement&#39;</span>);
<a name="l01208"></a>01208                         xml_set_character_data_handler($this-&gt;parser,<span class="stringliteral">&#39;schemaCharacterData&#39;</span>);
<a name="l01209"></a>01209                         } elseif($type == <span class="stringliteral">&quot;xml&quot;</span>){
<a name="l01210"></a>01210                                 xml_set_element_handler($this-&gt;parser, <span class="stringliteral">&#39;xmlStartElement&#39;</span>,<span class="stringliteral">&#39;xmlEndElement&#39;</span>);
<a name="l01211"></a>01211                         xml_set_character_data_handler($this-&gt;parser,<span class="stringliteral">&#39;xmlCharacterData&#39;</span>);
<a name="l01212"></a>01212                         }
<a name="l01213"></a>01213 
<a name="l01214"></a>01214                     <span class="comment">// Parse the XML file.</span>
<a name="l01215"></a>01215                     <span class="keywordflow">if</span>(!xml_parse($this-&gt;parser,<a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>,<span class="keyword">true</span>)){
<a name="l01216"></a>01216                         <span class="comment">// Display an error message.</span>
<a name="l01217"></a>01217                                 $errstr = sprintf(<span class="stringliteral">&#39;XML error parsing XML schema on line %d: %s&#39;</span>,
<a name="l01218"></a>01218                                 xml_get_current_line_number($this-&gt;parser),
<a name="l01219"></a>01219                                 xml_error_string(xml_get_error_code($this-&gt;parser))
<a name="l01220"></a>01220                                 );
<a name="l01221"></a>01221                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($errstr);
<a name="l01222"></a>01222                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;XML payload:\n&quot;</span> . <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>);
<a name="l01223"></a>01223                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($errstr);
<a name="l01224"></a>01224                 }
<a name="l01225"></a>01225             
<a name="l01226"></a>01226                         xml_parser_free($this-&gt;parser);
<a name="l01227"></a>01227                 } <span class="keywordflow">else</span>{
<a name="l01228"></a>01228                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no xml passed to parseString()!!&#39;</span>);
<a name="l01229"></a>01229                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;no xml passed to parseString()!!&#39;</span>);
<a name="l01230"></a>01230                 }
<a name="l01231"></a>01231         }
<a name="l01232"></a>01232 
<a name="l01240"></a><a class="code" href="classnusoap__xmlschema.html#af81e69a74736c389b59e8e59f033c9e9">01240</a>         function <a class="code" href="classnusoap__xmlschema.html#af81e69a74736c389b59e8e59f033c9e9">CreateTypeName</a>($ename) {
<a name="l01241"></a>01241                 $scope = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01242"></a>01242                 <span class="keywordflow">for</span> (<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0; <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt; count($this-&gt;complexTypeStack); <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {
<a name="l01243"></a>01243                         $scope .= $this-&gt;complexTypeStack[<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] . <span class="charliteral">&#39;_&#39;</span>;
<a name="l01244"></a>01244                 }
<a name="l01245"></a>01245                 <span class="keywordflow">return</span> $scope . $ename . <span class="stringliteral">&#39;_ContainedType&#39;</span>;
<a name="l01246"></a>01246         }
<a name="l01247"></a>01247         
<a name="l01256"></a><a class="code" href="classnusoap__xmlschema.html#adcdb0975582b814d3da83856144a0241">01256</a>         function <a class="code" href="classnusoap__xmlschema.html#adcdb0975582b814d3da83856144a0241">schemaStartElement</a>(<a class="code" href="classnusoap__xmlschema.html#a5a923375f50a90ab2397e8b824c9c1e0">$parser</a>, $name, $attrs) {
<a name="l01257"></a>01257                 
<a name="l01258"></a>01258                 <span class="comment">// position in the total number of elements, starting from 0</span>
<a name="l01259"></a>01259                 $pos = $this-&gt;position++;
<a name="l01260"></a>01260                 <a class="code" href="classnusoap__xmlschema.html#a929ac5f08947b4adb10e781b8b6f1b78">$depth</a> = $this-&gt;depth++;
<a name="l01261"></a>01261                 <span class="comment">// set self as current value for this depth</span>
<a name="l01262"></a>01262                 $this-&gt;depth_array[<a class="code" href="classnusoap__xmlschema.html#a929ac5f08947b4adb10e781b8b6f1b78">$depth</a>] = $pos;
<a name="l01263"></a>01263                 $this-&gt;message[$pos] = array(<span class="stringliteral">&#39;cdata&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>); 
<a name="l01264"></a>01264                 <span class="keywordflow">if</span> (<a class="code" href="classnusoap__xmlschema.html#a929ac5f08947b4adb10e781b8b6f1b78">$depth</a> &gt; 0) {
<a name="l01265"></a>01265                         $this-&gt;defaultNamespace[$pos] = $this-&gt;defaultNamespace[$this-&gt;depth_array[<a class="code" href="classnusoap__xmlschema.html#a929ac5f08947b4adb10e781b8b6f1b78">$depth</a> - 1]];
<a name="l01266"></a>01266                 } <span class="keywordflow">else</span> {
<a name="l01267"></a>01267                         $this-&gt;defaultNamespace[$pos] = <span class="keyword">false</span>;
<a name="l01268"></a>01268                 }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270                 <span class="comment">// get element prefix</span>
<a name="l01271"></a>01271                 <span class="keywordflow">if</span>($prefix = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($name)){
<a name="l01272"></a>01272                         <span class="comment">// get unqualified name</span>
<a name="l01273"></a>01273                         $name = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($name);
<a name="l01274"></a>01274                 } <span class="keywordflow">else</span> {
<a name="l01275"></a>01275                 $prefix = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01276"></a>01276         }
<a name="l01277"></a>01277                 
<a name="l01278"></a>01278         <span class="comment">// loop thru attributes, expanding, and registering namespace declarations</span>
<a name="l01279"></a>01279         <span class="keywordflow">if</span>(count($attrs) &gt; 0){
<a name="l01280"></a>01280                 <span class="keywordflow">foreach</span>($attrs as $k =&gt; $v){
<a name="l01281"></a>01281                 <span class="comment">// if ns declarations, add to class level array of valid namespaces</span>
<a name="l01282"></a>01282                                 <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/^xmlns/&#39;</span>,$k)){
<a name="l01283"></a>01283                         <span class="comment">//$this-&gt;xdebug(&quot;$k: $v&quot;);</span>
<a name="l01284"></a>01284                         <span class="comment">//$this-&gt;xdebug(&#39;ns_prefix: &#39;.$this-&gt;getPrefix($k));</span>
<a name="l01285"></a>01285                         <span class="keywordflow">if</span>($ns_prefix = substr(strrchr($k,<span class="charliteral">&#39;:&#39;</span>),1)){
<a name="l01286"></a>01286                                 <span class="comment">//$this-&gt;xdebug(&quot;Add namespace[$ns_prefix] = $v&quot;);</span>
<a name="l01287"></a>01287                                                 $this-&gt;namespaces[$ns_prefix] = $v;
<a name="l01288"></a>01288                                         } <span class="keywordflow">else</span> {
<a name="l01289"></a>01289                                                 $this-&gt;defaultNamespace[$pos] = $v;
<a name="l01290"></a>01290                                                 <span class="keywordflow">if</span> (! $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($v)) {
<a name="l01291"></a>01291                                                         $this-&gt;namespaces[<span class="stringliteral">&#39;ns&#39;</span>.(count($this-&gt;namespaces)+1)] = $v;
<a name="l01292"></a>01292                                                 }
<a name="l01293"></a>01293                                         }
<a name="l01294"></a>01294                                         <span class="keywordflow">if</span>($v == <span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span> || $v == <span class="stringliteral">&#39;http://www.w3.org/1999/XMLSchema&#39;</span> || $v == <span class="stringliteral">&#39;http://www.w3.org/2000/10/XMLSchema&#39;</span>){
<a name="l01295"></a>01295                                                 $this-&gt;XMLSchemaVersion = $v;
<a name="l01296"></a>01296                                                 $this-&gt;namespaces[<span class="stringliteral">&#39;xsi&#39;</span>] = $v.<span class="stringliteral">&#39;-instance&#39;</span>;
<a name="l01297"></a>01297                                         }
<a name="l01298"></a>01298                                 }
<a name="l01299"></a>01299                 }
<a name="l01300"></a>01300                 <span class="keywordflow">foreach</span>($attrs as $k =&gt; $v){
<a name="l01301"></a>01301                 <span class="comment">// expand each attribute</span>
<a name="l01302"></a>01302                 $k = strpos($k,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($k) : $k;
<a name="l01303"></a>01303                 $v = strpos($v,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($v) : $v;
<a name="l01304"></a>01304                         $eAttrs[$k] = $v;
<a name="l01305"></a>01305                 }
<a name="l01306"></a>01306                 $attrs = $eAttrs;
<a name="l01307"></a>01307         } <span class="keywordflow">else</span> {
<a name="l01308"></a>01308                 $attrs = array();
<a name="l01309"></a>01309         }
<a name="l01310"></a>01310                 <span class="comment">// find status, register data</span>
<a name="l01311"></a>01311                 <span class="keywordflow">switch</span>($name){
<a name="l01312"></a>01312                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;all&#39;</span>:                     <span class="comment">// (optional) compositor content for a complexType</span>
<a name="l01313"></a>01313                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;choice&#39;</span>:
<a name="l01314"></a>01314                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;group&#39;</span>:
<a name="l01315"></a>01315                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;sequence&#39;</span>:
<a name="l01316"></a>01316                                 <span class="comment">//$this-&gt;xdebug(&quot;compositor $name for currentComplexType: $this-&gt;currentComplexType and currentElement: $this-&gt;currentElement&quot;);</span>
<a name="l01317"></a>01317                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;compositor&#39;</span>] = $name;
<a name="l01318"></a>01318                                 <span class="comment">//if($name == &#39;all&#39; || $name == &#39;sequence&#39;){</span>
<a name="l01319"></a>01319                                 <span class="comment">//      $this-&gt;complexTypes[$this-&gt;currentComplexType][&#39;phpType&#39;] = &#39;struct&#39;;</span>
<a name="l01320"></a>01320                                 <span class="comment">//}</span>
<a name="l01321"></a>01321                         <span class="keywordflow">break</span>;
<a name="l01322"></a>01322                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;attribute&#39;</span>:       <span class="comment">// complexType attribute</span>
<a name="l01323"></a>01323                 <span class="comment">//$this-&gt;xdebug(&quot;parsing attribute $attrs[name] $attrs[ref] of value: &quot;.$attrs[&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;]);</span>
<a name="l01324"></a>01324                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;parsing attribute:&quot;</span>);
<a name="l01325"></a>01325                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($attrs));
<a name="l01326"></a>01326                                 <span class="keywordflow">if</span> (!isset($attrs[<span class="stringliteral">&#39;form&#39;</span>])) {
<a name="l01327"></a>01327                                         <span class="comment">// TODO: handle globals</span>
<a name="l01328"></a>01328                                         $attrs[<span class="stringliteral">&#39;form&#39;</span>] = $this-&gt;schemaInfo[<span class="stringliteral">&#39;attributeFormDefault&#39;</span>];
<a name="l01329"></a>01329                                 }
<a name="l01330"></a>01330                 <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>])) {
<a name="l01331"></a>01331                                         $v = $attrs[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>];
<a name="l01332"></a>01332                                         <span class="keywordflow">if</span> (!strpos($v, <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l01333"></a>01333                                                 <span class="comment">// no namespace in arrayType attribute value...</span>
<a name="l01334"></a>01334                                                 <span class="keywordflow">if</span> ($this-&gt;defaultNamespace[$pos]) {
<a name="l01335"></a>01335                                                         <span class="comment">// ...so use the default</span>
<a name="l01336"></a>01336                                                         $attrs[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>] = $this-&gt;defaultNamespace[$pos] . <span class="charliteral">&#39;:&#39;</span> . $attrs[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>];
<a name="l01337"></a>01337                                                 }
<a name="l01338"></a>01338                                         }
<a name="l01339"></a>01339                 }
<a name="l01340"></a>01340                 <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;name&#39;</span>])){
<a name="l01341"></a>01341                                         $this-&gt;attributes[$attrs[<span class="stringliteral">&#39;name&#39;</span>]] = $attrs;
<a name="l01342"></a>01342                                         $aname = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01343"></a>01343                                 } elseif(isset($attrs[<span class="stringliteral">&#39;ref&#39;</span>]) &amp;&amp; $attrs[<span class="stringliteral">&#39;ref&#39;</span>] == <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/:arrayType&#39;</span>){
<a name="l01344"></a>01344                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>])) {
<a name="l01345"></a>01345                                 $aname = $attrs[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>];
<a name="l01346"></a>01346                         } <span class="keywordflow">else</span> {
<a name="l01347"></a>01347                                 $aname = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01348"></a>01348                         }
<a name="l01349"></a>01349                                 } elseif(isset($attrs[<span class="stringliteral">&#39;ref&#39;</span>])){
<a name="l01350"></a>01350                                         $aname = $attrs[<span class="stringliteral">&#39;ref&#39;</span>];
<a name="l01351"></a>01351                     $this-&gt;attributes[$attrs[<span class="stringliteral">&#39;ref&#39;</span>]] = $attrs;
<a name="l01352"></a>01352                                 }
<a name="l01353"></a>01353                 
<a name="l01354"></a>01354                                 <span class="keywordflow">if</span>($this-&gt;currentComplexType){  <span class="comment">// This should *always* be</span>
<a name="l01355"></a>01355                                         $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;attrs&#39;</span>][$aname] = $attrs;
<a name="l01356"></a>01356                                 }
<a name="l01357"></a>01357                                 <span class="comment">// arrayType attribute</span>
<a name="l01358"></a>01358                                 <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>]) || $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($aname) == <span class="stringliteral">&#39;arrayType&#39;</span>){
<a name="l01359"></a>01359                                         $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;array&#39;</span>;
<a name="l01360"></a>01360                         $prefix = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($aname);
<a name="l01361"></a>01361                                         <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>])){
<a name="l01362"></a>01362                                                 $v = $attrs[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>];
<a name="l01363"></a>01363                                         } <span class="keywordflow">else</span> {
<a name="l01364"></a>01364                                                 $v = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01365"></a>01365                                         }
<a name="l01366"></a>01366                     <span class="keywordflow">if</span>(strpos($v,<span class="stringliteral">&#39;[,]&#39;</span>)){
<a name="l01367"></a>01367                         $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;multidimensional&#39;</span>] = <span class="keyword">true</span>;
<a name="l01368"></a>01368                     }
<a name="l01369"></a>01369                     $v = substr($v,0,strpos($v,<span class="charliteral">&#39;[&#39;</span>)); <span class="comment">// clip the []</span>
<a name="l01370"></a>01370                     <span class="keywordflow">if</span>(!strpos($v,<span class="charliteral">&#39;:&#39;</span>) &amp;&amp; isset($this-&gt;typemap[$this-&gt;XMLSchemaVersion][$v])){
<a name="l01371"></a>01371                         $v = $this-&gt;XMLSchemaVersion.<span class="charliteral">&#39;:&#39;</span>.$v;
<a name="l01372"></a>01372                     }
<a name="l01373"></a>01373                     $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;arrayType&#39;</span>] = $v;
<a name="l01374"></a>01374                                 }
<a name="l01375"></a>01375                         <span class="keywordflow">break</span>;
<a name="l01376"></a>01376                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;complexContent&#39;</span>:  <span class="comment">// (optional) content for a complexType</span>
<a name="l01377"></a>01377                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;do nothing for element $name&quot;</span>);
<a name="l01378"></a>01378                         <span class="keywordflow">break</span>;
<a name="l01379"></a>01379                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;complexType&#39;</span>:
<a name="l01380"></a>01380                                 array_push($this-&gt;complexTypeStack, $this-&gt;currentComplexType);
<a name="l01381"></a>01381                                 <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;name&#39;</span>])){
<a name="l01382"></a>01382                                         <span class="comment">// TODO: what is the scope of named complexTypes that appear</span>
<a name="l01383"></a>01383                                         <span class="comment">//       nested within other c complexTypes?</span>
<a name="l01384"></a>01384                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;processing named complexType &#39;</span>.$attrs[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l01385"></a>01385                                         <span class="comment">//$this-&gt;currentElement = false;</span>
<a name="l01386"></a>01386                                         $this-&gt;currentComplexType = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01387"></a>01387                                         $this-&gt;complexTypes[$this-&gt;currentComplexType] = $attrs;
<a name="l01388"></a>01388                                         $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;typeClass&#39;</span>] = <span class="stringliteral">&#39;complexType&#39;</span>;
<a name="l01389"></a>01389                                         <span class="comment">// This is for constructs like</span>
<a name="l01390"></a>01390                                         <span class="comment">//           &lt;complexType name=&quot;ListOfString&quot; base=&quot;soap:Array&quot;&gt;</span>
<a name="l01391"></a>01391                                         <span class="comment">//                &lt;sequence&gt;</span>
<a name="l01392"></a>01392                                         <span class="comment">//                    &lt;element name=&quot;string&quot; type=&quot;xsd:string&quot;</span>
<a name="l01393"></a>01393                                         <span class="comment">//                        minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot; /&gt;</span>
<a name="l01394"></a>01394                                         <span class="comment">//                &lt;/sequence&gt;</span>
<a name="l01395"></a>01395                                         <span class="comment">//            &lt;/complexType&gt;</span>
<a name="l01396"></a>01396                                         <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;base&#39;</span>]) &amp;&amp; preg_match(<span class="stringliteral">&#39;/:Array$/&#39;</span>,$attrs[<span class="stringliteral">&#39;base&#39;</span>])){
<a name="l01397"></a>01397                                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;complexType is unusual array&#39;</span>);
<a name="l01398"></a>01398                                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;array&#39;</span>;
<a name="l01399"></a>01399                                         } <span class="keywordflow">else</span> {
<a name="l01400"></a>01400                                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;struct&#39;</span>;
<a name="l01401"></a>01401                                         }
<a name="l01402"></a>01402                                 } <span class="keywordflow">else</span> {
<a name="l01403"></a>01403                                         $name = $this-&gt;<a class="code" href="classnusoap__xmlschema.html#af81e69a74736c389b59e8e59f033c9e9">CreateTypeName</a>($this-&gt;currentElement);
<a name="l01404"></a>01404                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;processing unnamed complexType for element &#39;</span> . $this-&gt;currentElement . <span class="stringliteral">&#39; named &#39;</span> . $name);
<a name="l01405"></a>01405                                         $this-&gt;currentComplexType = $name;
<a name="l01406"></a>01406                                         <span class="comment">//$this-&gt;currentElement = false;</span>
<a name="l01407"></a>01407                                         $this-&gt;complexTypes[$this-&gt;currentComplexType] = $attrs;
<a name="l01408"></a>01408                                         $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;typeClass&#39;</span>] = <span class="stringliteral">&#39;complexType&#39;</span>;
<a name="l01409"></a>01409                                         <span class="comment">// This is for constructs like</span>
<a name="l01410"></a>01410                                         <span class="comment">//           &lt;complexType name=&quot;ListOfString&quot; base=&quot;soap:Array&quot;&gt;</span>
<a name="l01411"></a>01411                                         <span class="comment">//                &lt;sequence&gt;</span>
<a name="l01412"></a>01412                                         <span class="comment">//                    &lt;element name=&quot;string&quot; type=&quot;xsd:string&quot;</span>
<a name="l01413"></a>01413                                         <span class="comment">//                        minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot; /&gt;</span>
<a name="l01414"></a>01414                                         <span class="comment">//                &lt;/sequence&gt;</span>
<a name="l01415"></a>01415                                         <span class="comment">//            &lt;/complexType&gt;</span>
<a name="l01416"></a>01416                                         <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;base&#39;</span>]) &amp;&amp; preg_match(<span class="stringliteral">&#39;/:Array$/&#39;</span>,$attrs[<span class="stringliteral">&#39;base&#39;</span>])){
<a name="l01417"></a>01417                                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;complexType is unusual array&#39;</span>);
<a name="l01418"></a>01418                                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;array&#39;</span>;
<a name="l01419"></a>01419                                         } <span class="keywordflow">else</span> {
<a name="l01420"></a>01420                                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;struct&#39;</span>;
<a name="l01421"></a>01421                                         }
<a name="l01422"></a>01422                                 }
<a name="l01423"></a>01423                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;simpleContent&#39;</span>] = <span class="stringliteral">&#39;false&#39;</span>;
<a name="l01424"></a>01424                         <span class="keywordflow">break</span>;
<a name="l01425"></a>01425                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;element&#39;</span>:
<a name="l01426"></a>01426                                 array_push($this-&gt;elementStack, $this-&gt;currentElement);
<a name="l01427"></a>01427                                 <span class="keywordflow">if</span> (!isset($attrs[<span class="stringliteral">&#39;form&#39;</span>])) {
<a name="l01428"></a>01428                                         <span class="keywordflow">if</span> ($this-&gt;currentComplexType) {
<a name="l01429"></a>01429                                                 $attrs[<span class="stringliteral">&#39;form&#39;</span>] = $this-&gt;schemaInfo[<span class="stringliteral">&#39;elementFormDefault&#39;</span>];
<a name="l01430"></a>01430                                         } <span class="keywordflow">else</span> {
<a name="l01431"></a>01431                                                 <span class="comment">// global</span>
<a name="l01432"></a>01432                                                 $attrs[<span class="stringliteral">&#39;form&#39;</span>] = <span class="stringliteral">&#39;qualified&#39;</span>;
<a name="l01433"></a>01433                                         }
<a name="l01434"></a>01434                                 }
<a name="l01435"></a>01435                                 <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;type&#39;</span>])){
<a name="l01436"></a>01436                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;processing typed element &quot;</span>.$attrs[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot; of type &quot;</span>.$attrs[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l01437"></a>01437                                         <span class="keywordflow">if</span> (! $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($attrs[<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l01438"></a>01438                                                 <span class="keywordflow">if</span> ($this-&gt;defaultNamespace[$pos]) {
<a name="l01439"></a>01439                                                         $attrs[<span class="stringliteral">&#39;type&#39;</span>] = $this-&gt;defaultNamespace[$pos] . <span class="charliteral">&#39;:&#39;</span> . $attrs[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l01440"></a>01440                                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;used default namespace to make type &#39;</span> . $attrs[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l01441"></a>01441                                                 }
<a name="l01442"></a>01442                                         }
<a name="l01443"></a>01443                                         <span class="comment">// This is for constructs like</span>
<a name="l01444"></a>01444                                         <span class="comment">//           &lt;complexType name=&quot;ListOfString&quot; base=&quot;soap:Array&quot;&gt;</span>
<a name="l01445"></a>01445                                         <span class="comment">//                &lt;sequence&gt;</span>
<a name="l01446"></a>01446                                         <span class="comment">//                    &lt;element name=&quot;string&quot; type=&quot;xsd:string&quot;</span>
<a name="l01447"></a>01447                                         <span class="comment">//                        minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot; /&gt;</span>
<a name="l01448"></a>01448                                         <span class="comment">//                &lt;/sequence&gt;</span>
<a name="l01449"></a>01449                                         <span class="comment">//            &lt;/complexType&gt;</span>
<a name="l01450"></a>01450                                         <span class="keywordflow">if</span> ($this-&gt;currentComplexType &amp;&amp; $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;phpType&#39;</span>] == <span class="stringliteral">&#39;array&#39;</span>) {
<a name="l01451"></a>01451                                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;arrayType for unusual array is &#39;</span> . $attrs[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l01452"></a>01452                                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;arrayType&#39;</span>] = $attrs[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l01453"></a>01453                                         }
<a name="l01454"></a>01454                                         $this-&gt;currentElement = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01455"></a>01455                                         $ename = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01456"></a>01456                                 } elseif(isset($attrs[<span class="stringliteral">&#39;ref&#39;</span>])){
<a name="l01457"></a>01457                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;processing element as ref to &quot;</span>.$attrs[<span class="stringliteral">&#39;ref&#39;</span>]);
<a name="l01458"></a>01458                                         $this-&gt;currentElement = <span class="stringliteral">&quot;ref to &quot;</span>.$attrs[<span class="stringliteral">&#39;ref&#39;</span>];
<a name="l01459"></a>01459                                         $ename = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($attrs[<span class="stringliteral">&#39;ref&#39;</span>]);
<a name="l01460"></a>01460                                 } <span class="keywordflow">else</span> {
<a name="l01461"></a>01461                                         $type = $this-&gt;<a class="code" href="classnusoap__xmlschema.html#af81e69a74736c389b59e8e59f033c9e9">CreateTypeName</a>($this-&gt;currentComplexType . <span class="charliteral">&#39;_&#39;</span> . $attrs[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l01462"></a>01462                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;processing untyped element &quot;</span> . $attrs[<span class="stringliteral">&#39;name&#39;</span>] . <span class="stringliteral">&#39; type &#39;</span> . $type);
<a name="l01463"></a>01463                                         $this-&gt;currentElement = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01464"></a>01464                                         $attrs[<span class="stringliteral">&#39;type&#39;</span>] = $this-&gt;schemaTargetNamespace . <span class="charliteral">&#39;:&#39;</span> . $type;
<a name="l01465"></a>01465                                         $ename = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01466"></a>01466                                 }
<a name="l01467"></a>01467                                 <span class="keywordflow">if</span> (isset($ename) &amp;&amp; $this-&gt;currentComplexType) {
<a name="l01468"></a>01468                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;add element $ename to complexType $this-&gt;currentComplexType&quot;</span>);
<a name="l01469"></a>01469                                         $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;elements&#39;</span>][$ename] = $attrs;
<a name="l01470"></a>01470                                 } elseif (!isset($attrs[<span class="stringliteral">&#39;ref&#39;</span>])) {
<a name="l01471"></a>01471                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;add element $ename to elements array&quot;</span>);
<a name="l01472"></a>01472                                         $this-&gt;elements[ $attrs[<span class="stringliteral">&#39;name&#39;</span>] ] = $attrs;
<a name="l01473"></a>01473                                         $this-&gt;elements[ $attrs[<span class="stringliteral">&#39;name&#39;</span>] ][<span class="stringliteral">&#39;typeClass&#39;</span>] = <span class="stringliteral">&#39;element&#39;</span>;
<a name="l01474"></a>01474                                 }
<a name="l01475"></a>01475                         <span class="keywordflow">break</span>;
<a name="l01476"></a>01476                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;enumeration&#39;</span>:     <span class="comment">//      restriction value list member</span>
<a name="l01477"></a>01477                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;enumeration &#39;</span> . $attrs[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l01478"></a>01478                                 <span class="keywordflow">if</span> ($this-&gt;currentSimpleType) {
<a name="l01479"></a>01479                                         $this-&gt;simpleTypes[$this-&gt;currentSimpleType][<span class="stringliteral">&#39;enumeration&#39;</span>][] = $attrs[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l01480"></a>01480                                 } elseif ($this-&gt;currentComplexType) {
<a name="l01481"></a>01481                                         $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;enumeration&#39;</span>][] = $attrs[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l01482"></a>01482                                 }
<a name="l01483"></a>01483                         <span class="keywordflow">break</span>;
<a name="l01484"></a>01484                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;extension&#39;</span>:       <span class="comment">// simpleContent or complexContent type extension</span>
<a name="l01485"></a>01485                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;extension &#39;</span> . $attrs[<span class="stringliteral">&#39;base&#39;</span>]);
<a name="l01486"></a>01486                                 <span class="keywordflow">if</span> ($this-&gt;currentComplexType) {
<a name="l01487"></a>01487                                         $ns = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($attrs[<span class="stringliteral">&#39;base&#39;</span>]);
<a name="l01488"></a>01488                                         <span class="keywordflow">if</span> ($ns == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01489"></a>01489                                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;extensionBase&#39;</span>] = $this-&gt;schemaTargetNamespace . <span class="charliteral">&#39;:&#39;</span> . $attrs[<span class="stringliteral">&#39;base&#39;</span>];
<a name="l01490"></a>01490                                         } <span class="keywordflow">else</span> {
<a name="l01491"></a>01491                                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;extensionBase&#39;</span>] = $attrs[<span class="stringliteral">&#39;base&#39;</span>];
<a name="l01492"></a>01492                                         }
<a name="l01493"></a>01493                                 } <span class="keywordflow">else</span> {
<a name="l01494"></a>01494                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;no current complexType to set extensionBase&#39;</span>);
<a name="l01495"></a>01495                                 }
<a name="l01496"></a>01496                         <span class="keywordflow">break</span>;
<a name="l01497"></a>01497                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;import&#39;</span>:
<a name="l01498"></a>01498                             <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;schemaLocation&#39;</span>])) {
<a name="l01499"></a>01499                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;import namespace &#39;</span> . $attrs[<span class="stringliteral">&#39;namespace&#39;</span>] . <span class="stringliteral">&#39; from &#39;</span> . $attrs[<span class="stringliteral">&#39;schemaLocation&#39;</span>]);
<a name="l01500"></a>01500                     $this-&gt;imports[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]][] = array(<span class="stringliteral">&#39;location&#39;</span> =&gt; $attrs[<span class="stringliteral">&#39;schemaLocation&#39;</span>], <span class="stringliteral">&#39;loaded&#39;</span> =&gt; <span class="keyword">false</span>);
<a name="l01501"></a>01501                                 } <span class="keywordflow">else</span> {
<a name="l01502"></a>01502                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;import namespace &#39;</span> . $attrs[<span class="stringliteral">&#39;namespace&#39;</span>]);
<a name="l01503"></a>01503                     $this-&gt;imports[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]][] = array(<span class="stringliteral">&#39;location&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;loaded&#39;</span> =&gt; <span class="keyword">true</span>);
<a name="l01504"></a>01504                                         <span class="keywordflow">if</span> (! $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($attrs[<span class="stringliteral">&#39;namespace&#39;</span>])) {
<a name="l01505"></a>01505                                                 $this-&gt;namespaces[<span class="stringliteral">&#39;ns&#39;</span>.(count($this-&gt;namespaces)+1)] = $attrs[<span class="stringliteral">&#39;namespace&#39;</span>];
<a name="l01506"></a>01506                                         }
<a name="l01507"></a>01507                                 }
<a name="l01508"></a>01508                         <span class="keywordflow">break</span>;
<a name="l01509"></a>01509                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;include&#39;</span>:
<a name="l01510"></a>01510                             <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;schemaLocation&#39;</span>])) {
<a name="l01511"></a>01511                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;include into namespace &#39;</span> . $this-&gt;schemaTargetNamespace . <span class="stringliteral">&#39; from &#39;</span> . $attrs[<span class="stringliteral">&#39;schemaLocation&#39;</span>]);
<a name="l01512"></a>01512                     $this-&gt;imports[$this-&gt;schemaTargetNamespace][] = array(<span class="stringliteral">&#39;location&#39;</span> =&gt; $attrs[<span class="stringliteral">&#39;schemaLocation&#39;</span>], <span class="stringliteral">&#39;loaded&#39;</span> =&gt; <span class="keyword">false</span>);
<a name="l01513"></a>01513                                 } <span class="keywordflow">else</span> {
<a name="l01514"></a>01514                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;ignoring invalid XML Schema construct: include without schemaLocation attribute&#39;</span>);
<a name="l01515"></a>01515                                 }
<a name="l01516"></a>01516                         <span class="keywordflow">break</span>;
<a name="l01517"></a>01517                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;list&#39;</span>:    <span class="comment">// simpleType value list</span>
<a name="l01518"></a>01518                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;do nothing for element $name&quot;</span>);
<a name="l01519"></a>01519                         <span class="keywordflow">break</span>;
<a name="l01520"></a>01520                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;restriction&#39;</span>:     <span class="comment">// simpleType, simpleContent or complexContent value restriction</span>
<a name="l01521"></a>01521                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;restriction &#39;</span> . $attrs[<span class="stringliteral">&#39;base&#39;</span>]);
<a name="l01522"></a>01522                                 <span class="keywordflow">if</span>($this-&gt;currentSimpleType){
<a name="l01523"></a>01523                                         $this-&gt;simpleTypes[$this-&gt;currentSimpleType][<span class="stringliteral">&#39;type&#39;</span>] = $attrs[<span class="stringliteral">&#39;base&#39;</span>];
<a name="l01524"></a>01524                                 } elseif($this-&gt;currentComplexType){
<a name="l01525"></a>01525                                         $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;restrictionBase&#39;</span>] = $attrs[<span class="stringliteral">&#39;base&#39;</span>];
<a name="l01526"></a>01526                                         <span class="keywordflow">if</span>(strstr($attrs[<span class="stringliteral">&#39;base&#39;</span>],<span class="charliteral">&#39;:&#39;</span>) == <span class="stringliteral">&#39;:Array&#39;</span>){
<a name="l01527"></a>01527                                                 $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;array&#39;</span>;
<a name="l01528"></a>01528                                         }
<a name="l01529"></a>01529                                 }
<a name="l01530"></a>01530                         <span class="keywordflow">break</span>;
<a name="l01531"></a>01531                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;schema&#39;</span>:
<a name="l01532"></a>01532                                 $this-&gt;schemaInfo = $attrs;
<a name="l01533"></a>01533                                 $this-&gt;schemaInfo[<span class="stringliteral">&#39;schemaVersion&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($prefix);
<a name="l01534"></a>01534                                 <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;targetNamespace&#39;</span>])) {
<a name="l01535"></a>01535                                         $this-&gt;schemaTargetNamespace = $attrs[<span class="stringliteral">&#39;targetNamespace&#39;</span>];
<a name="l01536"></a>01536                                 }
<a name="l01537"></a>01537                                 <span class="keywordflow">if</span> (!isset($attrs[<span class="stringliteral">&#39;elementFormDefault&#39;</span>])) {
<a name="l01538"></a>01538                                         $this-&gt;schemaInfo[<span class="stringliteral">&#39;elementFormDefault&#39;</span>] = <span class="stringliteral">&#39;unqualified&#39;</span>;
<a name="l01539"></a>01539                                 }
<a name="l01540"></a>01540                                 <span class="keywordflow">if</span> (!isset($attrs[<span class="stringliteral">&#39;attributeFormDefault&#39;</span>])) {
<a name="l01541"></a>01541                                         $this-&gt;schemaInfo[<span class="stringliteral">&#39;attributeFormDefault&#39;</span>] = <span class="stringliteral">&#39;unqualified&#39;</span>;
<a name="l01542"></a>01542                                 }
<a name="l01543"></a>01543                         <span class="keywordflow">break</span>;
<a name="l01544"></a>01544                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;simpleContent&#39;</span>:   <span class="comment">// (optional) content for a complexType</span>
<a name="l01545"></a>01545                                 <span class="keywordflow">if</span> ($this-&gt;currentComplexType) {        <span class="comment">// This should *always* be</span>
<a name="l01546"></a>01546                                         $this-&gt;complexTypes[$this-&gt;currentComplexType][<span class="stringliteral">&#39;simpleContent&#39;</span>] = <span class="stringliteral">&#39;true&#39;</span>;
<a name="l01547"></a>01547                                 } <span class="keywordflow">else</span> {
<a name="l01548"></a>01548                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;do nothing for element $name because there is no current complexType&quot;</span>);
<a name="l01549"></a>01549                                 }
<a name="l01550"></a>01550                         <span class="keywordflow">break</span>;
<a name="l01551"></a>01551                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;simpleType&#39;</span>:
<a name="l01552"></a>01552                                 array_push($this-&gt;simpleTypeStack, $this-&gt;currentSimpleType);
<a name="l01553"></a>01553                                 <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;name&#39;</span>])){
<a name="l01554"></a>01554                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;processing simpleType for name &quot;</span> . $attrs[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l01555"></a>01555                                         $this-&gt;currentSimpleType = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01556"></a>01556                                         $this-&gt;simpleTypes[ $attrs[<span class="stringliteral">&#39;name&#39;</span>] ] = $attrs;
<a name="l01557"></a>01557                                         $this-&gt;simpleTypes[ $attrs[<span class="stringliteral">&#39;name&#39;</span>] ][<span class="stringliteral">&#39;typeClass&#39;</span>] = <span class="stringliteral">&#39;simpleType&#39;</span>;
<a name="l01558"></a>01558                                         $this-&gt;simpleTypes[ $attrs[<span class="stringliteral">&#39;name&#39;</span>] ][<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;scalar&#39;</span>;
<a name="l01559"></a>01559                                 } <span class="keywordflow">else</span> {
<a name="l01560"></a>01560                                         $name = $this-&gt;<a class="code" href="classnusoap__xmlschema.html#af81e69a74736c389b59e8e59f033c9e9">CreateTypeName</a>($this-&gt;currentComplexType . <span class="charliteral">&#39;_&#39;</span> . $this-&gt;currentElement);
<a name="l01561"></a>01561                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;processing unnamed simpleType for element &#39;</span> . $this-&gt;currentElement . <span class="stringliteral">&#39; named &#39;</span> . $name);
<a name="l01562"></a>01562                                         $this-&gt;currentSimpleType = $name;
<a name="l01563"></a>01563                                         <span class="comment">//$this-&gt;currentElement = false;</span>
<a name="l01564"></a>01564                                         $this-&gt;simpleTypes[$this-&gt;currentSimpleType] = $attrs;
<a name="l01565"></a>01565                                         $this-&gt;simpleTypes[$this-&gt;currentSimpleType][<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;scalar&#39;</span>;
<a name="l01566"></a>01566                                 }
<a name="l01567"></a>01567                         <span class="keywordflow">break</span>;
<a name="l01568"></a>01568                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;union&#39;</span>:   <span class="comment">// simpleType type list</span>
<a name="l01569"></a>01569                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;do nothing for element $name&quot;</span>);
<a name="l01570"></a>01570                         <span class="keywordflow">break</span>;
<a name="l01571"></a>01571                         <span class="keywordflow">default</span>:
<a name="l01572"></a>01572                                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;do not have any logic to process element $name&quot;</span>);
<a name="l01573"></a>01573                 }
<a name="l01574"></a>01574         }
<a name="l01575"></a>01575 
<a name="l01583"></a><a class="code" href="classnusoap__xmlschema.html#acefbda81e27787056c44f475887d1131">01583</a>         function <a class="code" href="classnusoap__xmlschema.html#acefbda81e27787056c44f475887d1131">schemaEndElement</a>(<a class="code" href="classnusoap__xmlschema.html#a5a923375f50a90ab2397e8b824c9c1e0">$parser</a>, $name) {
<a name="l01584"></a>01584                 <span class="comment">// bring depth down a notch</span>
<a name="l01585"></a>01585                 $this-&gt;depth--;
<a name="l01586"></a>01586                 <span class="comment">// position of current element is equal to the last value left in depth_array for my depth</span>
<a name="l01587"></a>01587                 <span class="keywordflow">if</span>(isset($this-&gt;depth_array[$this-&gt;depth])){
<a name="l01588"></a>01588                 $pos = $this-&gt;depth_array[$this-&gt;depth];
<a name="l01589"></a>01589         }
<a name="l01590"></a>01590                 <span class="comment">// get element prefix</span>
<a name="l01591"></a>01591                 <span class="keywordflow">if</span> ($prefix = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($name)){
<a name="l01592"></a>01592                         <span class="comment">// get unqualified name</span>
<a name="l01593"></a>01593                         $name = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($name);
<a name="l01594"></a>01594                 } <span class="keywordflow">else</span> {
<a name="l01595"></a>01595                 $prefix = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01596"></a>01596         }
<a name="l01597"></a>01597                 <span class="comment">// move on...</span>
<a name="l01598"></a>01598                 <span class="keywordflow">if</span>($name == <span class="stringliteral">&#39;complexType&#39;</span>){
<a name="l01599"></a>01599                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;done processing complexType &#39;</span> . ($this-&gt;currentComplexType ? $this-&gt;currentComplexType : <span class="stringliteral">&#39;(unknown)&#39;</span>));
<a name="l01600"></a>01600                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;complexTypes[$this-&gt;currentComplexType]));
<a name="l01601"></a>01601                         $this-&gt;currentComplexType = array_pop($this-&gt;complexTypeStack);
<a name="l01602"></a>01602                         <span class="comment">//$this-&gt;currentElement = false;</span>
<a name="l01603"></a>01603                 }
<a name="l01604"></a>01604                 <span class="keywordflow">if</span>($name == <span class="stringliteral">&#39;element&#39;</span>){
<a name="l01605"></a>01605                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;done processing element &#39;</span> . ($this-&gt;currentElement ? $this-&gt;currentElement : <span class="stringliteral">&#39;(unknown)&#39;</span>));
<a name="l01606"></a>01606                         $this-&gt;currentElement = array_pop($this-&gt;elementStack);
<a name="l01607"></a>01607                 }
<a name="l01608"></a>01608                 <span class="keywordflow">if</span>($name == <span class="stringliteral">&#39;simpleType&#39;</span>){
<a name="l01609"></a>01609                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&#39;done processing simpleType &#39;</span> . ($this-&gt;currentSimpleType ? $this-&gt;currentSimpleType : <span class="stringliteral">&#39;(unknown)&#39;</span>));
<a name="l01610"></a>01610                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;simpleTypes[$this-&gt;currentSimpleType]));
<a name="l01611"></a>01611                         $this-&gt;currentSimpleType = array_pop($this-&gt;simpleTypeStack);
<a name="l01612"></a>01612                 }
<a name="l01613"></a>01613         }
<a name="l01614"></a>01614 
<a name="l01622"></a><a class="code" href="classnusoap__xmlschema.html#a0ab12386d6d21cdfa78a6b6fcf2da8ae">01622</a>         function <a class="code" href="classnusoap__xmlschema.html#a0ab12386d6d21cdfa78a6b6fcf2da8ae">schemaCharacterData</a>(<a class="code" href="classnusoap__xmlschema.html#a5a923375f50a90ab2397e8b824c9c1e0">$parser</a>, $data){
<a name="l01623"></a>01623                 $pos = $this-&gt;depth_array[$this-&gt;depth - 1];
<a name="l01624"></a>01624                 $this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>] .= $data;
<a name="l01625"></a>01625         }
<a name="l01626"></a>01626 
<a name="l01632"></a><a class="code" href="classnusoap__xmlschema.html#aa692870037441ee54fd6ef6bb2495754">01632</a>         function <a class="code" href="classnusoap__xmlschema.html#aa692870037441ee54fd6ef6bb2495754">serializeSchema</a>(){
<a name="l01633"></a>01633 
<a name="l01634"></a>01634                 $schemaPrefix = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($this-&gt;XMLSchemaVersion);
<a name="l01635"></a>01635                 <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01636"></a>01636                 <span class="comment">// imports</span>
<a name="l01637"></a>01637                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>($this-&gt;imports) &gt; 0) {
<a name="l01638"></a>01638                         <span class="keywordflow">foreach</span>($this-&gt;imports as $ns =&gt; $list) {
<a name="l01639"></a>01639                                 <span class="keywordflow">foreach</span> ($list as $ii) {
<a name="l01640"></a>01640                                         <span class="keywordflow">if</span> ($ii[<span class="stringliteral">&#39;location&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01641"></a>01641                                                 <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> .= <span class="stringliteral">&quot; &lt;$schemaPrefix:import location=\&quot;&quot;</span> . $ii[<span class="stringliteral">&#39;location&#39;</span>] . <span class="stringliteral">&#39;&quot; namespace=&quot;&#39;</span> . $ns . <span class="stringliteral">&quot;\&quot; /&gt;\n&quot;</span>;
<a name="l01642"></a>01642                                         } <span class="keywordflow">else</span> {
<a name="l01643"></a>01643                                                 <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> .= <span class="stringliteral">&quot; &lt;$schemaPrefix:import namespace=\&quot;&quot;</span> . $ns . <span class="stringliteral">&quot;\&quot; /&gt;\n&quot;</span>;
<a name="l01644"></a>01644                                         }
<a name="l01645"></a>01645                                 }
<a name="l01646"></a>01646                         } 
<a name="l01647"></a>01647                 } 
<a name="l01648"></a>01648                 <span class="comment">// complex types</span>
<a name="l01649"></a>01649                 <span class="keywordflow">foreach</span>($this-&gt;complexTypes as $typeName =&gt; $attrs){
<a name="l01650"></a>01650                         $contentStr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01651"></a>01651                         <span class="comment">// serialize child elements</span>
<a name="l01652"></a>01652                         <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;elements&#39;</span>]) &amp;&amp; (count($attrs[<span class="stringliteral">&#39;elements&#39;</span>]) &gt; 0)){
<a name="l01653"></a>01653                                 <span class="keywordflow">foreach</span>($attrs[<span class="stringliteral">&#39;elements&#39;</span>] as $element =&gt; $eParts){
<a name="l01654"></a>01654                                         <span class="keywordflow">if</span>(isset($eParts[<span class="stringliteral">&#39;ref&#39;</span>])){
<a name="l01655"></a>01655                                                 $contentStr .= <span class="stringliteral">&quot;   &lt;$schemaPrefix:element ref=\&quot;$element\&quot;/&gt;\n&quot;</span>;
<a name="l01656"></a>01656                                         } <span class="keywordflow">else</span> {
<a name="l01657"></a>01657                                                 $contentStr .= <span class="stringliteral">&quot;   &lt;$schemaPrefix:element name=\&quot;$element\&quot; type=\&quot;&quot;</span> . $this-&gt;contractQName($eParts[<span class="stringliteral">&#39;type&#39;</span>]) . <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l01658"></a>01658                                                 <span class="keywordflow">foreach</span> ($eParts as $aName =&gt; $aValue) {
<a name="l01659"></a>01659                                                         <span class="comment">// handle, e.g., abstract, default, form, minOccurs, maxOccurs, nillable</span>
<a name="l01660"></a>01660                                                         <span class="keywordflow">if</span> ($aName != <span class="stringliteral">&#39;name&#39;</span> &amp;&amp; $aName != <span class="stringliteral">&#39;type&#39;</span>) {
<a name="l01661"></a>01661                                                                 $contentStr .= <span class="stringliteral">&quot; $aName=\&quot;$aValue\&quot;&quot;</span>;
<a name="l01662"></a>01662                                                         }
<a name="l01663"></a>01663                                                 }
<a name="l01664"></a>01664                                                 $contentStr .= <span class="stringliteral">&quot;/&gt;\n&quot;</span>;
<a name="l01665"></a>01665                                         }
<a name="l01666"></a>01666                                 }
<a name="l01667"></a>01667                                 <span class="comment">// compositor wraps elements</span>
<a name="l01668"></a>01668                                 <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;compositor&#39;</span>]) &amp;&amp; ($attrs[<span class="stringliteral">&#39;compositor&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>)) {
<a name="l01669"></a>01669                                         $contentStr = <span class="stringliteral">&quot;  &lt;$schemaPrefix:$attrs[compositor]&gt;\n&quot;</span>.$contentStr.<span class="stringliteral">&quot;  &lt;/$schemaPrefix:$attrs[compositor]&gt;\n&quot;</span>;
<a name="l01670"></a>01670                                 }
<a name="l01671"></a>01671                         }
<a name="l01672"></a>01672                         <span class="comment">// attributes</span>
<a name="l01673"></a>01673                         <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;attrs&#39;</span>]) &amp;&amp; (count($attrs[<span class="stringliteral">&#39;attrs&#39;</span>]) &gt;= 1)){
<a name="l01674"></a>01674                                 <span class="keywordflow">foreach</span>($attrs[<span class="stringliteral">&#39;attrs&#39;</span>] as $attr =&gt; $aParts){
<a name="l01675"></a>01675                                         $contentStr .= <span class="stringliteral">&quot;    &lt;$schemaPrefix:attribute&quot;</span>;
<a name="l01676"></a>01676                                         <span class="keywordflow">foreach</span> ($aParts as $a =&gt; $v) {
<a name="l01677"></a>01677                                                 <span class="keywordflow">if</span> ($a == <span class="stringliteral">&#39;ref&#39;</span> || $a == <span class="stringliteral">&#39;type&#39;</span>) {
<a name="l01678"></a>01678                                                         $contentStr .= <span class="stringliteral">&quot; $a=\&quot;&quot;</span>.$this-&gt;contractQName($v).<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01679"></a>01679                                                 } elseif ($a == <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/:arrayType&#39;</span>) {
<a name="l01680"></a>01680                                                         $this-&gt;usedNamespaces[<span class="stringliteral">&#39;wsdl&#39;</span>] = $this-&gt;namespaces[<span class="stringliteral">&#39;wsdl&#39;</span>];
<a name="l01681"></a>01681                                                         $contentStr .= <span class="stringliteral">&#39; wsdl:arrayType=&quot;&#39;</span>.$this-&gt;contractQName($v).<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01682"></a>01682                                                 } <span class="keywordflow">else</span> {
<a name="l01683"></a>01683                                                         $contentStr .= <span class="stringliteral">&quot; $a=\&quot;$v\&quot;&quot;</span>;
<a name="l01684"></a>01684                                                 }
<a name="l01685"></a>01685                                         }
<a name="l01686"></a>01686                                         $contentStr .= <span class="stringliteral">&quot;/&gt;\n&quot;</span>;
<a name="l01687"></a>01687                                 }
<a name="l01688"></a>01688                         }
<a name="l01689"></a>01689                         <span class="comment">// if restriction</span>
<a name="l01690"></a>01690                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;restrictionBase&#39;</span>]) &amp;&amp; $attrs[<span class="stringliteral">&#39;restrictionBase&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>){
<a name="l01691"></a>01691                                 $contentStr = <span class="stringliteral">&quot;   &lt;$schemaPrefix:restriction base=\&quot;&quot;</span>.$this-&gt;contractQName($attrs[<span class="stringliteral">&#39;restrictionBase&#39;</span>]).<span class="stringliteral">&quot;\&quot;&gt;\n&quot;</span>.$contentStr.<span class="stringliteral">&quot;   &lt;/$schemaPrefix:restriction&gt;\n&quot;</span>;
<a name="l01692"></a>01692                                 <span class="comment">// complex or simple content</span>
<a name="l01693"></a>01693                                 <span class="keywordflow">if</span> ((isset($attrs[<span class="stringliteral">&#39;elements&#39;</span>]) &amp;&amp; count($attrs[<span class="stringliteral">&#39;elements&#39;</span>]) &gt; 0) || (isset($attrs[<span class="stringliteral">&#39;attrs&#39;</span>]) &amp;&amp; count($attrs[<span class="stringliteral">&#39;attrs&#39;</span>]) &gt; 0)){
<a name="l01694"></a>01694                                         $contentStr = <span class="stringliteral">&quot;  &lt;$schemaPrefix:complexContent&gt;\n&quot;</span>.$contentStr.<span class="stringliteral">&quot;  &lt;/$schemaPrefix:complexContent&gt;\n&quot;</span>;
<a name="l01695"></a>01695                                 }
<a name="l01696"></a>01696                         }
<a name="l01697"></a>01697                         <span class="comment">// finalize complex type</span>
<a name="l01698"></a>01698                         <span class="keywordflow">if</span>($contentStr != <span class="stringliteral">&#39;&#39;</span>){
<a name="l01699"></a>01699                                 $contentStr = <span class="stringliteral">&quot; &lt;$schemaPrefix:complexType name=\&quot;$typeName\&quot;&gt;\n&quot;</span>.$contentStr.<span class="stringliteral">&quot; &lt;/$schemaPrefix:complexType&gt;\n&quot;</span>;
<a name="l01700"></a>01700                         } <span class="keywordflow">else</span> {
<a name="l01701"></a>01701                                 $contentStr = <span class="stringliteral">&quot; &lt;$schemaPrefix:complexType name=\&quot;$typeName\&quot;/&gt;\n&quot;</span>;
<a name="l01702"></a>01702                         }
<a name="l01703"></a>01703                         <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> .= $contentStr;
<a name="l01704"></a>01704                 }
<a name="l01705"></a>01705                 <span class="comment">// simple types</span>
<a name="l01706"></a>01706                 <span class="keywordflow">if</span>(isset($this-&gt;simpleTypes) &amp;&amp; count($this-&gt;simpleTypes) &gt; 0){
<a name="l01707"></a>01707                         <span class="keywordflow">foreach</span>($this-&gt;simpleTypes as $typeName =&gt; $eParts){
<a name="l01708"></a>01708                                 <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> .= <span class="stringliteral">&quot; &lt;$schemaPrefix:simpleType name=\&quot;$typeName\&quot;&gt;\n  &lt;$schemaPrefix:restriction base=\&quot;&quot;</span>.$this-&gt;contractQName($eParts[<span class="stringliteral">&#39;type&#39;</span>]).<span class="stringliteral">&quot;\&quot;&gt;\n&quot;</span>;
<a name="l01709"></a>01709                                 <span class="keywordflow">if</span> (isset($eParts[<span class="stringliteral">&#39;enumeration&#39;</span>])) {
<a name="l01710"></a>01710                                         <span class="keywordflow">foreach</span> ($eParts[<span class="stringliteral">&#39;enumeration&#39;</span>] as $e) {
<a name="l01711"></a>01711                                                 <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> .= <span class="stringliteral">&quot;  &lt;$schemaPrefix:enumeration value=\&quot;$e\&quot;/&gt;\n&quot;</span>;
<a name="l01712"></a>01712                                         }
<a name="l01713"></a>01713                                 }
<a name="l01714"></a>01714                                 <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> .= <span class="stringliteral">&quot;  &lt;/$schemaPrefix:restriction&gt;\n &lt;/$schemaPrefix:simpleType&gt;&quot;</span>;
<a name="l01715"></a>01715                         }
<a name="l01716"></a>01716                 }
<a name="l01717"></a>01717                 <span class="comment">// elements</span>
<a name="l01718"></a>01718                 <span class="keywordflow">if</span>(isset($this-&gt;elements) &amp;&amp; count($this-&gt;elements) &gt; 0){
<a name="l01719"></a>01719                         <span class="keywordflow">foreach</span>($this-&gt;elements as $element =&gt; $eParts){
<a name="l01720"></a>01720                                 <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> .= <span class="stringliteral">&quot; &lt;$schemaPrefix:element name=\&quot;$element\&quot; type=\&quot;&quot;</span>.$this-&gt;contractQName($eParts[<span class="stringliteral">&#39;type&#39;</span>]).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l01721"></a>01721                         }
<a name="l01722"></a>01722                 }
<a name="l01723"></a>01723                 <span class="comment">// attributes</span>
<a name="l01724"></a>01724                 <span class="keywordflow">if</span>(isset($this-&gt;attributes) &amp;&amp; count($this-&gt;attributes) &gt; 0){
<a name="l01725"></a>01725                         <span class="keywordflow">foreach</span>($this-&gt;attributes as $attr =&gt; $aParts){
<a name="l01726"></a>01726                                 <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> .= <span class="stringliteral">&quot; &lt;$schemaPrefix:attribute name=\&quot;$attr\&quot; type=\&quot;&quot;</span>.$this-&gt;contractQName($aParts[<span class="stringliteral">&#39;type&#39;</span>]).<span class="stringliteral">&quot;\&quot;\n/&gt;&quot;</span>;
<a name="l01727"></a>01727                         }
<a name="l01728"></a>01728                 }
<a name="l01729"></a>01729                 <span class="comment">// finish &#39;er up</span>
<a name="l01730"></a>01730                 $attr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01731"></a>01731                 <span class="keywordflow">foreach</span> ($this-&gt;schemaInfo as $k =&gt; $v) {
<a name="l01732"></a>01732                         <span class="keywordflow">if</span> ($k == <span class="stringliteral">&#39;elementFormDefault&#39;</span> || $k == <span class="stringliteral">&#39;attributeFormDefault&#39;</span>) {
<a name="l01733"></a>01733                                 $attr .= <span class="stringliteral">&quot; $k=\&quot;$v\&quot;&quot;</span>;
<a name="l01734"></a>01734                         }
<a name="l01735"></a>01735                 }
<a name="l01736"></a>01736                 $el = <span class="stringliteral">&quot;&lt;$schemaPrefix:schema$attr targetNamespace=\&quot;$this-&gt;schemaTargetNamespace\&quot;\n&quot;</span>;
<a name="l01737"></a>01737                 <span class="keywordflow">foreach</span> (array_diff($this-&gt;usedNamespaces, $this-&gt;enclosingNamespaces) as $nsp =&gt; $ns) {
<a name="l01738"></a>01738                         $el .= <span class="stringliteral">&quot; xmlns:$nsp=\&quot;$ns\&quot;&quot;</span>;
<a name="l01739"></a>01739                 }
<a name="l01740"></a>01740                 <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a> = $el . <span class="stringliteral">&quot;&gt;\n&quot;</span>.$xml.<span class="stringliteral">&quot;&lt;/$schemaPrefix:schema&gt;\n&quot;</span>;
<a name="l01741"></a>01741                 <span class="keywordflow">return</span> <a class="code" href="classnusoap__xmlschema.html#ac5685e37ae78ad8d8e1b56621fc9a7b2">$xml</a>;
<a name="l01742"></a>01742         }
<a name="l01743"></a>01743 
<a name="l01750"></a><a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">01750</a>         function <a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>($string){
<a name="l01751"></a>01751                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="charliteral">&#39;&lt;&#39;</span> . $this-&gt;schemaTargetNamespace . <span class="stringliteral">&#39;&gt; &#39;</span>.$string);
<a name="l01752"></a>01752         }
<a name="l01753"></a>01753 
<a name="l01766"></a><a class="code" href="classnusoap__xmlschema.html#a7668fba050a08cdf19f2f836d131180a">01766</a>         function <a class="code" href="classnusoap__xmlschema.html#a7668fba050a08cdf19f2f836d131180a">getPHPType</a>($type,$ns){
<a name="l01767"></a>01767                 <span class="keywordflow">if</span>(isset($this-&gt;typemap[$ns][$type])){
<a name="l01768"></a>01768                         <span class="comment">//print &quot;found type &#39;$type&#39; and ns $ns in typemap&lt;br&gt;&quot;;</span>
<a name="l01769"></a>01769                         <span class="keywordflow">return</span> $this-&gt;typemap[$ns][$type];
<a name="l01770"></a>01770                 } elseif(isset($this-&gt;complexTypes[$type])){
<a name="l01771"></a>01771                         <span class="comment">//print &quot;getting type &#39;$type&#39; and ns $ns from complexTypes array&lt;br&gt;&quot;;</span>
<a name="l01772"></a>01772                         <span class="keywordflow">return</span> $this-&gt;complexTypes[$type][<span class="stringliteral">&#39;phpType&#39;</span>];
<a name="l01773"></a>01773                 }
<a name="l01774"></a>01774                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01775"></a>01775         }
<a name="l01776"></a>01776 
<a name="l01799"></a><a class="code" href="classnusoap__xmlschema.html#a11336efcb5b2efa3685b5339bd54b259">01799</a>         function <a class="code" href="classnusoap__xmlschema.html#a11336efcb5b2efa3685b5339bd54b259">getTypeDef</a>($type){
<a name="l01800"></a>01800                 <span class="comment">//$this-&gt;debug(&quot;in getTypeDef for type $type&quot;);</span>
<a name="l01801"></a>01801                 <span class="keywordflow">if</span> (substr($type, -1) == <span class="charliteral">&#39;^&#39;</span>) {
<a name="l01802"></a>01802                         $is_element = 1;
<a name="l01803"></a>01803                         $type = substr($type, 0, -1);
<a name="l01804"></a>01804                 } <span class="keywordflow">else</span> {
<a name="l01805"></a>01805                         $is_element = 0;
<a name="l01806"></a>01806                 }
<a name="l01807"></a>01807 
<a name="l01808"></a>01808                 <span class="keywordflow">if</span>((! $is_element) &amp;&amp; isset($this-&gt;complexTypes[$type])){
<a name="l01809"></a>01809                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;in getTypeDef, found complexType $type&quot;</span>);
<a name="l01810"></a>01810                         <span class="keywordflow">return</span> $this-&gt;complexTypes[$type];
<a name="l01811"></a>01811                 } elseif((! $is_element) &amp;&amp; isset($this-&gt;simpleTypes[$type])){
<a name="l01812"></a>01812                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;in getTypeDef, found simpleType $type&quot;</span>);
<a name="l01813"></a>01813                         <span class="keywordflow">if</span> (!isset($this-&gt;simpleTypes[$type][<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l01814"></a>01814                                 <span class="comment">// get info for type to tack onto the simple type</span>
<a name="l01815"></a>01815                                 <span class="comment">// TODO: can this ever really apply (i.e. what is a simpleType really?)</span>
<a name="l01816"></a>01816                                 $uqType = substr($this-&gt;simpleTypes[$type][<span class="stringliteral">&#39;type&#39;</span>], strrpos($this-&gt;simpleTypes[$type][<span class="stringliteral">&#39;type&#39;</span>], <span class="charliteral">&#39;:&#39;</span>) + 1);
<a name="l01817"></a>01817                                 $ns = substr($this-&gt;simpleTypes[$type][<span class="stringliteral">&#39;type&#39;</span>], 0, strrpos($this-&gt;simpleTypes[$type][<span class="stringliteral">&#39;type&#39;</span>], <span class="charliteral">&#39;:&#39;</span>));
<a name="l01818"></a>01818                                 $etype = $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a11336efcb5b2efa3685b5339bd54b259">getTypeDef</a>($uqType);
<a name="l01819"></a>01819                                 <span class="keywordflow">if</span> ($etype) {
<a name="l01820"></a>01820                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;in getTypeDef, found type for simpleType $type:&quot;</span>);
<a name="l01821"></a>01821                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($etype));
<a name="l01822"></a>01822                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l01823"></a>01823                                                 $this-&gt;simpleTypes[$type][<span class="stringliteral">&#39;phpType&#39;</span>] = $etype[<span class="stringliteral">&#39;phpType&#39;</span>];
<a name="l01824"></a>01824                                         }
<a name="l01825"></a>01825                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;elements&#39;</span>])) {
<a name="l01826"></a>01826                                                 $this-&gt;simpleTypes[$type][<span class="stringliteral">&#39;elements&#39;</span>] = $etype[<span class="stringliteral">&#39;elements&#39;</span>];
<a name="l01827"></a>01827                                         }
<a name="l01828"></a>01828                                 }
<a name="l01829"></a>01829                         }
<a name="l01830"></a>01830                         <span class="keywordflow">return</span> $this-&gt;simpleTypes[$type];
<a name="l01831"></a>01831                 } elseif(isset($this-&gt;elements[$type])){
<a name="l01832"></a>01832                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;in getTypeDef, found element $type&quot;</span>);
<a name="l01833"></a>01833                         <span class="keywordflow">if</span> (!isset($this-&gt;elements[$type][<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l01834"></a>01834                                 <span class="comment">// get info for type to tack onto the element</span>
<a name="l01835"></a>01835                                 $uqType = substr($this-&gt;elements[$type][<span class="stringliteral">&#39;type&#39;</span>], strrpos($this-&gt;elements[$type][<span class="stringliteral">&#39;type&#39;</span>], <span class="charliteral">&#39;:&#39;</span>) + 1);
<a name="l01836"></a>01836                                 $ns = substr($this-&gt;elements[$type][<span class="stringliteral">&#39;type&#39;</span>], 0, strrpos($this-&gt;elements[$type][<span class="stringliteral">&#39;type&#39;</span>], <span class="charliteral">&#39;:&#39;</span>));
<a name="l01837"></a>01837                                 $etype = $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a11336efcb5b2efa3685b5339bd54b259">getTypeDef</a>($uqType);
<a name="l01838"></a>01838                                 <span class="keywordflow">if</span> ($etype) {
<a name="l01839"></a>01839                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;in getTypeDef, found type for element $type:&quot;</span>);
<a name="l01840"></a>01840                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($etype));
<a name="l01841"></a>01841                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l01842"></a>01842                                                 $this-&gt;elements[$type][<span class="stringliteral">&#39;phpType&#39;</span>] = $etype[<span class="stringliteral">&#39;phpType&#39;</span>];
<a name="l01843"></a>01843                                         }
<a name="l01844"></a>01844                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;elements&#39;</span>])) {
<a name="l01845"></a>01845                                                 $this-&gt;elements[$type][<span class="stringliteral">&#39;elements&#39;</span>] = $etype[<span class="stringliteral">&#39;elements&#39;</span>];
<a name="l01846"></a>01846                                         }
<a name="l01847"></a>01847                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;extensionBase&#39;</span>])) {
<a name="l01848"></a>01848                                                 $this-&gt;elements[$type][<span class="stringliteral">&#39;extensionBase&#39;</span>] = $etype[<span class="stringliteral">&#39;extensionBase&#39;</span>];
<a name="l01849"></a>01849                                         }
<a name="l01850"></a>01850                                 } elseif ($ns == <span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span>) {
<a name="l01851"></a>01851                                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;in getTypeDef, element $type is an XSD type&quot;</span>);
<a name="l01852"></a>01852                                         $this-&gt;elements[$type][<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;scalar&#39;</span>;
<a name="l01853"></a>01853                                 }
<a name="l01854"></a>01854                         }
<a name="l01855"></a>01855                         <span class="keywordflow">return</span> $this-&gt;elements[$type];
<a name="l01856"></a>01856                 } elseif(isset($this-&gt;attributes[$type])){
<a name="l01857"></a>01857                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;in getTypeDef, found attribute $type&quot;</span>);
<a name="l01858"></a>01858                         <span class="keywordflow">return</span> $this-&gt;attributes[$type];
<a name="l01859"></a>01859                 } elseif (preg_match(<span class="stringliteral">&#39;/_ContainedType$/&#39;</span>, $type)) {
<a name="l01860"></a>01860                         $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;in getTypeDef, have an untyped element $type&quot;</span>);
<a name="l01861"></a>01861                         $typeDef[<span class="stringliteral">&#39;typeClass&#39;</span>] = <span class="stringliteral">&#39;simpleType&#39;</span>;
<a name="l01862"></a>01862                         $typeDef[<span class="stringliteral">&#39;phpType&#39;</span>] = <span class="stringliteral">&#39;scalar&#39;</span>;
<a name="l01863"></a>01863                         $typeDef[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema:string&#39;</span>;
<a name="l01864"></a>01864                         <span class="keywordflow">return</span> $typeDef;
<a name="l01865"></a>01865                 }
<a name="l01866"></a>01866                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;in getTypeDef, did not find $type&quot;</span>);
<a name="l01867"></a>01867                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01868"></a>01868         }
<a name="l01869"></a>01869 
<a name="l01878"></a><a class="code" href="classnusoap__xmlschema.html#ae5f1fac6d70d1c9f48a7b407a182dd8c">01878</a>     function <a class="code" href="classnusoap__xmlschema.html#ae5f1fac6d70d1c9f48a7b407a182dd8c">serializeTypeDef</a>($type){
<a name="l01879"></a>01879         <span class="comment">//print &quot;in sTD() for type $type&lt;br&gt;&quot;;</span>
<a name="l01880"></a>01880         <span class="keywordflow">if</span>($typeDef = $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a11336efcb5b2efa3685b5339bd54b259">getTypeDef</a>($type)){
<a name="l01881"></a>01881                 $str .= <span class="charliteral">&#39;&lt;&#39;</span>.$type;
<a name="l01882"></a>01882             <span class="keywordflow">if</span>(is_array($typeDef[<span class="stringliteral">&#39;attrs&#39;</span>])){
<a name="l01883"></a>01883                 <span class="keywordflow">foreach</span>($typeDef[<span class="stringliteral">&#39;attrs&#39;</span>] as $attName =&gt; $data){
<a name="l01884"></a>01884                     $str .= <span class="stringliteral">&quot; $attName=\&quot;{type = &quot;</span>.$data[<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot;}\&quot;&quot;</span>;
<a name="l01885"></a>01885                 }
<a name="l01886"></a>01886             }
<a name="l01887"></a>01887             $str .= <span class="stringliteral">&quot; xmlns=\&quot;&quot;</span>.$this-&gt;schema[<span class="stringliteral">&#39;targetNamespace&#39;</span>].<span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l01888"></a>01888             <span class="keywordflow">if</span>(count($typeDef[<span class="stringliteral">&#39;elements&#39;</span>]) &gt; 0){
<a name="l01889"></a>01889                 $str .= <span class="stringliteral">&quot;&gt;&quot;</span>;
<a name="l01890"></a>01890                 <span class="keywordflow">foreach</span>($typeDef[<span class="stringliteral">&#39;elements&#39;</span>] as $element =&gt; $eData){
<a name="l01891"></a>01891                     $str .= $this-&gt;<a class="code" href="classnusoap__xmlschema.html#ae5f1fac6d70d1c9f48a7b407a182dd8c">serializeTypeDef</a>($element);
<a name="l01892"></a>01892                 }
<a name="l01893"></a>01893                 $str .= <span class="stringliteral">&quot;&lt;/$type&gt;&quot;</span>;
<a name="l01894"></a>01894             } elseif($typeDef[<span class="stringliteral">&#39;typeClass&#39;</span>] == <span class="stringliteral">&#39;element&#39;</span>) {
<a name="l01895"></a>01895                 $str .= <span class="stringliteral">&quot;&gt;&lt;/$type&gt;&quot;</span>;
<a name="l01896"></a>01896             } <span class="keywordflow">else</span> {
<a name="l01897"></a>01897                 $str .= <span class="stringliteral">&quot;/&gt;&quot;</span>;
<a name="l01898"></a>01898             }
<a name="l01899"></a>01899                         <span class="keywordflow">return</span> $str;
<a name="l01900"></a>01900         }
<a name="l01901"></a>01901         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01902"></a>01902     }
<a name="l01903"></a>01903 
<a name="l01914"></a><a class="code" href="classnusoap__xmlschema.html#a226f17949d3b47e7e6e2168189d1fca1">01914</a>         function <a class="code" href="classnusoap__xmlschema.html#a226f17949d3b47e7e6e2168189d1fca1">typeToForm</a>($name,$type){
<a name="l01915"></a>01915                 <span class="comment">// get typedef</span>
<a name="l01916"></a>01916                 <span class="keywordflow">if</span>($typeDef = $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a11336efcb5b2efa3685b5339bd54b259">getTypeDef</a>($type)){
<a name="l01917"></a>01917                         <span class="comment">// if struct</span>
<a name="l01918"></a>01918                         <span class="keywordflow">if</span>($typeDef[<span class="stringliteral">&#39;phpType&#39;</span>] == <span class="stringliteral">&#39;struct&#39;</span>){
<a name="l01919"></a>01919                                 $buffer .= <span class="stringliteral">&#39;&lt;table&gt;&#39;</span>;
<a name="l01920"></a>01920                                 <span class="keywordflow">foreach</span>($typeDef[<span class="stringliteral">&#39;elements&#39;</span>] as $child =&gt; $childDef){
<a name="l01921"></a>01921                                         $buffer .= <span class="stringliteral">&quot;</span>
<a name="l01922"></a>01922 <span class="stringliteral">                                        &lt;tr&gt;&lt;td align=&#39;right&#39;&gt;$childDef[name] (type: &quot;</span>.$this-&gt;getLocalPart($childDef[<span class="stringliteral">&#39;type&#39;</span>]).<span class="stringliteral">&quot;):&lt;/td&gt;</span>
<a name="l01923"></a>01923 <span class="stringliteral">                                        &lt;td&gt;&lt;input type=&#39;text&#39; name=&#39;parameters[&quot;</span>.$name.<span class="stringliteral">&quot;][$childDef[name]]&#39;&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l01924"></a>01924                                 }
<a name="l01925"></a>01925                                 $buffer .= <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;
<a name="l01926"></a>01926                         <span class="comment">// if array</span>
<a name="l01927"></a>01927                         } elseif($typeDef[<span class="stringliteral">&#39;phpType&#39;</span>] == <span class="stringliteral">&#39;array&#39;</span>){
<a name="l01928"></a>01928                                 $buffer .= <span class="stringliteral">&#39;&lt;table&gt;&#39;</span>;
<a name="l01929"></a>01929                                 <span class="keywordflow">for</span>(<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>=0;<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt; 3; <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++){
<a name="l01930"></a>01930                                         $buffer .= <span class="stringliteral">&quot;</span>
<a name="l01931"></a>01931 <span class="stringliteral">                                        &lt;tr&gt;&lt;td align=&#39;right&#39;&gt;array item (type: $typeDef[arrayType]):&lt;/td&gt;</span>
<a name="l01932"></a>01932 <span class="stringliteral">                                        &lt;td&gt;&lt;input type=&#39;text&#39; name=&#39;parameters[&quot;</span>.$name.<span class="stringliteral">&quot;][]&#39;&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l01933"></a>01933                                 }
<a name="l01934"></a>01934                                 $buffer .= <span class="stringliteral">&#39;&lt;/table&gt;&#39;</span>;
<a name="l01935"></a>01935                         <span class="comment">// if scalar</span>
<a name="l01936"></a>01936                         } <span class="keywordflow">else</span> {
<a name="l01937"></a>01937                                 $buffer .= <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;parameters[$name]&#39;&gt;&quot;</span>;
<a name="l01938"></a>01938                         }
<a name="l01939"></a>01939                 } <span class="keywordflow">else</span> {
<a name="l01940"></a>01940                         $buffer .= <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;parameters[$name]&#39;&gt;&quot;</span>;
<a name="l01941"></a>01941                 }
<a name="l01942"></a>01942                 <span class="keywordflow">return</span> $buffer;
<a name="l01943"></a>01943         }
<a name="l01944"></a>01944         
<a name="l01986"></a><a class="code" href="classnusoap__xmlschema.html#a1e8872255ad40d52bbc4c749f36e44c6">01986</a>         function <a class="code" href="classnusoap__xmlschema.html#a1e8872255ad40d52bbc4c749f36e44c6">addComplexType</a>($name,$typeClass=<span class="stringliteral">&#39;complexType&#39;</span>,$phpType=<span class="stringliteral">&#39;array&#39;</span>,$compositor=<span class="stringliteral">&#39;&#39;</span>,$restrictionBase=<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="classnusoap__xmlschema.html#ad551bb12a51da38e7e3d9ea79aed7d52">$elements</a>=array(),$attrs=array(),$arrayType=<span class="stringliteral">&#39;&#39;</span>){
<a name="l01987"></a>01987                 $this-&gt;complexTypes[$name] = array(
<a name="l01988"></a>01988             <span class="stringliteral">&#39;name&#39;</span>              =&gt; $name,
<a name="l01989"></a>01989             <span class="stringliteral">&#39;typeClass&#39;</span> =&gt; $typeClass,
<a name="l01990"></a>01990             <span class="stringliteral">&#39;phpType&#39;</span>   =&gt; $phpType,
<a name="l01991"></a>01991                 <span class="stringliteral">&#39;compositor&#39;</span>=&gt; $compositor,
<a name="l01992"></a>01992             <span class="stringliteral">&#39;restrictionBase&#39;</span> =&gt; $restrictionBase,
<a name="l01993"></a>01993                 <span class="stringliteral">&#39;elements&#39;</span>      =&gt; <a class="code" href="classnusoap__xmlschema.html#ad551bb12a51da38e7e3d9ea79aed7d52">$elements</a>,
<a name="l01994"></a>01994             <span class="stringliteral">&#39;attrs&#39;</span>             =&gt; $attrs,
<a name="l01995"></a>01995             <span class="stringliteral">&#39;arrayType&#39;</span> =&gt; $arrayType
<a name="l01996"></a>01996                 );
<a name="l01997"></a>01997                 
<a name="l01998"></a>01998                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;addComplexType $name:&quot;</span>);
<a name="l01999"></a>01999                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;complexTypes[$name]));
<a name="l02000"></a>02000         }
<a name="l02001"></a>02001         
<a name="l02014"></a><a class="code" href="classnusoap__xmlschema.html#a9e3370e2acb024ebdf9140a9fa1330a5">02014</a>         function <a class="code" href="classnusoap__xmlschema.html#a9e3370e2acb024ebdf9140a9fa1330a5">addSimpleType</a>($name, $restrictionBase=<span class="stringliteral">&#39;&#39;</span>, $typeClass=<span class="stringliteral">&#39;simpleType&#39;</span>, $phpType=<span class="stringliteral">&#39;scalar&#39;</span>, $enumeration=array()) {
<a name="l02015"></a>02015                 $this-&gt;simpleTypes[$name] = array(
<a name="l02016"></a>02016             <span class="stringliteral">&#39;name&#39;</span>                      =&gt; $name,
<a name="l02017"></a>02017             <span class="stringliteral">&#39;typeClass&#39;</span>         =&gt; $typeClass,
<a name="l02018"></a>02018             <span class="stringliteral">&#39;phpType&#39;</span>           =&gt; $phpType,
<a name="l02019"></a>02019             <span class="stringliteral">&#39;type&#39;</span>                      =&gt; $restrictionBase,
<a name="l02020"></a>02020             <span class="stringliteral">&#39;enumeration&#39;</span>       =&gt; $enumeration
<a name="l02021"></a>02021                 );
<a name="l02022"></a>02022                 
<a name="l02023"></a>02023                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;addSimpleType $name:&quot;</span>);
<a name="l02024"></a>02024                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;simpleTypes[$name]));
<a name="l02025"></a>02025         }
<a name="l02026"></a>02026 
<a name="l02034"></a><a class="code" href="classnusoap__xmlschema.html#a41645f551b5b158b9746e78746b8b28d">02034</a>         function <a class="code" href="classnusoap__xmlschema.html#a41645f551b5b158b9746e78746b8b28d">addElement</a>($attrs) {
<a name="l02035"></a>02035                 <span class="keywordflow">if</span> (! $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($attrs[<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l02036"></a>02036                         $attrs[<span class="stringliteral">&#39;type&#39;</span>] = $this-&gt;schemaTargetNamespace . <span class="charliteral">&#39;:&#39;</span> . $attrs[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l02037"></a>02037                 }
<a name="l02038"></a>02038                 $this-&gt;elements[ $attrs[<span class="stringliteral">&#39;name&#39;</span>] ] = $attrs;
<a name="l02039"></a>02039                 $this-&gt;elements[ $attrs[<span class="stringliteral">&#39;name&#39;</span>] ][<span class="stringliteral">&#39;typeClass&#39;</span>] = <span class="stringliteral">&#39;element&#39;</span>;
<a name="l02040"></a>02040                 
<a name="l02041"></a>02041                 $this-&gt;<a class="code" href="classnusoap__xmlschema.html#a7ca81603f83d2e1342dc4a5ead6f9b7d">xdebug</a>(<span class="stringliteral">&quot;addElement &quot;</span> . $attrs[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l02042"></a>02042                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;elements[ $attrs[<span class="stringliteral">&#39;name&#39;</span>] ]));
<a name="l02043"></a>02043         }
<a name="l02044"></a>02044 }
<a name="l02045"></a>02045 
<a name="l02049"></a>02049 <span class="keyword">class </span><a class="code" href="classXMLSchema.html">XMLSchema</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__xmlschema.html">nusoap_xmlschema</a> {
<a name="l02050"></a>02050 }
<a name="l02051"></a>02051 
<a name="l02052"></a>02052 ?&gt;&lt;?php
<a name="l02053"></a>02053 
<a name="l02054"></a>02054 
<a name="l02055"></a>02055 
<a name="l02067"></a>02067 <span class="keyword">class </span><a class="code" href="classsoapval.html">soapval</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__base.html">nusoap_base</a> {
<a name="l02074"></a>02074         var <a class="code" href="classsoapval.html#ad58a0e6cbbf71ae25433c24effdabeaa">$name</a>;
<a name="l02081"></a>02081         var <a class="code" href="classsoapval.html#a6f3c2cbfcf4848a5d3ee4551a54f51bd">$type</a>;
<a name="l02088"></a>02088         var <a class="code" href="classsoapval.html#ae957d7e67aa7023c94f2a8cadbac20e3">$value</a>;
<a name="l02095"></a>02095         var <a class="code" href="classsoapval.html#a38f92c7ff3a45b87beba84d46d246620">$element_ns</a>;
<a name="l02102"></a>02102         var <a class="code" href="classsoapval.html#a55a131bff2addc9ef21748197f00a6e5">$type_ns</a>;
<a name="l02109"></a>02109         var <a class="code" href="classsoapval.html#ae53340b2c11b5d18ff4936afbeba670e">$attributes</a>;
<a name="l02110"></a>02110 
<a name="l02122"></a><a class="code" href="classsoapval.html#a352d76e14ff4f8f7eed2fbea06c50dbe">02122</a>         function <a class="code" href="classsoapval.html#a352d76e14ff4f8f7eed2fbea06c50dbe">soapval</a>(<a class="code" href="classsoapval.html#ad58a0e6cbbf71ae25433c24effdabeaa">$name</a>=<span class="stringliteral">&#39;soapval&#39;</span>,<a class="code" href="classsoapval.html#a6f3c2cbfcf4848a5d3ee4551a54f51bd">$type</a>=<span class="keyword">false</span>,<a class="code" href="classsoapval.html#ae957d7e67aa7023c94f2a8cadbac20e3">$value</a>=-1,<a class="code" href="classsoapval.html#a38f92c7ff3a45b87beba84d46d246620">$element_ns</a>=<span class="keyword">false</span>,<a class="code" href="classsoapval.html#a55a131bff2addc9ef21748197f00a6e5">$type_ns</a>=<span class="keyword">false</span>,<a class="code" href="classsoapval.html#ae53340b2c11b5d18ff4936afbeba670e">$attributes</a>=<span class="keyword">false</span>) {
<a name="l02123"></a>02123                 <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">parent::nusoap_base</a>();
<a name="l02124"></a>02124                 $this-&gt;name = <a class="code" href="classsoapval.html#ad58a0e6cbbf71ae25433c24effdabeaa">$name</a>;
<a name="l02125"></a>02125                 $this-&gt;type = <a class="code" href="classsoapval.html#a6f3c2cbfcf4848a5d3ee4551a54f51bd">$type</a>;
<a name="l02126"></a>02126                 $this-&gt;value = <a class="code" href="classsoapval.html#ae957d7e67aa7023c94f2a8cadbac20e3">$value</a>;
<a name="l02127"></a>02127                 $this-&gt;element_ns = <a class="code" href="classsoapval.html#a38f92c7ff3a45b87beba84d46d246620">$element_ns</a>;
<a name="l02128"></a>02128                 $this-&gt;type_ns = <a class="code" href="classsoapval.html#a55a131bff2addc9ef21748197f00a6e5">$type_ns</a>;
<a name="l02129"></a>02129                 $this-&gt;attributes = <a class="code" href="classsoapval.html#ae53340b2c11b5d18ff4936afbeba670e">$attributes</a>;
<a name="l02130"></a>02130     }
<a name="l02131"></a>02131 
<a name="l02139"></a><a class="code" href="classsoapval.html#a2c31a26a86b1b934c1ae33e49bab2a56">02139</a>         function <a class="code" href="classsoapval.html#a2c31a26a86b1b934c1ae33e49bab2a56">serialize</a>($use=<span class="stringliteral">&#39;encoded&#39;</span>) {
<a name="l02140"></a>02140                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($this-&gt;value, $this-&gt;name, $this-&gt;type, $this-&gt;element_ns, $this-&gt;type_ns, $this-&gt;attributes, $use, <span class="keyword">true</span>);
<a name="l02141"></a>02141     }
<a name="l02142"></a>02142 
<a name="l02149"></a><a class="code" href="classsoapval.html#ae17bba6b7695c86f4da44ecb951b0b6c">02149</a>         function <a class="code" href="classsoapval.html#ae17bba6b7695c86f4da44ecb951b0b6c">decode</a>(){
<a name="l02150"></a>02150                 <span class="keywordflow">return</span> $this-&gt;value;
<a name="l02151"></a>02151         }
<a name="l02152"></a>02152 }
<a name="l02153"></a>02153 
<a name="l02154"></a>02154 
<a name="l02155"></a>02155 
<a name="l02156"></a>02156 ?&gt;&lt;?php
<a name="l02157"></a>02157 
<a name="l02158"></a>02158 
<a name="l02159"></a>02159 
<a name="l02169"></a>02169 <span class="keyword">class </span><a class="code" href="classsoap__transport__http.html">soap_transport_http</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__base.html">nusoap_base</a> {
<a name="l02170"></a>02170 
<a name="l02171"></a>02171         var <a class="code" href="classsoap__transport__http.html#a1db3693e8c841c66bb108a58ec7e46ab">$url</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02172"></a>02172         var <a class="code" href="classsoap__transport__http.html#abde37eb2f32334cce09e6c9ccabae194">$uri</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02173"></a>02173         var <a class="code" href="classsoap__transport__http.html#a1292a0a8c3727ea46f871b3ff69b1f86">$digest_uri</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02174"></a>02174         var <a class="code" href="classsoap__transport__http.html#a3660fd67c307a64f648f3c78e5a3b7ba">$scheme</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02175"></a>02175         var <a class="code" href="classsoap__transport__http.html#acec0341648d153f961c364b0bd6ba9f1">$host</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02176"></a>02176         var <a class="code" href="classsoap__transport__http.html#ab7e24b910d550dbe3255a96e0bb81a62">$port</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02177"></a>02177         var <a class="code" href="classsoap__transport__http.html#aeb05779276186b2ab150a982794ceaa1">$path</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02178"></a>02178         var <a class="code" href="classsoap__transport__http.html#a6b0f7032b525413c3eed2e8a4bfff1e8">$request_method</a> = <span class="stringliteral">&#39;POST&#39;</span>;
<a name="l02179"></a>02179         var <a class="code" href="classsoap__transport__http.html#a820da135083db61952a403a795f9d6b8">$protocol_version</a> = <span class="stringliteral">&#39;1.0&#39;</span>;
<a name="l02180"></a>02180         var <a class="code" href="classsoap__transport__http.html#ab1eb34b8387b32637044afefcd7f13a4">$encoding</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02181"></a>02181         var <a class="code" href="classsoap__transport__http.html#a66f7f9642cfdea8ed1a37941859851e9">$outgoing_headers</a> = array();
<a name="l02182"></a>02182         var <a class="code" href="classsoap__transport__http.html#ae4864f9490748991b76af8b7fc8147f1">$incoming_headers</a> = array();
<a name="l02183"></a>02183         var <a class="code" href="classsoap__transport__http.html#add34a6adf1684ef575534f22e58a581a">$incoming_cookies</a> = array();
<a name="l02184"></a>02184         var <a class="code" href="classsoap__transport__http.html#a2da7347913dad69b6b2659fc8a4e1e33">$outgoing_payload</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02185"></a>02185         var <a class="code" href="classsoap__transport__http.html#a0f9f6f1f30771af6784ac3b3e4b63b6e">$incoming_payload</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02186"></a>02186         var <a class="code" href="classsoap__transport__http.html#a3e378cad6beb56017eb67259edcc1eb8">$response_status_line</a>;      <span class="comment">// HTTP response status line</span>
<a name="l02187"></a>02187         var <a class="code" href="classsoap__transport__http.html#af5f0564a4bb51a332f9ad91329f85061">$useSOAPAction</a> = <span class="keyword">true</span>;
<a name="l02188"></a>02188         var <a class="code" href="classsoap__transport__http.html#a6c46cc24f6c4b2b25c450a81ecbbe76b">$persistentConnection</a> = <span class="keyword">false</span>;
<a name="l02189"></a>02189         var <a class="code" href="classsoap__transport__http.html#ab3bcffa32ab4eb7e0c9596ea076b642d">$ch</a> = <span class="keyword">false</span>;        <span class="comment">// cURL handle</span>
<a name="l02190"></a>02190         var <a class="code" href="classsoap__transport__http.html#a10d34cee4d6ead2dca6b1ac44a6993ce">$ch_options</a> = array();      <span class="comment">// cURL custom options</span>
<a name="l02191"></a>02191         var <a class="code" href="classsoap__transport__http.html#a3fdb13a40d54fce3b498167687076f31">$use_curl</a> = <span class="keyword">false</span>;          <span class="comment">// force cURL use</span>
<a name="l02192"></a>02192         var <a class="code" href="classsoap__transport__http.html#acff66352dab55662db0480d84517110c">$proxy</a> = null;                      <span class="comment">// proxy information (associative array)</span>
<a name="l02193"></a>02193         var <a class="code" href="classsoap__transport__http.html#acad1ba6566255a1506ebccfdb396b796">$username</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02194"></a>02194         var <a class="code" href="classsoap__transport__http.html#a8a428524f4140c0a3d5c1b2702326a8f">$password</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02195"></a>02195         var <a class="code" href="classsoap__transport__http.html#acf17547c786f8c487379a30db35e9a9b">$authtype</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02196"></a>02196         var <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a> = array();
<a name="l02197"></a>02197         var <a class="code" href="classsoap__transport__http.html#a3c1dc688b2dfe987b0efd6ab76fa537f">$certRequest</a> = array();     <span class="comment">// keys must be cainfofile (optional), sslcertfile, sslkeyfile, passphrase, certpassword (optional), verifypeer (optional), verifyhost (optional)</span>
<a name="l02198"></a>02198                                                                 <span class="comment">// cainfofile: certificate authority file, e.g. &#39;$pathToPemFiles/rootca.pem&#39;</span>
<a name="l02199"></a>02199                                                                 <span class="comment">// sslcertfile: SSL certificate file, e.g. &#39;$pathToPemFiles/mycert.pem&#39;</span>
<a name="l02200"></a>02200                                                                 <span class="comment">// sslkeyfile: SSL key file, e.g. &#39;$pathToPemFiles/mykey.pem&#39;</span>
<a name="l02201"></a>02201                                                                 <span class="comment">// passphrase: SSL key password/passphrase</span>
<a name="l02202"></a>02202                                                                 <span class="comment">// certpassword: SSL certificate password</span>
<a name="l02203"></a>02203                                                                 <span class="comment">// verifypeer: default is 1</span>
<a name="l02204"></a>02204                                                                 <span class="comment">// verifyhost: default is 1</span>
<a name="l02205"></a>02205 
<a name="l02214"></a><a class="code" href="classsoap__transport__http.html#a08903b65f4fd6d0d27db71807765d7a3">02214</a>         function <a class="code" href="classsoap__transport__http.html#a08903b65f4fd6d0d27db71807765d7a3">soap_transport_http</a>(<a class="code" href="classsoap__transport__http.html#a1db3693e8c841c66bb108a58ec7e46ab">$url</a>, $curl_options = NULL, <a class="code" href="classsoap__transport__http.html#a3fdb13a40d54fce3b498167687076f31">$use_curl</a> = <span class="keyword">false</span>){
<a name="l02215"></a>02215                 <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">parent::nusoap_base</a>();
<a name="l02216"></a>02216                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;ctor url=$url use_curl=$use_curl curl_options:&quot;</span>);
<a name="l02217"></a>02217                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($curl_options));
<a name="l02218"></a>02218                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a623be0456bfdc6297c461387af8e610b">setURL</a>(<a class="code" href="classsoap__transport__http.html#a1db3693e8c841c66bb108a58ec7e46ab">$url</a>);
<a name="l02219"></a>02219                 <span class="keywordflow">if</span> (is_array($curl_options)) {
<a name="l02220"></a>02220                         $this-&gt;ch_options = $curl_options;
<a name="l02221"></a>02221                 }
<a name="l02222"></a>02222                 $this-&gt;use_curl = <a class="code" href="classsoap__transport__http.html#a3fdb13a40d54fce3b498167687076f31">$use_curl</a>;
<a name="l02223"></a>02223                 preg_match(<span class="stringliteral">&#39;/\$Revisio&#39;</span> . <span class="stringliteral">&#39;n: ([^ ]+)/&#39;</span>, $this-&gt;revision, $rev);
<a name="l02224"></a>02224                 $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;User-Agent&#39;</span>, $this-&gt;title.<span class="charliteral">&#39;/&#39;</span>.$this-&gt;version.<span class="stringliteral">&#39; (&#39;</span>.$rev[1].<span class="charliteral">&#39;)&#39;</span>);
<a name="l02225"></a>02225         }
<a name="l02226"></a>02226 
<a name="l02234"></a><a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">02234</a>         function <a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>($option, $value) {
<a name="l02235"></a>02235                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setCurlOption option=$option, value=&quot;</span>);
<a name="l02236"></a>02236                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($value));
<a name="l02237"></a>02237                 curl_setopt($this-&gt;ch, $option, $value);
<a name="l02238"></a>02238         }
<a name="l02239"></a>02239 
<a name="l02247"></a><a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">02247</a>         function <a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>($name, $value) {
<a name="l02248"></a>02248                 $this-&gt;outgoing_headers[$name] = $value;
<a name="l02249"></a>02249                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;set header $name: $value&quot;</span>);
<a name="l02250"></a>02250         }
<a name="l02251"></a>02251 
<a name="l02258"></a><a class="code" href="classsoap__transport__http.html#a87f153910b7ee6a8394b2b555de840fe">02258</a>         function <a class="code" href="classsoap__transport__http.html#a87f153910b7ee6a8394b2b555de840fe">unsetHeader</a>($name) {
<a name="l02259"></a>02259                 <span class="keywordflow">if</span> (isset($this-&gt;outgoing_headers[$name])) {
<a name="l02260"></a>02260                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;unset header $name&quot;</span>);
<a name="l02261"></a>02261                         unset($this-&gt;outgoing_headers[$name]);
<a name="l02262"></a>02262                 }
<a name="l02263"></a>02263         }
<a name="l02264"></a>02264 
<a name="l02271"></a><a class="code" href="classsoap__transport__http.html#a623be0456bfdc6297c461387af8e610b">02271</a>         function <a class="code" href="classsoap__transport__http.html#a623be0456bfdc6297c461387af8e610b">setURL</a>(<a class="code" href="classsoap__transport__http.html#a1db3693e8c841c66bb108a58ec7e46ab">$url</a>) {
<a name="l02272"></a>02272                 $this-&gt;url = <a class="code" href="classsoap__transport__http.html#a1db3693e8c841c66bb108a58ec7e46ab">$url</a>;
<a name="l02273"></a>02273 
<a name="l02274"></a>02274                 $u = parse_url(<a class="code" href="classsoap__transport__http.html#a1db3693e8c841c66bb108a58ec7e46ab">$url</a>);
<a name="l02275"></a>02275                 <span class="keywordflow">foreach</span>($u as $k =&gt; $v){
<a name="l02276"></a>02276                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;parsed URL $k = $v&quot;</span>);
<a name="l02277"></a>02277                         $this-&gt;$k = $v;
<a name="l02278"></a>02278                 }
<a name="l02279"></a>02279                 
<a name="l02280"></a>02280                 <span class="comment">// add any GET params to path</span>
<a name="l02281"></a>02281                 <span class="keywordflow">if</span>(isset($u[<span class="stringliteral">&#39;query&#39;</span>]) &amp;&amp; $u[<span class="stringliteral">&#39;query&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>){
<a name="l02282"></a>02282             $this-&gt;path .= <span class="charliteral">&#39;?&#39;</span> . $u[<span class="stringliteral">&#39;query&#39;</span>];
<a name="l02283"></a>02283                 }
<a name="l02284"></a>02284                 
<a name="l02285"></a>02285                 <span class="comment">// set default port</span>
<a name="l02286"></a>02286                 <span class="keywordflow">if</span>(!isset($u[<span class="stringliteral">&#39;port&#39;</span>])){
<a name="l02287"></a>02287                         <span class="keywordflow">if</span>($u[<span class="stringliteral">&#39;scheme&#39;</span>] == <span class="stringliteral">&#39;https&#39;</span>){
<a name="l02288"></a>02288                                 $this-&gt;port = 443;
<a name="l02289"></a>02289                         } <span class="keywordflow">else</span> {
<a name="l02290"></a>02290                                 $this-&gt;port = 80;
<a name="l02291"></a>02291                         }
<a name="l02292"></a>02292                 }
<a name="l02293"></a>02293                 
<a name="l02294"></a>02294                 $this-&gt;uri = $this-&gt;path;
<a name="l02295"></a>02295                 $this-&gt;digest_uri = $this-&gt;uri;
<a name="l02296"></a>02296                 
<a name="l02297"></a>02297                 <span class="comment">// build headers</span>
<a name="l02298"></a>02298                 <span class="keywordflow">if</span> (!isset($u[<span class="stringliteral">&#39;port&#39;</span>])) {
<a name="l02299"></a>02299                         $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Host&#39;</span>, $this-&gt;host);
<a name="l02300"></a>02300                 } <span class="keywordflow">else</span> {
<a name="l02301"></a>02301                         $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Host&#39;</span>, $this-&gt;host.<span class="charliteral">&#39;:&#39;</span>.$this-&gt;port);
<a name="l02302"></a>02302                 }
<a name="l02303"></a>02303 
<a name="l02304"></a>02304                 <span class="keywordflow">if</span> (isset($u[<span class="stringliteral">&#39;user&#39;</span>]) &amp;&amp; $u[<span class="stringliteral">&#39;user&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l02305"></a>02305                         $this-&gt;<a class="code" href="classsoap__transport__http.html#adfb41c21ed326e3883adcb6bda41f913">setCredentials</a>(urldecode($u[<span class="stringliteral">&#39;user&#39;</span>]), isset($u[<span class="stringliteral">&#39;pass&#39;</span>]) ? urldecode($u[<span class="stringliteral">&#39;pass&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>);
<a name="l02306"></a>02306                 }
<a name="l02307"></a>02307         }
<a name="l02308"></a>02308 
<a name="l02315"></a><a class="code" href="classsoap__transport__http.html#ac2063d8e4798df30da3ea97e444e1410">02315</a>         function <a class="code" href="classsoap__transport__http.html#ac2063d8e4798df30da3ea97e444e1410">io_method</a>() {
<a name="l02316"></a>02316                 <span class="keywordflow">if</span> ($this-&gt;use_curl || ($this-&gt;scheme == <span class="stringliteral">&#39;https&#39;</span>) || ($this-&gt;scheme == <span class="stringliteral">&#39;http&#39;</span> &amp;&amp; $this-&gt;authtype == <span class="stringliteral">&#39;ntlm&#39;</span>) || ($this-&gt;scheme == <span class="stringliteral">&#39;http&#39;</span> &amp;&amp; is_array($this-&gt;proxy) &amp;&amp; $this-&gt;proxy[<span class="stringliteral">&#39;authtype&#39;</span>] == <span class="stringliteral">&#39;ntlm&#39;</span>))
<a name="l02317"></a>02317                         <span class="keywordflow">return</span> <span class="stringliteral">&#39;curl&#39;</span>;
<a name="l02318"></a>02318                 <span class="keywordflow">if</span> (($this-&gt;scheme == <span class="stringliteral">&#39;http&#39;</span> || $this-&gt;scheme == <span class="stringliteral">&#39;ssl&#39;</span>) &amp;&amp; $this-&gt;authtype != <span class="stringliteral">&#39;ntlm&#39;</span> &amp;&amp; (!is_array($this-&gt;proxy) || $this-&gt;proxy[<span class="stringliteral">&#39;authtype&#39;</span>] != <span class="stringliteral">&#39;ntlm&#39;</span>))
<a name="l02319"></a>02319                         <span class="keywordflow">return</span> <span class="stringliteral">&#39;socket&#39;</span>;
<a name="l02320"></a>02320                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;unknown&#39;</span>;
<a name="l02321"></a>02321         }
<a name="l02322"></a>02322 
<a name="l02331"></a><a class="code" href="classsoap__transport__http.html#abc562cf4bce0f4c8eeeb58db459486a8">02331</a>         function <a class="code" href="classsoap__transport__http.html#abc562cf4bce0f4c8eeeb58db459486a8">connect</a>($connection_timeout=0,$response_timeout=30){
<a name="l02332"></a>02332                 <span class="comment">// For PHP 4.3 with OpenSSL, change https scheme to ssl, then treat like</span>
<a name="l02333"></a>02333                 <span class="comment">// &quot;regular&quot; socket.</span>
<a name="l02334"></a>02334                 <span class="comment">// TODO: disabled for now because OpenSSL must be *compiled* in (not just</span>
<a name="l02335"></a>02335                 <span class="comment">//       loaded), and until PHP5 stream_get_wrappers is not available.</span>
<a name="l02336"></a>02336 <span class="comment">//              if ($this-&gt;scheme == &#39;https&#39;) {</span>
<a name="l02337"></a>02337 <span class="comment">//                      if (version_compare(phpversion(), &#39;4.3.0&#39;) &gt;= 0) {</span>
<a name="l02338"></a>02338 <span class="comment">//                              if (extension_loaded(&#39;openssl&#39;)) {</span>
<a name="l02339"></a>02339 <span class="comment">//                                      $this-&gt;scheme = &#39;ssl&#39;;</span>
<a name="l02340"></a>02340 <span class="comment">//                                      $this-&gt;debug(&#39;Using SSL over OpenSSL&#39;);</span>
<a name="l02341"></a>02341 <span class="comment">//                              }</span>
<a name="l02342"></a>02342 <span class="comment">//                      }</span>
<a name="l02343"></a>02343 <span class="comment">//              }</span>
<a name="l02344"></a>02344                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;connect connection_timeout $connection_timeout, response_timeout $response_timeout, scheme $this-&gt;scheme, host $this-&gt;host, port $this-&gt;port&quot;</span>);
<a name="l02345"></a>02345           <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classsoap__transport__http.html#ac2063d8e4798df30da3ea97e444e1410">io_method</a>() == <span class="stringliteral">&#39;socket&#39;</span>) {
<a name="l02346"></a>02346                 <span class="keywordflow">if</span> (!is_array($this-&gt;proxy)) {
<a name="l02347"></a>02347                         <a class="code" href="classsoap__transport__http.html#acec0341648d153f961c364b0bd6ba9f1">$host</a> = $this-&gt;host;
<a name="l02348"></a>02348                         <a class="code" href="classsoap__transport__http.html#ab7e24b910d550dbe3255a96e0bb81a62">$port</a> = $this-&gt;port;
<a name="l02349"></a>02349                 } <span class="keywordflow">else</span> {
<a name="l02350"></a>02350                         <a class="code" href="classsoap__transport__http.html#acec0341648d153f961c364b0bd6ba9f1">$host</a> = $this-&gt;proxy[<span class="stringliteral">&#39;host&#39;</span>];
<a name="l02351"></a>02351                         <a class="code" href="classsoap__transport__http.html#ab7e24b910d550dbe3255a96e0bb81a62">$port</a> = $this-&gt;proxy[<span class="stringliteral">&#39;port&#39;</span>];
<a name="l02352"></a>02352                 }
<a name="l02353"></a>02353 
<a name="l02354"></a>02354                 <span class="comment">// use persistent connection</span>
<a name="l02355"></a>02355                 <span class="keywordflow">if</span>($this-&gt;persistentConnection &amp;&amp; isset($this-&gt;fp) &amp;&amp; is_resource($this-&gt;fp)){
<a name="l02356"></a>02356                         <span class="keywordflow">if</span> (!feof($this-&gt;fp)) {
<a name="l02357"></a>02357                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Re-use persistent connection&#39;</span>);
<a name="l02358"></a>02358                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02359"></a>02359                         }
<a name="l02360"></a>02360                         fclose($this-&gt;fp);
<a name="l02361"></a>02361                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Closed persistent connection at EOF&#39;</span>);
<a name="l02362"></a>02362                 }
<a name="l02363"></a>02363 
<a name="l02364"></a>02364                 <span class="comment">// munge host if using OpenSSL</span>
<a name="l02365"></a>02365                 <span class="keywordflow">if</span> ($this-&gt;scheme == <span class="stringliteral">&#39;ssl&#39;</span>) {
<a name="l02366"></a>02366                         <a class="code" href="classsoap__transport__http.html#acec0341648d153f961c364b0bd6ba9f1">$host</a> = <span class="stringliteral">&#39;ssl://&#39;</span> . <a class="code" href="classsoap__transport__http.html#acec0341648d153f961c364b0bd6ba9f1">$host</a>;
<a name="l02367"></a>02367                 }
<a name="l02368"></a>02368                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling fsockopen with host &#39;</span> . <a class="code" href="classsoap__transport__http.html#acec0341648d153f961c364b0bd6ba9f1">$host</a> . <span class="stringliteral">&#39; connection_timeout &#39;</span> . $connection_timeout);
<a name="l02369"></a>02369 
<a name="l02370"></a>02370                 <span class="comment">// open socket</span>
<a name="l02371"></a>02371                 <span class="keywordflow">if</span>($connection_timeout &gt; 0){
<a name="l02372"></a>02372                         $this-&gt;fp = @fsockopen( <a class="code" href="classsoap__transport__http.html#acec0341648d153f961c364b0bd6ba9f1">$host</a>, $this-&gt;port, $this-&gt;errno, $this-&gt;error_str, $connection_timeout);
<a name="l02373"></a>02373                 } <span class="keywordflow">else</span> {
<a name="l02374"></a>02374                         $this-&gt;fp = @fsockopen( <a class="code" href="classsoap__transport__http.html#acec0341648d153f961c364b0bd6ba9f1">$host</a>, $this-&gt;port, $this-&gt;errno, $this-&gt;error_str);
<a name="l02375"></a>02375                 }
<a name="l02376"></a>02376                 
<a name="l02377"></a>02377                 <span class="comment">// test pointer</span>
<a name="l02378"></a>02378                 <span class="keywordflow">if</span>(!$this-&gt;fp) {
<a name="l02379"></a>02379                         $msg = <span class="stringliteral">&#39;Couldn\&#39;t open socket connection to server &#39;</span> . $this-&gt;url;
<a name="l02380"></a>02380                         <span class="keywordflow">if</span> ($this-&gt;errno) {
<a name="l02381"></a>02381                                 $msg .= <span class="stringliteral">&#39;, Error (&#39;</span>.$this-&gt;errno.<span class="stringliteral">&#39;): &#39;</span>.$this-&gt;error_str;
<a name="l02382"></a>02382                         } <span class="keywordflow">else</span> {
<a name="l02383"></a>02383                                 $msg .= <span class="stringliteral">&#39; prior to connect().  This is often a problem looking up the host name.&#39;</span>;
<a name="l02384"></a>02384                         }
<a name="l02385"></a>02385                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($msg);
<a name="l02386"></a>02386                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($msg);
<a name="l02387"></a>02387                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02388"></a>02388                 }
<a name="l02389"></a>02389                 
<a name="l02390"></a>02390                 <span class="comment">// set response timeout</span>
<a name="l02391"></a>02391                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set response timeout to &#39;</span> . $response_timeout);
<a name="l02392"></a>02392                 socket_set_timeout( $this-&gt;fp, $response_timeout);
<a name="l02393"></a>02393 
<a name="l02394"></a>02394                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;socket connected&#39;</span>);
<a name="l02395"></a>02395                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02396"></a>02396           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classsoap__transport__http.html#ac2063d8e4798df30da3ea97e444e1410">io_method</a>() == <span class="stringliteral">&#39;curl&#39;</span>) {
<a name="l02397"></a>02397                 <span class="keywordflow">if</span> (!extension_loaded(<span class="stringliteral">&#39;curl&#39;</span>)) {
<a name="l02398"></a>02398 <span class="comment">//                      $this-&gt;setError(&#39;cURL Extension, or OpenSSL extension w/ PHP version &gt;= 4.3 is required for HTTPS&#39;);</span>
<a name="l02399"></a>02399                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;The PHP cURL Extension is required for HTTPS or NLTM.  You will need to re-build or update your PHP to include cURL or change php.ini to load the PHP cURL extension.&#39;</span>);
<a name="l02400"></a>02400                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02401"></a>02401                 }
<a name="l02402"></a>02402                 <span class="comment">// Avoid warnings when PHP does not have these options</span>
<a name="l02403"></a>02403                 <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;CURLOPT_CONNECTIONTIMEOUT&#39;</span>))
<a name="l02404"></a>02404                         $CURLOPT_CONNECTIONTIMEOUT = CURLOPT_CONNECTIONTIMEOUT;
<a name="l02405"></a>02405                 <span class="keywordflow">else</span>
<a name="l02406"></a>02406                         $CURLOPT_CONNECTIONTIMEOUT = 78;
<a name="l02407"></a>02407                 <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;CURLOPT_HTTPAUTH&#39;</span>))
<a name="l02408"></a>02408                         $CURLOPT_HTTPAUTH = CURLOPT_HTTPAUTH;
<a name="l02409"></a>02409                 <span class="keywordflow">else</span>
<a name="l02410"></a>02410                         $CURLOPT_HTTPAUTH = 107;
<a name="l02411"></a>02411                 <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;CURLOPT_PROXYAUTH&#39;</span>))
<a name="l02412"></a>02412                         $CURLOPT_PROXYAUTH = CURLOPT_PROXYAUTH;
<a name="l02413"></a>02413                 <span class="keywordflow">else</span>
<a name="l02414"></a>02414                         $CURLOPT_PROXYAUTH = 111;
<a name="l02415"></a>02415                 <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;CURLAUTH_BASIC&#39;</span>))
<a name="l02416"></a>02416                         $CURLAUTH_BASIC = CURLAUTH_BASIC;
<a name="l02417"></a>02417                 <span class="keywordflow">else</span>
<a name="l02418"></a>02418                         $CURLAUTH_BASIC = 1;
<a name="l02419"></a>02419                 <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;CURLAUTH_DIGEST&#39;</span>))
<a name="l02420"></a>02420                         $CURLAUTH_DIGEST = CURLAUTH_DIGEST;
<a name="l02421"></a>02421                 <span class="keywordflow">else</span>
<a name="l02422"></a>02422                         $CURLAUTH_DIGEST = 2;
<a name="l02423"></a>02423                 <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;CURLAUTH_NTLM&#39;</span>))
<a name="l02424"></a>02424                         $CURLAUTH_NTLM = CURLAUTH_NTLM;
<a name="l02425"></a>02425                 <span class="keywordflow">else</span>
<a name="l02426"></a>02426                         $CURLAUTH_NTLM = 8;
<a name="l02427"></a>02427 
<a name="l02428"></a>02428                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;connect using cURL&#39;</span>);
<a name="l02429"></a>02429                 <span class="comment">// init CURL</span>
<a name="l02430"></a>02430                 $this-&gt;ch = curl_init();
<a name="l02431"></a>02431                 <span class="comment">// set url</span>
<a name="l02432"></a>02432                 $hostURL = ($this-&gt;port != <span class="stringliteral">&#39;&#39;</span>) ? <span class="stringliteral">&quot;$this-&gt;scheme://$this-&gt;host:$this-&gt;port&quot;</span> : <span class="stringliteral">&quot;$this-&gt;scheme://$this-&gt;host&quot;</span>;
<a name="l02433"></a>02433                 <span class="comment">// add path</span>
<a name="l02434"></a>02434                 $hostURL .= $this-&gt;path;
<a name="l02435"></a>02435                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_URL, $hostURL);
<a name="l02436"></a>02436                 <span class="comment">// follow location headers (re-directs)</span>
<a name="l02437"></a>02437                 <span class="keywordflow">if</span> (ini_get(<span class="stringliteral">&#39;safe_mode&#39;</span>) || ini_get(<span class="stringliteral">&#39;open_basedir&#39;</span>)) {
<a name="l02438"></a>02438                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;safe_mode or open_basedir set, so do not set CURLOPT_FOLLOWLOCATION&#39;</span>);
<a name="l02439"></a>02439                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;safe_mode = &#39;</span>);
<a name="l02440"></a>02440                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(ini_get(<span class="stringliteral">&#39;safe_mode&#39;</span>)));
<a name="l02441"></a>02441                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;open_basedir = &#39;</span>);
<a name="l02442"></a>02442                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(ini_get(<span class="stringliteral">&#39;open_basedir&#39;</span>)));
<a name="l02443"></a>02443                 } <span class="keywordflow">else</span> {
<a name="l02444"></a>02444                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_FOLLOWLOCATION, 1);
<a name="l02445"></a>02445                 }
<a name="l02446"></a>02446                 <span class="comment">// ask for headers in the response output</span>
<a name="l02447"></a>02447                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_HEADER, 1);
<a name="l02448"></a>02448                 <span class="comment">// ask for the response output as the return value</span>
<a name="l02449"></a>02449                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_RETURNTRANSFER, 1);
<a name="l02450"></a>02450                 <span class="comment">// encode</span>
<a name="l02451"></a>02451                 <span class="comment">// We manage this ourselves through headers and encoding</span>
<a name="l02452"></a>02452 <span class="comment">//              if(function_exists(&#39;gzuncompress&#39;)){</span>
<a name="l02453"></a>02453 <span class="comment">//                      $this-&gt;setCurlOption(CURLOPT_ENCODING, &#39;deflate&#39;);</span>
<a name="l02454"></a>02454 <span class="comment">//              }</span>
<a name="l02455"></a>02455                 <span class="comment">// persistent connection</span>
<a name="l02456"></a>02456                 <span class="keywordflow">if</span> ($this-&gt;persistentConnection) {
<a name="l02457"></a>02457                         <span class="comment">// I believe the following comment is now bogus, having applied to</span>
<a name="l02458"></a>02458                         <span class="comment">// the code when it used CURLOPT_CUSTOMREQUEST to send the request.</span>
<a name="l02459"></a>02459                         <span class="comment">// The way we send data, we cannot use persistent connections, since</span>
<a name="l02460"></a>02460                         <span class="comment">// there will be some &quot;junk&quot; at the end of our request.</span>
<a name="l02461"></a>02461                         <span class="comment">//$this-&gt;setCurlOption(CURL_HTTP_VERSION_1_1, true);</span>
<a name="l02462"></a>02462                         $this-&gt;persistentConnection = <span class="keyword">false</span>;
<a name="l02463"></a>02463                         $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Connection&#39;</span>, <span class="stringliteral">&#39;close&#39;</span>);
<a name="l02464"></a>02464                 }
<a name="l02465"></a>02465                 <span class="comment">// set timeouts</span>
<a name="l02466"></a>02466                 <span class="keywordflow">if</span> ($connection_timeout != 0) {
<a name="l02467"></a>02467                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>($CURLOPT_CONNECTIONTIMEOUT, $connection_timeout);
<a name="l02468"></a>02468                 }
<a name="l02469"></a>02469                 <span class="keywordflow">if</span> ($response_timeout != 0) {
<a name="l02470"></a>02470                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_TIMEOUT, $response_timeout);
<a name="l02471"></a>02471                 }
<a name="l02472"></a>02472 
<a name="l02473"></a>02473                 <span class="keywordflow">if</span> ($this-&gt;scheme == <span class="stringliteral">&#39;https&#39;</span>) {
<a name="l02474"></a>02474                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL SSL verify options&#39;</span>);
<a name="l02475"></a>02475                         <span class="comment">// recent versions of cURL turn on peer/host checking by default,</span>
<a name="l02476"></a>02476                         <span class="comment">// while PHP binaries are not compiled with a default location for the</span>
<a name="l02477"></a>02477                         <span class="comment">// CA cert bundle, so disable peer/host checking.</span>
<a name="l02478"></a>02478                         <span class="comment">//$this-&gt;setCurlOption(CURLOPT_CAINFO, &#39;f:\php-4.3.2-win32\extensions\curl-ca-bundle.crt&#39;);             </span>
<a name="l02479"></a>02479                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSL_VERIFYPEER, 0);
<a name="l02480"></a>02480                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSL_VERIFYHOST, 0);
<a name="l02481"></a>02481         
<a name="l02482"></a>02482                         <span class="comment">// support client certificates (thanks Tobias Boes, Doug Anarino, Eryan Ariobowo)</span>
<a name="l02483"></a>02483                         <span class="keywordflow">if</span> ($this-&gt;authtype == <span class="stringliteral">&#39;certificate&#39;</span>) {
<a name="l02484"></a>02484                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL certificate options&#39;</span>);
<a name="l02485"></a>02485                                 <span class="keywordflow">if</span> (isset($this-&gt;certRequest[<span class="stringliteral">&#39;cainfofile&#39;</span>])) {
<a name="l02486"></a>02486                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_CAINFO, $this-&gt;certRequest[<span class="stringliteral">&#39;cainfofile&#39;</span>]);
<a name="l02487"></a>02487                                 }
<a name="l02488"></a>02488                                 <span class="keywordflow">if</span> (isset($this-&gt;certRequest[<span class="stringliteral">&#39;verifypeer&#39;</span>])) {
<a name="l02489"></a>02489                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSL_VERIFYPEER, $this-&gt;certRequest[<span class="stringliteral">&#39;verifypeer&#39;</span>]);
<a name="l02490"></a>02490                                 } <span class="keywordflow">else</span> {
<a name="l02491"></a>02491                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSL_VERIFYPEER, 1);
<a name="l02492"></a>02492                                 }
<a name="l02493"></a>02493                                 <span class="keywordflow">if</span> (isset($this-&gt;certRequest[<span class="stringliteral">&#39;verifyhost&#39;</span>])) {
<a name="l02494"></a>02494                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSL_VERIFYHOST, $this-&gt;certRequest[<span class="stringliteral">&#39;verifyhost&#39;</span>]);
<a name="l02495"></a>02495                                 } <span class="keywordflow">else</span> {
<a name="l02496"></a>02496                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSL_VERIFYHOST, 1);
<a name="l02497"></a>02497                                 }
<a name="l02498"></a>02498                                 <span class="keywordflow">if</span> (isset($this-&gt;certRequest[<span class="stringliteral">&#39;sslcertfile&#39;</span>])) {
<a name="l02499"></a>02499                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSLCERT, $this-&gt;certRequest[<span class="stringliteral">&#39;sslcertfile&#39;</span>]);
<a name="l02500"></a>02500                                 }
<a name="l02501"></a>02501                                 <span class="keywordflow">if</span> (isset($this-&gt;certRequest[<span class="stringliteral">&#39;sslkeyfile&#39;</span>])) {
<a name="l02502"></a>02502                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSLKEY, $this-&gt;certRequest[<span class="stringliteral">&#39;sslkeyfile&#39;</span>]);
<a name="l02503"></a>02503                                 }
<a name="l02504"></a>02504                                 <span class="keywordflow">if</span> (isset($this-&gt;certRequest[<span class="stringliteral">&#39;passphrase&#39;</span>])) {
<a name="l02505"></a>02505                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSLKEYPASSWD, $this-&gt;certRequest[<span class="stringliteral">&#39;passphrase&#39;</span>]);
<a name="l02506"></a>02506                                 }
<a name="l02507"></a>02507                                 <span class="keywordflow">if</span> (isset($this-&gt;certRequest[<span class="stringliteral">&#39;certpassword&#39;</span>])) {
<a name="l02508"></a>02508                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_SSLCERTPASSWD, $this-&gt;certRequest[<span class="stringliteral">&#39;certpassword&#39;</span>]);
<a name="l02509"></a>02509                                 }
<a name="l02510"></a>02510                         }
<a name="l02511"></a>02511                 }
<a name="l02512"></a>02512                 <span class="keywordflow">if</span> ($this-&gt;authtype &amp;&amp; ($this-&gt;authtype != <span class="stringliteral">&#39;certificate&#39;</span>)) {
<a name="l02513"></a>02513                         <span class="keywordflow">if</span> ($this-&gt;username) {
<a name="l02514"></a>02514                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL username/password&#39;</span>);
<a name="l02515"></a>02515                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_USERPWD, <span class="stringliteral">&quot;$this-&gt;username:$this-&gt;password&quot;</span>);
<a name="l02516"></a>02516                         }
<a name="l02517"></a>02517                         <span class="keywordflow">if</span> ($this-&gt;authtype == <span class="stringliteral">&#39;basic&#39;</span>) {
<a name="l02518"></a>02518                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL for Basic authentication&#39;</span>);
<a name="l02519"></a>02519                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>($CURLOPT_HTTPAUTH, $CURLAUTH_BASIC);
<a name="l02520"></a>02520                         }
<a name="l02521"></a>02521                         <span class="keywordflow">if</span> ($this-&gt;authtype == <span class="stringliteral">&#39;digest&#39;</span>) {
<a name="l02522"></a>02522                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL for digest authentication&#39;</span>);
<a name="l02523"></a>02523                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>($CURLOPT_HTTPAUTH, $CURLAUTH_DIGEST);
<a name="l02524"></a>02524                         }
<a name="l02525"></a>02525                         <span class="keywordflow">if</span> ($this-&gt;authtype == <span class="stringliteral">&#39;ntlm&#39;</span>) {
<a name="l02526"></a>02526                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL for NTLM authentication&#39;</span>);
<a name="l02527"></a>02527                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>($CURLOPT_HTTPAUTH, $CURLAUTH_NTLM);
<a name="l02528"></a>02528                         }
<a name="l02529"></a>02529                 }
<a name="l02530"></a>02530                 <span class="keywordflow">if</span> (is_array($this-&gt;proxy)) {
<a name="l02531"></a>02531                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL proxy options&#39;</span>);
<a name="l02532"></a>02532                         <span class="keywordflow">if</span> ($this-&gt;proxy[<span class="stringliteral">&#39;port&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l02533"></a>02533                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_PROXY, $this-&gt;proxy[<span class="stringliteral">&#39;host&#39;</span>].<span class="charliteral">&#39;:&#39;</span>.$this-&gt;proxy[<span class="stringliteral">&#39;port&#39;</span>]);
<a name="l02534"></a>02534                         } <span class="keywordflow">else</span> {
<a name="l02535"></a>02535                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_PROXY, $this-&gt;proxy[<span class="stringliteral">&#39;host&#39;</span>]);
<a name="l02536"></a>02536                         }
<a name="l02537"></a>02537                         <span class="keywordflow">if</span> ($this-&gt;proxy[<span class="stringliteral">&#39;username&#39;</span>] || $this-&gt;proxy[<span class="stringliteral">&#39;password&#39;</span>]) {
<a name="l02538"></a>02538                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL proxy authentication options&#39;</span>);
<a name="l02539"></a>02539                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_PROXYUSERPWD, $this-&gt;proxy[<span class="stringliteral">&#39;username&#39;</span>].<span class="charliteral">&#39;:&#39;</span>.$this-&gt;proxy[<span class="stringliteral">&#39;password&#39;</span>]);
<a name="l02540"></a>02540                                 <span class="keywordflow">if</span> ($this-&gt;proxy[<span class="stringliteral">&#39;authtype&#39;</span>] == <span class="stringliteral">&#39;basic&#39;</span>) {
<a name="l02541"></a>02541                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>($CURLOPT_PROXYAUTH, $CURLAUTH_BASIC);
<a name="l02542"></a>02542                                 }
<a name="l02543"></a>02543                                 <span class="keywordflow">if</span> ($this-&gt;proxy[<span class="stringliteral">&#39;authtype&#39;</span>] == <span class="stringliteral">&#39;ntlm&#39;</span>) {
<a name="l02544"></a>02544                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>($CURLOPT_PROXYAUTH, $CURLAUTH_NTLM);
<a name="l02545"></a>02545                                 }
<a name="l02546"></a>02546                         }
<a name="l02547"></a>02547                 }
<a name="l02548"></a>02548                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;cURL connection set up&#39;</span>);
<a name="l02549"></a>02549                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02550"></a>02550           } <span class="keywordflow">else</span> {
<a name="l02551"></a>02551                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Unknown scheme &#39;</span> . $this-&gt;scheme);
<a name="l02552"></a>02552                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Unknown scheme &#39;</span> . $this-&gt;scheme);
<a name="l02553"></a>02553                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02554"></a>02554           }
<a name="l02555"></a>02555         }
<a name="l02556"></a>02556 
<a name="l02567"></a><a class="code" href="classsoap__transport__http.html#aa94c4dba22fa613381dc2a2c5cb3e4c2">02567</a>         function <a class="code" href="classsoap__transport__http.html#aa94c4dba22fa613381dc2a2c5cb3e4c2">send</a>($data, $timeout=0, $response_timeout=30, $cookies=NULL) {
<a name="l02568"></a>02568                 
<a name="l02569"></a>02569                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;entered send() with data of length: &#39;</span>.strlen($data));
<a name="l02570"></a>02570 
<a name="l02571"></a>02571                 $this-&gt;tryagain = <span class="keyword">true</span>;
<a name="l02572"></a>02572                 $tries = 0;
<a name="l02573"></a>02573                 <span class="keywordflow">while</span> ($this-&gt;tryagain) {
<a name="l02574"></a>02574                         $this-&gt;tryagain = <span class="keyword">false</span>;
<a name="l02575"></a>02575                         <span class="keywordflow">if</span> ($tries++ &lt; 2) {
<a name="l02576"></a>02576                                 <span class="comment">// make connnection</span>
<a name="l02577"></a>02577                                 <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classsoap__transport__http.html#abc562cf4bce0f4c8eeeb58db459486a8">connect</a>($timeout, $response_timeout)){
<a name="l02578"></a>02578                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02579"></a>02579                                 }
<a name="l02580"></a>02580                                 
<a name="l02581"></a>02581                                 <span class="comment">// send request</span>
<a name="l02582"></a>02582                                 <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classsoap__transport__http.html#ac2eb2f606519a34022d6eef540e7c9ca">sendRequest</a>($data, $cookies)){
<a name="l02583"></a>02583                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02584"></a>02584                                 }
<a name="l02585"></a>02585                                 
<a name="l02586"></a>02586                                 <span class="comment">// get response</span>
<a name="l02587"></a>02587                                 $respdata = $this-&gt;<a class="code" href="classsoap__transport__http.html#a70235a810b4bdb1ee7875fb1c6ba9576">getResponse</a>();
<a name="l02588"></a>02588                         } <span class="keywordflow">else</span> {
<a name="l02589"></a>02589                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;Too many tries to get an OK response ($this-&gt;response_status_line)&quot;</span>);
<a name="l02590"></a>02590                         }
<a name="l02591"></a>02591                 }               
<a name="l02592"></a>02592                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;end of send()&#39;</span>);
<a name="l02593"></a>02593                 <span class="keywordflow">return</span> $respdata;
<a name="l02594"></a>02594         }
<a name="l02595"></a>02595 
<a name="l02596"></a>02596 
<a name="l02608"></a><a class="code" href="classsoap__transport__http.html#a86475d97d7e6c42e3c0c491d505198a8">02608</a>         function <a class="code" href="classsoap__transport__http.html#a86475d97d7e6c42e3c0c491d505198a8">sendHTTPS</a>($data, $timeout=0, $response_timeout=30, $cookies) {
<a name="l02609"></a>02609                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classsoap__transport__http.html#aa94c4dba22fa613381dc2a2c5cb3e4c2">send</a>($data, $timeout, $response_timeout, $cookies);
<a name="l02610"></a>02610         }
<a name="l02611"></a>02611         
<a name="l02622"></a><a class="code" href="classsoap__transport__http.html#adfb41c21ed326e3883adcb6bda41f913">02622</a>         function <a class="code" href="classsoap__transport__http.html#adfb41c21ed326e3883adcb6bda41f913">setCredentials</a>(<a class="code" href="classsoap__transport__http.html#acad1ba6566255a1506ebccfdb396b796">$username</a>, <a class="code" href="classsoap__transport__http.html#a8a428524f4140c0a3d5c1b2702326a8f">$password</a>, <a class="code" href="classsoap__transport__http.html#acf17547c786f8c487379a30db35e9a9b">$authtype</a> = <span class="stringliteral">&#39;basic&#39;</span>, <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a> = array(), <a class="code" href="classsoap__transport__http.html#a3c1dc688b2dfe987b0efd6ab76fa537f">$certRequest</a> = array()) {
<a name="l02623"></a>02623                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setCredentials username=$username authtype=$authtype digestRequest=&quot;</span>);
<a name="l02624"></a>02624                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>));
<a name="l02625"></a>02625                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;certRequest=&quot;</span>);
<a name="l02626"></a>02626                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classsoap__transport__http.html#a3c1dc688b2dfe987b0efd6ab76fa537f">$certRequest</a>));
<a name="l02627"></a>02627                 <span class="comment">// cf. RFC 2617</span>
<a name="l02628"></a>02628                 <span class="keywordflow">if</span> (<a class="code" href="classsoap__transport__http.html#acf17547c786f8c487379a30db35e9a9b">$authtype</a> == <span class="stringliteral">&#39;basic&#39;</span>) {
<a name="l02629"></a>02629                         $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Authorization&#39;</span>, <span class="stringliteral">&#39;Basic &#39;</span>.base64_encode(str_replace(<span class="charliteral">&#39;:&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="classsoap__transport__http.html#acad1ba6566255a1506ebccfdb396b796">$username</a>).<span class="charliteral">&#39;:&#39;</span>.<a class="code" href="classsoap__transport__http.html#a8a428524f4140c0a3d5c1b2702326a8f">$password</a>));
<a name="l02630"></a>02630                 } elseif (<a class="code" href="classsoap__transport__http.html#acf17547c786f8c487379a30db35e9a9b">$authtype</a> == <span class="stringliteral">&#39;digest&#39;</span>) {
<a name="l02631"></a>02631                         <span class="keywordflow">if</span> (isset(<a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;nonce&#39;</span>])) {
<a name="l02632"></a>02632                                 <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;nc&#39;</span>] = isset(<a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;nc&#39;</span>]) ? <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;nc&#39;</span>]++ : 1;
<a name="l02633"></a>02633                                 
<a name="l02634"></a>02634                                 <span class="comment">// calculate the Digest hashes (calculate code based on digest implementation found at: http://www.rassoc.com/gregr/weblog/stories/2002/07/09/webServicesSecurityHttpDigestAuthenticationWithoutActiveDirectory.html)</span>
<a name="l02635"></a>02635         
<a name="l02636"></a>02636                                 <span class="comment">// A1 = unq(username-value) &quot;:&quot; unq(realm-value) &quot;:&quot; passwd</span>
<a name="l02637"></a>02637                                 $A1 = <a class="code" href="classsoap__transport__http.html#acad1ba6566255a1506ebccfdb396b796">$username</a>. <span class="charliteral">&#39;:&#39;</span> . (isset(<a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;realm&#39;</span>]) ? <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;realm&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>) . <span class="charliteral">&#39;:&#39;</span> . <a class="code" href="classsoap__transport__http.html#a8a428524f4140c0a3d5c1b2702326a8f">$password</a>;
<a name="l02638"></a>02638         
<a name="l02639"></a>02639                                 <span class="comment">// H(A1) = MD5(A1)</span>
<a name="l02640"></a>02640                                 $HA1 = md5($A1);
<a name="l02641"></a>02641         
<a name="l02642"></a>02642                                 <span class="comment">// A2 = Method &quot;:&quot; digest-uri-value</span>
<a name="l02643"></a>02643                                 $A2 = $this-&gt;request_method . <span class="charliteral">&#39;:&#39;</span> . $this-&gt;digest_uri;
<a name="l02644"></a>02644         
<a name="l02645"></a>02645                                 <span class="comment">// H(A2)</span>
<a name="l02646"></a>02646                                 $HA2 =  md5($A2);
<a name="l02647"></a>02647         
<a name="l02648"></a>02648                                 <span class="comment">// KD(secret, data) = H(concat(secret, &quot;:&quot;, data))</span>
<a name="l02649"></a>02649                                 <span class="comment">// if qop == auth:</span>
<a name="l02650"></a>02650                                 <span class="comment">// request-digest  = &lt;&quot;&gt; &lt; KD ( H(A1),     unq(nonce-value)</span>
<a name="l02651"></a>02651                                 <span class="comment">//                              &quot;:&quot; nc-value</span>
<a name="l02652"></a>02652                                 <span class="comment">//                              &quot;:&quot; unq(cnonce-value)</span>
<a name="l02653"></a>02653                                 <span class="comment">//                              &quot;:&quot; unq(qop-value)</span>
<a name="l02654"></a>02654                                 <span class="comment">//                              &quot;:&quot; H(A2)</span>
<a name="l02655"></a>02655                                 <span class="comment">//                            ) &lt;&quot;&gt;</span>
<a name="l02656"></a>02656                                 <span class="comment">// if qop is missing,</span>
<a name="l02657"></a>02657                                 <span class="comment">// request-digest  = &lt;&quot;&gt; &lt; KD ( H(A1), unq(nonce-value) &quot;:&quot; H(A2) ) &gt; &lt;&quot;&gt;</span>
<a name="l02658"></a>02658         
<a name="l02659"></a>02659                                 $unhashedDigest = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02660"></a>02660                                 $nonce = isset(<a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;nonce&#39;</span>]) ? <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;nonce&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l02661"></a>02661                                 $cnonce = $nonce;
<a name="l02662"></a>02662                                 <span class="keywordflow">if</span> (<a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;qop&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l02663"></a>02663                                         $unhashedDigest = $HA1 . <span class="charliteral">&#39;:&#39;</span> . $nonce . <span class="charliteral">&#39;:&#39;</span> . sprintf(<span class="stringliteral">&quot;%08d&quot;</span>, <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;nc&#39;</span>]) . <span class="charliteral">&#39;:&#39;</span> . $cnonce . <span class="charliteral">&#39;:&#39;</span> . <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;qop&#39;</span>] . <span class="charliteral">&#39;:&#39;</span> . $HA2;
<a name="l02664"></a>02664                                 } <span class="keywordflow">else</span> {
<a name="l02665"></a>02665                                         $unhashedDigest = $HA1 . <span class="charliteral">&#39;:&#39;</span> . $nonce . <span class="charliteral">&#39;:&#39;</span> . $HA2;
<a name="l02666"></a>02666                                 }
<a name="l02667"></a>02667         
<a name="l02668"></a>02668                                 $hashedDigest = md5($unhashedDigest);
<a name="l02669"></a>02669         
<a name="l02670"></a>02670                                 $opaque = <span class="stringliteral">&#39;&#39;</span>;   
<a name="l02671"></a>02671                                 <span class="keywordflow">if</span> (isset(<a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;opaque&#39;</span>])) {
<a name="l02672"></a>02672                                         $opaque = <span class="stringliteral">&#39;, opaque=&quot;&#39;</span> . <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;opaque&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l02673"></a>02673                                 }
<a name="l02674"></a>02674 
<a name="l02675"></a>02675                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Authorization&#39;</span>, <span class="stringliteral">&#39;Digest username=&quot;&#39;</span> . <a class="code" href="classsoap__transport__http.html#acad1ba6566255a1506ebccfdb396b796">$username</a> . <span class="stringliteral">&#39;&quot;, realm=&quot;&#39;</span> . <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;realm&#39;</span>] . <span class="stringliteral">&#39;&quot;, nonce=&quot;&#39;</span> . $nonce . <span class="stringliteral">&#39;&quot;, uri=&quot;&#39;</span> . $this-&gt;digest_uri . $opaque . <span class="stringliteral">&#39;&quot;, cnonce=&quot;&#39;</span> . $cnonce . <span class="stringliteral">&#39;&quot;, nc=&#39;</span> . sprintf(<span class="stringliteral">&quot;%08x&quot;</span>, <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;nc&#39;</span>]) . <span class="stringliteral">&#39;, qop=&quot;&#39;</span> . <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;qop&#39;</span>] . <span class="stringliteral">&#39;&quot;, response=&quot;&#39;</span> . $hashedDigest . <span class="charliteral">&#39;&quot;&#39;</span>);
<a name="l02676"></a>02676                         }
<a name="l02677"></a>02677                 } elseif (<a class="code" href="classsoap__transport__http.html#acf17547c786f8c487379a30db35e9a9b">$authtype</a> == <span class="stringliteral">&#39;certificate&#39;</span>) {
<a name="l02678"></a>02678                         $this-&gt;certRequest = <a class="code" href="classsoap__transport__http.html#a3c1dc688b2dfe987b0efd6ab76fa537f">$certRequest</a>;
<a name="l02679"></a>02679                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Authorization header not set for certificate&#39;</span>);
<a name="l02680"></a>02680                 } elseif (<a class="code" href="classsoap__transport__http.html#acf17547c786f8c487379a30db35e9a9b">$authtype</a> == <span class="stringliteral">&#39;ntlm&#39;</span>) {
<a name="l02681"></a>02681                         <span class="comment">// do nothing</span>
<a name="l02682"></a>02682                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Authorization header not set for ntlm&#39;</span>);
<a name="l02683"></a>02683                 }
<a name="l02684"></a>02684                 $this-&gt;username = <a class="code" href="classsoap__transport__http.html#acad1ba6566255a1506ebccfdb396b796">$username</a>;
<a name="l02685"></a>02685                 $this-&gt;password = <a class="code" href="classsoap__transport__http.html#a8a428524f4140c0a3d5c1b2702326a8f">$password</a>;
<a name="l02686"></a>02686                 $this-&gt;authtype = <a class="code" href="classsoap__transport__http.html#acf17547c786f8c487379a30db35e9a9b">$authtype</a>;
<a name="l02687"></a>02687                 $this-&gt;digestRequest = <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>;
<a name="l02688"></a>02688         }
<a name="l02689"></a>02689         
<a name="l02696"></a><a class="code" href="classsoap__transport__http.html#a953ac97567be93483adb5620075a3d99">02696</a>         function <a class="code" href="classsoap__transport__http.html#a953ac97567be93483adb5620075a3d99">setSOAPAction</a>($soapaction) {
<a name="l02697"></a>02697                 $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;SOAPAction&#39;</span>, <span class="charliteral">&#39;&quot;&#39;</span> . $soapaction . <span class="charliteral">&#39;&quot;&#39;</span>);
<a name="l02698"></a>02698         }
<a name="l02699"></a>02699         
<a name="l02706"></a><a class="code" href="classsoap__transport__http.html#aa822efbbdc22caf78a6a9b590d0d5916">02706</a>         function <a class="code" href="classsoap__transport__http.html#aa822efbbdc22caf78a6a9b590d0d5916">setEncoding</a>($enc=<span class="stringliteral">&#39;gzip, deflate&#39;</span>) {
<a name="l02707"></a>02707                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;gzdeflate&#39;</span>)) {
<a name="l02708"></a>02708                         $this-&gt;protocol_version = <span class="stringliteral">&#39;1.1&#39;</span>;
<a name="l02709"></a>02709                         $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Accept-Encoding&#39;</span>, $enc);
<a name="l02710"></a>02710                         <span class="keywordflow">if</span> (!isset($this-&gt;outgoing_headers[<span class="stringliteral">&#39;Connection&#39;</span>])) {
<a name="l02711"></a>02711                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Connection&#39;</span>, <span class="stringliteral">&#39;close&#39;</span>);
<a name="l02712"></a>02712                                 $this-&gt;persistentConnection = <span class="keyword">false</span>;
<a name="l02713"></a>02713                         }
<a name="l02714"></a>02714                         <span class="comment">// deprecated as of PHP 5.3.0</span>
<a name="l02715"></a>02715                         <span class="comment">//set_magic_quotes_runtime(0);</span>
<a name="l02716"></a>02716                         $this-&gt;encoding = $enc;
<a name="l02717"></a>02717                 }
<a name="l02718"></a>02718         }
<a name="l02719"></a>02719         
<a name="l02730"></a><a class="code" href="classsoap__transport__http.html#ab9918e54af2d81ae8b7a8ce79c7d8dea">02730</a>         function <a class="code" href="classsoap__transport__http.html#ab9918e54af2d81ae8b7a8ce79c7d8dea">setProxy</a>($proxyhost, $proxyport, $proxyusername = <span class="stringliteral">&#39;&#39;</span>, $proxypassword = <span class="stringliteral">&#39;&#39;</span>, $proxyauthtype = <span class="stringliteral">&#39;basic&#39;</span>) {
<a name="l02731"></a>02731                 <span class="keywordflow">if</span> ($proxyhost) {
<a name="l02732"></a>02732                         $this-&gt;proxy = array(
<a name="l02733"></a>02733                                 <span class="stringliteral">&#39;host&#39;</span> =&gt; $proxyhost,
<a name="l02734"></a>02734                                 <span class="stringliteral">&#39;port&#39;</span> =&gt; $proxyport,
<a name="l02735"></a>02735                                 <span class="stringliteral">&#39;username&#39;</span> =&gt; $proxyusername,
<a name="l02736"></a>02736                                 <span class="stringliteral">&#39;password&#39;</span> =&gt; $proxypassword,
<a name="l02737"></a>02737                                 <span class="stringliteral">&#39;authtype&#39;</span> =&gt; $proxyauthtype
<a name="l02738"></a>02738                         );
<a name="l02739"></a>02739                         <span class="keywordflow">if</span> ($proxyusername != <span class="stringliteral">&#39;&#39;</span> &amp;&amp; $proxypassword != <span class="stringliteral">&#39;&#39;</span> &amp;&amp; $proxyauthtype = <span class="stringliteral">&#39;basic&#39;</span>) {
<a name="l02740"></a>02740                                 $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Proxy-Authorization&#39;</span>, <span class="stringliteral">&#39; Basic &#39;</span>.base64_encode($proxyusername.<span class="charliteral">&#39;:&#39;</span>.$proxypassword));
<a name="l02741"></a>02741                         }
<a name="l02742"></a>02742                 } <span class="keywordflow">else</span> {
<a name="l02743"></a>02743                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;remove proxy&#39;</span>);
<a name="l02744"></a>02744                         <a class="code" href="classsoap__transport__http.html#acff66352dab55662db0480d84517110c">$proxy</a> = null;
<a name="l02745"></a>02745                         <a class="code" href="classsoap__transport__http.html#a87f153910b7ee6a8394b2b555de840fe">unsetHeader</a>(<span class="stringliteral">&#39;Proxy-Authorization&#39;</span>);
<a name="l02746"></a>02746                 }
<a name="l02747"></a>02747         }
<a name="l02748"></a>02748         
<a name="l02749"></a>02749 
<a name="l02758"></a><a class="code" href="classsoap__transport__http.html#a8e9b987b4e7009ed2075e398e4a3fa99">02758</a>         function <a class="code" href="classsoap__transport__http.html#a8e9b987b4e7009ed2075e398e4a3fa99">isSkippableCurlHeader</a>(&amp;$data) {
<a name="l02759"></a>02759                 $skipHeaders = array(   <span class="stringliteral">&#39;HTTP/1.1 100&#39;</span>,
<a name="l02760"></a>02760                                                                 <span class="stringliteral">&#39;HTTP/1.0 301&#39;</span>,
<a name="l02761"></a>02761                                                                 <span class="stringliteral">&#39;HTTP/1.1 301&#39;</span>,
<a name="l02762"></a>02762                                                                 <span class="stringliteral">&#39;HTTP/1.0 302&#39;</span>,
<a name="l02763"></a>02763                                                                 <span class="stringliteral">&#39;HTTP/1.1 302&#39;</span>,
<a name="l02764"></a>02764                                                                 <span class="stringliteral">&#39;HTTP/1.0 401&#39;</span>,
<a name="l02765"></a>02765                                                                 <span class="stringliteral">&#39;HTTP/1.1 401&#39;</span>,
<a name="l02766"></a>02766                                                                 <span class="stringliteral">&#39;HTTP/1.0 200 Connection established&#39;</span>);
<a name="l02767"></a>02767                 <span class="keywordflow">foreach</span> ($skipHeaders as $hd) {
<a name="l02768"></a>02768                         $prefix = substr($data, 0, strlen($hd));
<a name="l02769"></a>02769                         <span class="keywordflow">if</span> ($prefix == $hd) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02770"></a>02770                 }
<a name="l02771"></a>02771 
<a name="l02772"></a>02772                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02773"></a>02773         }
<a name="l02774"></a>02774 
<a name="l02785"></a><a class="code" href="classsoap__transport__http.html#accea8c17428c17f23432a3e0b4ab7c04">02785</a>         function <a class="code" href="classsoap__transport__http.html#accea8c17428c17f23432a3e0b4ab7c04">decodeChunked</a>($buffer, $lb){
<a name="l02786"></a>02786                 <span class="comment">// length := 0</span>
<a name="l02787"></a>02787                 $length = 0;
<a name="l02788"></a>02788                 $new = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02789"></a>02789                 
<a name="l02790"></a>02790                 <span class="comment">// read chunk-size, chunk-extension (if any) and CRLF</span>
<a name="l02791"></a>02791                 <span class="comment">// get the position of the linebreak</span>
<a name="l02792"></a>02792                 $chunkend = strpos($buffer, $lb);
<a name="l02793"></a>02793                 <span class="keywordflow">if</span> ($chunkend == FALSE) {
<a name="l02794"></a>02794                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no linebreak found in decodeChunked&#39;</span>);
<a name="l02795"></a>02795                         <span class="keywordflow">return</span> $new;
<a name="l02796"></a>02796                 }
<a name="l02797"></a>02797                 $temp = substr($buffer,0,$chunkend);
<a name="l02798"></a>02798                 $chunk_size = hexdec( trim($temp) );
<a name="l02799"></a>02799                 $chunkstart = $chunkend + strlen($lb);
<a name="l02800"></a>02800                 <span class="comment">// while (chunk-size &gt; 0) {</span>
<a name="l02801"></a>02801                 <span class="keywordflow">while</span> ($chunk_size &gt; 0) {
<a name="l02802"></a>02802                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;chunkstart: $chunkstart chunk_size: $chunk_size&quot;</span>);
<a name="l02803"></a>02803                         $chunkend = strpos( $buffer, $lb, $chunkstart + $chunk_size);
<a name="l02804"></a>02804                         
<a name="l02805"></a>02805                         <span class="comment">// Just in case we got a broken connection</span>
<a name="l02806"></a>02806                         <span class="keywordflow">if</span> ($chunkend == FALSE) {
<a name="l02807"></a>02807                             $chunk = substr($buffer,$chunkstart);
<a name="l02808"></a>02808                                 <span class="comment">// append chunk-data to entity-body</span>
<a name="l02809"></a>02809                         $new .= $chunk;
<a name="l02810"></a>02810                             $length += strlen($chunk);
<a name="l02811"></a>02811                             <span class="keywordflow">break</span>;
<a name="l02812"></a>02812                         }
<a name="l02813"></a>02813                         
<a name="l02814"></a>02814                         <span class="comment">// read chunk-data and CRLF</span>
<a name="l02815"></a>02815                         $chunk = substr($buffer,$chunkstart,$chunkend-$chunkstart);
<a name="l02816"></a>02816                         <span class="comment">// append chunk-data to entity-body</span>
<a name="l02817"></a>02817                         $new .= $chunk;
<a name="l02818"></a>02818                         <span class="comment">// length := length + chunk-size</span>
<a name="l02819"></a>02819                         $length += strlen($chunk);
<a name="l02820"></a>02820                         <span class="comment">// read chunk-size and CRLF</span>
<a name="l02821"></a>02821                         $chunkstart = $chunkend + strlen($lb);
<a name="l02822"></a>02822                         
<a name="l02823"></a>02823                         $chunkend = strpos($buffer, $lb, $chunkstart) + strlen($lb);
<a name="l02824"></a>02824                         <span class="keywordflow">if</span> ($chunkend == FALSE) {
<a name="l02825"></a>02825                                 <span class="keywordflow">break</span>; <span class="comment">//Just in case we got a broken connection</span>
<a name="l02826"></a>02826                         }
<a name="l02827"></a>02827                         $temp = substr($buffer,$chunkstart,$chunkend-$chunkstart);
<a name="l02828"></a>02828                         $chunk_size = hexdec( trim($temp) );
<a name="l02829"></a>02829                         $chunkstart = $chunkend;
<a name="l02830"></a>02830                 }
<a name="l02831"></a>02831                 <span class="keywordflow">return</span> $new;
<a name="l02832"></a>02832         }
<a name="l02833"></a>02833         
<a name="l02842"></a><a class="code" href="classsoap__transport__http.html#aac5dcfa8ebaf94f332afcfb4219eb501">02842</a>         function <a class="code" href="classsoap__transport__http.html#aac5dcfa8ebaf94f332afcfb4219eb501">buildPayload</a>($data, $cookie_str = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l02843"></a>02843                 <span class="comment">// Note: for cURL connections, $this-&gt;outgoing_payload is ignored,</span>
<a name="l02844"></a>02844                 <span class="comment">// as is the Content-Length header, but these are still created as</span>
<a name="l02845"></a>02845                 <span class="comment">// debugging guides.</span>
<a name="l02846"></a>02846 
<a name="l02847"></a>02847                 <span class="comment">// add content-length header</span>
<a name="l02848"></a>02848                 <span class="keywordflow">if</span> ($this-&gt;request_method != <span class="stringliteral">&#39;GET&#39;</span>) {
<a name="l02849"></a>02849                         $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Content-Length&#39;</span>, strlen($data));
<a name="l02850"></a>02850                 }
<a name="l02851"></a>02851 
<a name="l02852"></a>02852                 <span class="comment">// start building outgoing payload:</span>
<a name="l02853"></a>02853                 <span class="keywordflow">if</span> ($this-&gt;proxy) {
<a name="l02854"></a>02854                         <a class="code" href="classsoap__transport__http.html#abde37eb2f32334cce09e6c9ccabae194">$uri</a> = $this-&gt;url;
<a name="l02855"></a>02855                 } <span class="keywordflow">else</span> {
<a name="l02856"></a>02856                         <a class="code" href="classsoap__transport__http.html#abde37eb2f32334cce09e6c9ccabae194">$uri</a> = $this-&gt;uri;
<a name="l02857"></a>02857                 }
<a name="l02858"></a>02858                 $req = <span class="stringliteral">&quot;$this-&gt;request_method $uri HTTP/$this-&gt;protocol_version&quot;</span>;
<a name="l02859"></a>02859                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;HTTP request: $req&quot;</span>);
<a name="l02860"></a>02860                 $this-&gt;outgoing_payload = <span class="stringliteral">&quot;$req\r\n&quot;</span>;
<a name="l02861"></a>02861 
<a name="l02862"></a>02862                 <span class="comment">// loop thru headers, serializing</span>
<a name="l02863"></a>02863                 <span class="keywordflow">foreach</span>($this-&gt;outgoing_headers as $k =&gt; $v){
<a name="l02864"></a>02864                         $hdr = $k.<span class="stringliteral">&#39;: &#39;</span>.$v;
<a name="l02865"></a>02865                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;HTTP header: $hdr&quot;</span>);
<a name="l02866"></a>02866                         $this-&gt;outgoing_payload .= <span class="stringliteral">&quot;$hdr\r\n&quot;</span>;
<a name="l02867"></a>02867                 }
<a name="l02868"></a>02868 
<a name="l02869"></a>02869                 <span class="comment">// add any cookies</span>
<a name="l02870"></a>02870                 <span class="keywordflow">if</span> ($cookie_str != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l02871"></a>02871                         $hdr = <span class="stringliteral">&#39;Cookie: &#39;</span>.$cookie_str;
<a name="l02872"></a>02872                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;HTTP header: $hdr&quot;</span>);
<a name="l02873"></a>02873                         $this-&gt;outgoing_payload .= <span class="stringliteral">&quot;$hdr\r\n&quot;</span>;
<a name="l02874"></a>02874                 }
<a name="l02875"></a>02875 
<a name="l02876"></a>02876                 <span class="comment">// header/body separator</span>
<a name="l02877"></a>02877                 $this-&gt;outgoing_payload .= <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l02878"></a>02878                 
<a name="l02879"></a>02879                 <span class="comment">// add data</span>
<a name="l02880"></a>02880                 $this-&gt;outgoing_payload .= $data;
<a name="l02881"></a>02881         }
<a name="l02882"></a>02882 
<a name="l02891"></a><a class="code" href="classsoap__transport__http.html#ac2eb2f606519a34022d6eef540e7c9ca">02891</a>         function <a class="code" href="classsoap__transport__http.html#ac2eb2f606519a34022d6eef540e7c9ca">sendRequest</a>($data, $cookies = NULL) {
<a name="l02892"></a>02892                 <span class="comment">// build cookie string</span>
<a name="l02893"></a>02893                 $cookie_str = $this-&gt;<a class="code" href="classsoap__transport__http.html#a19be7aba1e13fee213d344465c78230a">getCookiesForRequest</a>($cookies, (($this-&gt;scheme == <span class="stringliteral">&#39;ssl&#39;</span>) || ($this-&gt;scheme == <span class="stringliteral">&#39;https&#39;</span>)));
<a name="l02894"></a>02894 
<a name="l02895"></a>02895                 <span class="comment">// build payload</span>
<a name="l02896"></a>02896                 $this-&gt;<a class="code" href="classsoap__transport__http.html#aac5dcfa8ebaf94f332afcfb4219eb501">buildPayload</a>($data, $cookie_str);
<a name="l02897"></a>02897 
<a name="l02898"></a>02898           <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classsoap__transport__http.html#ac2063d8e4798df30da3ea97e444e1410">io_method</a>() == <span class="stringliteral">&#39;socket&#39;</span>) {
<a name="l02899"></a>02899                 <span class="comment">// send payload</span>
<a name="l02900"></a>02900                 <span class="keywordflow">if</span>(!fputs($this-&gt;fp, $this-&gt;outgoing_payload, strlen($this-&gt;outgoing_payload))) {
<a name="l02901"></a>02901                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;couldn\&#39;t write message data to socket&#39;</span>);
<a name="l02902"></a>02902                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;couldn\&#39;t write message data to socket&#39;</span>);
<a name="l02903"></a>02903                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02904"></a>02904                 }
<a name="l02905"></a>02905                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;wrote data to socket, length = &#39;</span> . strlen($this-&gt;outgoing_payload));
<a name="l02906"></a>02906                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02907"></a>02907           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classsoap__transport__http.html#ac2063d8e4798df30da3ea97e444e1410">io_method</a>() == <span class="stringliteral">&#39;curl&#39;</span>) {
<a name="l02908"></a>02908                 <span class="comment">// set payload</span>
<a name="l02909"></a>02909                 <span class="comment">// cURL does say this should only be the verb, and in fact it</span>
<a name="l02910"></a>02910                 <span class="comment">// turns out that the URI and HTTP version are appended to this, which</span>
<a name="l02911"></a>02911                 <span class="comment">// some servers refuse to work with (so we no longer use this method!)</span>
<a name="l02912"></a>02912                 <span class="comment">//$this-&gt;setCurlOption(CURLOPT_CUSTOMREQUEST, $this-&gt;outgoing_payload);</span>
<a name="l02913"></a>02913                 $curl_headers = array();
<a name="l02914"></a>02914                 <span class="keywordflow">foreach</span>($this-&gt;outgoing_headers as $k =&gt; $v){
<a name="l02915"></a>02915                         <span class="keywordflow">if</span> ($k == <span class="stringliteral">&#39;Connection&#39;</span> || $k == <span class="stringliteral">&#39;Content-Length&#39;</span> || $k == <span class="stringliteral">&#39;Host&#39;</span> || $k == <span class="stringliteral">&#39;Authorization&#39;</span> || $k == <span class="stringliteral">&#39;Proxy-Authorization&#39;</span>) {
<a name="l02916"></a>02916                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Skip cURL header $k: $v&quot;</span>);
<a name="l02917"></a>02917                         } <span class="keywordflow">else</span> {
<a name="l02918"></a>02918                                 $curl_headers[] = <span class="stringliteral">&quot;$k: $v&quot;</span>;
<a name="l02919"></a>02919                         }
<a name="l02920"></a>02920                 }
<a name="l02921"></a>02921                 <span class="keywordflow">if</span> ($cookie_str != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l02922"></a>02922                         $curl_headers[] = <span class="stringliteral">&#39;Cookie: &#39;</span> . $cookie_str;
<a name="l02923"></a>02923                 }
<a name="l02924"></a>02924                 $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_HTTPHEADER, $curl_headers);
<a name="l02925"></a>02925                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL HTTP headers&#39;</span>);
<a name="l02926"></a>02926                 <span class="keywordflow">if</span> ($this-&gt;request_method == <span class="stringliteral">&quot;POST&quot;</span>) {
<a name="l02927"></a>02927                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_POST, 1);
<a name="l02928"></a>02928                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>(CURLOPT_POSTFIELDS, $data);
<a name="l02929"></a>02929                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL POST data&#39;</span>);
<a name="l02930"></a>02930                 } <span class="keywordflow">else</span> {
<a name="l02931"></a>02931                 }
<a name="l02932"></a>02932                 <span class="comment">// insert custom user-set cURL options</span>
<a name="l02933"></a>02933                 <span class="keywordflow">foreach</span> ($this-&gt;ch_options as $key =&gt; $val) {
<a name="l02934"></a>02934                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a0e582db972a4a9a5d1fd1640f1e9eee1">setCurlOption</a>($key, $val);
<a name="l02935"></a>02935                 }
<a name="l02936"></a>02936 
<a name="l02937"></a>02937                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;set cURL payload&#39;</span>);
<a name="l02938"></a>02938                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02939"></a>02939           }
<a name="l02940"></a>02940         }
<a name="l02941"></a>02941 
<a name="l02948"></a><a class="code" href="classsoap__transport__http.html#a70235a810b4bdb1ee7875fb1c6ba9576">02948</a>         function <a class="code" href="classsoap__transport__http.html#a70235a810b4bdb1ee7875fb1c6ba9576">getResponse</a>(){
<a name="l02949"></a>02949                 $this-&gt;incoming_payload = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02950"></a>02950             
<a name="l02951"></a>02951           <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classsoap__transport__http.html#ac2063d8e4798df30da3ea97e444e1410">io_method</a>() == <span class="stringliteral">&#39;socket&#39;</span>) {
<a name="l02952"></a>02952             <span class="comment">// loop until headers have been retrieved</span>
<a name="l02953"></a>02953             $data = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02954"></a>02954             <span class="keywordflow">while</span> (!isset($lb)){
<a name="l02955"></a>02955 
<a name="l02956"></a>02956                         <span class="comment">// We might EOF during header read.</span>
<a name="l02957"></a>02957                         <span class="keywordflow">if</span>(feof($this-&gt;fp)) {
<a name="l02958"></a>02958                                 $this-&gt;incoming_payload = $data;
<a name="l02959"></a>02959                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;found no headers before EOF after length &#39;</span> . strlen($data));
<a name="l02960"></a>02960                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;received before EOF:\n&quot;</span> . $data);
<a name="l02961"></a>02961                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;server failed to send headers&#39;</span>);
<a name="l02962"></a>02962                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02963"></a>02963                         }
<a name="l02964"></a>02964 
<a name="l02965"></a>02965                         $tmp = fgets($this-&gt;fp, 256);
<a name="l02966"></a>02966                         $tmplen = strlen($tmp);
<a name="l02967"></a>02967                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;read line of $tmplen bytes: &quot;</span> . trim($tmp));
<a name="l02968"></a>02968 
<a name="l02969"></a>02969                         <span class="keywordflow">if</span> ($tmplen == 0) {
<a name="l02970"></a>02970                                 $this-&gt;incoming_payload = $data;
<a name="l02971"></a>02971                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;socket read of headers timed out after length &#39;</span> . strlen($data));
<a name="l02972"></a>02972                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;read before timeout: &quot;</span> . $data);
<a name="l02973"></a>02973                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;socket read of headers timed out&#39;</span>);
<a name="l02974"></a>02974                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02975"></a>02975                         }
<a name="l02976"></a>02976 
<a name="l02977"></a>02977                         $data .= $tmp;
<a name="l02978"></a>02978                         $pos = strpos($data,<span class="stringliteral">&quot;\r\n\r\n&quot;</span>);
<a name="l02979"></a>02979                         <span class="keywordflow">if</span>($pos &gt; 1){
<a name="l02980"></a>02980                                 $lb = <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l02981"></a>02981                         } <span class="keywordflow">else</span> {
<a name="l02982"></a>02982                                 $pos = strpos($data,<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l02983"></a>02983                                 <span class="keywordflow">if</span>($pos &gt; 1){
<a name="l02984"></a>02984                                         $lb = <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l02985"></a>02985                                 }
<a name="l02986"></a>02986                         }
<a name="l02987"></a>02987                         <span class="comment">// remove 100 headers</span>
<a name="l02988"></a>02988                         <span class="keywordflow">if</span> (isset($lb) &amp;&amp; preg_match(<span class="stringliteral">&#39;/^HTTP\/1.1 100/&#39;</span>,$data)) {
<a name="l02989"></a>02989                                 unset($lb);
<a name="l02990"></a>02990                                 $data = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02991"></a>02991                         }<span class="comment">//</span>
<a name="l02992"></a>02992                 }
<a name="l02993"></a>02993                 <span class="comment">// store header data</span>
<a name="l02994"></a>02994                 $this-&gt;incoming_payload .= $data;
<a name="l02995"></a>02995                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;found end of headers after length &#39;</span> . strlen($data));
<a name="l02996"></a>02996                 <span class="comment">// process headers</span>
<a name="l02997"></a>02997                 $header_data = trim(substr($data,0,$pos));
<a name="l02998"></a>02998                 $header_array = explode($lb,$header_data);
<a name="l02999"></a>02999                 $this-&gt;incoming_headers = array();
<a name="l03000"></a>03000                 $this-&gt;incoming_cookies = array();
<a name="l03001"></a>03001                 <span class="keywordflow">foreach</span>($header_array as $header_line){
<a name="l03002"></a>03002                         $arr = explode(<span class="charliteral">&#39;:&#39;</span>,$header_line, 2);
<a name="l03003"></a>03003                         <span class="keywordflow">if</span>(count($arr) &gt; 1){
<a name="l03004"></a>03004                                 $header_name = strtolower(trim($arr[0]));
<a name="l03005"></a>03005                                 $this-&gt;incoming_headers[$header_name] = trim($arr[1]);
<a name="l03006"></a>03006                                 <span class="keywordflow">if</span> ($header_name == <span class="stringliteral">&#39;set-cookie&#39;</span>) {
<a name="l03007"></a>03007                                         <span class="comment">// TODO: allow multiple cookies from parseCookie</span>
<a name="l03008"></a>03008                                         $cookie = $this-&gt;<a class="code" href="classsoap__transport__http.html#a5fce06ff95e1383f49c9adfe976e84c2">parseCookie</a>(trim($arr[1]));
<a name="l03009"></a>03009                                         <span class="keywordflow">if</span> ($cookie) {
<a name="l03010"></a>03010                                                 $this-&gt;incoming_cookies[] = $cookie;
<a name="l03011"></a>03011                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;found cookie: &#39;</span> . $cookie[<span class="stringliteral">&#39;name&#39;</span>] . <span class="stringliteral">&#39; = &#39;</span> . $cookie[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l03012"></a>03012                                         } <span class="keywordflow">else</span> {
<a name="l03013"></a>03013                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;did not find cookie in &#39;</span> . trim($arr[1]));
<a name="l03014"></a>03014                                         }
<a name="l03015"></a>03015                         }
<a name="l03016"></a>03016                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($header_name)) {
<a name="l03017"></a>03017                                 <span class="comment">// append continuation line to previous header</span>
<a name="l03018"></a>03018                                 $this-&gt;incoming_headers[$header_name] .= $lb . <span class="charliteral">&#39; &#39;</span> . $header_line;
<a name="l03019"></a>03019                         }
<a name="l03020"></a>03020                 }
<a name="l03021"></a>03021                 
<a name="l03022"></a>03022                 <span class="comment">// loop until msg has been received</span>
<a name="l03023"></a>03023                 <span class="keywordflow">if</span> (isset($this-&gt;incoming_headers[<span class="stringliteral">&#39;transfer-encoding&#39;</span>]) &amp;&amp; strtolower($this-&gt;incoming_headers[<span class="stringliteral">&#39;transfer-encoding&#39;</span>]) == <span class="stringliteral">&#39;chunked&#39;</span>) {
<a name="l03024"></a>03024                         $content_length =  2147483647;  <span class="comment">// ignore any content-length header</span>
<a name="l03025"></a>03025                         $chunked = <span class="keyword">true</span>;
<a name="l03026"></a>03026                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;want to read chunked content&quot;</span>);
<a name="l03027"></a>03027                 } elseif (isset($this-&gt;incoming_headers[<span class="stringliteral">&#39;content-length&#39;</span>])) {
<a name="l03028"></a>03028                         $content_length = $this-&gt;incoming_headers[<span class="stringliteral">&#39;content-length&#39;</span>];
<a name="l03029"></a>03029                         $chunked = <span class="keyword">false</span>;
<a name="l03030"></a>03030                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;want to read content of length $content_length&quot;</span>);
<a name="l03031"></a>03031                 } <span class="keywordflow">else</span> {
<a name="l03032"></a>03032                         $content_length =  2147483647;
<a name="l03033"></a>03033                         $chunked = <span class="keyword">false</span>;
<a name="l03034"></a>03034                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;want to read content to EOF&quot;</span>);
<a name="l03035"></a>03035                 }
<a name="l03036"></a>03036                 $data = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03037"></a>03037                 <span class="keywordflow">do</span> {
<a name="l03038"></a>03038                         <span class="keywordflow">if</span> ($chunked) {
<a name="l03039"></a>03039                                 $tmp = fgets($this-&gt;fp, 256);
<a name="l03040"></a>03040                                 $tmplen = strlen($tmp);
<a name="l03041"></a>03041                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;read chunk line of $tmplen bytes&quot;</span>);
<a name="l03042"></a>03042                                 <span class="keywordflow">if</span> ($tmplen == 0) {
<a name="l03043"></a>03043                                         $this-&gt;incoming_payload = $data;
<a name="l03044"></a>03044                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;socket read of chunk length timed out after length &#39;</span> . strlen($data));
<a name="l03045"></a>03045                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;read before timeout:\n&quot;</span> . $data);
<a name="l03046"></a>03046                                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;socket read of chunk length timed out&#39;</span>);
<a name="l03047"></a>03047                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03048"></a>03048                                 }
<a name="l03049"></a>03049                                 $content_length = hexdec(trim($tmp));
<a name="l03050"></a>03050                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;chunk length $content_length&quot;</span>);
<a name="l03051"></a>03051                         }
<a name="l03052"></a>03052                         $strlen = 0;
<a name="l03053"></a>03053                     <span class="keywordflow">while</span> (($strlen &lt; $content_length) &amp;&amp; (!feof($this-&gt;fp))) {
<a name="l03054"></a>03054                         $readlen = min(8192, $content_length - $strlen);
<a name="l03055"></a>03055                                 $tmp = fread($this-&gt;fp, $readlen);
<a name="l03056"></a>03056                                 $tmplen = strlen($tmp);
<a name="l03057"></a>03057                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;read buffer of $tmplen bytes&quot;</span>);
<a name="l03058"></a>03058                                 <span class="keywordflow">if</span> (($tmplen == 0) &amp;&amp; (!feof($this-&gt;fp))) {
<a name="l03059"></a>03059                                         $this-&gt;incoming_payload = $data;
<a name="l03060"></a>03060                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;socket read of body timed out after length &#39;</span> . strlen($data));
<a name="l03061"></a>03061                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;read before timeout:\n&quot;</span> . $data);
<a name="l03062"></a>03062                                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;socket read of body timed out&#39;</span>);
<a name="l03063"></a>03063                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03064"></a>03064                                 }
<a name="l03065"></a>03065                                 $strlen += $tmplen;
<a name="l03066"></a>03066                                 $data .= $tmp;
<a name="l03067"></a>03067                         }
<a name="l03068"></a>03068                         <span class="keywordflow">if</span> ($chunked &amp;&amp; ($content_length &gt; 0)) {
<a name="l03069"></a>03069                                 $tmp = fgets($this-&gt;fp, 256);
<a name="l03070"></a>03070                                 $tmplen = strlen($tmp);
<a name="l03071"></a>03071                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;read chunk terminator of $tmplen bytes&quot;</span>);
<a name="l03072"></a>03072                                 <span class="keywordflow">if</span> ($tmplen == 0) {
<a name="l03073"></a>03073                                         $this-&gt;incoming_payload = $data;
<a name="l03074"></a>03074                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;socket read of chunk terminator timed out after length &#39;</span> . strlen($data));
<a name="l03075"></a>03075                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;read before timeout:\n&quot;</span> . $data);
<a name="l03076"></a>03076                                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;socket read of chunk terminator timed out&#39;</span>);
<a name="l03077"></a>03077                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03078"></a>03078                                 }
<a name="l03079"></a>03079                         }
<a name="l03080"></a>03080                 } <span class="keywordflow">while</span> ($chunked &amp;&amp; ($content_length &gt; 0) &amp;&amp; (!feof($this-&gt;fp)));
<a name="l03081"></a>03081                 <span class="keywordflow">if</span> (feof($this-&gt;fp)) {
<a name="l03082"></a>03082                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;read to EOF&#39;</span>);
<a name="l03083"></a>03083                 }
<a name="l03084"></a>03084                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;read body of length &#39;</span> . strlen($data));
<a name="l03085"></a>03085                 $this-&gt;incoming_payload .= $data;
<a name="l03086"></a>03086                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;received a total of &#39;</span>.strlen($this-&gt;incoming_payload).<span class="stringliteral">&#39; bytes of data from server&#39;</span>);
<a name="l03087"></a>03087                 
<a name="l03088"></a>03088                 <span class="comment">// close filepointer</span>
<a name="l03089"></a>03089                 <span class="keywordflow">if</span>(
<a name="l03090"></a>03090                         (isset($this-&gt;incoming_headers[<span class="stringliteral">&#39;connection&#39;</span>]) &amp;&amp; strtolower($this-&gt;incoming_headers[<span class="stringliteral">&#39;connection&#39;</span>]) == <span class="stringliteral">&#39;close&#39;</span>) || 
<a name="l03091"></a>03091                         (! $this-&gt;persistentConnection) || feof($this-&gt;fp)){
<a name="l03092"></a>03092                         fclose($this-&gt;fp);
<a name="l03093"></a>03093                         $this-&gt;fp = <span class="keyword">false</span>;
<a name="l03094"></a>03094                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;closed socket&#39;</span>);
<a name="l03095"></a>03095                 }
<a name="l03096"></a>03096                 
<a name="l03097"></a>03097                 <span class="comment">// connection was closed unexpectedly</span>
<a name="l03098"></a>03098                 <span class="keywordflow">if</span>($this-&gt;incoming_payload == <span class="stringliteral">&#39;&#39;</span>){
<a name="l03099"></a>03099                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;no response from server&#39;</span>);
<a name="l03100"></a>03100                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03101"></a>03101                 }
<a name="l03102"></a>03102                 
<a name="l03103"></a>03103                 <span class="comment">// decode transfer-encoding</span>
<a name="l03104"></a>03104 <span class="comment">//              if(isset($this-&gt;incoming_headers[&#39;transfer-encoding&#39;]) &amp;&amp; strtolower($this-&gt;incoming_headers[&#39;transfer-encoding&#39;]) == &#39;chunked&#39;){</span>
<a name="l03105"></a>03105 <span class="comment">//                      if(!$data = $this-&gt;decodeChunked($data, $lb)){</span>
<a name="l03106"></a>03106 <span class="comment">//                              $this-&gt;setError(&#39;Decoding of chunked data failed&#39;);</span>
<a name="l03107"></a>03107 <span class="comment">//                              return false;</span>
<a name="l03108"></a>03108 <span class="comment">//                      }</span>
<a name="l03109"></a>03109                         <span class="comment">//print &quot;&lt;pre&gt;\nde-chunked:\n---------------\n$data\n\n---------------\n&lt;/pre&gt;&quot;;</span>
<a name="l03110"></a>03110                         <span class="comment">// set decoded payload</span>
<a name="l03111"></a>03111 <span class="comment">//                      $this-&gt;incoming_payload = $header_data.$lb.$lb.$data;</span>
<a name="l03112"></a>03112 <span class="comment">//              }</span>
<a name="l03113"></a>03113         
<a name="l03114"></a>03114           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classsoap__transport__http.html#ac2063d8e4798df30da3ea97e444e1410">io_method</a>() == <span class="stringliteral">&#39;curl&#39;</span>) {
<a name="l03115"></a>03115                 <span class="comment">// send and receive</span>
<a name="l03116"></a>03116                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;send and receive with cURL&#39;</span>);
<a name="l03117"></a>03117                 $this-&gt;incoming_payload = curl_exec($this-&gt;ch);
<a name="l03118"></a>03118                 $data = $this-&gt;incoming_payload;
<a name="l03119"></a>03119 
<a name="l03120"></a>03120         $cErr = curl_error($this-&gt;ch);
<a name="l03121"></a>03121                 <span class="keywordflow">if</span> ($cErr != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l03122"></a>03122                 <a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a> = <span class="stringliteral">&#39;cURL ERROR: &#39;</span>.curl_errno($this-&gt;ch).<span class="stringliteral">&#39;: &#39;</span>.$cErr.<span class="stringliteral">&#39;&lt;br&gt;&#39;</span>;
<a name="l03123"></a>03123                 <span class="comment">// TODO: there is a PHP bug that can cause this to SEGV for CURLINFO_CONTENT_TYPE</span>
<a name="l03124"></a>03124                         <span class="keywordflow">foreach</span>(curl_getinfo($this-&gt;ch) as $k =&gt; $v){
<a name="l03125"></a>03125                                 <a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a> .= <span class="stringliteral">&quot;$k: $v&lt;br&gt;&quot;</span>;
<a name="l03126"></a>03126                         }
<a name="l03127"></a>03127                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a>);
<a name="l03128"></a>03128                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a>);
<a name="l03129"></a>03129                         curl_close($this-&gt;ch);
<a name="l03130"></a>03130                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03131"></a>03131                 } <span class="keywordflow">else</span> {
<a name="l03132"></a>03132                         <span class="comment">//echo &#39;&lt;pre&gt;&#39;;</span>
<a name="l03133"></a>03133                         <span class="comment">//var_dump(curl_getinfo($this-&gt;ch));</span>
<a name="l03134"></a>03134                         <span class="comment">//echo &#39;&lt;/pre&gt;&#39;;</span>
<a name="l03135"></a>03135                 }
<a name="l03136"></a>03136                 <span class="comment">// close curl</span>
<a name="l03137"></a>03137                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;No cURL error, closing cURL&#39;</span>);
<a name="l03138"></a>03138                 curl_close($this-&gt;ch);
<a name="l03139"></a>03139                 
<a name="l03140"></a>03140                 <span class="comment">// try removing skippable headers</span>
<a name="l03141"></a>03141                 $savedata = $data;
<a name="l03142"></a>03142                 <span class="keywordflow">while</span> ($this-&gt;<a class="code" href="classsoap__transport__http.html#a8e9b987b4e7009ed2075e398e4a3fa99">isSkippableCurlHeader</a>($data)) {
<a name="l03143"></a>03143                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Found HTTP header to skip&quot;</span>);
<a name="l03144"></a>03144                         <span class="keywordflow">if</span> ($pos = strpos($data,<span class="stringliteral">&quot;\r\n\r\n&quot;</span>)) {
<a name="l03145"></a>03145                                 $data = ltrim(substr($data,$pos));
<a name="l03146"></a>03146                         } elseif($pos = strpos($data,<span class="stringliteral">&quot;\n\n&quot;</span>) ) {
<a name="l03147"></a>03147                                 $data = ltrim(substr($data,$pos));
<a name="l03148"></a>03148                         }
<a name="l03149"></a>03149                 }
<a name="l03150"></a>03150 
<a name="l03151"></a>03151                 <span class="keywordflow">if</span> ($data == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l03152"></a>03152                         <span class="comment">// have nothing left; just remove 100 header(s)</span>
<a name="l03153"></a>03153                         $data = $savedata;
<a name="l03154"></a>03154                         <span class="keywordflow">while</span> (preg_match(<span class="stringliteral">&#39;/^HTTP\/1.1 100/&#39;</span>,$data)) {
<a name="l03155"></a>03155                                 <span class="keywordflow">if</span> ($pos = strpos($data,<span class="stringliteral">&quot;\r\n\r\n&quot;</span>)) {
<a name="l03156"></a>03156                                         $data = ltrim(substr($data,$pos));
<a name="l03157"></a>03157                                 } elseif($pos = strpos($data,<span class="stringliteral">&quot;\n\n&quot;</span>) ) {
<a name="l03158"></a>03158                                         $data = ltrim(substr($data,$pos));
<a name="l03159"></a>03159                                 }
<a name="l03160"></a>03160                         }
<a name="l03161"></a>03161                 }
<a name="l03162"></a>03162                 
<a name="l03163"></a>03163                 <span class="comment">// separate content from HTTP headers</span>
<a name="l03164"></a>03164                 <span class="keywordflow">if</span> ($pos = strpos($data,<span class="stringliteral">&quot;\r\n\r\n&quot;</span>)) {
<a name="l03165"></a>03165                         $lb = <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l03166"></a>03166                 } elseif( $pos = strpos($data,<span class="stringliteral">&quot;\n\n&quot;</span>)) {
<a name="l03167"></a>03167                         $lb = <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l03168"></a>03168                 } <span class="keywordflow">else</span> {
<a name="l03169"></a>03169                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no proper separation of headers and document&#39;</span>);
<a name="l03170"></a>03170                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;no proper separation of headers and document&#39;</span>);
<a name="l03171"></a>03171                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03172"></a>03172                 }
<a name="l03173"></a>03173                 $header_data = trim(substr($data,0,$pos));
<a name="l03174"></a>03174                 $header_array = explode($lb,$header_data);
<a name="l03175"></a>03175                 $data = ltrim(substr($data,$pos));
<a name="l03176"></a>03176                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;found proper separation of headers and document&#39;</span>);
<a name="l03177"></a>03177                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;cleaned data, stringlen: &#39;</span>.strlen($data));
<a name="l03178"></a>03178                 <span class="comment">// clean headers</span>
<a name="l03179"></a>03179                 <span class="keywordflow">foreach</span> ($header_array as $header_line) {
<a name="l03180"></a>03180                         $arr = explode(<span class="charliteral">&#39;:&#39;</span>,$header_line,2);
<a name="l03181"></a>03181                         <span class="keywordflow">if</span>(count($arr) &gt; 1){
<a name="l03182"></a>03182                                 $header_name = strtolower(trim($arr[0]));
<a name="l03183"></a>03183                                 $this-&gt;incoming_headers[$header_name] = trim($arr[1]);
<a name="l03184"></a>03184                                 <span class="keywordflow">if</span> ($header_name == <span class="stringliteral">&#39;set-cookie&#39;</span>) {
<a name="l03185"></a>03185                                         <span class="comment">// TODO: allow multiple cookies from parseCookie</span>
<a name="l03186"></a>03186                                         $cookie = $this-&gt;<a class="code" href="classsoap__transport__http.html#a5fce06ff95e1383f49c9adfe976e84c2">parseCookie</a>(trim($arr[1]));
<a name="l03187"></a>03187                                         <span class="keywordflow">if</span> ($cookie) {
<a name="l03188"></a>03188                                                 $this-&gt;incoming_cookies[] = $cookie;
<a name="l03189"></a>03189                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;found cookie: &#39;</span> . $cookie[<span class="stringliteral">&#39;name&#39;</span>] . <span class="stringliteral">&#39; = &#39;</span> . $cookie[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l03190"></a>03190                                         } <span class="keywordflow">else</span> {
<a name="l03191"></a>03191                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;did not find cookie in &#39;</span> . trim($arr[1]));
<a name="l03192"></a>03192                                         }
<a name="l03193"></a>03193                         }
<a name="l03194"></a>03194                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($header_name)) {
<a name="l03195"></a>03195                                 <span class="comment">// append continuation line to previous header</span>
<a name="l03196"></a>03196                                 $this-&gt;incoming_headers[$header_name] .= $lb . <span class="charliteral">&#39; &#39;</span> . $header_line;
<a name="l03197"></a>03197                         }
<a name="l03198"></a>03198                 }
<a name="l03199"></a>03199           }
<a name="l03200"></a>03200 
<a name="l03201"></a>03201                 $this-&gt;response_status_line = $header_array[0];
<a name="l03202"></a>03202                 $arr = explode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;response_status_line, 3);
<a name="l03203"></a>03203                 $http_version = $arr[0];
<a name="l03204"></a>03204                 $http_status = intval($arr[1]);
<a name="l03205"></a>03205                 $http_reason = count($arr) &gt; 2 ? $arr[2] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l03206"></a>03206 
<a name="l03207"></a>03207                 <span class="comment">// see if we need to resend the request with http digest authentication</span>
<a name="l03208"></a>03208                 <span class="keywordflow">if</span> (isset($this-&gt;incoming_headers[<span class="stringliteral">&#39;location&#39;</span>]) &amp;&amp; ($http_status == 301 || $http_status == 302)) {
<a name="l03209"></a>03209                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Got $http_status $http_reason with Location: &quot;</span> . $this-&gt;incoming_headers[<span class="stringliteral">&#39;location&#39;</span>]);
<a name="l03210"></a>03210                         $this-&gt;<a class="code" href="classsoap__transport__http.html#a623be0456bfdc6297c461387af8e610b">setURL</a>($this-&gt;incoming_headers[<span class="stringliteral">&#39;location&#39;</span>]);
<a name="l03211"></a>03211                         $this-&gt;tryagain = <span class="keyword">true</span>;
<a name="l03212"></a>03212                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03213"></a>03213                 }
<a name="l03214"></a>03214 
<a name="l03215"></a>03215                 <span class="comment">// see if we need to resend the request with http digest authentication</span>
<a name="l03216"></a>03216                 <span class="keywordflow">if</span> (isset($this-&gt;incoming_headers[<span class="stringliteral">&#39;www-authenticate&#39;</span>]) &amp;&amp; $http_status == 401) {
<a name="l03217"></a>03217                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Got 401 $http_reason with WWW-Authenticate: &quot;</span> . $this-&gt;incoming_headers[<span class="stringliteral">&#39;www-authenticate&#39;</span>]);
<a name="l03218"></a>03218                         <span class="keywordflow">if</span> (strstr($this-&gt;incoming_headers[<span class="stringliteral">&#39;www-authenticate&#39;</span>], <span class="stringliteral">&quot;Digest &quot;</span>)) {
<a name="l03219"></a>03219                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Server wants digest authentication&#39;</span>);
<a name="l03220"></a>03220                                 <span class="comment">// remove &quot;Digest &quot; from our elements</span>
<a name="l03221"></a>03221                                 $digestString = str_replace(<span class="stringliteral">&#39;Digest &#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $this-&gt;incoming_headers[<span class="stringliteral">&#39;www-authenticate&#39;</span>]);
<a name="l03222"></a>03222                                 
<a name="l03223"></a>03223                                 <span class="comment">// parse elements into array</span>
<a name="l03224"></a>03224                                 $digestElements = explode(<span class="charliteral">&#39;,&#39;</span>, $digestString);
<a name="l03225"></a>03225                                 <span class="keywordflow">foreach</span> ($digestElements as $val) {
<a name="l03226"></a>03226                                         $tempElement = explode(<span class="charliteral">&#39;=&#39;</span>, trim($val), 2);
<a name="l03227"></a>03227                                         <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[$tempElement[0]] = str_replace(<span class="stringliteral">&quot;\&quot;&quot;</span>, <span class="stringliteral">&#39;&#39;</span>, $tempElement[1]);
<a name="l03228"></a>03228                                 }
<a name="l03229"></a>03229 
<a name="l03230"></a>03230                                 <span class="comment">// should have (at least) qop, realm, nonce</span>
<a name="l03231"></a>03231                                 <span class="keywordflow">if</span> (isset(<a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>[<span class="stringliteral">&#39;nonce&#39;</span>])) {
<a name="l03232"></a>03232                                         $this-&gt;<a class="code" href="classsoap__transport__http.html#adfb41c21ed326e3883adcb6bda41f913">setCredentials</a>($this-&gt;username, $this-&gt;password, <span class="stringliteral">&#39;digest&#39;</span>, <a class="code" href="classsoap__transport__http.html#accabcbbc2a75ed17f05c7ccce064c138">$digestRequest</a>);
<a name="l03233"></a>03233                                         $this-&gt;tryagain = <span class="keyword">true</span>;
<a name="l03234"></a>03234                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03235"></a>03235                                 }
<a name="l03236"></a>03236                         }
<a name="l03237"></a>03237                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;HTTP authentication failed&#39;</span>);
<a name="l03238"></a>03238                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;HTTP authentication failed&#39;</span>);
<a name="l03239"></a>03239                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03240"></a>03240                 }
<a name="l03241"></a>03241                 
<a name="l03242"></a>03242                 <span class="keywordflow">if</span> (
<a name="l03243"></a>03243                         ($http_status &gt;= 300 &amp;&amp; $http_status &lt;= 307) ||
<a name="l03244"></a>03244                         ($http_status &gt;= 400 &amp;&amp; $http_status &lt;= 417) ||
<a name="l03245"></a>03245                         ($http_status &gt;= 501 &amp;&amp; $http_status &lt;= 505)
<a name="l03246"></a>03246                    ) {
<a name="l03247"></a>03247                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;Unsupported HTTP response status $http_status $http_reason (soapclient-&gt;response has contents of the response)&quot;</span>);
<a name="l03248"></a>03248                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03249"></a>03249                 }
<a name="l03250"></a>03250 
<a name="l03251"></a>03251                 <span class="comment">// decode content-encoding</span>
<a name="l03252"></a>03252                 <span class="keywordflow">if</span>(isset($this-&gt;incoming_headers[<span class="stringliteral">&#39;content-encoding&#39;</span>]) &amp;&amp; $this-&gt;incoming_headers[<span class="stringliteral">&#39;content-encoding&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>){
<a name="l03253"></a>03253                         <span class="keywordflow">if</span>(strtolower($this-&gt;incoming_headers[<span class="stringliteral">&#39;content-encoding&#39;</span>]) == <span class="stringliteral">&#39;deflate&#39;</span> || strtolower($this-&gt;incoming_headers[<span class="stringliteral">&#39;content-encoding&#39;</span>]) == <span class="stringliteral">&#39;gzip&#39;</span>){
<a name="l03254"></a>03254                         <span class="comment">// if decoding works, use it. else assume data wasn&#39;t gzencoded</span>
<a name="l03255"></a>03255                         <span class="keywordflow">if</span>(function_exists(<span class="stringliteral">&#39;gzinflate&#39;</span>)){
<a name="l03256"></a>03256                                         <span class="comment">//$timer-&gt;setMarker(&#39;starting decoding of gzip/deflated content&#39;);</span>
<a name="l03257"></a>03257                                         <span class="comment">// IIS 5 requires gzinflate instead of gzuncompress (similar to IE 5 and gzdeflate v. gzcompress)</span>
<a name="l03258"></a>03258                                         <span class="comment">// this means there are no Zlib headers, although there should be</span>
<a name="l03259"></a>03259                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The gzinflate function exists&#39;</span>);
<a name="l03260"></a>03260                                         $datalen = strlen($data);
<a name="l03261"></a>03261                                         <span class="keywordflow">if</span> ($this-&gt;incoming_headers[<span class="stringliteral">&#39;content-encoding&#39;</span>] == <span class="stringliteral">&#39;deflate&#39;</span>) {
<a name="l03262"></a>03262                                                 <span class="keywordflow">if</span> ($degzdata = @gzinflate($data)) {
<a name="l03263"></a>03263                                                 $data = $degzdata;
<a name="l03264"></a>03264                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The payload has been inflated to &#39;</span> . strlen($data) . <span class="stringliteral">&#39; bytes&#39;</span>);
<a name="l03265"></a>03265                                                 <span class="keywordflow">if</span> (strlen($data) &lt; $datalen) {
<a name="l03266"></a>03266                                                         <span class="comment">// test for the case that the payload has been compressed twice</span>
<a name="l03267"></a>03267                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The inflated payload is smaller than the gzipped one; try again&#39;</span>);
<a name="l03268"></a>03268                                                                 <span class="keywordflow">if</span> ($degzdata = @gzinflate($data)) {
<a name="l03269"></a>03269                                                                 $data = $degzdata;
<a name="l03270"></a>03270                                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The payload has been inflated again to &#39;</span> . strlen($data) . <span class="stringliteral">&#39; bytes&#39;</span>);
<a name="l03271"></a>03271                                                                 }
<a name="l03272"></a>03272                                                 }
<a name="l03273"></a>03273                                         } <span class="keywordflow">else</span> {
<a name="l03274"></a>03274                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Error using gzinflate to inflate the payload&#39;</span>);
<a name="l03275"></a>03275                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Error using gzinflate to inflate the payload&#39;</span>);
<a name="l03276"></a>03276                                         }
<a name="l03277"></a>03277                                         } elseif ($this-&gt;incoming_headers[<span class="stringliteral">&#39;content-encoding&#39;</span>] == <span class="stringliteral">&#39;gzip&#39;</span>) {
<a name="l03278"></a>03278                                                 <span class="keywordflow">if</span> ($degzdata = @gzinflate(substr($data, 10))) {        <span class="comment">// do our best</span>
<a name="l03279"></a>03279                                                         $data = $degzdata;
<a name="l03280"></a>03280                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The payload has been un-gzipped to &#39;</span> . strlen($data) . <span class="stringliteral">&#39; bytes&#39;</span>);
<a name="l03281"></a>03281                                                 <span class="keywordflow">if</span> (strlen($data) &lt; $datalen) {
<a name="l03282"></a>03282                                                         <span class="comment">// test for the case that the payload has been compressed twice</span>
<a name="l03283"></a>03283                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The un-gzipped payload is smaller than the gzipped one; try again&#39;</span>);
<a name="l03284"></a>03284                                                                 <span class="keywordflow">if</span> ($degzdata = @gzinflate(substr($data, 10))) {
<a name="l03285"></a>03285                                                                 $data = $degzdata;
<a name="l03286"></a>03286                                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The payload has been un-gzipped again to &#39;</span> . strlen($data) . <span class="stringliteral">&#39; bytes&#39;</span>);
<a name="l03287"></a>03287                                                                 }
<a name="l03288"></a>03288                                                 }
<a name="l03289"></a>03289                                         } <span class="keywordflow">else</span> {
<a name="l03290"></a>03290                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Error using gzinflate to un-gzip the payload&#39;</span>);
<a name="l03291"></a>03291                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Error using gzinflate to un-gzip the payload&#39;</span>);
<a name="l03292"></a>03292                                         }
<a name="l03293"></a>03293                                         }
<a name="l03294"></a>03294                                         <span class="comment">//$timer-&gt;setMarker(&#39;finished decoding of gzip/deflated content&#39;);</span>
<a name="l03295"></a>03295                                         <span class="comment">//print &quot;&lt;xmp&gt;\nde-inflated:\n---------------\n$data\n-------------\n&lt;/xmp&gt;&quot;;</span>
<a name="l03296"></a>03296                                         <span class="comment">// set decoded payload</span>
<a name="l03297"></a>03297                                         $this-&gt;incoming_payload = $header_data.$lb.$lb.$data;
<a name="l03298"></a>03298                         } <span class="keywordflow">else</span> {
<a name="l03299"></a>03299                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The server sent compressed data. Your php install must have the Zlib extension compiled in to support this.&#39;</span>);
<a name="l03300"></a>03300                                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;The server sent compressed data. Your php install must have the Zlib extension compiled in to support this.&#39;</span>);
<a name="l03301"></a>03301                                 }
<a name="l03302"></a>03302                         } <span class="keywordflow">else</span> {
<a name="l03303"></a>03303                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Unsupported Content-Encoding &#39;</span> . $this-&gt;incoming_headers[<span class="stringliteral">&#39;content-encoding&#39;</span>]);
<a name="l03304"></a>03304                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Unsupported Content-Encoding &#39;</span> . $this-&gt;incoming_headers[<span class="stringliteral">&#39;content-encoding&#39;</span>]);
<a name="l03305"></a>03305                         }
<a name="l03306"></a>03306                 } <span class="keywordflow">else</span> {
<a name="l03307"></a>03307                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;No Content-Encoding header&#39;</span>);
<a name="l03308"></a>03308                 }
<a name="l03309"></a>03309                 
<a name="l03310"></a>03310                 <span class="keywordflow">if</span>(strlen($data) == 0){
<a name="l03311"></a>03311                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no data after headers!&#39;</span>);
<a name="l03312"></a>03312                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;no data present after HTTP headers&#39;</span>);
<a name="l03313"></a>03313                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03314"></a>03314                 }
<a name="l03315"></a>03315                 
<a name="l03316"></a>03316                 <span class="keywordflow">return</span> $data;
<a name="l03317"></a>03317         }
<a name="l03318"></a>03318 
<a name="l03326"></a><a class="code" href="classsoap__transport__http.html#a84c052db95a14c428c8062d4910e83f9">03326</a>         function <a class="code" href="classsoap__transport__http.html#a84c052db95a14c428c8062d4910e83f9">setContentType</a>($type, $charset = <span class="keyword">false</span>) {
<a name="l03327"></a>03327                 $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Content-Type&#39;</span>, $type . ($charset ? <span class="stringliteral">&#39;; charset=&#39;</span> . $charset : <span class="stringliteral">&#39;&#39;</span>));
<a name="l03328"></a>03328         }
<a name="l03329"></a>03329 
<a name="l03336"></a><a class="code" href="classsoap__transport__http.html#aae3451a7cd7eeb095e86cc9b744a3040">03336</a>         function <a class="code" href="classsoap__transport__http.html#aae3451a7cd7eeb095e86cc9b744a3040">usePersistentConnection</a>(){
<a name="l03337"></a>03337                 <span class="keywordflow">if</span> (isset($this-&gt;outgoing_headers[<span class="stringliteral">&#39;Accept-Encoding&#39;</span>])) {
<a name="l03338"></a>03338                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03339"></a>03339                 }
<a name="l03340"></a>03340                 $this-&gt;protocol_version = <span class="stringliteral">&#39;1.1&#39;</span>;
<a name="l03341"></a>03341                 $this-&gt;persistentConnection = <span class="keyword">true</span>;
<a name="l03342"></a>03342                 $this-&gt;<a class="code" href="classsoap__transport__http.html#ac1e6628b468515934e05df0bd8523ce0">setHeader</a>(<span class="stringliteral">&#39;Connection&#39;</span>, <span class="stringliteral">&#39;Keep-Alive&#39;</span>);
<a name="l03343"></a>03343                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l03344"></a>03344         }
<a name="l03345"></a>03345 
<a name="l03353"></a>03353         <span class="comment">/*</span>
<a name="l03354"></a>03354 <span class="comment">         * TODO: allow a Set-Cookie string to be parsed into multiple cookies</span>
<a name="l03355"></a>03355 <span class="comment">         */</span>
<a name="l03356"></a><a class="code" href="classsoap__transport__http.html#a5fce06ff95e1383f49c9adfe976e84c2">03356</a>         function <a class="code" href="classsoap__transport__http.html#a5fce06ff95e1383f49c9adfe976e84c2">parseCookie</a>($cookie_str) {
<a name="l03357"></a>03357                 $cookie_str = str_replace(<span class="stringliteral">&#39;; &#39;</span>, <span class="charliteral">&#39;;&#39;</span>, $cookie_str) . <span class="charliteral">&#39;;&#39;</span>;
<a name="l03358"></a>03358                 $data = preg_split(<span class="stringliteral">&#39;/;/&#39;</span>, $cookie_str);
<a name="l03359"></a>03359                 $value_str = $data[0];
<a name="l03360"></a>03360 
<a name="l03361"></a>03361                 $cookie_param = <span class="stringliteral">&#39;domain=&#39;</span>;
<a name="l03362"></a>03362                 $start = strpos($cookie_str, $cookie_param);
<a name="l03363"></a>03363                 <span class="keywordflow">if</span> ($start &gt; 0) {
<a name="l03364"></a>03364                         $domain = substr($cookie_str, $start + strlen($cookie_param));
<a name="l03365"></a>03365                         $domain = substr($domain, 0, strpos($domain, <span class="charliteral">&#39;;&#39;</span>));
<a name="l03366"></a>03366                 } <span class="keywordflow">else</span> {
<a name="l03367"></a>03367                         $domain = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03368"></a>03368                 }
<a name="l03369"></a>03369 
<a name="l03370"></a>03370                 $cookie_param = <span class="stringliteral">&#39;expires=&#39;</span>;
<a name="l03371"></a>03371                 $start = strpos($cookie_str, $cookie_param);
<a name="l03372"></a>03372                 <span class="keywordflow">if</span> ($start &gt; 0) {
<a name="l03373"></a>03373                         $expires = substr($cookie_str, $start + strlen($cookie_param));
<a name="l03374"></a>03374                         $expires = substr($expires, 0, strpos($expires, <span class="charliteral">&#39;;&#39;</span>));
<a name="l03375"></a>03375                 } <span class="keywordflow">else</span> {
<a name="l03376"></a>03376                         $expires = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03377"></a>03377                 }
<a name="l03378"></a>03378 
<a name="l03379"></a>03379                 $cookie_param = <span class="stringliteral">&#39;path=&#39;</span>;
<a name="l03380"></a>03380                 $start = strpos($cookie_str, $cookie_param);
<a name="l03381"></a>03381                 <span class="keywordflow">if</span> ( $start &gt; 0 ) {
<a name="l03382"></a>03382                         <a class="code" href="classsoap__transport__http.html#aeb05779276186b2ab150a982794ceaa1">$path</a> = substr($cookie_str, $start + strlen($cookie_param));
<a name="l03383"></a>03383                         <a class="code" href="classsoap__transport__http.html#aeb05779276186b2ab150a982794ceaa1">$path</a> = substr(<a class="code" href="classsoap__transport__http.html#aeb05779276186b2ab150a982794ceaa1">$path</a>, 0, strpos(<a class="code" href="classsoap__transport__http.html#aeb05779276186b2ab150a982794ceaa1">$path</a>, <span class="charliteral">&#39;;&#39;</span>));
<a name="l03384"></a>03384                 } <span class="keywordflow">else</span> {
<a name="l03385"></a>03385                         <a class="code" href="classsoap__transport__http.html#aeb05779276186b2ab150a982794ceaa1">$path</a> = <span class="charliteral">&#39;/&#39;</span>;
<a name="l03386"></a>03386                 }
<a name="l03387"></a>03387                                                 
<a name="l03388"></a>03388                 $cookie_param = <span class="stringliteral">&#39;;secure;&#39;</span>;
<a name="l03389"></a>03389                 <span class="keywordflow">if</span> (strpos($cookie_str, $cookie_param) !== FALSE) {
<a name="l03390"></a>03390                         $secure = <span class="keyword">true</span>;
<a name="l03391"></a>03391                 } <span class="keywordflow">else</span> {
<a name="l03392"></a>03392                         $secure = <span class="keyword">false</span>;
<a name="l03393"></a>03393                 }
<a name="l03394"></a>03394 
<a name="l03395"></a>03395                 $sep_pos = strpos($value_str, <span class="charliteral">&#39;=&#39;</span>);
<a name="l03396"></a>03396 
<a name="l03397"></a>03397                 <span class="keywordflow">if</span> ($sep_pos) {
<a name="l03398"></a>03398                         $name = substr($value_str, 0, $sep_pos);
<a name="l03399"></a>03399                         $value = substr($value_str, $sep_pos + 1);
<a name="l03400"></a>03400                         $cookie= array( <span class="stringliteral">&#39;name&#39;</span> =&gt; $name,
<a name="l03401"></a>03401                                         <span class="stringliteral">&#39;value&#39;</span> =&gt; $value,
<a name="l03402"></a>03402                                                         <span class="stringliteral">&#39;domain&#39;</span> =&gt; $domain,
<a name="l03403"></a>03403                                                         <span class="stringliteral">&#39;path&#39;</span> =&gt; <a class="code" href="classsoap__transport__http.html#aeb05779276186b2ab150a982794ceaa1">$path</a>,
<a name="l03404"></a>03404                                                         <span class="stringliteral">&#39;expires&#39;</span> =&gt; $expires,
<a name="l03405"></a>03405                                                         <span class="stringliteral">&#39;secure&#39;</span> =&gt; $secure
<a name="l03406"></a>03406                                                         );              
<a name="l03407"></a>03407                         <span class="keywordflow">return</span> $cookie;
<a name="l03408"></a>03408                 }
<a name="l03409"></a>03409                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03410"></a>03410         }
<a name="l03411"></a>03411   
<a name="l03420"></a><a class="code" href="classsoap__transport__http.html#a19be7aba1e13fee213d344465c78230a">03420</a>         function <a class="code" href="classsoap__transport__http.html#a19be7aba1e13fee213d344465c78230a">getCookiesForRequest</a>($cookies, $secure=<span class="keyword">false</span>) {
<a name="l03421"></a>03421                 $cookie_str = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03422"></a>03422                 <span class="keywordflow">if</span> ((! is_null($cookies)) &amp;&amp; (is_array($cookies))) {
<a name="l03423"></a>03423                         <span class="keywordflow">foreach</span> ($cookies as $cookie) {
<a name="l03424"></a>03424                                 <span class="keywordflow">if</span> (! is_array($cookie)) {
<a name="l03425"></a>03425                                         <span class="keywordflow">continue</span>;
<a name="l03426"></a>03426                                 }
<a name="l03427"></a>03427                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;check cookie for validity: &quot;</span>.$cookie[<span class="stringliteral">&#39;name&#39;</span>].<span class="charliteral">&#39;=&#39;</span>.$cookie[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l03428"></a>03428                                 <span class="keywordflow">if</span> ((isset($cookie[<span class="stringliteral">&#39;expires&#39;</span>])) &amp;&amp; (! empty($cookie[<span class="stringliteral">&#39;expires&#39;</span>]))) {
<a name="l03429"></a>03429                                         <span class="keywordflow">if</span> (strtotime($cookie[<span class="stringliteral">&#39;expires&#39;</span>]) &lt;= time()) {
<a name="l03430"></a>03430                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;cookie has expired&#39;</span>);
<a name="l03431"></a>03431                                                 <span class="keywordflow">continue</span>;
<a name="l03432"></a>03432                                         }
<a name="l03433"></a>03433                                 }
<a name="l03434"></a>03434                                 <span class="keywordflow">if</span> ((isset($cookie[<span class="stringliteral">&#39;domain&#39;</span>])) &amp;&amp; (! empty($cookie[<span class="stringliteral">&#39;domain&#39;</span>]))) {
<a name="l03435"></a>03435                                         $domain = preg_quote($cookie[<span class="stringliteral">&#39;domain&#39;</span>]);
<a name="l03436"></a>03436                                         <span class="keywordflow">if</span> (! preg_match(<span class="stringliteral">&quot;&#39;.*$domain$&#39;i&quot;</span>, $this-&gt;host)) {
<a name="l03437"></a>03437                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;cookie has different domain&#39;</span>);
<a name="l03438"></a>03438                                                 <span class="keywordflow">continue</span>;
<a name="l03439"></a>03439                                         }
<a name="l03440"></a>03440                                 }
<a name="l03441"></a>03441                                 <span class="keywordflow">if</span> ((isset($cookie[<span class="stringliteral">&#39;path&#39;</span>])) &amp;&amp; (! empty($cookie[<span class="stringliteral">&#39;path&#39;</span>]))) {
<a name="l03442"></a>03442                                         <a class="code" href="classsoap__transport__http.html#aeb05779276186b2ab150a982794ceaa1">$path</a> = preg_quote($cookie[<span class="stringliteral">&#39;path&#39;</span>]);
<a name="l03443"></a>03443                                         <span class="keywordflow">if</span> (! preg_match(<span class="stringliteral">&quot;&#39;^$path.*&#39;i&quot;</span>, $this-&gt;path)) {
<a name="l03444"></a>03444                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;cookie is for a different path&#39;</span>);
<a name="l03445"></a>03445                                                 <span class="keywordflow">continue</span>;
<a name="l03446"></a>03446                                         }
<a name="l03447"></a>03447                                 }
<a name="l03448"></a>03448                                 <span class="keywordflow">if</span> ((! $secure) &amp;&amp; (isset($cookie[<span class="stringliteral">&#39;secure&#39;</span>])) &amp;&amp; ($cookie[<span class="stringliteral">&#39;secure&#39;</span>])) {
<a name="l03449"></a>03449                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;cookie is secure, transport is not&#39;</span>);
<a name="l03450"></a>03450                                         <span class="keywordflow">continue</span>;
<a name="l03451"></a>03451                                 }
<a name="l03452"></a>03452                                 $cookie_str .= $cookie[<span class="stringliteral">&#39;name&#39;</span>] . <span class="charliteral">&#39;=&#39;</span> . $cookie[<span class="stringliteral">&#39;value&#39;</span>] . <span class="stringliteral">&#39;; &#39;</span>;
<a name="l03453"></a>03453                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;add cookie to Cookie-String: &#39;</span> . $cookie[<span class="stringliteral">&#39;name&#39;</span>] . <span class="charliteral">&#39;=&#39;</span> . $cookie[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l03454"></a>03454                         }
<a name="l03455"></a>03455                 }
<a name="l03456"></a>03456                 <span class="keywordflow">return</span> $cookie_str;
<a name="l03457"></a>03457   }
<a name="l03458"></a>03458 }
<a name="l03459"></a>03459 
<a name="l03460"></a>03460 ?&gt;&lt;?php
<a name="l03461"></a>03461 
<a name="l03462"></a>03462 
<a name="l03463"></a>03463 
<a name="l03474"></a>03474 <span class="keyword">class </span><a class="code" href="classnusoap__server.html">nusoap_server</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__base.html">nusoap_base</a> {
<a name="l03480"></a>03480         var <a class="code" href="classnusoap__server.html#abde275408fda58579fbb7f7cc44025e6">$headers</a> = array();
<a name="l03486"></a>03486         var <a class="code" href="classnusoap__server.html#aa1a06b1263f86293631eaadec9f289c6">$request</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03492"></a>03492         var <a class="code" href="classnusoap__server.html#aaa0d3bd9a8b715c293bba48ff831800f">$requestHeaders</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03498"></a>03498         var <a class="code" href="classnusoap__server.html#afb0ea50d572fc931a51fac2a01739500">$requestHeader</a> = NULL;
<a name="l03504"></a>03504         var <a class="code" href="classnusoap__server.html#a003d4035a0a6b53fd537853af48d9483">$document</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03510"></a>03510         var <a class="code" href="classnusoap__server.html#ab7b109010eb5be462c25a451be7e4160">$requestSOAP</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03516"></a>03516         var <a class="code" href="classnusoap__server.html#a7b901c42f648961c6632ff0e04a2fa28">$methodURI</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03522"></a>03522         var <a class="code" href="classnusoap__server.html#aa3889c896a3ff3bc86d2932c12c5420c">$methodname</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03528"></a>03528         var <a class="code" href="classnusoap__server.html#aaaf1eea481ff7c45b1c9a05202b19e14">$methodparams</a> = array();
<a name="l03534"></a>03534         var <a class="code" href="classnusoap__server.html#ad7d6991ebd2ebe20408521546fdfeccf">$SOAPAction</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03540"></a>03540         var <a class="code" href="classnusoap__server.html#a37c0f4550d39b01c0d5fc4ac8e9625b7">$xml_encoding</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03546"></a>03546     var <a class="code" href="classnusoap__server.html#acf5993b83b941cbe101e8f6fa4c3cc37">$decode_utf8</a> = <span class="keyword">true</span>;
<a name="l03547"></a>03547 
<a name="l03553"></a>03553         var <a class="code" href="classnusoap__server.html#a5f6c2c5044de97bbc230a8478a24d347">$outgoing_headers</a> = array();
<a name="l03559"></a>03559         var <a class="code" href="classnusoap__server.html#a6b7cf637c497c41563cfdb49ad793c3f">$response</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03565"></a>03565         var <a class="code" href="classnusoap__server.html#a3034e7535c345f77dc3f21cdfdfff6cb">$responseHeaders</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03571"></a>03571         var <a class="code" href="classnusoap__server.html#a0dc0fd966cfd40f2c3a1b69747e1165f">$responseSOAP</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03577"></a>03577         var <a class="code" href="classnusoap__server.html#ab7549e6c29de856cd1eaff6062a4298d">$methodreturn</a> = <span class="keyword">false</span>;
<a name="l03583"></a>03583         var <a class="code" href="classnusoap__server.html#a3869d6e11e9d99128fe1b4d9409643ef">$methodreturnisliteralxml</a> = <span class="keyword">false</span>;
<a name="l03589"></a>03589         var <a class="code" href="classnusoap__server.html#a3efef5a3f0cf2ecb0ebb227ef854fd2b">$fault</a> = <span class="keyword">false</span>;
<a name="l03595"></a>03595         var <a class="code" href="classnusoap__server.html#a6d48ddb6ef9f09eacc91cf26ce6835ce">$result</a> = <span class="stringliteral">&#39;successful&#39;</span>;
<a name="l03596"></a>03596 
<a name="l03603"></a>03603         var <a class="code" href="classnusoap__server.html#aeab469e13b09793f2f82529d24368677">$operations</a> = array();
<a name="l03609"></a>03609         var <a class="code" href="classnusoap__server.html#aef1fb82b166f28799be81fe3e860329e">$wsdl</a> = <span class="keyword">false</span>;
<a name="l03615"></a>03615         var <a class="code" href="classnusoap__server.html#a60e1dc8d7ad4403f8836efe5b70ec0ff">$externalWSDLURL</a> = <span class="keyword">false</span>;
<a name="l03621"></a>03621         var <a class="code" href="classnusoap__server.html#a9b8e801f63de2c9bda8753599439aa46">$debug_flag</a> = <span class="keyword">false</span>;
<a name="l03622"></a>03622 
<a name="l03623"></a>03623 
<a name="l03631"></a><a class="code" href="classnusoap__server.html#abb4026693abced19dd2695d489a91031">03631</a>         function <a class="code" href="classnusoap__server.html#abb4026693abced19dd2695d489a91031">nusoap_server</a>(<a class="code" href="classnusoap__server.html#aef1fb82b166f28799be81fe3e860329e">$wsdl</a>=<span class="keyword">false</span>){
<a name="l03632"></a>03632                 <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">parent::nusoap_base</a>();
<a name="l03633"></a>03633                 <span class="comment">// turn on debugging?</span>
<a name="l03634"></a>03634                 global $debug;
<a name="l03635"></a>03635                 global $HTTP_SERVER_VARS;
<a name="l03636"></a>03636 
<a name="l03637"></a>03637                 <span class="keywordflow">if</span> (isset($_SERVER)) {
<a name="l03638"></a>03638                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;_SERVER is defined:&quot;</span>);
<a name="l03639"></a>03639                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($_SERVER));
<a name="l03640"></a>03640                 } elseif (isset($HTTP_SERVER_VARS)) {
<a name="l03641"></a>03641                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;HTTP_SERVER_VARS is defined:&quot;</span>);
<a name="l03642"></a>03642                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($HTTP_SERVER_VARS));
<a name="l03643"></a>03643                 } <span class="keywordflow">else</span> {
<a name="l03644"></a>03644                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Neither _SERVER nor HTTP_SERVER_VARS is defined.&quot;</span>);
<a name="l03645"></a>03645                 }
<a name="l03646"></a>03646 
<a name="l03647"></a>03647                 <span class="keywordflow">if</span> (isset($debug)) {
<a name="l03648"></a>03648                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In nusoap_server, set debug_flag=$debug based on global flag&quot;</span>);
<a name="l03649"></a>03649                         $this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a> = $debug;
<a name="l03650"></a>03650                 } elseif (isset($_SERVER[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>])) {
<a name="l03651"></a>03651                         $qs = explode(<span class="charliteral">&#39;&amp;&#39;</span>, $_SERVER[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>]);
<a name="l03652"></a>03652                         <span class="keywordflow">foreach</span> ($qs as $v) {
<a name="l03653"></a>03653                                 <span class="keywordflow">if</span> (substr($v, 0, 6) == <span class="stringliteral">&#39;debug=&#39;</span>) {
<a name="l03654"></a>03654                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In nusoap_server, set debug_flag=&quot;</span> . substr($v, 6) . <span class="stringliteral">&quot; based on query string #1&quot;</span>);
<a name="l03655"></a>03655                                         $this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a> = substr($v, 6);
<a name="l03656"></a>03656                                 }
<a name="l03657"></a>03657                         }
<a name="l03658"></a>03658                 } elseif (isset($HTTP_SERVER_VARS[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>])) {
<a name="l03659"></a>03659                         $qs = explode(<span class="charliteral">&#39;&amp;&#39;</span>, $HTTP_SERVER_VARS[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>]);
<a name="l03660"></a>03660                         <span class="keywordflow">foreach</span> ($qs as $v) {
<a name="l03661"></a>03661                                 <span class="keywordflow">if</span> (substr($v, 0, 6) == <span class="stringliteral">&#39;debug=&#39;</span>) {
<a name="l03662"></a>03662                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In nusoap_server, set debug_flag=&quot;</span> . substr($v, 6) . <span class="stringliteral">&quot; based on query string #2&quot;</span>);
<a name="l03663"></a>03663                                         $this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a> = substr($v, 6);
<a name="l03664"></a>03664                                 }
<a name="l03665"></a>03665                         }
<a name="l03666"></a>03666                 }
<a name="l03667"></a>03667 
<a name="l03668"></a>03668                 <span class="comment">// wsdl</span>
<a name="l03669"></a>03669                 <span class="keywordflow">if</span>(<a class="code" href="classnusoap__server.html#aef1fb82b166f28799be81fe3e860329e">$wsdl</a>){
<a name="l03670"></a>03670                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In nusoap_server, WSDL is specified&quot;</span>);
<a name="l03671"></a>03671                         <span class="keywordflow">if</span> (is_object(<a class="code" href="classnusoap__server.html#aef1fb82b166f28799be81fe3e860329e">$wsdl</a>) &amp;&amp; (get_class(<a class="code" href="classnusoap__server.html#aef1fb82b166f28799be81fe3e860329e">$wsdl</a>) == <span class="stringliteral">&#39;wsdl&#39;</span>)) {
<a name="l03672"></a>03672                                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a> = <a class="code" href="classnusoap__server.html#aef1fb82b166f28799be81fe3e860329e">$wsdl</a>;
<a name="l03673"></a>03673                                 $this-&gt;externalWSDLURL = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;wsdl;
<a name="l03674"></a>03674                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Use existing wsdl instance from &#39;</span> . $this-&gt;externalWSDLURL);
<a name="l03675"></a>03675                         } <span class="keywordflow">else</span> {
<a name="l03676"></a>03676                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Create wsdl from &#39;</span> . <a class="code" href="classnusoap__server.html#aef1fb82b166f28799be81fe3e860329e">$wsdl</a>);
<a name="l03677"></a>03677                                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a> = <span class="keyword">new</span> <a class="code" href="classwsdl.html">wsdl</a>(<a class="code" href="classnusoap__server.html#aef1fb82b166f28799be81fe3e860329e">$wsdl</a>);
<a name="l03678"></a>03678                                 $this-&gt;externalWSDLURL = <a class="code" href="classnusoap__server.html#aef1fb82b166f28799be81fe3e860329e">$wsdl</a>;
<a name="l03679"></a>03679                         }
<a name="l03680"></a>03680                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l03681"></a>03681                         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;clearDebug();
<a name="l03682"></a>03682                         <span class="keywordflow">if</span>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a> = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getError()){
<a name="l03683"></a>03683                                 die(<span class="stringliteral">&#39;WSDL ERROR: &#39;</span>.<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a>);
<a name="l03684"></a>03684                         }
<a name="l03685"></a>03685                 }
<a name="l03686"></a>03686         }
<a name="l03687"></a>03687 
<a name="l03694"></a><a class="code" href="classnusoap__server.html#ae9dcdb1b0b906f8e89f621694e702420">03694</a>         function <a class="code" href="classnusoap__server.html#ae9dcdb1b0b906f8e89f621694e702420">service</a>($data){
<a name="l03695"></a>03695                 global $HTTP_SERVER_VARS;
<a name="l03696"></a>03696 
<a name="l03697"></a>03697                 <span class="keywordflow">if</span> (isset($_SERVER[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>])) {
<a name="l03698"></a>03698                         $rm = $_SERVER[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>];
<a name="l03699"></a>03699                 } elseif (isset($HTTP_SERVER_VARS[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>])) {
<a name="l03700"></a>03700                         $rm = $HTTP_SERVER_VARS[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>];
<a name="l03701"></a>03701                 } <span class="keywordflow">else</span> {
<a name="l03702"></a>03702                         $rm = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03703"></a>03703                 }
<a name="l03704"></a>03704 
<a name="l03705"></a>03705                 <span class="keywordflow">if</span> (isset($_SERVER[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>])) {
<a name="l03706"></a>03706                         $qs = $_SERVER[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>];
<a name="l03707"></a>03707                 } elseif (isset($HTTP_SERVER_VARS[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>])) {
<a name="l03708"></a>03708                         $qs = $HTTP_SERVER_VARS[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>];
<a name="l03709"></a>03709                 } <span class="keywordflow">else</span> {
<a name="l03710"></a>03710                         $qs = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03711"></a>03711                 }
<a name="l03712"></a>03712                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In service, request method=$rm query string=$qs strlen(\$data)=&quot;</span> . strlen($data));
<a name="l03713"></a>03713                 <span class="comment">//if(strpos($qs, &#39;wsdl&#39;))</span>
<a name="l03714"></a>03714                 $qs .= <span class="stringliteral">&#39;?wsdl&#39;</span>;
<a name="l03715"></a>03715 
<a name="l03716"></a>03716                 <span class="keywordflow">if</span> ($rm == <span class="stringliteral">&#39;POST&#39;</span>) {
<a name="l03717"></a>03717                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In service, invoke the request&quot;</span>);
<a name="l03718"></a>03718                         $this-&gt;<a class="code" href="classnusoap__server.html#a6e834e2d97482747691a12fe4dd58634">parse_request</a>($data);
<a name="l03719"></a>03719                         <span class="keywordflow">if</span> (! $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>) {
<a name="l03720"></a>03720                                 $this-&gt;<a class="code" href="classnusoap__server.html#a44c8d3547a947ec6df9b16abd5a65b97">invoke_method</a>();
<a name="l03721"></a>03721                         }
<a name="l03722"></a>03722                         <span class="keywordflow">if</span> (! $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>) {
<a name="l03723"></a>03723                                 $this-&gt;<a class="code" href="classnusoap__server.html#aa7114c4f5b0ab05aadd0b2f796446aeb">serialize_return</a>();
<a name="l03724"></a>03724                         }
<a name="l03725"></a>03725                         $this-&gt;<a class="code" href="classnusoap__server.html#aac3a2868dcbb2cfb57e893b63762e7b6">send_response</a>();
<a name="l03726"></a>03726                 } elseif (preg_match(<span class="stringliteral">&#39;/wsdl/&#39;</span>, $qs) ){
<a name="l03727"></a>03727                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In service, this is a request for WSDL&quot;</span>);
<a name="l03728"></a>03728                         <span class="keywordflow">if</span> ($this-&gt;externalWSDLURL){
<a name="l03729"></a>03729               <span class="keywordflow">if</span> (strpos($this-&gt;externalWSDLURL, <span class="stringliteral">&quot;http://&quot;</span>) !== <span class="keyword">false</span>) { <span class="comment">// assume URL</span>
<a name="l03730"></a>03730                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In service, re-direct for WSDL&quot;</span>);
<a name="l03731"></a>03731                                 header(<span class="stringliteral">&#39;Location: &#39;</span>.$this-&gt;externalWSDLURL);
<a name="l03732"></a>03732               } <span class="keywordflow">else</span> { <span class="comment">// assume file</span>
<a name="l03733"></a>03733                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In service, use file passthru for WSDL&quot;</span>);
<a name="l03734"></a>03734                 header(<span class="stringliteral">&quot;Content-Type: text/xml\r\n&quot;</span>);
<a name="l03735"></a>03735                                 $pos = strpos($this-&gt;externalWSDLURL, <span class="stringliteral">&quot;file://&quot;</span>);
<a name="l03736"></a>03736                                 <span class="keywordflow">if</span> ($pos === <span class="keyword">false</span>) {
<a name="l03737"></a>03737                                         $filename = $this-&gt;externalWSDLURL;
<a name="l03738"></a>03738                                 } <span class="keywordflow">else</span> {
<a name="l03739"></a>03739                                         $filename = substr($this-&gt;externalWSDLURL, $pos + 7);
<a name="l03740"></a>03740                                 }
<a name="l03741"></a>03741                 $fp = fopen($this-&gt;externalWSDLURL, <span class="charliteral">&#39;r&#39;</span>);
<a name="l03742"></a>03742                 fpassthru($fp);
<a name="l03743"></a>03743               }
<a name="l03744"></a>03744                         } elseif ($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>) {
<a name="l03745"></a>03745                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In service, serialize WSDL&quot;</span>);
<a name="l03746"></a>03746                                 header(<span class="stringliteral">&quot;Content-Type: text/xml; charset=ISO-8859-1\r\n&quot;</span>);
<a name="l03747"></a>03747                                 print $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;serialize($this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>);
<a name="l03748"></a>03748                                 <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) {
<a name="l03749"></a>03749                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;wsdl:&#39;</span>);
<a name="l03750"></a>03750                                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>));
<a name="l03751"></a>03751                                         print $this-&gt;<a class="code" href="classnusoap__base.html#a1517d53fd8ffed1b61db074b038d1521">getDebugAsXMLComment</a>();
<a name="l03752"></a>03752                                 }
<a name="l03753"></a>03753                         } <span class="keywordflow">else</span> {
<a name="l03754"></a>03754                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In service, there is no WSDL&quot;</span>);
<a name="l03755"></a>03755                                 header(<span class="stringliteral">&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;</span>);
<a name="l03756"></a>03756                                 print <span class="stringliteral">&quot;This service does not provide WSDL&quot;</span>;
<a name="l03757"></a>03757                         }
<a name="l03758"></a>03758                 } elseif ($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>) {
<a name="l03759"></a>03759                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In service, return Web description&quot;</span>);
<a name="l03760"></a>03760                         print $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;webDescription();
<a name="l03761"></a>03761                 } <span class="keywordflow">else</span> {
<a name="l03762"></a>03762                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In service, no Web description&quot;</span>);
<a name="l03763"></a>03763                         header(<span class="stringliteral">&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;</span>);
<a name="l03764"></a>03764                         print <span class="stringliteral">&quot;This service does not provide a Web description&quot;</span>;
<a name="l03765"></a>03765                 }
<a name="l03766"></a>03766         }
<a name="l03767"></a>03767 
<a name="l03780"></a><a class="code" href="classnusoap__server.html#ac548612ac90d0e70d441a5285a180fa1">03780</a>         function <a class="code" href="classnusoap__server.html#ac548612ac90d0e70d441a5285a180fa1">parse_http_headers</a>() {
<a name="l03781"></a>03781                 global $HTTP_SERVER_VARS;
<a name="l03782"></a>03782 
<a name="l03783"></a>03783                 $this-&gt;request = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03784"></a>03784                 $this-&gt;SOAPAction = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03785"></a>03785                 <span class="keywordflow">if</span>(function_exists(<span class="stringliteral">&#39;getallheaders&#39;</span>)){
<a name="l03786"></a>03786                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In parse_http_headers, use getallheaders&quot;</span>);
<a name="l03787"></a>03787                         <a class="code" href="classnusoap__server.html#abde275408fda58579fbb7f7cc44025e6">$headers</a> = getallheaders();
<a name="l03788"></a>03788                         <span class="keywordflow">foreach</span>(<a class="code" href="classnusoap__server.html#abde275408fda58579fbb7f7cc44025e6">$headers</a> as $k=&gt;$v){
<a name="l03789"></a>03789                                 $k = strtolower($k);
<a name="l03790"></a>03790                                 $this-&gt;headers[$k] = $v;
<a name="l03791"></a>03791                                 $this-&gt;request .= <span class="stringliteral">&quot;$k: $v\r\n&quot;</span>;
<a name="l03792"></a>03792                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;$k: $v&quot;</span>);
<a name="l03793"></a>03793                         }
<a name="l03794"></a>03794                         <span class="comment">// get SOAPAction header</span>
<a name="l03795"></a>03795                         <span class="keywordflow">if</span>(isset($this-&gt;headers[<span class="stringliteral">&#39;soapaction&#39;</span>])){
<a name="l03796"></a>03796                                 $this-&gt;SOAPAction = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$this-&gt;headers[<span class="stringliteral">&#39;soapaction&#39;</span>]);
<a name="l03797"></a>03797                         }
<a name="l03798"></a>03798                         <span class="comment">// get the character encoding of the incoming request</span>
<a name="l03799"></a>03799                         <span class="keywordflow">if</span>(isset($this-&gt;headers[<span class="stringliteral">&#39;content-type&#39;</span>]) &amp;&amp; strpos($this-&gt;headers[<span class="stringliteral">&#39;content-type&#39;</span>],<span class="charliteral">&#39;=&#39;</span>)){
<a name="l03800"></a>03800                                 $enc = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,substr(strstr($this-&gt;headers[<span class="stringliteral">&quot;content-type&quot;</span>],<span class="charliteral">&#39;=&#39;</span>),1));
<a name="l03801"></a>03801                                 <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/^(ISO-8859-1|US-ASCII|UTF-8)$/i&#39;</span>,$enc)){
<a name="l03802"></a>03802                                         $this-&gt;xml_encoding = strtoupper($enc);
<a name="l03803"></a>03803                                 } <span class="keywordflow">else</span> {
<a name="l03804"></a>03804                                         $this-&gt;xml_encoding = <span class="stringliteral">&#39;US-ASCII&#39;</span>;
<a name="l03805"></a>03805                                 }
<a name="l03806"></a>03806                         } <span class="keywordflow">else</span> {
<a name="l03807"></a>03807                                 <span class="comment">// should be US-ASCII for HTTP 1.0 or ISO-8859-1 for HTTP 1.1</span>
<a name="l03808"></a>03808                                 $this-&gt;xml_encoding = <span class="stringliteral">&#39;ISO-8859-1&#39;</span>;
<a name="l03809"></a>03809                         }
<a name="l03810"></a>03810                 } elseif(isset($_SERVER) &amp;&amp; is_array($_SERVER)){
<a name="l03811"></a>03811                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In parse_http_headers, use _SERVER&quot;</span>);
<a name="l03812"></a>03812                         <span class="keywordflow">foreach</span> ($_SERVER as $k =&gt; $v) {
<a name="l03813"></a>03813                                 <span class="keywordflow">if</span> (substr($k, 0, 5) == <span class="stringliteral">&#39;HTTP_&#39;</span>) {
<a name="l03814"></a>03814                                         $k = str_replace(<span class="charliteral">&#39; &#39;</span>, <span class="charliteral">&#39;-&#39;</span>, strtolower(str_replace(<span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39; &#39;</span>, substr($k, 5))));
<a name="l03815"></a>03815                                 } <span class="keywordflow">else</span> {
<a name="l03816"></a>03816                                         $k = str_replace(<span class="charliteral">&#39; &#39;</span>, <span class="charliteral">&#39;-&#39;</span>, strtolower(str_replace(<span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39; &#39;</span>, $k)));
<a name="l03817"></a>03817                                 }
<a name="l03818"></a>03818                                 <span class="keywordflow">if</span> ($k == <span class="stringliteral">&#39;soapaction&#39;</span>) {
<a name="l03819"></a>03819                                         <span class="comment">// get SOAPAction header</span>
<a name="l03820"></a>03820                                         $k = <span class="stringliteral">&#39;SOAPAction&#39;</span>;
<a name="l03821"></a>03821                                         $v = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $v);
<a name="l03822"></a>03822                                         $v = str_replace(<span class="charliteral">&#39;\\&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $v);
<a name="l03823"></a>03823                                         $this-&gt;SOAPAction = $v;
<a name="l03824"></a>03824                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($k == <span class="stringliteral">&#39;content-type&#39;</span>) {
<a name="l03825"></a>03825                                         <span class="comment">// get the character encoding of the incoming request</span>
<a name="l03826"></a>03826                                         <span class="keywordflow">if</span> (strpos($v, <span class="charliteral">&#39;=&#39;</span>)) {
<a name="l03827"></a>03827                                                 $enc = substr(strstr($v, <span class="charliteral">&#39;=&#39;</span>), 1);
<a name="l03828"></a>03828                                                 $enc = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $enc);
<a name="l03829"></a>03829                                                 $enc = str_replace(<span class="charliteral">&#39;\\&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $enc);
<a name="l03830"></a>03830                                                 <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^(ISO-8859-1|US-ASCII|UTF-8)$/i&#39;</span>,$enc)) {
<a name="l03831"></a>03831                                                         $this-&gt;xml_encoding = strtoupper($enc);
<a name="l03832"></a>03832                                                 } <span class="keywordflow">else</span> {
<a name="l03833"></a>03833                                                         $this-&gt;xml_encoding = <span class="stringliteral">&#39;US-ASCII&#39;</span>;
<a name="l03834"></a>03834                                                 }
<a name="l03835"></a>03835                                         } <span class="keywordflow">else</span> {
<a name="l03836"></a>03836                                                 <span class="comment">// should be US-ASCII for HTTP 1.0 or ISO-8859-1 for HTTP 1.1</span>
<a name="l03837"></a>03837                                                 $this-&gt;xml_encoding = <span class="stringliteral">&#39;ISO-8859-1&#39;</span>;
<a name="l03838"></a>03838                                         }
<a name="l03839"></a>03839                                 }
<a name="l03840"></a>03840                                 $this-&gt;headers[$k] = $v;
<a name="l03841"></a>03841                                 $this-&gt;request .= <span class="stringliteral">&quot;$k: $v\r\n&quot;</span>;
<a name="l03842"></a>03842                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;$k: $v&quot;</span>);
<a name="l03843"></a>03843                         }
<a name="l03844"></a>03844                 } elseif (is_array($HTTP_SERVER_VARS)) {
<a name="l03845"></a>03845                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In parse_http_headers, use HTTP_SERVER_VARS&quot;</span>);
<a name="l03846"></a>03846                         <span class="keywordflow">foreach</span> ($HTTP_SERVER_VARS as $k =&gt; $v) {
<a name="l03847"></a>03847                                 <span class="keywordflow">if</span> (substr($k, 0, 5) == <span class="stringliteral">&#39;HTTP_&#39;</span>) {
<a name="l03848"></a>03848                                         $k = str_replace(<span class="charliteral">&#39; &#39;</span>, <span class="charliteral">&#39;-&#39;</span>, strtolower(str_replace(<span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39; &#39;</span>, substr($k, 5))));                                            $k = strtolower(substr($k, 5));
<a name="l03849"></a>03849                                 } <span class="keywordflow">else</span> {
<a name="l03850"></a>03850                                         $k = str_replace(<span class="charliteral">&#39; &#39;</span>, <span class="charliteral">&#39;-&#39;</span>, strtolower(str_replace(<span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39; &#39;</span>, $k)));                                               $k = strtolower($k);
<a name="l03851"></a>03851                                 }
<a name="l03852"></a>03852                                 <span class="keywordflow">if</span> ($k == <span class="stringliteral">&#39;soapaction&#39;</span>) {
<a name="l03853"></a>03853                                         <span class="comment">// get SOAPAction header</span>
<a name="l03854"></a>03854                                         $k = <span class="stringliteral">&#39;SOAPAction&#39;</span>;
<a name="l03855"></a>03855                                         $v = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $v);
<a name="l03856"></a>03856                                         $v = str_replace(<span class="charliteral">&#39;\\&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $v);
<a name="l03857"></a>03857                                         $this-&gt;SOAPAction = $v;
<a name="l03858"></a>03858                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($k == <span class="stringliteral">&#39;content-type&#39;</span>) {
<a name="l03859"></a>03859                                         <span class="comment">// get the character encoding of the incoming request</span>
<a name="l03860"></a>03860                                         <span class="keywordflow">if</span> (strpos($v, <span class="charliteral">&#39;=&#39;</span>)) {
<a name="l03861"></a>03861                                                 $enc = substr(strstr($v, <span class="charliteral">&#39;=&#39;</span>), 1);
<a name="l03862"></a>03862                                                 $enc = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $enc);
<a name="l03863"></a>03863                                                 $enc = str_replace(<span class="charliteral">&#39;\\&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $enc);
<a name="l03864"></a>03864                                                 <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^(ISO-8859-1|US-ASCII|UTF-8)$/i&#39;</span>,$enc)) {
<a name="l03865"></a>03865                                                         $this-&gt;xml_encoding = strtoupper($enc);
<a name="l03866"></a>03866                                                 } <span class="keywordflow">else</span> {
<a name="l03867"></a>03867                                                         $this-&gt;xml_encoding = <span class="stringliteral">&#39;US-ASCII&#39;</span>;
<a name="l03868"></a>03868                                                 }
<a name="l03869"></a>03869                                         } <span class="keywordflow">else</span> {
<a name="l03870"></a>03870                                                 <span class="comment">// should be US-ASCII for HTTP 1.0 or ISO-8859-1 for HTTP 1.1</span>
<a name="l03871"></a>03871                                                 $this-&gt;xml_encoding = <span class="stringliteral">&#39;ISO-8859-1&#39;</span>;
<a name="l03872"></a>03872                                         }
<a name="l03873"></a>03873                                 }
<a name="l03874"></a>03874                                 $this-&gt;headers[$k] = $v;
<a name="l03875"></a>03875                                 $this-&gt;request .= <span class="stringliteral">&quot;$k: $v\r\n&quot;</span>;
<a name="l03876"></a>03876                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;$k: $v&quot;</span>);
<a name="l03877"></a>03877                         }
<a name="l03878"></a>03878                 } <span class="keywordflow">else</span> {
<a name="l03879"></a>03879                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;In parse_http_headers, HTTP headers not accessible&quot;</span>);
<a name="l03880"></a>03880                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;HTTP headers not accessible&quot;</span>);
<a name="l03881"></a>03881                 }
<a name="l03882"></a>03882         }
<a name="l03883"></a>03883 
<a name="l03906"></a><a class="code" href="classnusoap__server.html#a6e834e2d97482747691a12fe4dd58634">03906</a>         function <a class="code" href="classnusoap__server.html#a6e834e2d97482747691a12fe4dd58634">parse_request</a>($data=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l03907"></a>03907                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;entering parse_request()&#39;</span>);
<a name="l03908"></a>03908                 $this-&gt;<a class="code" href="classnusoap__server.html#ac548612ac90d0e70d441a5285a180fa1">parse_http_headers</a>();
<a name="l03909"></a>03909                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got character encoding: &#39;</span>.$this-&gt;xml_encoding);
<a name="l03910"></a>03910                 <span class="comment">// uncompress if necessary</span>
<a name="l03911"></a>03911                 <span class="keywordflow">if</span> (isset($this-&gt;headers[<span class="stringliteral">&#39;content-encoding&#39;</span>]) &amp;&amp; $this-&gt;headers[<span class="stringliteral">&#39;content-encoding&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l03912"></a>03912                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got content encoding: &#39;</span> . $this-&gt;headers[<span class="stringliteral">&#39;content-encoding&#39;</span>]);
<a name="l03913"></a>03913                         <span class="keywordflow">if</span> ($this-&gt;headers[<span class="stringliteral">&#39;content-encoding&#39;</span>] == <span class="stringliteral">&#39;deflate&#39;</span> || $this-&gt;headers[<span class="stringliteral">&#39;content-encoding&#39;</span>] == <span class="stringliteral">&#39;gzip&#39;</span>) {
<a name="l03914"></a>03914                         <span class="comment">// if decoding works, use it. else assume data wasn&#39;t gzencoded</span>
<a name="l03915"></a>03915                                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;gzuncompress&#39;</span>)) {
<a name="l03916"></a>03916                                         <span class="keywordflow">if</span> ($this-&gt;headers[<span class="stringliteral">&#39;content-encoding&#39;</span>] == <span class="stringliteral">&#39;deflate&#39;</span> &amp;&amp; $degzdata = @gzuncompress($data)) {
<a name="l03917"></a>03917                                                 $data = $degzdata;
<a name="l03918"></a>03918                                         } elseif ($this-&gt;headers[<span class="stringliteral">&#39;content-encoding&#39;</span>] == <span class="stringliteral">&#39;gzip&#39;</span> &amp;&amp; $degzdata = gzinflate(substr($data, 10))) {
<a name="l03919"></a>03919                                                 $data = $degzdata;
<a name="l03920"></a>03920                                         } <span class="keywordflow">else</span> {
<a name="l03921"></a>03921                                                 $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>(<span class="stringliteral">&#39;SOAP-ENV:Client&#39;</span>, <span class="stringliteral">&#39;Errors occurred when trying to decode the data&#39;</span>);
<a name="l03922"></a>03922                                                 <span class="keywordflow">return</span>;
<a name="l03923"></a>03923                                         }
<a name="l03924"></a>03924                                 } <span class="keywordflow">else</span> {
<a name="l03925"></a>03925                                         $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>(<span class="stringliteral">&#39;SOAP-ENV:Client&#39;</span>, <span class="stringliteral">&#39;This Server does not support compressed data&#39;</span>);
<a name="l03926"></a>03926                                         <span class="keywordflow">return</span>;
<a name="l03927"></a>03927                                 }
<a name="l03928"></a>03928                         }
<a name="l03929"></a>03929                 }
<a name="l03930"></a>03930                 $this-&gt;request .= <span class="stringliteral">&quot;\r\n&quot;</span>.$data;
<a name="l03931"></a>03931                 $data = $this-&gt;<a class="code" href="classnusoap__server.html#af783838a846cf093959b428afd104ac0">parseRequest</a>($this-&gt;headers, $data);
<a name="l03932"></a>03932                 $this-&gt;requestSOAP = $data;
<a name="l03933"></a>03933                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;leaving parse_request&#39;</span>);
<a name="l03934"></a>03934         }
<a name="l03935"></a>03935 
<a name="l03953"></a><a class="code" href="classnusoap__server.html#a44c8d3547a947ec6df9b16abd5a65b97">03953</a>         function <a class="code" href="classnusoap__server.html#a44c8d3547a947ec6df9b16abd5a65b97">invoke_method</a>() {
<a name="l03954"></a>03954                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, methodname=&#39;</span> . $this-&gt;methodname . <span class="stringliteral">&#39; methodURI=&#39;</span> . $this-&gt;methodURI . <span class="stringliteral">&#39; SOAPAction=&#39;</span> . $this-&gt;SOAPAction);
<a name="l03955"></a>03955 
<a name="l03956"></a>03956                 <span class="comment">//</span>
<a name="l03957"></a>03957                 <span class="comment">// if you are debugging in this area of the code, your service uses a class to implement methods,</span>
<a name="l03958"></a>03958                 <span class="comment">// you use SOAP RPC, and the client is .NET, please be aware of the following...</span>
<a name="l03959"></a>03959                 <span class="comment">// when the .NET wsdl.exe utility generates a proxy, it will remove the &#39;.&#39; or &#39;..&#39; from the</span>
<a name="l03960"></a>03960                 <span class="comment">// method name.  that is fine for naming the .NET methods.  it is not fine for properly constructing</span>
<a name="l03961"></a>03961                 <span class="comment">// the XML request and reading the XML response.  you need to add the RequestElementName and</span>
<a name="l03962"></a>03962                 <span class="comment">// ResponseElementName to the System.Web.Services.Protocols.SoapRpcMethodAttribute that wsdl.exe</span>
<a name="l03963"></a>03963                 <span class="comment">// generates for the method.  these parameters are used to specify the correct XML element names</span>
<a name="l03964"></a>03964                 <span class="comment">// for .NET to use, i.e. the names with the &#39;.&#39; in them.</span>
<a name="l03965"></a>03965                 <span class="comment">//</span>
<a name="l03966"></a>03966                 $orig_methodname = $this-&gt;methodname;
<a name="l03967"></a>03967                 <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>) {
<a name="l03968"></a>03968                         <span class="keywordflow">if</span> ($this-&gt;opData = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getOperationData($this-&gt;methodname)) {
<a name="l03969"></a>03969                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, found WSDL operation=&#39;</span> . $this-&gt;methodname);
<a name="l03970"></a>03970                                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;opData=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;opData));
<a name="l03971"></a>03971                         } elseif ($this-&gt;opData = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getOperationDataForSoapAction($this-&gt;SOAPAction)) {
<a name="l03972"></a>03972                                 <span class="comment">// Note: hopefully this case will only be used for doc/lit, since rpc services should have wrapper element</span>
<a name="l03973"></a>03973                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, found WSDL soapAction=&#39;</span> . $this-&gt;SOAPAction . <span class="stringliteral">&#39; for operation=&#39;</span> . $this-&gt;opData[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l03974"></a>03974                                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;opData=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;opData));
<a name="l03975"></a>03975                                 $this-&gt;methodname = $this-&gt;opData[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l03976"></a>03976                         } <span class="keywordflow">else</span> {
<a name="l03977"></a>03977                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, no WSDL for operation=&#39;</span> . $this-&gt;methodname);
<a name="l03978"></a>03978                                 $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>(<span class="stringliteral">&#39;SOAP-ENV:Client&#39;</span>, <span class="stringliteral">&quot;Operation &#39;&quot;</span> . $this-&gt;methodname . <span class="stringliteral">&quot;&#39; is not defined in the WSDL for this service&quot;</span>);
<a name="l03979"></a>03979                                 <span class="keywordflow">return</span>;
<a name="l03980"></a>03980                         }
<a name="l03981"></a>03981                 } <span class="keywordflow">else</span> {
<a name="l03982"></a>03982                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, no WSDL to validate method&#39;</span>);
<a name="l03983"></a>03983                 }
<a name="l03984"></a>03984 
<a name="l03985"></a>03985                 <span class="comment">// if a . is present in $this-&gt;methodname, we see if there is a class in scope,</span>
<a name="l03986"></a>03986                 <span class="comment">// which could be referred to. We will also distinguish between two deliminators,</span>
<a name="l03987"></a>03987                 <span class="comment">// to allow methods to be called a the class or an instance</span>
<a name="l03988"></a>03988                 <span class="keywordflow">if</span> (strpos($this-&gt;methodname, <span class="stringliteral">&#39;..&#39;</span>) &gt; 0) {
<a name="l03989"></a>03989                         $delim = <span class="stringliteral">&#39;..&#39;</span>;
<a name="l03990"></a>03990                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strpos($this-&gt;methodname, <span class="charliteral">&#39;.&#39;</span>) &gt; 0) {
<a name="l03991"></a>03991                         $delim = <span class="charliteral">&#39;.&#39;</span>;
<a name="l03992"></a>03992                 } <span class="keywordflow">else</span> {
<a name="l03993"></a>03993                         $delim = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03994"></a>03994                 }
<a name="l03995"></a>03995                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in invoke_method, delim=$delim&quot;</span>);
<a name="l03996"></a>03996 
<a name="l03997"></a>03997                 $class = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03998"></a>03998                 $method = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03999"></a>03999                 <span class="keywordflow">if</span> (strlen($delim) &gt; 0 &amp;&amp; substr_count($this-&gt;methodname, $delim) == 1) {
<a name="l04000"></a>04000                         $try_class = substr($this-&gt;methodname, 0, strpos($this-&gt;methodname, $delim));
<a name="l04001"></a>04001                         <span class="keywordflow">if</span> (class_exists($try_class)) {
<a name="l04002"></a>04002                                 <span class="comment">// get the class and method name</span>
<a name="l04003"></a>04003                                 $class = $try_class;
<a name="l04004"></a>04004                                 $method = substr($this-&gt;methodname, strpos($this-&gt;methodname, $delim) + strlen($delim));
<a name="l04005"></a>04005                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in invoke_method, class=$class method=$method delim=$delim&quot;</span>);
<a name="l04006"></a>04006                         } <span class="keywordflow">else</span> {
<a name="l04007"></a>04007                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in invoke_method, class=$try_class not found&quot;</span>);
<a name="l04008"></a>04008                         }
<a name="l04009"></a>04009                 } <span class="keywordflow">else</span> {
<a name="l04010"></a>04010                         $try_class = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04011"></a>04011                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in invoke_method, no class to try&quot;</span>);
<a name="l04012"></a>04012                 }
<a name="l04013"></a>04013 
<a name="l04014"></a>04014                 <span class="comment">// does method exist?</span>
<a name="l04015"></a>04015                 <span class="keywordflow">if</span> ($class == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l04016"></a>04016                         <span class="keywordflow">if</span> (!function_exists($this-&gt;methodname)) {
<a name="l04017"></a>04017                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in invoke_method, function &#39;$this-&gt;methodname&#39; not found!&quot;</span>);
<a name="l04018"></a>04018                                 $this-&gt;result = <span class="stringliteral">&#39;fault: method not found&#39;</span>;
<a name="l04019"></a>04019                                 $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>(<span class="stringliteral">&#39;SOAP-ENV:Client&#39;</span>,<span class="stringliteral">&quot;method &#39;$this-&gt;methodname&#39;(&#39;$orig_methodname&#39;) not defined in service(&#39;$try_class&#39; &#39;$delim&#39;)&quot;</span>);
<a name="l04020"></a>04020                                 <span class="keywordflow">return</span>;
<a name="l04021"></a>04021                         }
<a name="l04022"></a>04022                 } <span class="keywordflow">else</span> {
<a name="l04023"></a>04023                         $method_to_compare = (substr(phpversion(), 0, 2) == <span class="stringliteral">&#39;4.&#39;</span>) ? strtolower($method) : $method;
<a name="l04024"></a>04024                         <span class="keywordflow">if</span> (!in_array($method_to_compare, get_class_methods($class))) {
<a name="l04025"></a>04025                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in invoke_method, method &#39;$this-&gt;methodname&#39; not found in class &#39;$class&#39;!&quot;</span>);
<a name="l04026"></a>04026                                 $this-&gt;result = <span class="stringliteral">&#39;fault: method not found&#39;</span>;
<a name="l04027"></a>04027                                 $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>(<span class="stringliteral">&#39;SOAP-ENV:Client&#39;</span>,<span class="stringliteral">&quot;method &#39;$this-&gt;methodname&#39;/&#39;$method_to_compare&#39;(&#39;$orig_methodname&#39;) not defined in service/&#39;$class&#39;(&#39;$try_class&#39; &#39;$delim&#39;)&quot;</span>);
<a name="l04028"></a>04028                                 <span class="keywordflow">return</span>;
<a name="l04029"></a>04029                         }
<a name="l04030"></a>04030                 }
<a name="l04031"></a>04031 
<a name="l04032"></a>04032                 <span class="comment">// evaluate message, getting back parameters</span>
<a name="l04033"></a>04033                 <span class="comment">// verify that request parameters match the method&#39;s signature</span>
<a name="l04034"></a>04034                 <span class="keywordflow">if</span>(! $this-&gt;<a class="code" href="classnusoap__server.html#a04c9f5dc471b90764d30dd99e4fab8d5">verify_method</a>($this-&gt;methodname,$this-&gt;methodparams)){
<a name="l04035"></a>04035                         <span class="comment">// debug</span>
<a name="l04036"></a>04036                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;ERROR: request not verified against method signature&#39;</span>);
<a name="l04037"></a>04037                         $this-&gt;result = <span class="stringliteral">&#39;fault: request failed validation against method signature&#39;</span>;
<a name="l04038"></a>04038                         <span class="comment">// return fault</span>
<a name="l04039"></a>04039                         $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>(<span class="stringliteral">&#39;SOAP-ENV:Client&#39;</span>,<span class="stringliteral">&quot;Operation &#39;$this-&gt;methodname&#39; not defined in service.&quot;</span>);
<a name="l04040"></a>04040                         <span class="keywordflow">return</span>;
<a name="l04041"></a>04041                 }
<a name="l04042"></a>04042 
<a name="l04043"></a>04043                 <span class="comment">// if there are parameters to pass</span>
<a name="l04044"></a>04044                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, params:&#39;</span>);
<a name="l04045"></a>04045                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;methodparams));
<a name="l04046"></a>04046                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in invoke_method, calling &#39;$this-&gt;methodname&#39;&quot;</span>);
<a name="l04047"></a>04047                 <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;call_user_func_array&#39;</span>)) {
<a name="l04048"></a>04048                         <span class="keywordflow">if</span> ($class == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l04049"></a>04049                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, calling function using eval()&#39;</span>);
<a name="l04050"></a>04050                                 $funcCall = <span class="stringliteral">&quot;\$this-&gt;methodreturn = $this-&gt;methodname(&quot;</span>;
<a name="l04051"></a>04051                         } <span class="keywordflow">else</span> {
<a name="l04052"></a>04052                                 <span class="keywordflow">if</span> ($delim == <span class="stringliteral">&#39;..&#39;</span>) {
<a name="l04053"></a>04053                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, calling class method using eval()&#39;</span>);
<a name="l04054"></a>04054                                         $funcCall = <span class="stringliteral">&quot;\$this-&gt;methodreturn = &quot;</span>.$class.<span class="stringliteral">&quot;::&quot;</span>.$method.<span class="stringliteral">&quot;(&quot;</span>;
<a name="l04055"></a>04055                                 } <span class="keywordflow">else</span> {
<a name="l04056"></a>04056                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, calling instance method using eval()&#39;</span>);
<a name="l04057"></a>04057                                         <span class="comment">// generate unique instance name</span>
<a name="l04058"></a>04058                                         $instname = <span class="stringliteral">&quot;\$inst_&quot;</span>.time();
<a name="l04059"></a>04059                                         $funcCall = $instname.<span class="stringliteral">&quot; = new &quot;</span>.$class.<span class="stringliteral">&quot;(); &quot;</span>;
<a name="l04060"></a>04060                                         $funcCall .= <span class="stringliteral">&quot;\$this-&gt;methodreturn = &quot;</span>.$instname.<span class="stringliteral">&quot;-&gt;&quot;</span>.$method.<span class="stringliteral">&quot;(&quot;</span>;
<a name="l04061"></a>04061                                 }
<a name="l04062"></a>04062                         }
<a name="l04063"></a>04063                         <span class="keywordflow">if</span> ($this-&gt;methodparams) {
<a name="l04064"></a>04064                                 <span class="keywordflow">foreach</span> ($this-&gt;methodparams as <a class="code" href="soap__server__test_8php.html#a65d590130d833e45f20b390e6eea1354">$param</a>) {
<a name="l04065"></a>04065                                         <span class="keywordflow">if</span> (is_array($param) || is_object($param)) {
<a name="l04066"></a>04066                                                 $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>(<span class="stringliteral">&#39;SOAP-ENV:Client&#39;</span>, <span class="stringliteral">&#39;NuSOAP does not handle complexType parameters correctly when using eval; call_user_func_array must be available&#39;</span>);
<a name="l04067"></a>04067                                                 <span class="keywordflow">return</span>;
<a name="l04068"></a>04068                                         }
<a name="l04069"></a>04069                                         $funcCall .= <span class="stringliteral">&quot;\&quot;$param\&quot;,&quot;</span>;
<a name="l04070"></a>04070                                 }
<a name="l04071"></a>04071                                 $funcCall = substr($funcCall, 0, -1);
<a name="l04072"></a>04072                         }
<a name="l04073"></a>04073                         $funcCall .= <span class="stringliteral">&#39;);&#39;</span>;
<a name="l04074"></a>04074                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, function call: &#39;</span>.$funcCall);
<a name="l04075"></a>04075                         @eval($funcCall);
<a name="l04076"></a>04076                 } <span class="keywordflow">else</span> {
<a name="l04077"></a>04077                         <span class="keywordflow">if</span> ($class == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l04078"></a>04078                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, calling function using call_user_func_array()&#39;</span>);
<a name="l04079"></a>04079                                 $call_arg = <span class="stringliteral">&quot;$this-&gt;methodname&quot;</span>;        <span class="comment">// straight assignment changes $this-&gt;methodname to lower case after call_user_func_array()</span>
<a name="l04080"></a>04080                         } elseif ($delim == <span class="stringliteral">&#39;..&#39;</span>) {
<a name="l04081"></a>04081                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, calling class method using call_user_func_array()&#39;</span>);
<a name="l04082"></a>04082                                 $call_arg = array ($class, $method);
<a name="l04083"></a>04083                         } <span class="keywordflow">else</span> {
<a name="l04084"></a>04084                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, calling instance method using call_user_func_array()&#39;</span>);
<a name="l04085"></a>04085                                 $instance = <span class="keyword">new</span> $class ();
<a name="l04086"></a>04086                                 $call_arg = array(&amp;$instance, $method);
<a name="l04087"></a>04087                         }
<a name="l04088"></a>04088                         <span class="keywordflow">if</span> (is_array($this-&gt;methodparams)) {
<a name="l04089"></a>04089                                 $this-&gt;methodreturn = call_user_func_array($call_arg, array_values($this-&gt;methodparams));
<a name="l04090"></a>04090                         } <span class="keywordflow">else</span> {
<a name="l04091"></a>04091                                 $this-&gt;methodreturn = call_user_func_array($call_arg, array());
<a name="l04092"></a>04092                         }
<a name="l04093"></a>04093                 }
<a name="l04094"></a>04094         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in invoke_method, methodreturn:&#39;</span>);
<a name="l04095"></a>04095         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;methodreturn));
<a name="l04096"></a>04096                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in invoke_method, called method $this-&gt;methodname, received data of type &quot;</span>.gettype($this-&gt;methodreturn));
<a name="l04097"></a>04097         }
<a name="l04098"></a>04098 
<a name="l04110"></a><a class="code" href="classnusoap__server.html#aa7114c4f5b0ab05aadd0b2f796446aeb">04110</a>         function <a class="code" href="classnusoap__server.html#aa7114c4f5b0ab05aadd0b2f796446aeb">serialize_return</a>() {
<a name="l04111"></a>04111                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Entering serialize_return methodname: &#39;</span> . $this-&gt;methodname . <span class="stringliteral">&#39; methodURI: &#39;</span> . $this-&gt;methodURI);
<a name="l04112"></a>04112                 <span class="comment">// if fault</span>
<a name="l04113"></a>04113                 <span class="keywordflow">if</span> (isset($this-&gt;methodreturn) &amp;&amp; is_object($this-&gt;methodreturn) &amp;&amp; ((get_class($this-&gt;methodreturn) == <span class="stringliteral">&#39;soap_fault&#39;</span>) || (get_class($this-&gt;methodreturn) == <span class="stringliteral">&#39;nusoap_fault&#39;</span>))) {
<a name="l04114"></a>04114                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got a fault object from method&#39;</span>);
<a name="l04115"></a>04115                         $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a> = $this-&gt;methodreturn;
<a name="l04116"></a>04116                         <span class="keywordflow">return</span>;
<a name="l04117"></a>04117                 } elseif ($this-&gt;methodreturnisliteralxml) {
<a name="l04118"></a>04118                         $return_val = $this-&gt;methodreturn;
<a name="l04119"></a>04119                 <span class="comment">// returned value(s)</span>
<a name="l04120"></a>04120                 } <span class="keywordflow">else</span> {
<a name="l04121"></a>04121                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got a(n) &#39;</span>.gettype($this-&gt;methodreturn).<span class="stringliteral">&#39; from method&#39;</span>);
<a name="l04122"></a>04122                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;serializing return value&#39;</span>);
<a name="l04123"></a>04123                         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>){
<a name="l04124"></a>04124                                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>($this-&gt;opData[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;parts&#39;</span>]) &gt; 1) {
<a name="l04125"></a>04125                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;more than one output part, so use the method return unchanged&#39;</span>);
<a name="l04126"></a>04126                                 $opParams = $this-&gt;methodreturn;
<a name="l04127"></a>04127                             } elseif (<span class="keyword">sizeof</span>($this-&gt;opData[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;parts&#39;</span>]) == 1) {
<a name="l04128"></a>04128                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;exactly one output part, so wrap the method return in a simple array&#39;</span>);
<a name="l04129"></a>04129                                         <span class="comment">// TODO: verify that it is not already wrapped!</span>
<a name="l04130"></a>04130                                 <span class="comment">//foreach ($this-&gt;opData[&#39;output&#39;][&#39;parts&#39;] as $name =&gt; $type) {</span>
<a name="l04131"></a>04131                                         <span class="comment">//      $this-&gt;debug(&#39;wrap in element named &#39; . $name);</span>
<a name="l04132"></a>04132                                 <span class="comment">//}</span>
<a name="l04133"></a>04133                                 $opParams = array($this-&gt;methodreturn);
<a name="l04134"></a>04134                             }
<a name="l04135"></a>04135                             $return_val = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;serializeRPCParameters($this-&gt;methodname,<span class="stringliteral">&#39;output&#39;</span>,$opParams);
<a name="l04136"></a>04136                             $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l04137"></a>04137                             $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;clearDebug();
<a name="l04138"></a>04138                                 <span class="keywordflow">if</span>($errstr = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getError()){
<a name="l04139"></a>04139                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got wsdl error: &#39;</span>.$errstr);
<a name="l04140"></a>04140                                         $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>(<span class="stringliteral">&#39;SOAP-ENV:Server&#39;</span>, <span class="stringliteral">&#39;unable to serialize result&#39;</span>);
<a name="l04141"></a>04141                                         <span class="keywordflow">return</span>;
<a name="l04142"></a>04142                                 }
<a name="l04143"></a>04143                         } <span class="keywordflow">else</span> {
<a name="l04144"></a>04144                                 <span class="keywordflow">if</span> (isset($this-&gt;methodreturn)) {
<a name="l04145"></a>04145                                         $return_val = $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($this-&gt;methodreturn, <span class="stringliteral">&#39;return&#39;</span>);
<a name="l04146"></a>04146                                 } <span class="keywordflow">else</span> {
<a name="l04147"></a>04147                                         $return_val = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04148"></a>04148                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in absence of WSDL, assume void return for backward compatibility&#39;</span>);
<a name="l04149"></a>04149                                 }
<a name="l04150"></a>04150                         }
<a name="l04151"></a>04151                 }
<a name="l04152"></a>04152                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;return value:&#39;</span>);
<a name="l04153"></a>04153                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($return_val));
<a name="l04154"></a>04154 
<a name="l04155"></a>04155                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;serializing response&#39;</span>);
<a name="l04156"></a>04156                 <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>) {
<a name="l04157"></a>04157                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;have WSDL for serialization: style is &#39;</span> . $this-&gt;opData[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l04158"></a>04158                         <span class="keywordflow">if</span> ($this-&gt;opData[<span class="stringliteral">&#39;style&#39;</span>] == <span class="stringliteral">&#39;rpc&#39;</span>) {
<a name="l04159"></a>04159                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;style is rpc for serialization: use is &#39;</span> . $this-&gt;opData[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;use&#39;</span>]);
<a name="l04160"></a>04160                                 <span class="keywordflow">if</span> ($this-&gt;opData[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;use&#39;</span>] == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l04161"></a>04161                                         <span class="comment">// http://www.ws-i.org/Profiles/BasicProfile-1.1-2004-08-24.html R2735 says rpc/literal accessor elements should not be in a namespace</span>
<a name="l04162"></a>04162                                         <span class="keywordflow">if</span> ($this-&gt;methodURI) {
<a name="l04163"></a>04163                                                 $payload = <span class="stringliteral">&#39;&lt;ns1:&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&#39;Response xmlns:ns1=&quot;&#39;</span>.$this-&gt;methodURI.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$return_val.<span class="stringliteral">&#39;&lt;/ns1:&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&quot;Response&gt;&quot;</span>;
<a name="l04164"></a>04164                                         } <span class="keywordflow">else</span> {
<a name="l04165"></a>04165                                                 $payload = <span class="charliteral">&#39;&lt;&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&#39;Response&gt;&#39;</span>.$return_val.<span class="stringliteral">&#39;&lt;/&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&#39;Response&gt;&#39;</span>;
<a name="l04166"></a>04166                                         }
<a name="l04167"></a>04167                                 } <span class="keywordflow">else</span> {
<a name="l04168"></a>04168                                         <span class="keywordflow">if</span> ($this-&gt;methodURI) {
<a name="l04169"></a>04169                                                 $payload = <span class="stringliteral">&#39;&lt;ns1:&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&#39;Response xmlns:ns1=&quot;&#39;</span>.$this-&gt;methodURI.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$return_val.<span class="stringliteral">&#39;&lt;/ns1:&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&quot;Response&gt;&quot;</span>;
<a name="l04170"></a>04170                                         } <span class="keywordflow">else</span> {
<a name="l04171"></a>04171                                                 $payload = <span class="charliteral">&#39;&lt;&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&#39;Response&gt;&#39;</span>.$return_val.<span class="stringliteral">&#39;&lt;/&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&#39;Response&gt;&#39;</span>;
<a name="l04172"></a>04172                                         }
<a name="l04173"></a>04173                                 }
<a name="l04174"></a>04174                         } <span class="keywordflow">else</span> {
<a name="l04175"></a>04175                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;style is not rpc for serialization: assume document&#39;</span>);
<a name="l04176"></a>04176                                 $payload = $return_val;
<a name="l04177"></a>04177                         }
<a name="l04178"></a>04178                 } <span class="keywordflow">else</span> {
<a name="l04179"></a>04179                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;do not have WSDL for serialization: assume rpc/encoded&#39;</span>);
<a name="l04180"></a>04180                         $payload = <span class="stringliteral">&#39;&lt;ns1:&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&#39;Response xmlns:ns1=&quot;&#39;</span>.$this-&gt;methodURI.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$return_val.<span class="stringliteral">&#39;&lt;/ns1:&#39;</span>.$this-&gt;methodname.<span class="stringliteral">&quot;Response&gt;&quot;</span>;
<a name="l04181"></a>04181                 }
<a name="l04182"></a>04182                 $this-&gt;result = <span class="stringliteral">&#39;successful&#39;</span>;
<a name="l04183"></a>04183                 <span class="keywordflow">if</span>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>){
<a name="l04184"></a>04184                         <span class="comment">//if($this-&gt;debug_flag){</span>
<a name="l04185"></a>04185                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l04186"></a>04186             <span class="comment">//  }</span>
<a name="l04187"></a>04187                         <span class="keywordflow">if</span> (isset($this-&gt;opData[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>])) {
<a name="l04188"></a>04188                                 $encodingStyle = $this-&gt;opData[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>];
<a name="l04189"></a>04189                         } <span class="keywordflow">else</span> {
<a name="l04190"></a>04190                                 $encodingStyle = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04191"></a>04191                         }
<a name="l04192"></a>04192                         <span class="comment">// Added: In case we use a WSDL, return a serialized env. WITH the usedNamespaces.</span>
<a name="l04193"></a>04193                         $this-&gt;responseSOAP = $this-&gt;<a class="code" href="classnusoap__base.html#a8940fff9aa5bc728be4fee5c5d319d5e">serializeEnvelope</a>($payload,$this-&gt;responseHeaders,$this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;usedNamespaces,$this-&gt;opData[<span class="stringliteral">&#39;style&#39;</span>],$this-&gt;opData[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;use&#39;</span>],$encodingStyle);
<a name="l04194"></a>04194                 } <span class="keywordflow">else</span> {
<a name="l04195"></a>04195                         $this-&gt;responseSOAP = $this-&gt;<a class="code" href="classnusoap__base.html#a8940fff9aa5bc728be4fee5c5d319d5e">serializeEnvelope</a>($payload,$this-&gt;responseHeaders);
<a name="l04196"></a>04196                 }
<a name="l04197"></a>04197                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Leaving serialize_return&quot;</span>);
<a name="l04198"></a>04198         }
<a name="l04199"></a>04199 
<a name="l04210"></a><a class="code" href="classnusoap__server.html#aac3a2868dcbb2cfb57e893b63762e7b6">04210</a>         function <a class="code" href="classnusoap__server.html#aac3a2868dcbb2cfb57e893b63762e7b6">send_response</a>() {
<a name="l04211"></a>04211                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Enter send_response&#39;</span>);
<a name="l04212"></a>04212                 <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>) {
<a name="l04213"></a>04213                         $payload = $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>-&gt;serialize();
<a name="l04214"></a>04214                         $this-&gt;outgoing_headers[] = <span class="stringliteral">&quot;HTTP/1.0 500 Internal Server Error&quot;</span>;
<a name="l04215"></a>04215                         $this-&gt;outgoing_headers[] = <span class="stringliteral">&quot;Status: 500 Internal Server Error&quot;</span>;
<a name="l04216"></a>04216                 } <span class="keywordflow">else</span> {
<a name="l04217"></a>04217                         $payload = $this-&gt;responseSOAP;
<a name="l04218"></a>04218                         <span class="comment">// Some combinations of PHP+Web server allow the Status</span>
<a name="l04219"></a>04219                         <span class="comment">// to come through as a header.  Since OK is the default</span>
<a name="l04220"></a>04220                         <span class="comment">// just do nothing.</span>
<a name="l04221"></a>04221                         <span class="comment">// $this-&gt;outgoing_headers[] = &quot;HTTP/1.0 200 OK&quot;;</span>
<a name="l04222"></a>04222                         <span class="comment">// $this-&gt;outgoing_headers[] = &quot;Status: 200 OK&quot;;</span>
<a name="l04223"></a>04223                 }
<a name="l04224"></a>04224         <span class="comment">// add debug data if in debug mode</span>
<a name="l04225"></a>04225                 <span class="keywordflow">if</span>(isset($this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) &amp;&amp; $this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>){
<a name="l04226"></a>04226                 $payload .= $this-&gt;<a class="code" href="classnusoap__base.html#a1517d53fd8ffed1b61db074b038d1521">getDebugAsXMLComment</a>();
<a name="l04227"></a>04227         }
<a name="l04228"></a>04228                 $this-&gt;outgoing_headers[] = <span class="stringliteral">&quot;Server: $this-&gt;title Server v$this-&gt;version&quot;</span>;
<a name="l04229"></a>04229                 preg_match(<span class="stringliteral">&#39;/\$Revisio&#39;</span> . <span class="stringliteral">&#39;n: ([^ ]+)/&#39;</span>, $this-&gt;revision, $rev);
<a name="l04230"></a>04230                 $this-&gt;outgoing_headers[] = <span class="stringliteral">&quot;X-SOAP-Server: $this-&gt;title/$this-&gt;version (&quot;</span>.$rev[1].<span class="stringliteral">&quot;)&quot;</span>;
<a name="l04231"></a>04231                 <span class="comment">// Let the Web server decide about this</span>
<a name="l04232"></a>04232                 <span class="comment">//$this-&gt;outgoing_headers[] = &quot;Connection: Close\r\n&quot;;</span>
<a name="l04233"></a>04233                 $payload = $this-&gt;<a class="code" href="classnusoap__server.html#a43cc57c78918fb52a91191e864532613">getHTTPBody</a>($payload);
<a name="l04234"></a>04234                 $type = $this-&gt;<a class="code" href="classnusoap__server.html#a60ed481719d9815244a07f08ab7f0856">getHTTPContentType</a>();
<a name="l04235"></a>04235                 $charset = $this-&gt;<a class="code" href="classnusoap__server.html#aa1c476a07a34939ac6a6f15c3072066a">getHTTPContentTypeCharset</a>();
<a name="l04236"></a>04236                 $this-&gt;outgoing_headers[] = <span class="stringliteral">&quot;Content-Type: $type&quot;</span> . ($charset ? <span class="stringliteral">&#39;; charset=&#39;</span> . $charset : <span class="stringliteral">&#39;&#39;</span>);
<a name="l04237"></a>04237                 <span class="comment">//begin code to compress payload - by John</span>
<a name="l04238"></a>04238                 <span class="comment">// NOTE: there is no way to know whether the Web server will also compress</span>
<a name="l04239"></a>04239                 <span class="comment">// this data.</span>
<a name="l04240"></a>04240                 <span class="keywordflow">if</span> (strlen($payload) &gt; 1024 &amp;&amp; isset($this-&gt;headers) &amp;&amp; isset($this-&gt;headers[<span class="stringliteral">&#39;accept-encoding&#39;</span>])) {     
<a name="l04241"></a>04241                         <span class="keywordflow">if</span> (strstr($this-&gt;headers[<span class="stringliteral">&#39;accept-encoding&#39;</span>], <span class="stringliteral">&#39;gzip&#39;</span>)) {
<a name="l04242"></a>04242                                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;gzencode&#39;</span>)) {
<a name="l04243"></a>04243                                         <span class="keywordflow">if</span> (isset($this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) &amp;&amp; $this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) {
<a name="l04244"></a>04244                                                 $payload .= <span class="stringliteral">&quot;&lt;!-- Content being gzipped --&gt;&quot;</span>;
<a name="l04245"></a>04245                                         }
<a name="l04246"></a>04246                                         $this-&gt;outgoing_headers[] = <span class="stringliteral">&quot;Content-Encoding: gzip&quot;</span>;
<a name="l04247"></a>04247                                         $payload = gzencode($payload);
<a name="l04248"></a>04248                                 } <span class="keywordflow">else</span> {
<a name="l04249"></a>04249                                         <span class="keywordflow">if</span> (isset($this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) &amp;&amp; $this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) {
<a name="l04250"></a>04250                                                 $payload .= <span class="stringliteral">&quot;&lt;!-- Content will not be gzipped: no gzencode --&gt;&quot;</span>;
<a name="l04251"></a>04251                                         }
<a name="l04252"></a>04252                                 }
<a name="l04253"></a>04253                         } elseif (strstr($this-&gt;headers[<span class="stringliteral">&#39;accept-encoding&#39;</span>], <span class="stringliteral">&#39;deflate&#39;</span>)) {
<a name="l04254"></a>04254                                 <span class="comment">// Note: MSIE requires gzdeflate output (no Zlib header and checksum),</span>
<a name="l04255"></a>04255                                 <span class="comment">// instead of gzcompress output,</span>
<a name="l04256"></a>04256                                 <span class="comment">// which conflicts with HTTP 1.1 spec (http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.5)</span>
<a name="l04257"></a>04257                                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;gzdeflate&#39;</span>)) {
<a name="l04258"></a>04258                                         <span class="keywordflow">if</span> (isset($this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) &amp;&amp; $this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) {
<a name="l04259"></a>04259                                                 $payload .= <span class="stringliteral">&quot;&lt;!-- Content being deflated --&gt;&quot;</span>;
<a name="l04260"></a>04260                                         }
<a name="l04261"></a>04261                                         $this-&gt;outgoing_headers[] = <span class="stringliteral">&quot;Content-Encoding: deflate&quot;</span>;
<a name="l04262"></a>04262                                         $payload = gzdeflate($payload);
<a name="l04263"></a>04263                                 } <span class="keywordflow">else</span> {
<a name="l04264"></a>04264                                         <span class="keywordflow">if</span> (isset($this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) &amp;&amp; $this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) {
<a name="l04265"></a>04265                                                 $payload .= <span class="stringliteral">&quot;&lt;!-- Content will not be deflated: no gzcompress --&gt;&quot;</span>;
<a name="l04266"></a>04266                                         }
<a name="l04267"></a>04267                                 }
<a name="l04268"></a>04268                         }
<a name="l04269"></a>04269                 }
<a name="l04270"></a>04270                 <span class="comment">//end code</span>
<a name="l04271"></a>04271                 $this-&gt;outgoing_headers[] = <span class="stringliteral">&quot;Content-Length: &quot;</span>.strlen($payload);
<a name="l04272"></a>04272                 reset($this-&gt;outgoing_headers);
<a name="l04273"></a>04273                 <span class="keywordflow">foreach</span>($this-&gt;outgoing_headers as $hdr){
<a name="l04274"></a>04274                         header($hdr, <span class="keyword">false</span>);
<a name="l04275"></a>04275                 }
<a name="l04276"></a>04276                 print $payload;
<a name="l04277"></a>04277                 $this-&gt;response = join(<span class="stringliteral">&quot;\r\n&quot;</span>,$this-&gt;outgoing_headers).<span class="stringliteral">&quot;\r\n\r\n&quot;</span>.$payload;
<a name="l04278"></a>04278         }
<a name="l04279"></a>04279 
<a name="l04289"></a><a class="code" href="classnusoap__server.html#a04c9f5dc471b90764d30dd99e4fab8d5">04289</a>         function <a class="code" href="classnusoap__server.html#a04c9f5dc471b90764d30dd99e4fab8d5">verify_method</a>($operation,<a class="code" href="classnusoap__server.html#aa1a06b1263f86293631eaadec9f289c6">$request</a>){
<a name="l04290"></a>04290                 <span class="keywordflow">if</span>(isset($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>) &amp;&amp; is_object($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>)){
<a name="l04291"></a>04291                         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getOperationData($operation)){
<a name="l04292"></a>04292                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l04293"></a>04293                         }
<a name="l04294"></a>04294             } elseif(isset($this-&gt;operations[$operation])){
<a name="l04295"></a>04295                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l04296"></a>04296                 }
<a name="l04297"></a>04297                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l04298"></a>04298         }
<a name="l04299"></a>04299 
<a name="l04308"></a><a class="code" href="classnusoap__server.html#af783838a846cf093959b428afd104ac0">04308</a>     function <a class="code" href="classnusoap__server.html#af783838a846cf093959b428afd104ac0">parseRequest</a>(<a class="code" href="classnusoap__server.html#abde275408fda58579fbb7f7cc44025e6">$headers</a>, $data) {
<a name="l04309"></a>04309                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Entering parseRequest() for data of length &#39;</span> . strlen($data) . <span class="stringliteral">&#39; headers:&#39;</span>);
<a name="l04310"></a>04310                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classnusoap__server.html#abde275408fda58579fbb7f7cc44025e6">$headers</a>));
<a name="l04311"></a>04311         <span class="keywordflow">if</span> (!isset(<a class="code" href="classnusoap__server.html#abde275408fda58579fbb7f7cc44025e6">$headers</a>[<span class="stringliteral">&#39;content-type&#39;</span>])) {
<a name="l04312"></a>04312                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Request not of type text/xml (no content-type header)&#39;</span>);
<a name="l04313"></a>04313                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l04314"></a>04314         }
<a name="l04315"></a>04315                 <span class="keywordflow">if</span> (!strstr(<a class="code" href="classnusoap__server.html#abde275408fda58579fbb7f7cc44025e6">$headers</a>[<span class="stringliteral">&#39;content-type&#39;</span>], <span class="stringliteral">&#39;text/xml&#39;</span>)) {
<a name="l04316"></a>04316                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Request not of type text/xml&#39;</span>);
<a name="l04317"></a>04317                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l04318"></a>04318                 }
<a name="l04319"></a>04319                 <span class="keywordflow">if</span> (strpos(<a class="code" href="classnusoap__server.html#abde275408fda58579fbb7f7cc44025e6">$headers</a>[<span class="stringliteral">&#39;content-type&#39;</span>], <span class="charliteral">&#39;=&#39;</span>)) {
<a name="l04320"></a>04320                         $enc = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, substr(strstr(<a class="code" href="classnusoap__server.html#abde275408fda58579fbb7f7cc44025e6">$headers</a>[<span class="stringliteral">&quot;content-type&quot;</span>], <span class="charliteral">&#39;=&#39;</span>), 1));
<a name="l04321"></a>04321                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Got response encoding: &#39;</span> . $enc);
<a name="l04322"></a>04322                         <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/^(ISO-8859-1|US-ASCII|UTF-8)$/i&#39;</span>,$enc)){
<a name="l04323"></a>04323                                 $this-&gt;xml_encoding = strtoupper($enc);
<a name="l04324"></a>04324                         } <span class="keywordflow">else</span> {
<a name="l04325"></a>04325                                 $this-&gt;xml_encoding = <span class="stringliteral">&#39;US-ASCII&#39;</span>;
<a name="l04326"></a>04326                         }
<a name="l04327"></a>04327                 } <span class="keywordflow">else</span> {
<a name="l04328"></a>04328                         <span class="comment">// should be US-ASCII for HTTP 1.0 or ISO-8859-1 for HTTP 1.1</span>
<a name="l04329"></a>04329                         $this-&gt;xml_encoding = <span class="stringliteral">&#39;ISO-8859-1&#39;</span>;
<a name="l04330"></a>04330                 }
<a name="l04331"></a>04331                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Use encoding: &#39;</span> . $this-&gt;xml_encoding . <span class="stringliteral">&#39; when creating nusoap_parser&#39;</span>);
<a name="l04332"></a>04332                 <span class="comment">// parse response, get soap parser obj</span>
<a name="l04333"></a>04333                 $parser = <span class="keyword">new</span> <a class="code" href="classnusoap__parser.html">nusoap_parser</a>($data,$this-&gt;xml_encoding,<span class="stringliteral">&#39;&#39;</span>,$this-&gt;decode_utf8);
<a name="l04334"></a>04334                 <span class="comment">// parser debug</span>
<a name="l04335"></a>04335                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;parser debug: \n&quot;</span>.$parser-&gt;getDebug());
<a name="l04336"></a>04336                 <span class="comment">// if fault occurred during message parsing</span>
<a name="l04337"></a>04337                 <span class="keywordflow">if</span>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a> = $parser-&gt;getError()){
<a name="l04338"></a>04338                         $this-&gt;result = <span class="stringliteral">&#39;fault: error in msg parsing: &#39;</span>.$err;
<a name="l04339"></a>04339                         $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>(<span class="stringliteral">&#39;SOAP-ENV:Client&#39;</span>,<span class="stringliteral">&quot;error in msg parsing:\n&quot;</span>.<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a>);
<a name="l04340"></a>04340                 <span class="comment">// else successfully parsed request into soapval object</span>
<a name="l04341"></a>04341                 } <span class="keywordflow">else</span> {
<a name="l04342"></a>04342                         <span class="comment">// get/set methodname</span>
<a name="l04343"></a>04343                         $this-&gt;methodURI = $parser-&gt;root_struct_namespace;
<a name="l04344"></a>04344                         $this-&gt;methodname = $parser-&gt;root_struct_name;
<a name="l04345"></a>04345                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;methodname: &#39;</span>.$this-&gt;methodname.<span class="stringliteral">&#39; methodURI: &#39;</span>.$this-&gt;methodURI);
<a name="l04346"></a>04346                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling parser-&gt;get_soapbody()&#39;</span>);
<a name="l04347"></a>04347                         $this-&gt;methodparams = $parser-&gt;get_soapbody();
<a name="l04348"></a>04348                         <span class="comment">// get SOAP headers</span>
<a name="l04349"></a>04349                         $this-&gt;requestHeaders = $parser-&gt;getHeaders();
<a name="l04350"></a>04350                         <span class="comment">// get SOAP Header</span>
<a name="l04351"></a>04351                         $this-&gt;requestHeader = $parser-&gt;get_soapheader();
<a name="l04352"></a>04352             <span class="comment">// add document for doclit support</span>
<a name="l04353"></a>04353             $this-&gt;document = $parser-&gt;document;
<a name="l04354"></a>04354                 }
<a name="l04355"></a>04355          }
<a name="l04356"></a>04356 
<a name="l04364"></a><a class="code" href="classnusoap__server.html#a43cc57c78918fb52a91191e864532613">04364</a>         function <a class="code" href="classnusoap__server.html#a43cc57c78918fb52a91191e864532613">getHTTPBody</a>($soapmsg) {
<a name="l04365"></a>04365                 <span class="keywordflow">return</span> $soapmsg;
<a name="l04366"></a>04366         }
<a name="l04367"></a>04367         
<a name="l04376"></a><a class="code" href="classnusoap__server.html#a60ed481719d9815244a07f08ab7f0856">04376</a>         function <a class="code" href="classnusoap__server.html#a60ed481719d9815244a07f08ab7f0856">getHTTPContentType</a>() {
<a name="l04377"></a>04377                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;text/xml&#39;</span>;
<a name="l04378"></a>04378         }
<a name="l04379"></a>04379         
<a name="l04389"></a><a class="code" href="classnusoap__server.html#aa1c476a07a34939ac6a6f15c3072066a">04389</a>         function <a class="code" href="classnusoap__server.html#aa1c476a07a34939ac6a6f15c3072066a">getHTTPContentTypeCharset</a>() {
<a name="l04390"></a>04390                 <span class="keywordflow">return</span> $this-&gt;soap_defencoding;
<a name="l04391"></a>04391         }
<a name="l04392"></a>04392 
<a name="l04402"></a><a class="code" href="classnusoap__server.html#a4a109efdadea28bdf8878e5104099641">04402</a>         function <a class="code" href="classnusoap__server.html#a4a109efdadea28bdf8878e5104099641">add_to_map</a>(<a class="code" href="classnusoap__server.html#aa3889c896a3ff3bc86d2932c12c5420c">$methodname</a>,$in,$out){
<a name="l04403"></a>04403                         $this-&gt;operations[<a class="code" href="classnusoap__server.html#aa3889c896a3ff3bc86d2932c12c5420c">$methodname</a>] = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; <a class="code" href="classnusoap__server.html#aa3889c896a3ff3bc86d2932c12c5420c">$methodname</a>,<span class="stringliteral">&#39;in&#39;</span> =&gt; $in,<span class="stringliteral">&#39;out&#39;</span> =&gt; $out);
<a name="l04404"></a>04404         }
<a name="l04405"></a>04405 
<a name="l04420"></a><a class="code" href="classnusoap__server.html#a04ab5af82104c24ac84f3f1d4cc3d4b7">04420</a>         function <span class="keyword">register</span>($name,$in=array(),$out=array(),$namespace=<span class="keyword">false</span>,$soapaction=<span class="keyword">false</span>,$style=<span class="keyword">false</span>,$use=<span class="keyword">false</span>,$documentation=<span class="stringliteral">&#39;&#39;</span>,$encodingStyle=<span class="stringliteral">&#39;&#39;</span>){
<a name="l04421"></a>04421                 global $HTTP_SERVER_VARS;
<a name="l04422"></a>04422 
<a name="l04423"></a>04423                 <span class="keywordflow">if</span>($this-&gt;externalWSDLURL){
<a name="l04424"></a>04424                         die(<span class="stringliteral">&#39;You cannot bind to an external WSDL file, and register methods outside of it! Please choose either WSDL or no WSDL.&#39;</span>);
<a name="l04425"></a>04425                 }
<a name="l04426"></a>04426                 <span class="keywordflow">if</span> (! $name) {
<a name="l04427"></a>04427                         die(<span class="stringliteral">&#39;You must specify a name when you register an operation&#39;</span>);
<a name="l04428"></a>04428                 }
<a name="l04429"></a>04429                 <span class="keywordflow">if</span> (!is_array($in)) {
<a name="l04430"></a>04430                         die(<span class="stringliteral">&#39;You must provide an array for operation inputs&#39;</span>);
<a name="l04431"></a>04431                 }
<a name="l04432"></a>04432                 <span class="keywordflow">if</span> (!is_array($out)) {
<a name="l04433"></a>04433                         die(<span class="stringliteral">&#39;You must provide an array for operation outputs&#39;</span>);
<a name="l04434"></a>04434                 }
<a name="l04435"></a>04435                 <span class="keywordflow">if</span>(<span class="keyword">false</span> == $namespace) {
<a name="l04436"></a>04436                 }
<a name="l04437"></a>04437                 <span class="keywordflow">if</span>(<span class="keyword">false</span> == $soapaction) {
<a name="l04438"></a>04438                         <span class="keywordflow">if</span> (isset($_SERVER)) {
<a name="l04439"></a>04439                                 $SERVER_NAME = $_SERVER[<span class="stringliteral">&#39;SERVER_NAME&#39;</span>];
<a name="l04440"></a>04440                                 $SCRIPT_NAME = isset($_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>]) ? $_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>] : $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>];
<a name="l04441"></a>04441                                 $HTTPS = isset($_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>]) ? $_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>] : (isset($HTTP_SERVER_VARS[<span class="stringliteral">&#39;HTTPS&#39;</span>]) ? $HTTP_SERVER_VARS[<span class="stringliteral">&#39;HTTPS&#39;</span>] : <span class="stringliteral">&#39;off&#39;</span>);
<a name="l04442"></a>04442                         } elseif (isset($HTTP_SERVER_VARS)) {
<a name="l04443"></a>04443                                 $SERVER_NAME = $HTTP_SERVER_VARS[<span class="stringliteral">&#39;SERVER_NAME&#39;</span>];
<a name="l04444"></a>04444                                 $SCRIPT_NAME = isset($HTTP_SERVER_VARS[<span class="stringliteral">&#39;PHP_SELF&#39;</span>]) ? $HTTP_SERVER_VARS[<span class="stringliteral">&#39;PHP_SELF&#39;</span>] : $HTTP_SERVER_VARS[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>];
<a name="l04445"></a>04445                                 $HTTPS = isset($HTTP_SERVER_VARS[<span class="stringliteral">&#39;HTTPS&#39;</span>]) ? $HTTP_SERVER_VARS[<span class="stringliteral">&#39;HTTPS&#39;</span>] : <span class="stringliteral">&#39;off&#39;</span>;
<a name="l04446"></a>04446                         } <span class="keywordflow">else</span> {
<a name="l04447"></a>04447                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;Neither _SERVER nor HTTP_SERVER_VARS is available&quot;</span>);
<a name="l04448"></a>04448                         }
<a name="l04449"></a>04449                 <span class="keywordflow">if</span> ($HTTPS == <span class="charliteral">&#39;1&#39;</span> || $HTTPS == <span class="stringliteral">&#39;on&#39;</span>) {
<a name="l04450"></a>04450                         $SCHEME = <span class="stringliteral">&#39;https&#39;</span>;
<a name="l04451"></a>04451                 } <span class="keywordflow">else</span> {
<a name="l04452"></a>04452                         $SCHEME = <span class="stringliteral">&#39;http&#39;</span>;
<a name="l04453"></a>04453                 }
<a name="l04454"></a>04454                         $soapaction = <span class="stringliteral">&quot;$SCHEME://$SERVER_NAME$SCRIPT_NAME/$name&quot;</span>;
<a name="l04455"></a>04455                 }
<a name="l04456"></a>04456                 <span class="keywordflow">if</span>(<span class="keyword">false</span> == $style) {
<a name="l04457"></a>04457                         $style = <span class="stringliteral">&quot;rpc&quot;</span>;
<a name="l04458"></a>04458                 }
<a name="l04459"></a>04459                 <span class="keywordflow">if</span>(<span class="keyword">false</span> == $use) {
<a name="l04460"></a>04460                         $use = <span class="stringliteral">&quot;encoded&quot;</span>;
<a name="l04461"></a>04461                 }
<a name="l04462"></a>04462                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;encoded&#39;</span> &amp;&amp; $encodingStyle == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l04463"></a>04463                         $encodingStyle = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>;
<a name="l04464"></a>04464                 }
<a name="l04465"></a>04465 
<a name="l04466"></a>04466                 $this-&gt;operations[$name] = array(
<a name="l04467"></a>04467             <span class="stringliteral">&#39;name&#39;</span> =&gt; $name,
<a name="l04468"></a>04468             <span class="stringliteral">&#39;in&#39;</span> =&gt; $in,
<a name="l04469"></a>04469             <span class="stringliteral">&#39;out&#39;</span> =&gt; $out,
<a name="l04470"></a>04470             <span class="stringliteral">&#39;namespace&#39;</span> =&gt; $namespace,
<a name="l04471"></a>04471             <span class="stringliteral">&#39;soapaction&#39;</span> =&gt; $soapaction,
<a name="l04472"></a>04472             <span class="stringliteral">&#39;style&#39;</span> =&gt; $style);
<a name="l04473"></a>04473         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>){
<a name="l04474"></a>04474                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;addOperation($name,$in,$out,$namespace,$soapaction,$style,$use,$documentation,$encodingStyle);
<a name="l04475"></a>04475             }
<a name="l04476"></a>04476                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l04477"></a>04477         }
<a name="l04478"></a>04478 
<a name="l04489"></a><a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">04489</a>         function <a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>($faultcode,$faultstring,$faultactor=<span class="stringliteral">&#39;&#39;</span>,$faultdetail=<span class="stringliteral">&#39;&#39;</span>){
<a name="l04490"></a>04490                 <span class="keywordflow">if</span> ($faultdetail == <span class="stringliteral">&#39;&#39;</span> &amp;&amp; $this-&gt;<a class="code" href="soap__server__test_8php.html#a43b8c02253580292ad8dc5d99132cc83">debug_flag</a>) {
<a name="l04491"></a>04491                         $faultdetail = $this-&gt;<a class="code" href="classnusoap__base.html#a0ad5e3365040a6352f7064e107f3dab7">getDebug</a>();
<a name="l04492"></a>04492                 }
<a name="l04493"></a>04493                 $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a> = <span class="keyword">new</span> <a class="code" href="classnusoap__fault.html">nusoap_fault</a>($faultcode,$faultactor,$faultstring,$faultdetail);
<a name="l04494"></a>04494                 $this-&gt;<a class="code" href="classnusoap__server.html#ab01204b7115df558b41abfcaa8172eb1">fault</a>-&gt;soap_defencoding = $this-&gt;soap_defencoding;
<a name="l04495"></a>04495         }
<a name="l04496"></a>04496 
<a name="l04508"></a><a class="code" href="classnusoap__server.html#aba8122a161cbc7b09bf1481dd78473fc">04508</a>     function <a class="code" href="classnusoap__server.html#aba8122a161cbc7b09bf1481dd78473fc">configureWSDL</a>($serviceName,$namespace = <span class="keyword">false</span>,$endpoint = <span class="keyword">false</span>,$style=<span class="stringliteral">&#39;rpc&#39;</span>, $transport = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/http&#39;</span>, $schemaTargetNamespace = <span class="keyword">false</span>)
<a name="l04509"></a>04509     {
<a name="l04510"></a>04510         global $HTTP_SERVER_VARS;
<a name="l04511"></a>04511 
<a name="l04512"></a>04512                 <span class="keywordflow">if</span> (isset($_SERVER)) {
<a name="l04513"></a>04513                         $SERVER_NAME = $_SERVER[<span class="stringliteral">&#39;SERVER_NAME&#39;</span>];
<a name="l04514"></a>04514                         $SERVER_PORT = $_SERVER[<span class="stringliteral">&#39;SERVER_PORT&#39;</span>];
<a name="l04515"></a>04515                         $SCRIPT_NAME = isset($_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>]) ? $_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>] : $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>];
<a name="l04516"></a>04516                         $HTTPS = isset($_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>]) ? $_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>] : (isset($HTTP_SERVER_VARS[<span class="stringliteral">&#39;HTTPS&#39;</span>]) ? $HTTP_SERVER_VARS[<span class="stringliteral">&#39;HTTPS&#39;</span>] : <span class="stringliteral">&#39;off&#39;</span>);
<a name="l04517"></a>04517                 } elseif (isset($HTTP_SERVER_VARS)) {
<a name="l04518"></a>04518                         $SERVER_NAME = $HTTP_SERVER_VARS[<span class="stringliteral">&#39;SERVER_NAME&#39;</span>];
<a name="l04519"></a>04519                         $SERVER_PORT = $HTTP_SERVER_VARS[<span class="stringliteral">&#39;SERVER_PORT&#39;</span>];
<a name="l04520"></a>04520                         $SCRIPT_NAME = isset($HTTP_SERVER_VARS[<span class="stringliteral">&#39;PHP_SELF&#39;</span>]) ? $HTTP_SERVER_VARS[<span class="stringliteral">&#39;PHP_SELF&#39;</span>] : $HTTP_SERVER_VARS[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>];
<a name="l04521"></a>04521                         $HTTPS = isset($HTTP_SERVER_VARS[<span class="stringliteral">&#39;HTTPS&#39;</span>]) ? $HTTP_SERVER_VARS[<span class="stringliteral">&#39;HTTPS&#39;</span>] : <span class="stringliteral">&#39;off&#39;</span>;
<a name="l04522"></a>04522                 } <span class="keywordflow">else</span> {
<a name="l04523"></a>04523                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;Neither _SERVER nor HTTP_SERVER_VARS is available&quot;</span>);
<a name="l04524"></a>04524                 }
<a name="l04525"></a>04525                 <span class="comment">// If server name has port number attached then strip it (else port number gets duplicated in WSDL output) (occurred using lighttpd and FastCGI)</span>
<a name="l04526"></a>04526                 $colon = strpos($SERVER_NAME,<span class="stringliteral">&quot;:&quot;</span>);
<a name="l04527"></a>04527                 <span class="keywordflow">if</span> ($colon) {
<a name="l04528"></a>04528                     $SERVER_NAME = substr($SERVER_NAME, 0, $colon);
<a name="l04529"></a>04529                 }
<a name="l04530"></a>04530                 <span class="keywordflow">if</span> ($SERVER_PORT == 80) {
<a name="l04531"></a>04531                         $SERVER_PORT = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04532"></a>04532                 } <span class="keywordflow">else</span> {
<a name="l04533"></a>04533                         $SERVER_PORT = <span class="charliteral">&#39;:&#39;</span> . $SERVER_PORT;
<a name="l04534"></a>04534                 }
<a name="l04535"></a>04535         <span class="keywordflow">if</span>(<span class="keyword">false</span> == $namespace) {
<a name="l04536"></a>04536             $namespace = <span class="stringliteral">&quot;http://$SERVER_NAME/soap/$serviceName&quot;</span>;
<a name="l04537"></a>04537         }
<a name="l04538"></a>04538         
<a name="l04539"></a>04539         <span class="keywordflow">if</span>(<span class="keyword">false</span> == $endpoint) {
<a name="l04540"></a>04540                 <span class="keywordflow">if</span> ($HTTPS == <span class="charliteral">&#39;1&#39;</span> || $HTTPS == <span class="stringliteral">&#39;on&#39;</span>) {
<a name="l04541"></a>04541                         $SCHEME = <span class="stringliteral">&#39;https&#39;</span>;
<a name="l04542"></a>04542                 } <span class="keywordflow">else</span> {
<a name="l04543"></a>04543                         $SCHEME = <span class="stringliteral">&#39;http&#39;</span>;
<a name="l04544"></a>04544                 }
<a name="l04545"></a>04545             $endpoint = <span class="stringliteral">&quot;$SCHEME://$SERVER_NAME$SERVER_PORT$SCRIPT_NAME&quot;</span>;
<a name="l04546"></a>04546         }
<a name="l04547"></a>04547         
<a name="l04548"></a>04548         <span class="keywordflow">if</span>(<span class="keyword">false</span> == $schemaTargetNamespace) {
<a name="l04549"></a>04549             $schemaTargetNamespace = $namespace;
<a name="l04550"></a>04550         }
<a name="l04551"></a>04551         
<a name="l04552"></a>04552                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a> = <span class="keyword">new</span> <a class="code" href="classwsdl.html">wsdl</a>;
<a name="l04553"></a>04553                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;serviceName = $serviceName;
<a name="l04554"></a>04554         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;endpoint = $endpoint;
<a name="l04555"></a>04555                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>] = $namespace;
<a name="l04556"></a>04556                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;namespaces[<span class="stringliteral">&#39;soap&#39;</span>] = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap/&#39;</span>;
<a name="l04557"></a>04557                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;namespaces[<span class="stringliteral">&#39;wsdl&#39;</span>] = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/&#39;</span>;
<a name="l04558"></a>04558                 <span class="keywordflow">if</span> ($schemaTargetNamespace != $namespace) {
<a name="l04559"></a>04559                         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>] = $schemaTargetNamespace;
<a name="l04560"></a>04560                 }
<a name="l04561"></a>04561         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;schemas[$schemaTargetNamespace][0] = <span class="keyword">new</span> <a class="code" href="classnusoap__xmlschema.html">nusoap_xmlschema</a>(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;namespaces);
<a name="l04562"></a>04562         <span class="keywordflow">if</span> ($style == <span class="stringliteral">&#39;document&#39;</span>) {
<a name="l04563"></a>04563                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;schemas[$schemaTargetNamespace][0]-&gt;schemaInfo[<span class="stringliteral">&#39;elementFormDefault&#39;</span>] = <span class="stringliteral">&#39;qualified&#39;</span>;
<a name="l04564"></a>04564         }
<a name="l04565"></a>04565         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;schemas[$schemaTargetNamespace][0]-&gt;schemaTargetNamespace = $schemaTargetNamespace;
<a name="l04566"></a>04566         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;schemas[$schemaTargetNamespace][0]-&gt;imports[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>][0] = array(<span class="stringliteral">&#39;location&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;loaded&#39;</span> =&gt; <span class="keyword">true</span>);
<a name="l04567"></a>04567         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;schemas[$schemaTargetNamespace][0]-&gt;imports[<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/&#39;</span>][0] = array(<span class="stringliteral">&#39;location&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;loaded&#39;</span> =&gt; <span class="keyword">true</span>);
<a name="l04568"></a>04568         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;bindings[$serviceName.<span class="stringliteral">&#39;Binding&#39;</span>] = array(
<a name="l04569"></a>04569                 <span class="stringliteral">&#39;name&#39;</span>=&gt;$serviceName.<span class="stringliteral">&#39;Binding&#39;</span>,
<a name="l04570"></a>04570             <span class="stringliteral">&#39;style&#39;</span>=&gt;$style,
<a name="l04571"></a>04571             <span class="stringliteral">&#39;transport&#39;</span>=&gt;$transport,
<a name="l04572"></a>04572             <span class="stringliteral">&#39;portType&#39;</span>=&gt;$serviceName.<span class="stringliteral">&#39;PortType&#39;</span>);
<a name="l04573"></a>04573         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;ports[$serviceName.<span class="stringliteral">&#39;Port&#39;</span>] = array(
<a name="l04574"></a>04574                 <span class="stringliteral">&#39;binding&#39;</span>=&gt;$serviceName.<span class="stringliteral">&#39;Binding&#39;</span>,
<a name="l04575"></a>04575             <span class="stringliteral">&#39;location&#39;</span>=&gt;$endpoint,
<a name="l04576"></a>04576             <span class="stringliteral">&#39;bindingType&#39;</span>=&gt;<span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap/&#39;</span>);
<a name="l04577"></a>04577     }
<a name="l04578"></a>04578 }
<a name="l04579"></a>04579 
<a name="l04583"></a>04583 <span class="keyword">class </span><a class="code" href="classsoap__server.html">soap_server</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__server.html">nusoap_server</a> {
<a name="l04584"></a>04584 }
<a name="l04585"></a>04585 
<a name="l04586"></a>04586 ?&gt;&lt;?php
<a name="l04587"></a>04587 
<a name="l04588"></a>04588 
<a name="l04589"></a>04589 
<a name="l04599"></a>04599 <span class="keyword">class </span><a class="code" href="classwsdl.html">wsdl</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__base.html">nusoap_base</a> {
<a name="l04600"></a>04600         <span class="comment">// URL or filename of the root of this WSDL</span>
<a name="l04601"></a>04601     var <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>; 
<a name="l04602"></a>04602     <span class="comment">// define internal arrays of bindings, ports, operations, messages, etc.</span>
<a name="l04603"></a>04603     var <a class="code" href="classwsdl.html#ad080272d3605cb3a38d26962c2e278dd">$schemas</a> = array();
<a name="l04604"></a>04604     var <a class="code" href="classwsdl.html#a186097f9496b1773db133ead2cffe32d">$currentSchema</a>;
<a name="l04605"></a>04605     var <a class="code" href="classwsdl.html#aa2b59468dff3a034248f2b535a1de097">$message</a> = array();
<a name="l04606"></a>04606     var <a class="code" href="classwsdl.html#ad413198f9389cd71544be0e07debbf15">$complexTypes</a> = array();
<a name="l04607"></a>04607     var <a class="code" href="classwsdl.html#a5c57457ea9526d46d677cfb1027e4f97">$messages</a> = array();
<a name="l04608"></a>04608     var <a class="code" href="classwsdl.html#a01242b72d1706c165c0c35667dbf7bd1">$currentMessage</a>;
<a name="l04609"></a>04609     var <a class="code" href="classwsdl.html#a5a19e7bf907954b227e65e6ad2f1dbb2">$currentOperation</a>;
<a name="l04610"></a>04610     var <a class="code" href="classwsdl.html#a58ca918633989e8fa6bfba61e48087ee">$portTypes</a> = array();
<a name="l04611"></a>04611     var <a class="code" href="classwsdl.html#a2655c21706b6482adc13e33f7914297d">$currentPortType</a>;
<a name="l04612"></a>04612     var <a class="code" href="classwsdl.html#a69fb53ca70e0a06213aba6efe703fda3">$bindings</a> = array();
<a name="l04613"></a>04613     var <a class="code" href="classwsdl.html#af4a53d9d40636f2f465eeb4bc4be4239">$currentBinding</a>;
<a name="l04614"></a>04614     var <a class="code" href="classwsdl.html#a0d3d7f9336d54e8294e3be42b2286e64">$ports</a> = array();
<a name="l04615"></a>04615     var <a class="code" href="classwsdl.html#ad39ca436b722e162295d3e58a074e317">$currentPort</a>;
<a name="l04616"></a>04616     var <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a> = array();
<a name="l04617"></a>04617     var <a class="code" href="classwsdl.html#a3a27b7fd67cea14c6a802d1cb4ce678d">$status</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04618"></a>04618     var <a class="code" href="classwsdl.html#a90e868755e79fd7f8c37ec8345167952">$documentation</a> = <span class="keyword">false</span>;
<a name="l04619"></a>04619     var <a class="code" href="classwsdl.html#a8661410d035aa806a04997ed0a229b74">$endpoint</a> = <span class="stringliteral">&#39;&#39;</span>; 
<a name="l04620"></a>04620     <span class="comment">// array of wsdl docs to import</span>
<a name="l04621"></a>04621     var <a class="code" href="classwsdl.html#a01554a70869c02bdf1d423cf3f74633f">$import</a> = array(); 
<a name="l04622"></a>04622     <span class="comment">// parser vars</span>
<a name="l04623"></a>04623     var <a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>;
<a name="l04624"></a>04624     var <a class="code" href="classwsdl.html#acad521fa206d4aa342ed90dc04bef4ef">$position</a> = 0;
<a name="l04625"></a>04625     var <a class="code" href="classwsdl.html#a691f58222b4f45f166bd86b322167c74">$depth</a> = 0;
<a name="l04626"></a>04626     var <a class="code" href="classwsdl.html#abfb5ed7d1824cd3cd6a3a6460acf88f3">$depth_array</a> = array();
<a name="l04627"></a>04627         <span class="comment">// for getting wsdl</span>
<a name="l04628"></a>04628         var <a class="code" href="classwsdl.html#a108b5bea71b554398ff845f538b18388">$proxyhost</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04629"></a>04629     var <a class="code" href="classwsdl.html#aaddf7e68a36ab38d81379d94172574c3">$proxyport</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04630"></a>04630         var <a class="code" href="classwsdl.html#a87d216a60f34a55e343fbcf0249bd554">$proxyusername</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04631"></a>04631         var <a class="code" href="classwsdl.html#a46c27fa0bea5678345cc3505a94b5988">$proxypassword</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04632"></a>04632         var <a class="code" href="classwsdl.html#a77db04ebe7b299466caa2f9e2e5ad545">$timeout</a> = 0;
<a name="l04633"></a>04633         var <a class="code" href="classwsdl.html#ae54ca6c0a8cf901640cddbdc59eaabd4">$response_timeout</a> = 30;
<a name="l04634"></a>04634         var <a class="code" href="classwsdl.html#ad8e4cb335b9e62fd8affb23790ad9882">$curl_options</a> = array();    <span class="comment">// User-specified cURL options</span>
<a name="l04635"></a>04635         var <a class="code" href="classwsdl.html#a86e4f6d4d20f35a558b1a1a904567053">$use_curl</a> = <span class="keyword">false</span>;                  <span class="comment">// whether to always try to use cURL</span>
<a name="l04636"></a>04636         <span class="comment">// for HTTP authentication</span>
<a name="l04637"></a>04637         var <a class="code" href="classwsdl.html#a02a050652e5d9f5315532c4197598463">$username</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// Username for HTTP authentication</span>
<a name="l04638"></a>04638         var <a class="code" href="classwsdl.html#a672c75b3581df84b5998b52aaeced9f4">$password</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// Password for HTTP authentication</span>
<a name="l04639"></a>04639         var <a class="code" href="classwsdl.html#ab0e009f97d9a7be261c3cbf373938ca0">$authtype</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// Type of HTTP authentication</span>
<a name="l04640"></a>04640         var <a class="code" href="classwsdl.html#a50b3268de8446e1033882bf4b96efd47">$certRequest</a> = array();             <span class="comment">// Certificate for HTTP SSL authentication</span>
<a name="l04641"></a>04641 
<a name="l04656"></a><a class="code" href="classwsdl.html#ad304343ce214bae1f772509daa9f79fb">04656</a>     function <a class="code" href="classwsdl.html#ad304343ce214bae1f772509daa9f79fb">wsdl</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a> = <span class="stringliteral">&#39;&#39;</span>,<a class="code" href="classwsdl.html#a108b5bea71b554398ff845f538b18388">$proxyhost</a>=<span class="keyword">false</span>,<a class="code" href="classwsdl.html#aaddf7e68a36ab38d81379d94172574c3">$proxyport</a>=<span class="keyword">false</span>,<a class="code" href="classwsdl.html#a87d216a60f34a55e343fbcf0249bd554">$proxyusername</a>=<span class="keyword">false</span>,<a class="code" href="classwsdl.html#a46c27fa0bea5678345cc3505a94b5988">$proxypassword</a>=<span class="keyword">false</span>,<a class="code" href="classwsdl.html#a77db04ebe7b299466caa2f9e2e5ad545">$timeout</a>=0,<a class="code" href="classwsdl.html#ae54ca6c0a8cf901640cddbdc59eaabd4">$response_timeout</a>=30,<a class="code" href="classwsdl.html#ad8e4cb335b9e62fd8affb23790ad9882">$curl_options</a>=null,<a class="code" href="classwsdl.html#a86e4f6d4d20f35a558b1a1a904567053">$use_curl</a>=<span class="keyword">false</span>){
<a name="l04657"></a>04657                 <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">parent::nusoap_base</a>();
<a name="l04658"></a>04658                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;ctor wsdl=$wsdl timeout=$timeout response_timeout=$response_timeout&quot;</span>);
<a name="l04659"></a>04659         $this-&gt;proxyhost = <a class="code" href="classwsdl.html#a108b5bea71b554398ff845f538b18388">$proxyhost</a>;
<a name="l04660"></a>04660         $this-&gt;proxyport = <a class="code" href="classwsdl.html#aaddf7e68a36ab38d81379d94172574c3">$proxyport</a>;
<a name="l04661"></a>04661                 $this-&gt;proxyusername = <a class="code" href="classwsdl.html#a87d216a60f34a55e343fbcf0249bd554">$proxyusername</a>;
<a name="l04662"></a>04662                 $this-&gt;proxypassword = <a class="code" href="classwsdl.html#a46c27fa0bea5678345cc3505a94b5988">$proxypassword</a>;
<a name="l04663"></a>04663                 $this-&gt;timeout = <a class="code" href="classwsdl.html#a77db04ebe7b299466caa2f9e2e5ad545">$timeout</a>;
<a name="l04664"></a>04664                 $this-&gt;response_timeout = <a class="code" href="classwsdl.html#ae54ca6c0a8cf901640cddbdc59eaabd4">$response_timeout</a>;
<a name="l04665"></a>04665                 <span class="keywordflow">if</span> (is_array(<a class="code" href="classwsdl.html#ad8e4cb335b9e62fd8affb23790ad9882">$curl_options</a>))
<a name="l04666"></a>04666                         $this-&gt;curl_options = <a class="code" href="classwsdl.html#ad8e4cb335b9e62fd8affb23790ad9882">$curl_options</a>;
<a name="l04667"></a>04667                 $this-&gt;use_curl = <a class="code" href="classwsdl.html#a86e4f6d4d20f35a558b1a1a904567053">$use_curl</a>;
<a name="l04668"></a>04668                 $this-&gt;<a class="code" href="classwsdl.html#a63abea316d9ae351a891c7a0082b1617">fetchWSDL</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>);
<a name="l04669"></a>04669     }
<a name="l04670"></a>04670 
<a name="l04676"></a><a class="code" href="classwsdl.html#a63abea316d9ae351a891c7a0082b1617">04676</a>         function <a class="code" href="classwsdl.html#a63abea316d9ae351a891c7a0082b1617">fetchWSDL</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>) {
<a name="l04677"></a>04677                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;parse and process WSDL path=$wsdl&quot;</span>);
<a name="l04678"></a>04678                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a> = <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>;
<a name="l04679"></a>04679         <span class="comment">// parse wsdl file</span>
<a name="l04680"></a>04680         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classwsdl.html">wsdl</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l04681"></a>04681             $this-&gt;<a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">parseWSDL</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>);
<a name="l04682"></a>04682         }
<a name="l04683"></a>04683         <span class="comment">// imports</span>
<a name="l04684"></a>04684         <span class="comment">// TODO: handle imports more properly, grabbing them in-line and nesting them</span>
<a name="l04685"></a>04685         $imported_urls = array();
<a name="l04686"></a>04686         $imported = 1;
<a name="l04687"></a>04687         <span class="keywordflow">while</span> ($imported &gt; 0) {
<a name="l04688"></a>04688                 $imported = 0;
<a name="l04689"></a>04689                 <span class="comment">// Schema imports</span>
<a name="l04690"></a>04690                 <span class="keywordflow">foreach</span> ($this-&gt;schemas as $ns =&gt; $list) {
<a name="l04691"></a>04691                         <span class="keywordflow">foreach</span> ($list as $xs) {
<a name="l04692"></a>04692                                         $wsdlparts = parse_url($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>);    <span class="comment">// this is bogusly simple!</span>
<a name="l04693"></a>04693                             <span class="keywordflow">foreach</span> ($xs-&gt;imports as $ns2 =&gt; $list2) {
<a name="l04694"></a>04694                                 <span class="keywordflow">for</span> ($ii = 0; $ii &lt; count($list2); $ii++) {
<a name="l04695"></a>04695                                         <span class="keywordflow">if</span> (! $list2[$ii][<span class="stringliteral">&#39;loaded&#39;</span>]) {
<a name="l04696"></a>04696                                                 $this-&gt;schemas[$ns]-&gt;imports[$ns2][$ii][<span class="stringliteral">&#39;loaded&#39;</span>] = <span class="keyword">true</span>;
<a name="l04697"></a>04697                                                 $url = $list2[$ii][<span class="stringliteral">&#39;location&#39;</span>];
<a name="l04698"></a>04698                                                                 <span class="keywordflow">if</span> ($url != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l04699"></a>04699                                                                         $urlparts = parse_url($url);
<a name="l04700"></a>04700                                                                         <span class="keywordflow">if</span> (!isset($urlparts[<span class="stringliteral">&#39;host&#39;</span>])) {
<a name="l04701"></a>04701                                                                                 $url = $wsdlparts[<span class="stringliteral">&#39;scheme&#39;</span>] . <span class="stringliteral">&#39;://&#39;</span> . $wsdlparts[<span class="stringliteral">&#39;host&#39;</span>] . (isset($wsdlparts[<span class="stringliteral">&#39;port&#39;</span>]) ? <span class="charliteral">&#39;:&#39;</span> .$wsdlparts[<span class="stringliteral">&#39;port&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>) .
<a name="l04702"></a>04702                                                                                                 substr($wsdlparts[<span class="stringliteral">&#39;path&#39;</span>],0,strrpos($wsdlparts[<span class="stringliteral">&#39;path&#39;</span>],<span class="charliteral">&#39;/&#39;</span>) + 1) .$urlparts[<span class="stringliteral">&#39;path&#39;</span>];
<a name="l04703"></a>04703                                                                         }
<a name="l04704"></a>04704                                                                         <span class="keywordflow">if</span> (! in_array($url, $imported_urls)) {
<a name="l04705"></a>04705                                                                 $this-&gt;<a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">parseWSDL</a>($url);
<a name="l04706"></a>04706                                                                 $imported++;
<a name="l04707"></a>04707                                                                 $imported_urls[] = $url;
<a name="l04708"></a>04708                                                         }
<a name="l04709"></a>04709                                                                 } <span class="keywordflow">else</span> {
<a name="l04710"></a>04710                                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Unexpected scenario: empty URL for unloaded import&quot;</span>);
<a name="l04711"></a>04711                                                                 }
<a name="l04712"></a>04712                                                         }
<a name="l04713"></a>04713                                                 }
<a name="l04714"></a>04714                             } 
<a name="l04715"></a>04715                         }
<a name="l04716"></a>04716                 }
<a name="l04717"></a>04717                 <span class="comment">// WSDL imports</span>
<a name="l04718"></a>04718                         $wsdlparts = parse_url($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>);    <span class="comment">// this is bogusly simple!</span>
<a name="l04719"></a>04719             <span class="keywordflow">foreach</span> ($this-&gt;<span class="keyword">import</span> as $ns =&gt; $list) {
<a name="l04720"></a>04720                 <span class="keywordflow">for</span> ($ii = 0; $ii &lt; count($list); $ii++) {
<a name="l04721"></a>04721                         <span class="keywordflow">if</span> (! $list[$ii][<span class="stringliteral">&#39;loaded&#39;</span>]) {
<a name="l04722"></a>04722                                 $this-&gt;<span class="keyword">import</span>[$ns][$ii][<span class="stringliteral">&#39;loaded&#39;</span>] = <span class="keyword">true</span>;
<a name="l04723"></a>04723                                 $url = $list[$ii][<span class="stringliteral">&#39;location&#39;</span>];
<a name="l04724"></a>04724                                                 <span class="keywordflow">if</span> ($url != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l04725"></a>04725                                                         $urlparts = parse_url($url);
<a name="l04726"></a>04726                                                         <span class="keywordflow">if</span> (!isset($urlparts[<span class="stringliteral">&#39;host&#39;</span>])) {
<a name="l04727"></a>04727                                                                 $url = $wsdlparts[<span class="stringliteral">&#39;scheme&#39;</span>] . <span class="stringliteral">&#39;://&#39;</span> . $wsdlparts[<span class="stringliteral">&#39;host&#39;</span>] . (isset($wsdlparts[<span class="stringliteral">&#39;port&#39;</span>]) ? <span class="charliteral">&#39;:&#39;</span> . $wsdlparts[<span class="stringliteral">&#39;port&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>) .
<a name="l04728"></a>04728                                                                                 substr($wsdlparts[<span class="stringliteral">&#39;path&#39;</span>],0,strrpos($wsdlparts[<span class="stringliteral">&#39;path&#39;</span>],<span class="charliteral">&#39;/&#39;</span>) + 1) .$urlparts[<span class="stringliteral">&#39;path&#39;</span>];
<a name="l04729"></a>04729                                                         }
<a name="l04730"></a>04730                                                         <span class="keywordflow">if</span> (! in_array($url, $imported_urls)) {
<a name="l04731"></a>04731                                                 $this-&gt;<a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">parseWSDL</a>($url);
<a name="l04732"></a>04732                                                 $imported++;
<a name="l04733"></a>04733                                                 $imported_urls[] = $url;
<a name="l04734"></a>04734                                         }
<a name="l04735"></a>04735                                                 } <span class="keywordflow">else</span> {
<a name="l04736"></a>04736                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Unexpected scenario: empty URL for unloaded import&quot;</span>);
<a name="l04737"></a>04737                                                 }
<a name="l04738"></a>04738                                         }
<a name="l04739"></a>04739                                 }
<a name="l04740"></a>04740             } 
<a name="l04741"></a>04741                 }
<a name="l04742"></a>04742         <span class="comment">// add new data to operation data</span>
<a name="l04743"></a>04743         <span class="keywordflow">foreach</span>($this-&gt;bindings as $binding =&gt; $bindingData) {
<a name="l04744"></a>04744             <span class="keywordflow">if</span> (isset($bindingData[<span class="stringliteral">&#39;operations&#39;</span>]) &amp;&amp; is_array($bindingData[<span class="stringliteral">&#39;operations&#39;</span>])) {
<a name="l04745"></a>04745                 <span class="keywordflow">foreach</span>($bindingData[<span class="stringliteral">&#39;operations&#39;</span>] as $operation =&gt; $data) {
<a name="l04746"></a>04746                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;post-parse data gathering for &#39;</span> . $operation);
<a name="l04747"></a>04747                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>] = 
<a name="l04748"></a>04748                                                 isset($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>]) ? 
<a name="l04749"></a>04749                                                 array_merge($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>], $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;input&#39;</span>]) :
<a name="l04750"></a>04750                                                 $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;input&#39;</span>];
<a name="l04751"></a>04751                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>] = 
<a name="l04752"></a>04752                                                 isset($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>]) ?
<a name="l04753"></a>04753                                                 array_merge($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>], $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;output&#39;</span>]) :
<a name="l04754"></a>04754                                                 $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;output&#39;</span>];
<a name="l04755"></a>04755                     <span class="keywordflow">if</span>(isset($this-&gt;messages[ $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] ])){
<a name="l04756"></a>04756                                                 $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;parts&#39;</span>] = $this-&gt;messages[ $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] ];
<a name="l04757"></a>04757                                         }
<a name="l04758"></a>04758                                         <span class="keywordflow">if</span>(isset($this-&gt;messages[ $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] ])){
<a name="l04759"></a>04759                                 $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;parts&#39;</span>] = $this-&gt;messages[ $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] ];
<a name="l04760"></a>04760                     }
<a name="l04761"></a>04761                     <span class="comment">// Set operation style if necessary, but do not override one already provided</span>
<a name="l04762"></a>04762                                         <span class="keywordflow">if</span> (isset($bindingData[<span class="stringliteral">&#39;style&#39;</span>]) &amp;&amp; !isset($this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;style&#39;</span>])) {
<a name="l04763"></a>04763                         $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;style&#39;</span>] = $bindingData[<span class="stringliteral">&#39;style&#39;</span>];
<a name="l04764"></a>04764                     }
<a name="l04765"></a>04765                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;transport&#39;</span>] = isset($bindingData[<span class="stringliteral">&#39;transport&#39;</span>]) ? $bindingData[<span class="stringliteral">&#39;transport&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l04766"></a>04766                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;documentation&#39;</span>] = isset($this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;documentation&#39;</span>]) ? $this-&gt;portTypes[ $bindingData[<span class="stringliteral">&#39;portType&#39;</span>] ][$operation][<span class="stringliteral">&#39;documentation&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l04767"></a>04767                     $this-&gt;bindings[$binding][<span class="stringliteral">&#39;operations&#39;</span>][$operation][<span class="stringliteral">&#39;endpoint&#39;</span>] = isset($bindingData[<span class="stringliteral">&#39;endpoint&#39;</span>]) ? $bindingData[<span class="stringliteral">&#39;endpoint&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l04768"></a>04768                 } 
<a name="l04769"></a>04769             } 
<a name="l04770"></a>04770         }
<a name="l04771"></a>04771         }
<a name="l04772"></a>04772 
<a name="l04779"></a><a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">04779</a>     function <a class="code" href="classwsdl.html#aaeaf605d1cf7bfccb03eb0eef316cd2a">parseWSDL</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a> = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l04780"></a>04780                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;parse WSDL at path=$wsdl&quot;</span>);
<a name="l04781"></a>04781 
<a name="l04782"></a>04782         <span class="keywordflow">if</span> (<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a> == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l04783"></a>04783             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no wsdl passed to parseWSDL()!!&#39;</span>);
<a name="l04784"></a>04784             $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;no wsdl passed to parseWSDL()!!&#39;</span>);
<a name="l04785"></a>04785             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l04786"></a>04786         }
<a name="l04787"></a>04787         
<a name="l04788"></a>04788         <span class="comment">// parse $wsdl for url format</span>
<a name="l04789"></a>04789         $wsdl_props = parse_url(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>);
<a name="l04790"></a>04790 
<a name="l04791"></a>04791         <span class="keywordflow">if</span> (isset($wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>]) &amp;&amp; ($wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>] == <span class="stringliteral">&#39;http&#39;</span> || $wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>] == <span class="stringliteral">&#39;https&#39;</span>)) {
<a name="l04792"></a>04792             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;getting WSDL http(s) URL &#39;</span> . <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>);
<a name="l04793"></a>04793                 <span class="comment">// get wsdl</span>
<a name="l04794"></a>04794                 $tr = <span class="keyword">new</span> <a class="code" href="classsoap__transport__http.html">soap_transport_http</a>(<a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>, $this-&gt;curl_options, $this-&gt;use_curl);
<a name="l04795"></a>04795                         $tr-&gt;request_method = <span class="stringliteral">&#39;GET&#39;</span>;
<a name="l04796"></a>04796                         $tr-&gt;useSOAPAction = <span class="keyword">false</span>;
<a name="l04797"></a>04797                         <span class="keywordflow">if</span>($this-&gt;proxyhost &amp;&amp; $this-&gt;proxyport){
<a name="l04798"></a>04798                                 $tr-&gt;setProxy($this-&gt;proxyhost,$this-&gt;proxyport,$this-&gt;proxyusername,$this-&gt;proxypassword);
<a name="l04799"></a>04799                         }
<a name="l04800"></a>04800                         <span class="keywordflow">if</span> ($this-&gt;authtype != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l04801"></a>04801                                 $tr-&gt;setCredentials($this-&gt;username, $this-&gt;password, $this-&gt;authtype, array(), $this-&gt;certRequest);
<a name="l04802"></a>04802                         }
<a name="l04803"></a>04803                         $tr-&gt;setEncoding(<span class="stringliteral">&#39;gzip, deflate&#39;</span>);
<a name="l04804"></a>04804                         $wsdl_string = $tr-&gt;send(<span class="stringliteral">&#39;&#39;</span>, $this-&gt;timeout, $this-&gt;response_timeout);
<a name="l04805"></a>04805                         <span class="comment">//$this-&gt;debug(&quot;WSDL request\n&quot; . $tr-&gt;outgoing_payload);</span>
<a name="l04806"></a>04806                         <span class="comment">//$this-&gt;debug(&quot;WSDL response\n&quot; . $tr-&gt;incoming_payload);</span>
<a name="l04807"></a>04807                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($tr-&gt;getDebug());
<a name="l04808"></a>04808                         <span class="comment">// catch errors</span>
<a name="l04809"></a>04809                         <span class="keywordflow">if</span>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a> = $tr-&gt;getError() ){
<a name="l04810"></a>04810                                 $errstr = <span class="stringliteral">&#39;Getting &#39;</span> . <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a> . <span class="stringliteral">&#39; - HTTP ERROR: &#39;</span>.$err;
<a name="l04811"></a>04811                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($errstr);
<a name="l04812"></a>04812                     $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($errstr);
<a name="l04813"></a>04813                                 unset($tr);
<a name="l04814"></a>04814                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l04815"></a>04815                         }
<a name="l04816"></a>04816                         unset($tr);
<a name="l04817"></a>04817                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;got WSDL URL&quot;</span>);
<a name="l04818"></a>04818         } <span class="keywordflow">else</span> {
<a name="l04819"></a>04819             <span class="comment">// $wsdl is not http(s), so treat it as a file URL or plain file path</span>
<a name="l04820"></a>04820                 <span class="keywordflow">if</span> (isset($wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>]) &amp;&amp; ($wsdl_props[<span class="stringliteral">&#39;scheme&#39;</span>] == <span class="stringliteral">&#39;file&#39;</span>) &amp;&amp; isset($wsdl_props[<span class="stringliteral">&#39;path&#39;</span>])) {
<a name="l04821"></a>04821                         $path = isset($wsdl_props[<span class="stringliteral">&#39;host&#39;</span>]) ? ($wsdl_props[<span class="stringliteral">&#39;host&#39;</span>] . <span class="charliteral">&#39;:&#39;</span> . $wsdl_props[<span class="stringliteral">&#39;path&#39;</span>]) : $wsdl_props[<span class="stringliteral">&#39;path&#39;</span>];
<a name="l04822"></a>04822                 } <span class="keywordflow">else</span> {
<a name="l04823"></a>04823                         $path = <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>;
<a name="l04824"></a>04824                 }
<a name="l04825"></a>04825             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;getting WSDL file &#39;</span> . $path);
<a name="l04826"></a>04826             <span class="keywordflow">if</span> ($fp = @fopen($path, <span class="charliteral">&#39;r&#39;</span>)) {
<a name="l04827"></a>04827                 $wsdl_string = <span class="stringliteral">&#39;&#39;</span>;
<a name="l04828"></a>04828                 <span class="keywordflow">while</span> ($data = fread($fp, 32768)) {
<a name="l04829"></a>04829                     $wsdl_string .= $data;
<a name="l04830"></a>04830                 } 
<a name="l04831"></a>04831                 fclose($fp);
<a name="l04832"></a>04832             } <span class="keywordflow">else</span> {
<a name="l04833"></a>04833                 $errstr = <span class="stringliteral">&quot;Bad path to WSDL file $path&quot;</span>;
<a name="l04834"></a>04834                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($errstr);
<a name="l04835"></a>04835                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($errstr);
<a name="l04836"></a>04836                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l04837"></a>04837             } 
<a name="l04838"></a>04838         }
<a name="l04839"></a>04839         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Parse WSDL&#39;</span>);
<a name="l04840"></a>04840         <span class="comment">// end new code added</span>
<a name="l04841"></a>04841         <span class="comment">// Create an XML parser.</span>
<a name="l04842"></a>04842         $this-&gt;parser = xml_parser_create(); 
<a name="l04843"></a>04843         <span class="comment">// Set the options for parsing the XML data.</span>
<a name="l04844"></a>04844         <span class="comment">// xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);</span>
<a name="l04845"></a>04845         xml_parser_set_option($this-&gt;parser, XML_OPTION_CASE_FOLDING, 0); 
<a name="l04846"></a>04846         <span class="comment">// Set the object for the parser.</span>
<a name="l04847"></a>04847         xml_set_object($this-&gt;parser, $this); 
<a name="l04848"></a>04848         <span class="comment">// Set the element handlers for the parser.</span>
<a name="l04849"></a>04849         xml_set_element_handler($this-&gt;parser, <span class="stringliteral">&#39;start_element&#39;</span>, <span class="stringliteral">&#39;end_element&#39;</span>);
<a name="l04850"></a>04850         xml_set_character_data_handler($this-&gt;parser, <span class="stringliteral">&#39;character_data&#39;</span>);
<a name="l04851"></a>04851         <span class="comment">// Parse the XML file.</span>
<a name="l04852"></a>04852         <span class="keywordflow">if</span> (!xml_parse($this-&gt;parser, $wsdl_string, <span class="keyword">true</span>)) {
<a name="l04853"></a>04853             <span class="comment">// Display an error message.</span>
<a name="l04854"></a>04854             $errstr = sprintf(
<a name="l04855"></a>04855                                 <span class="stringliteral">&#39;XML error parsing WSDL from %s on line %d: %s&#39;</span>,
<a name="l04856"></a>04856                                 <a class="code" href="classwsdl.html#a777d8053dc10d73f9ab714da1ee6186d">$wsdl</a>,
<a name="l04857"></a>04857                 xml_get_current_line_number($this-&gt;parser),
<a name="l04858"></a>04858                 xml_error_string(xml_get_error_code($this-&gt;parser))
<a name="l04859"></a>04859                 );
<a name="l04860"></a>04860             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($errstr);
<a name="l04861"></a>04861                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;XML payload:\n&quot;</span> . $wsdl_string);
<a name="l04862"></a>04862             $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($errstr);
<a name="l04863"></a>04863             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l04864"></a>04864         } 
<a name="l04865"></a>04865                 <span class="comment">// free the parser</span>
<a name="l04866"></a>04866         xml_parser_free($this-&gt;parser);
<a name="l04867"></a>04867         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Parsing WSDL done&#39;</span>);
<a name="l04868"></a>04868                 <span class="comment">// catch wsdl parse errors</span>
<a name="l04869"></a>04869                 <span class="keywordflow">if</span>($this-&gt;<a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>()){
<a name="l04870"></a>04870                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l04871"></a>04871                 }
<a name="l04872"></a>04872         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l04873"></a>04873     } 
<a name="l04874"></a>04874 
<a name="l04883"></a><a class="code" href="classwsdl.html#aa92be510a5de3bfbd60fcf144712ab21">04883</a>     function <a class="code" href="classwsdl.html#aa92be510a5de3bfbd60fcf144712ab21">start_element</a>(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name, $attrs)
<a name="l04884"></a>04884     {
<a name="l04885"></a>04885         <span class="keywordflow">if</span> ($this-&gt;status == <span class="stringliteral">&#39;schema&#39;</span>) {
<a name="l04886"></a>04886             $this-&gt;currentSchema-&gt;schemaStartElement(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name, $attrs);
<a name="l04887"></a>04887             $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;currentSchema-&gt;getDebug());
<a name="l04888"></a>04888             $this-&gt;currentSchema-&gt;clearDebug();
<a name="l04889"></a>04889         } elseif (preg_match(<span class="stringliteral">&#39;/schema$/&#39;</span>, $name)) {
<a name="l04890"></a>04890                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Parsing WSDL schema&#39;</span>);
<a name="l04891"></a>04891             <span class="comment">// $this-&gt;debug(&quot;startElement for $name ($attrs[name]). status = $this-&gt;status (&quot;.$this-&gt;getLocalPart($name).&quot;)&quot;);</span>
<a name="l04892"></a>04892             $this-&gt;status = <span class="stringliteral">&#39;schema&#39;</span>;
<a name="l04893"></a>04893             $this-&gt;currentSchema = <span class="keyword">new</span> <a class="code" href="classnusoap__xmlschema.html">nusoap_xmlschema</a>(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $this-&gt;namespaces);
<a name="l04894"></a>04894             $this-&gt;currentSchema-&gt;schemaStartElement(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name, $attrs);
<a name="l04895"></a>04895             $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;currentSchema-&gt;getDebug());
<a name="l04896"></a>04896             $this-&gt;currentSchema-&gt;clearDebug();
<a name="l04897"></a>04897         } <span class="keywordflow">else</span> {
<a name="l04898"></a>04898             <span class="comment">// position in the total number of elements, starting from 0</span>
<a name="l04899"></a>04899             $pos = $this-&gt;position++;
<a name="l04900"></a>04900             <a class="code" href="classwsdl.html#a691f58222b4f45f166bd86b322167c74">$depth</a> = $this-&gt;depth++; 
<a name="l04901"></a>04901             <span class="comment">// set self as current value for this depth</span>
<a name="l04902"></a>04902             $this-&gt;depth_array[<a class="code" href="classwsdl.html#a691f58222b4f45f166bd86b322167c74">$depth</a>] = $pos;
<a name="l04903"></a>04903             $this-&gt;message[$pos] = array(<span class="stringliteral">&#39;cdata&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>); 
<a name="l04904"></a>04904             <span class="comment">// process attributes</span>
<a name="l04905"></a>04905             <span class="keywordflow">if</span> (count($attrs) &gt; 0) {
<a name="l04906"></a>04906                                 <span class="comment">// register namespace declarations</span>
<a name="l04907"></a>04907                 <span class="keywordflow">foreach</span>($attrs as $k =&gt; $v) {
<a name="l04908"></a>04908                     <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^xmlns/&#39;</span>,$k)) {
<a name="l04909"></a>04909                         <span class="keywordflow">if</span> ($ns_prefix = substr(strrchr($k, <span class="charliteral">&#39;:&#39;</span>), 1)) {
<a name="l04910"></a>04910                             $this-&gt;namespaces[$ns_prefix] = $v;
<a name="l04911"></a>04911                         } <span class="keywordflow">else</span> {
<a name="l04912"></a>04912                             $this-&gt;namespaces[<span class="stringliteral">&#39;ns&#39;</span> . (count($this-&gt;namespaces) + 1)] = $v;
<a name="l04913"></a>04913                         } 
<a name="l04914"></a>04914                         <span class="keywordflow">if</span> ($v == <span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span> || $v == <span class="stringliteral">&#39;http://www.w3.org/1999/XMLSchema&#39;</span> || $v == <span class="stringliteral">&#39;http://www.w3.org/2000/10/XMLSchema&#39;</span>) {
<a name="l04915"></a>04915                             $this-&gt;XMLSchemaVersion = $v;
<a name="l04916"></a>04916                             $this-&gt;namespaces[<span class="stringliteral">&#39;xsi&#39;</span>] = $v . <span class="stringliteral">&#39;-instance&#39;</span>;
<a name="l04917"></a>04917                         } 
<a name="l04918"></a>04918                     }
<a name="l04919"></a>04919                 }
<a name="l04920"></a>04920                 <span class="comment">// expand each attribute prefix to its namespace</span>
<a name="l04921"></a>04921                 <span class="keywordflow">foreach</span>($attrs as $k =&gt; $v) {
<a name="l04922"></a>04922                     $k = strpos($k, <span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($k) : $k;
<a name="l04923"></a>04923                     <span class="keywordflow">if</span> ($k != <span class="stringliteral">&#39;location&#39;</span> &amp;&amp; $k != <span class="stringliteral">&#39;soapAction&#39;</span> &amp;&amp; $k != <span class="stringliteral">&#39;namespace&#39;</span>) {
<a name="l04924"></a>04924                         $v = strpos($v, <span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($v) : $v;
<a name="l04925"></a>04925                     } 
<a name="l04926"></a>04926                     $eAttrs[$k] = $v;
<a name="l04927"></a>04927                 } 
<a name="l04928"></a>04928                 $attrs = $eAttrs;
<a name="l04929"></a>04929             } <span class="keywordflow">else</span> {
<a name="l04930"></a>04930                 $attrs = array();
<a name="l04931"></a>04931             } 
<a name="l04932"></a>04932             <span class="comment">// get element prefix, namespace and name</span>
<a name="l04933"></a>04933             <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/:/&#39;</span>, $name)) {
<a name="l04934"></a>04934                 <span class="comment">// get ns prefix</span>
<a name="l04935"></a>04935                 $prefix = substr($name, 0, strpos($name, <span class="charliteral">&#39;:&#39;</span>)); 
<a name="l04936"></a>04936                 <span class="comment">// get ns</span>
<a name="l04937"></a>04937                 $namespace = isset($this-&gt;namespaces[$prefix]) ? $this-&gt;namespaces[$prefix] : <span class="stringliteral">&#39;&#39;</span>; 
<a name="l04938"></a>04938                 <span class="comment">// get unqualified name</span>
<a name="l04939"></a>04939                 $name = substr(strstr($name, <span class="charliteral">&#39;:&#39;</span>), 1);
<a name="l04940"></a>04940             } 
<a name="l04941"></a>04941                         <span class="comment">// process attributes, expanding any prefixes to namespaces</span>
<a name="l04942"></a>04942             <span class="comment">// find status, register data</span>
<a name="l04943"></a>04943             <span class="keywordflow">switch</span> ($this-&gt;status) {
<a name="l04944"></a>04944                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;message&#39;</span>:
<a name="l04945"></a>04945                     <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;part&#39;</span>) {
<a name="l04946"></a>04946                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l04947"></a>04947                                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;msg &quot;</span> . $this-&gt;currentMessage . <span class="stringliteral">&quot;: found part (with type) $attrs[name]: &quot;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, $attrs));
<a name="l04948"></a>04948                                     $this-&gt;messages[$this-&gt;currentMessage][$attrs[<span class="stringliteral">&#39;name&#39;</span>]] = $attrs[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l04949"></a>04949                                 } 
<a name="l04950"></a>04950                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;element&#39;</span>])) {
<a name="l04951"></a>04951                                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;msg &quot;</span> . $this-&gt;currentMessage . <span class="stringliteral">&quot;: found part (with element) $attrs[name]: &quot;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, $attrs));
<a name="l04952"></a>04952                                         $this-&gt;messages[$this-&gt;currentMessage][$attrs[<span class="stringliteral">&#39;name&#39;</span>]] = $attrs[<span class="stringliteral">&#39;element&#39;</span>] . <span class="charliteral">&#39;^&#39;</span>;
<a name="l04953"></a>04953                                     } 
<a name="l04954"></a>04954                                 } 
<a name="l04955"></a>04955                                 <span class="keywordflow">break</span>;
<a name="l04956"></a>04956                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;portType&#39;</span>:
<a name="l04957"></a>04957                                 <span class="keywordflow">switch</span> ($name) {
<a name="l04958"></a>04958                                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;operation&#39;</span>:
<a name="l04959"></a>04959                                         $this-&gt;currentPortOperation = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l04960"></a>04960                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;portType $this-&gt;currentPortType operation: $this-&gt;currentPortOperation&quot;</span>);
<a name="l04961"></a>04961                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;parameterOrder&#39;</span>])) {
<a name="l04962"></a>04962                                                 $this-&gt;portTypes[$this-&gt;currentPortType][$attrs[<span class="stringliteral">&#39;name&#39;</span>]][<span class="stringliteral">&#39;parameterOrder&#39;</span>] = $attrs[<span class="stringliteral">&#39;parameterOrder&#39;</span>];
<a name="l04963"></a>04963                                                 } 
<a name="l04964"></a>04964                                                 <span class="keywordflow">break</span>;
<a name="l04965"></a>04965                                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;documentation&#39;</span>:
<a name="l04966"></a>04966                                                 $this-&gt;documentation = <span class="keyword">true</span>;
<a name="l04967"></a>04967                                                 <span class="keywordflow">break</span>; 
<a name="l04968"></a>04968                                             <span class="comment">// merge input/output data</span>
<a name="l04969"></a>04969                                             <span class="keywordflow">default</span>:
<a name="l04970"></a>04970                                                 $m = isset($attrs[<span class="stringliteral">&#39;message&#39;</span>]) ? $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($attrs[<span class="stringliteral">&#39;message&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l04971"></a>04971                                                 $this-&gt;portTypes[$this-&gt;currentPortType][$this-&gt;currentPortOperation][$name][<span class="stringliteral">&#39;message&#39;</span>] = $m;
<a name="l04972"></a>04972                                                 <span class="keywordflow">break</span>;
<a name="l04973"></a>04973                                         } 
<a name="l04974"></a>04974                                 <span class="keywordflow">break</span>;
<a name="l04975"></a>04975                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;binding&#39;</span>:
<a name="l04976"></a>04976                                     <span class="keywordflow">switch</span> ($name) {
<a name="l04977"></a>04977                                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;binding&#39;</span>: 
<a name="l04978"></a>04978                                             <span class="comment">// get ns prefix</span>
<a name="l04979"></a>04979                                             <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;style&#39;</span>])) {
<a name="l04980"></a>04980                                             $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;prefix&#39;</span>] = $prefix;
<a name="l04981"></a>04981                                                 } 
<a name="l04982"></a>04982                                                 $this-&gt;bindings[$this-&gt;currentBinding] = array_merge($this-&gt;bindings[$this-&gt;currentBinding], $attrs);
<a name="l04983"></a>04983                                                 <span class="keywordflow">break</span>;
<a name="l04984"></a>04984                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;header&#39;</span>:
<a name="l04985"></a>04985                                                     $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus][<span class="stringliteral">&#39;headers&#39;</span>][] = $attrs;
<a name="l04986"></a>04986                                                     <span class="keywordflow">break</span>;
<a name="l04987"></a>04987                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;operation&#39;</span>:
<a name="l04988"></a>04988                                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;soapAction&#39;</span>])) {
<a name="l04989"></a>04989                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;soapAction&#39;</span>] = $attrs[<span class="stringliteral">&#39;soapAction&#39;</span>];
<a name="l04990"></a>04990                                                     } 
<a name="l04991"></a>04991                                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;style&#39;</span>])) {
<a name="l04992"></a>04992                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;style&#39;</span>] = $attrs[<span class="stringliteral">&#39;style&#39;</span>];
<a name="l04993"></a>04993                                                     } 
<a name="l04994"></a>04994                                                     <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;name&#39;</span>])) {
<a name="l04995"></a>04995                                                         $this-&gt;currentOperation = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l04996"></a>04996                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;current binding operation: $this-&gt;currentOperation&quot;</span>);
<a name="l04997"></a>04997                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;name&#39;</span>] = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l04998"></a>04998                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;binding&#39;</span>] = $this-&gt;currentBinding;
<a name="l04999"></a>04999                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][<span class="stringliteral">&#39;endpoint&#39;</span>] = isset($this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;endpoint&#39;</span>]) ? $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;endpoint&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l05000"></a>05000                                                     } 
<a name="l05001"></a>05001                                                     <span class="keywordflow">break</span>;
<a name="l05002"></a>05002                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;input&#39;</span>:
<a name="l05003"></a>05003                                                     $this-&gt;opStatus = <span class="stringliteral">&#39;input&#39;</span>;
<a name="l05004"></a>05004                                                     <span class="keywordflow">break</span>;
<a name="l05005"></a>05005                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;output&#39;</span>:
<a name="l05006"></a>05006                                                     $this-&gt;opStatus = <span class="stringliteral">&#39;output&#39;</span>;
<a name="l05007"></a>05007                                                     <span class="keywordflow">break</span>;
<a name="l05008"></a>05008                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;body&#39;</span>:
<a name="l05009"></a>05009                                                     <span class="keywordflow">if</span> (isset($this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus])) {
<a name="l05010"></a>05010                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus] = array_merge($this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus], $attrs);
<a name="l05011"></a>05011                                                     } <span class="keywordflow">else</span> {
<a name="l05012"></a>05012                                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;operations&#39;</span>][$this-&gt;currentOperation][$this-&gt;opStatus] = $attrs;
<a name="l05013"></a>05013                                                     } 
<a name="l05014"></a>05014                                                     <span class="keywordflow">break</span>;
<a name="l05015"></a>05015                                         } 
<a name="l05016"></a>05016                                         <span class="keywordflow">break</span>;
<a name="l05017"></a>05017                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;service&#39;</span>:
<a name="l05018"></a>05018                                         <span class="keywordflow">switch</span> ($name) {
<a name="l05019"></a>05019                                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;port&#39;</span>:
<a name="l05020"></a>05020                                                 $this-&gt;currentPort = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l05021"></a>05021                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;current port: &#39;</span> . $this-&gt;currentPort);
<a name="l05022"></a>05022                                                 $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;binding&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($attrs[<span class="stringliteral">&#39;binding&#39;</span>]);
<a name="l05023"></a>05023                                         
<a name="l05024"></a>05024                                                 <span class="keywordflow">break</span>;
<a name="l05025"></a>05025                                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;address&#39;</span>:
<a name="l05026"></a>05026                                                 $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;location&#39;</span>] = $attrs[<span class="stringliteral">&#39;location&#39;</span>];
<a name="l05027"></a>05027                                                 $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;bindingType&#39;</span>] = $namespace;
<a name="l05028"></a>05028                                                 $this-&gt;bindings[ $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;bindingType&#39;</span>] = $namespace;
<a name="l05029"></a>05029                                                 $this-&gt;bindings[ $this-&gt;ports[$this-&gt;currentPort][<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;endpoint&#39;</span>] = $attrs[<span class="stringliteral">&#39;location&#39;</span>];
<a name="l05030"></a>05030                                                 <span class="keywordflow">break</span>;
<a name="l05031"></a>05031                                         } 
<a name="l05032"></a>05032                                         <span class="keywordflow">break</span>;
<a name="l05033"></a>05033                         } 
<a name="l05034"></a>05034                 <span class="comment">// set status</span>
<a name="l05035"></a>05035                 <span class="keywordflow">switch</span> ($name) {
<a name="l05036"></a>05036                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;import&#39;</span>:
<a name="l05037"></a>05037                             <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;location&#39;</span>])) {
<a name="l05038"></a>05038                     $this-&gt;<span class="keyword">import</span>[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]][] = array(<span class="stringliteral">&#39;location&#39;</span> =&gt; $attrs[<span class="stringliteral">&#39;location&#39;</span>], <span class="stringliteral">&#39;loaded&#39;</span> =&gt; <span class="keyword">false</span>);
<a name="l05039"></a>05039                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;parsing import &#39;</span> . $attrs[<span class="stringliteral">&#39;namespace&#39;</span>]. <span class="stringliteral">&#39; - &#39;</span> . $attrs[<span class="stringliteral">&#39;location&#39;</span>] . <span class="stringliteral">&#39; (&#39;</span> . count($this-&gt;<span class="keyword">import</span>[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]]).<span class="charliteral">&#39;)&#39;</span>);
<a name="l05040"></a>05040                                 } <span class="keywordflow">else</span> {
<a name="l05041"></a>05041                     $this-&gt;<span class="keyword">import</span>[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]][] = array(<span class="stringliteral">&#39;location&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;loaded&#39;</span> =&gt; <span class="keyword">true</span>);
<a name="l05042"></a>05042                                         <span class="keywordflow">if</span> (! $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($attrs[<span class="stringliteral">&#39;namespace&#39;</span>])) {
<a name="l05043"></a>05043                                                 $this-&gt;namespaces[<span class="stringliteral">&#39;ns&#39;</span>.(count($this-&gt;namespaces)+1)] = $attrs[<span class="stringliteral">&#39;namespace&#39;</span>];
<a name="l05044"></a>05044                                         }
<a name="l05045"></a>05045                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;parsing import &#39;</span> . $attrs[<span class="stringliteral">&#39;namespace&#39;</span>]. <span class="stringliteral">&#39; - [no location] (&#39;</span> . count($this-&gt;<span class="keyword">import</span>[$attrs[<span class="stringliteral">&#39;namespace&#39;</span>]]).<span class="charliteral">&#39;)&#39;</span>);
<a name="l05046"></a>05046                                 }
<a name="l05047"></a>05047                                 <span class="keywordflow">break</span>;
<a name="l05048"></a>05048                         <span class="comment">//wait for schema</span>
<a name="l05049"></a>05049                         <span class="comment">//case &#39;types&#39;:</span>
<a name="l05050"></a>05050                         <span class="comment">//      $this-&gt;status = &#39;schema&#39;;</span>
<a name="l05051"></a>05051                         <span class="comment">//      break;</span>
<a name="l05052"></a>05052                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;message&#39;</span>:
<a name="l05053"></a>05053                                 $this-&gt;status = <span class="stringliteral">&#39;message&#39;</span>;
<a name="l05054"></a>05054                                 $this-&gt;messages[$attrs[<span class="stringliteral">&#39;name&#39;</span>]] = array();
<a name="l05055"></a>05055                                 $this-&gt;currentMessage = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l05056"></a>05056                                 <span class="keywordflow">break</span>;
<a name="l05057"></a>05057                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;portType&#39;</span>:
<a name="l05058"></a>05058                                 $this-&gt;status = <span class="stringliteral">&#39;portType&#39;</span>;
<a name="l05059"></a>05059                                 $this-&gt;portTypes[$attrs[<span class="stringliteral">&#39;name&#39;</span>]] = array();
<a name="l05060"></a>05060                                 $this-&gt;currentPortType = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l05061"></a>05061                                 <span class="keywordflow">break</span>;
<a name="l05062"></a>05062                         <span class="keywordflow">case</span> <span class="stringliteral">&quot;binding&quot;</span>:
<a name="l05063"></a>05063                                 <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;name&#39;</span>])) {
<a name="l05064"></a>05064                                 <span class="comment">// get binding name</span>
<a name="l05065"></a>05065                                         <span class="keywordflow">if</span> (strpos($attrs[<span class="stringliteral">&#39;name&#39;</span>], <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l05066"></a>05066                                         $this-&gt;currentBinding = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($attrs[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l05067"></a>05067                                         } <span class="keywordflow">else</span> {
<a name="l05068"></a>05068                                         $this-&gt;currentBinding = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l05069"></a>05069                                         } 
<a name="l05070"></a>05070                                         $this-&gt;status = <span class="stringliteral">&#39;binding&#39;</span>;
<a name="l05071"></a>05071                                         $this-&gt;bindings[$this-&gt;currentBinding][<span class="stringliteral">&#39;portType&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($attrs[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l05072"></a>05072                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;current binding: $this-&gt;currentBinding of portType: &quot;</span> . $attrs[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l05073"></a>05073                                 } 
<a name="l05074"></a>05074                                 <span class="keywordflow">break</span>;
<a name="l05075"></a>05075                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;service&#39;</span>:
<a name="l05076"></a>05076                                 $this-&gt;serviceName = $attrs[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l05077"></a>05077                                 $this-&gt;status = <span class="stringliteral">&#39;service&#39;</span>;
<a name="l05078"></a>05078                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;current service: &#39;</span> . $this-&gt;serviceName);
<a name="l05079"></a>05079                                 <span class="keywordflow">break</span>;
<a name="l05080"></a>05080                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;definitions&#39;</span>:
<a name="l05081"></a>05081                                 <span class="keywordflow">foreach</span> ($attrs as $name =&gt; $value) {
<a name="l05082"></a>05082                                         $this-&gt;wsdl_info[$name] = $value;
<a name="l05083"></a>05083                                 } 
<a name="l05084"></a>05084                                 <span class="keywordflow">break</span>;
<a name="l05085"></a>05085                         } 
<a name="l05086"></a>05086                 } 
<a name="l05087"></a>05087         } 
<a name="l05088"></a>05088 
<a name="l05096"></a><a class="code" href="classwsdl.html#ab35a9bdfa733a195ba1f47b4efbc6035">05096</a>         function <a class="code" href="classwsdl.html#ab35a9bdfa733a195ba1f47b4efbc6035">end_element</a>(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name){ 
<a name="l05097"></a>05097                 <span class="comment">// unset schema status</span>
<a name="l05098"></a>05098                 <span class="keywordflow">if</span> (<span class="comment">/*preg_match(&#39;/types$/&#39;, $name) ||*/</span> preg_match(<span class="stringliteral">&#39;/schema$/&#39;</span>, $name)) {
<a name="l05099"></a>05099                         $this-&gt;status = <span class="stringliteral">&quot;&quot;</span>;
<a name="l05100"></a>05100             $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;currentSchema-&gt;getDebug());
<a name="l05101"></a>05101             $this-&gt;currentSchema-&gt;clearDebug();
<a name="l05102"></a>05102                         $this-&gt;schemas[$this-&gt;currentSchema-&gt;schemaTargetNamespace][] = $this-&gt;currentSchema;
<a name="l05103"></a>05103                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Parsing WSDL schema done&#39;</span>);
<a name="l05104"></a>05104                 } 
<a name="l05105"></a>05105                 <span class="keywordflow">if</span> ($this-&gt;status == <span class="stringliteral">&#39;schema&#39;</span>) {
<a name="l05106"></a>05106                         $this-&gt;currentSchema-&gt;schemaEndElement(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $name);
<a name="l05107"></a>05107                 } <span class="keywordflow">else</span> {
<a name="l05108"></a>05108                         <span class="comment">// bring depth down a notch</span>
<a name="l05109"></a>05109                         $this-&gt;depth--;
<a name="l05110"></a>05110                 } 
<a name="l05111"></a>05111                 <span class="comment">// end documentation</span>
<a name="l05112"></a>05112                 <span class="keywordflow">if</span> ($this-&gt;documentation) {
<a name="l05113"></a>05113                         <span class="comment">//TODO: track the node to which documentation should be assigned; it can be a part, message, etc.</span>
<a name="l05114"></a>05114                         <span class="comment">//$this-&gt;portTypes[$this-&gt;currentPortType][$this-&gt;currentPortOperation][&#39;documentation&#39;] = $this-&gt;documentation;</span>
<a name="l05115"></a>05115                         $this-&gt;documentation = <span class="keyword">false</span>;
<a name="l05116"></a>05116                 } 
<a name="l05117"></a>05117         } 
<a name="l05118"></a>05118 
<a name="l05126"></a><a class="code" href="classwsdl.html#a1224fed86a5e11d97db35156ff857e7b">05126</a>         function <a class="code" href="classwsdl.html#a1224fed86a5e11d97db35156ff857e7b">character_data</a>(<a class="code" href="classwsdl.html#abd32e22002a31fba6d01c8c4974ad3ab">$parser</a>, $data)
<a name="l05127"></a>05127         {
<a name="l05128"></a>05128                 $pos = isset($this-&gt;depth_array[$this-&gt;depth]) ? $this-&gt;depth_array[$this-&gt;depth] : 0;
<a name="l05129"></a>05129                 <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>])) {
<a name="l05130"></a>05130                         $this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>] .= $data;
<a name="l05131"></a>05131                 } 
<a name="l05132"></a>05132                 <span class="keywordflow">if</span> ($this-&gt;documentation) {
<a name="l05133"></a>05133                         $this-&gt;documentation .= $data;
<a name="l05134"></a>05134                 } 
<a name="l05135"></a>05135         } 
<a name="l05136"></a>05136 
<a name="l05146"></a><a class="code" href="classwsdl.html#a56c7f5a57209c4fa5e46d14c58f8d259">05146</a>         function <a class="code" href="classwsdl.html#a56c7f5a57209c4fa5e46d14c58f8d259">setCredentials</a>(<a class="code" href="classwsdl.html#a02a050652e5d9f5315532c4197598463">$username</a>, <a class="code" href="classwsdl.html#a672c75b3581df84b5998b52aaeced9f4">$password</a>, <a class="code" href="classwsdl.html#ab0e009f97d9a7be261c3cbf373938ca0">$authtype</a> = <span class="stringliteral">&#39;basic&#39;</span>, <a class="code" href="classwsdl.html#a50b3268de8446e1033882bf4b96efd47">$certRequest</a> = array()) {
<a name="l05147"></a>05147                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setCredentials username=$username authtype=$authtype certRequest=&quot;</span>);
<a name="l05148"></a>05148                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classwsdl.html#a50b3268de8446e1033882bf4b96efd47">$certRequest</a>));
<a name="l05149"></a>05149                 $this-&gt;username = <a class="code" href="classwsdl.html#a02a050652e5d9f5315532c4197598463">$username</a>;
<a name="l05150"></a>05150                 $this-&gt;password = <a class="code" href="classwsdl.html#a672c75b3581df84b5998b52aaeced9f4">$password</a>;
<a name="l05151"></a>05151                 $this-&gt;authtype = <a class="code" href="classwsdl.html#ab0e009f97d9a7be261c3cbf373938ca0">$authtype</a>;
<a name="l05152"></a>05152                 $this-&gt;certRequest = <a class="code" href="classwsdl.html#a50b3268de8446e1033882bf4b96efd47">$certRequest</a>;
<a name="l05153"></a>05153         }
<a name="l05154"></a>05154         
<a name="l05155"></a><a class="code" href="classwsdl.html#a1cd144d0ac89b1e36b6bbc6097bab0a9">05155</a>         function <a class="code" href="classwsdl.html#a1cd144d0ac89b1e36b6bbc6097bab0a9">getBindingData</a>($binding)
<a name="l05156"></a>05156         {
<a name="l05157"></a>05157                 <span class="keywordflow">if</span> (is_array($this-&gt;bindings[$binding])) {
<a name="l05158"></a>05158                         <span class="keywordflow">return</span> $this-&gt;bindings[$binding];
<a name="l05159"></a>05159                 } 
<a name="l05160"></a>05160         }
<a name="l05161"></a>05161         
<a name="l05170"></a><a class="code" href="classwsdl.html#a96c36ce86df41e3b054eafb16b184cbd">05170</a>         function <a class="code" href="classwsdl.html#a96c36ce86df41e3b054eafb16b184cbd">getOperations</a>($portName = <span class="stringliteral">&#39;&#39;</span>, $bindingType = <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l05171"></a>05171                 $ops = array();
<a name="l05172"></a>05172                 <span class="keywordflow">if</span> ($bindingType == <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l05173"></a>05173                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap/&#39;</span>;
<a name="l05174"></a>05174                 } elseif ($bindingType == <span class="stringliteral">&#39;soap12&#39;</span>) {
<a name="l05175"></a>05175                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap12/&#39;</span>;
<a name="l05176"></a>05176                 } <span class="keywordflow">else</span> {
<a name="l05177"></a>05177                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations bindingType $bindingType may not be supported&quot;</span>);
<a name="l05178"></a>05178                 }
<a name="l05179"></a>05179                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations for port &#39;$portName&#39; bindingType $bindingType&quot;</span>);
<a name="l05180"></a>05180                 <span class="comment">// loop thru ports</span>
<a name="l05181"></a>05181                 <span class="keywordflow">foreach</span>($this-&gt;ports as $port =&gt; $portData) {
<a name="l05182"></a>05182                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations checking port $port bindingType &quot;</span> . $portData[<span class="stringliteral">&#39;bindingType&#39;</span>]);
<a name="l05183"></a>05183                         <span class="keywordflow">if</span> ($portName == <span class="stringliteral">&#39;&#39;</span> || $port == $portName) {
<a name="l05184"></a>05184                                 <span class="comment">// binding type of port matches parameter</span>
<a name="l05185"></a>05185                                 <span class="keywordflow">if</span> ($portData[<span class="stringliteral">&#39;bindingType&#39;</span>] == $bindingType) {
<a name="l05186"></a>05186                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations found port $port bindingType $bindingType&quot;</span>);
<a name="l05187"></a>05187                                         <span class="comment">//$this-&gt;debug(&quot;port data: &quot; . $this-&gt;varDump($portData));</span>
<a name="l05188"></a>05188                                         <span class="comment">//$this-&gt;debug(&quot;bindings: &quot; . $this-&gt;varDump($this-&gt;bindings[ $portData[&#39;binding&#39;] ]));</span>
<a name="l05189"></a>05189                                         <span class="comment">// merge bindings</span>
<a name="l05190"></a>05190                                         <span class="keywordflow">if</span> (isset($this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>])) {
<a name="l05191"></a>05191                                                 $ops = array_merge ($ops, $this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>]);
<a name="l05192"></a>05192                                         }
<a name="l05193"></a>05193                                 }
<a name="l05194"></a>05194                         }
<a name="l05195"></a>05195                 }
<a name="l05196"></a>05196                 <span class="keywordflow">if</span> (count($ops) == 0) {
<a name="l05197"></a>05197                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;getOperations found no operations for port &#39;$portName&#39; bindingType $bindingType&quot;</span>);
<a name="l05198"></a>05198                 }
<a name="l05199"></a>05199                 <span class="keywordflow">return</span> $ops;
<a name="l05200"></a>05200         } 
<a name="l05201"></a>05201         
<a name="l05210"></a><a class="code" href="classwsdl.html#a67a91d9d9f62574149c609c62849664d">05210</a>         function <a class="code" href="classwsdl.html#a67a91d9d9f62574149c609c62849664d">getOperationData</a>($operation, $bindingType = <span class="stringliteral">&#39;soap&#39;</span>)
<a name="l05211"></a>05211         {
<a name="l05212"></a>05212                 <span class="keywordflow">if</span> ($bindingType == <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l05213"></a>05213                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap/&#39;</span>;
<a name="l05214"></a>05214                 } elseif ($bindingType == <span class="stringliteral">&#39;soap12&#39;</span>) {
<a name="l05215"></a>05215                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap12/&#39;</span>;
<a name="l05216"></a>05216                 }
<a name="l05217"></a>05217                 <span class="comment">// loop thru ports</span>
<a name="l05218"></a>05218                 <span class="keywordflow">foreach</span>($this-&gt;ports as $port =&gt; $portData) {
<a name="l05219"></a>05219                         <span class="comment">// binding type of port matches parameter</span>
<a name="l05220"></a>05220                         <span class="keywordflow">if</span> ($portData[<span class="stringliteral">&#39;bindingType&#39;</span>] == $bindingType) {
<a name="l05221"></a>05221                                 <span class="comment">// get binding</span>
<a name="l05222"></a>05222                                 <span class="comment">//foreach($this-&gt;bindings[ $portData[&#39;binding&#39;] ][&#39;operations&#39;] as $bOperation =&gt; $opData) {</span>
<a name="l05223"></a>05223                                 <span class="keywordflow">foreach</span>(array_keys($this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>]) as $bOperation) {
<a name="l05224"></a>05224                                         <span class="comment">// note that we could/should also check the namespace here</span>
<a name="l05225"></a>05225                                         <span class="keywordflow">if</span> ($operation == $bOperation) {
<a name="l05226"></a>05226                                                 <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a> = $this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>][$operation];
<a name="l05227"></a>05227                                             <span class="keywordflow">return</span> <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>;
<a name="l05228"></a>05228                                         } 
<a name="l05229"></a>05229                                 } 
<a name="l05230"></a>05230                         }
<a name="l05231"></a>05231                 } 
<a name="l05232"></a>05232         }
<a name="l05233"></a>05233         
<a name="l05242"></a><a class="code" href="classwsdl.html#aa62364fe0857d5a0eb423c1e1dad97da">05242</a>         function <a class="code" href="classwsdl.html#aa62364fe0857d5a0eb423c1e1dad97da">getOperationDataForSoapAction</a>($soapAction, $bindingType = <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l05243"></a>05243                 <span class="keywordflow">if</span> ($bindingType == <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l05244"></a>05244                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap/&#39;</span>;
<a name="l05245"></a>05245                 } elseif ($bindingType == <span class="stringliteral">&#39;soap12&#39;</span>) {
<a name="l05246"></a>05246                         $bindingType = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/wsdl/soap12/&#39;</span>;
<a name="l05247"></a>05247                 }
<a name="l05248"></a>05248                 <span class="comment">// loop thru ports</span>
<a name="l05249"></a>05249                 <span class="keywordflow">foreach</span>($this-&gt;ports as $port =&gt; $portData) {
<a name="l05250"></a>05250                         <span class="comment">// binding type of port matches parameter</span>
<a name="l05251"></a>05251                         <span class="keywordflow">if</span> ($portData[<span class="stringliteral">&#39;bindingType&#39;</span>] == $bindingType) {
<a name="l05252"></a>05252                                 <span class="comment">// loop through operations for the binding</span>
<a name="l05253"></a>05253                                 <span class="keywordflow">foreach</span> ($this-&gt;bindings[ $portData[<span class="stringliteral">&#39;binding&#39;</span>] ][<span class="stringliteral">&#39;operations&#39;</span>] as $bOperation =&gt; <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>) {
<a name="l05254"></a>05254                                         <span class="keywordflow">if</span> (<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;soapAction&#39;</span>] == $soapAction) {
<a name="l05255"></a>05255                                             <span class="keywordflow">return</span> <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>;
<a name="l05256"></a>05256                                         } 
<a name="l05257"></a>05257                                 } 
<a name="l05258"></a>05258                         }
<a name="l05259"></a>05259                 } 
<a name="l05260"></a>05260         }
<a name="l05261"></a>05261         
<a name="l05280"></a><a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">05280</a>         function <a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($type, $ns) {
<a name="l05281"></a>05281                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: type=$type, ns=$ns&quot;</span>);
<a name="l05282"></a>05282                 <span class="keywordflow">if</span> ((! $ns) &amp;&amp; isset($this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>])) {
<a name="l05283"></a>05283                         $ns = $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>];
<a name="l05284"></a>05284                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: type namespace forced to $ns&quot;</span>);
<a name="l05285"></a>05285                 }
<a name="l05286"></a>05286                 <span class="keywordflow">if</span> (!isset($this-&gt;schemas[$ns])) {
<a name="l05287"></a>05287                         <span class="keywordflow">foreach</span> ($this-&gt;schemas as $ns0 =&gt; $schema0) {
<a name="l05288"></a>05288                                 <span class="keywordflow">if</span> (strcasecmp($ns, $ns0) == 0) {
<a name="l05289"></a>05289                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: replacing schema namespace $ns with $ns0&quot;</span>);
<a name="l05290"></a>05290                                         $ns = $ns0;
<a name="l05291"></a>05291                                         <span class="keywordflow">break</span>;
<a name="l05292"></a>05292                                 }
<a name="l05293"></a>05293                         }
<a name="l05294"></a>05294                 }
<a name="l05295"></a>05295                 <span class="keywordflow">if</span> (isset($this-&gt;schemas[$ns])) {
<a name="l05296"></a>05296                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: have schema for namespace $ns&quot;</span>);
<a name="l05297"></a>05297                         <span class="keywordflow">for</span> (<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0; <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt; count($this-&gt;schemas[$ns]); <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {
<a name="l05298"></a>05298                                 $xs = &amp;$this-&gt;schemas[$ns][<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>];
<a name="l05299"></a>05299                                 $t = $xs-&gt;getTypeDef($type);
<a name="l05300"></a>05300                                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($xs-&gt;getDebug());
<a name="l05301"></a>05301                                 $xs-&gt;clearDebug();
<a name="l05302"></a>05302                                 <span class="keywordflow">if</span> ($t) {
<a name="l05303"></a>05303                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: found type $type&quot;</span>);
<a name="l05304"></a>05304                                         <span class="keywordflow">if</span> (!isset($t[<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l05305"></a>05305                                                 <span class="comment">// get info for type to tack onto the element</span>
<a name="l05306"></a>05306                                                 $uqType = substr($t[<span class="stringliteral">&#39;type&#39;</span>], strrpos($t[<span class="stringliteral">&#39;type&#39;</span>], <span class="charliteral">&#39;:&#39;</span>) + 1);
<a name="l05307"></a>05307                                                 $ns = substr($t[<span class="stringliteral">&#39;type&#39;</span>], 0, strrpos($t[<span class="stringliteral">&#39;type&#39;</span>], <span class="charliteral">&#39;:&#39;</span>));
<a name="l05308"></a>05308                                                 $etype = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqType, $ns);
<a name="l05309"></a>05309                                                 <span class="keywordflow">if</span> ($etype) {
<a name="l05310"></a>05310                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;found type for [element] $type:&quot;</span>);
<a name="l05311"></a>05311                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($etype));
<a name="l05312"></a>05312                                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l05313"></a>05313                                                                 $t[<span class="stringliteral">&#39;phpType&#39;</span>] = $etype[<span class="stringliteral">&#39;phpType&#39;</span>];
<a name="l05314"></a>05314                                                         }
<a name="l05315"></a>05315                                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;elements&#39;</span>])) {
<a name="l05316"></a>05316                                                                 $t[<span class="stringliteral">&#39;elements&#39;</span>] = $etype[<span class="stringliteral">&#39;elements&#39;</span>];
<a name="l05317"></a>05317                                                         }
<a name="l05318"></a>05318                                                         <span class="keywordflow">if</span> (isset($etype[<span class="stringliteral">&#39;attrs&#39;</span>])) {
<a name="l05319"></a>05319                                                                 $t[<span class="stringliteral">&#39;attrs&#39;</span>] = $etype[<span class="stringliteral">&#39;attrs&#39;</span>];
<a name="l05320"></a>05320                                                         }
<a name="l05321"></a>05321                                                 } <span class="keywordflow">else</span> {
<a name="l05322"></a>05322                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;did not find type for [element] $type&quot;</span>);
<a name="l05323"></a>05323                                                 }
<a name="l05324"></a>05324                                         }
<a name="l05325"></a>05325                                         <span class="keywordflow">return</span> $t;
<a name="l05326"></a>05326                                 }
<a name="l05327"></a>05327                         }
<a name="l05328"></a>05328                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: did not find type $type&quot;</span>);
<a name="l05329"></a>05329                 } <span class="keywordflow">else</span> {
<a name="l05330"></a>05330                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getTypeDef: do not have schema for namespace $ns&quot;</span>);
<a name="l05331"></a>05331                 }
<a name="l05332"></a>05332                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05333"></a>05333         }
<a name="l05334"></a>05334 
<a name="l05340"></a><a class="code" href="classwsdl.html#a929c11102abae3e6a01cae35f73b85c2">05340</a>     function <a class="code" href="classwsdl.html#a929c11102abae3e6a01cae35f73b85c2">webDescription</a>(){
<a name="l05341"></a>05341         global $HTTP_SERVER_VARS;
<a name="l05342"></a>05342 
<a name="l05343"></a>05343                 <span class="keywordflow">if</span> (isset($_SERVER)) {
<a name="l05344"></a>05344                         <span class="comment">//$PHP_SELF = $_SERVER[&#39;PHP_SELF&#39;];</span>
<a name="l05345"></a>05345                         $PHP_SELF = $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>];
<a name="l05346"></a>05346                 } elseif (isset($HTTP_SERVER_VARS)) {
<a name="l05347"></a>05347                         $PHP_SELF = $HTTP_SERVER_VARS[<span class="stringliteral">&#39;PHP_SELF&#39;</span>];
<a name="l05348"></a>05348                 } <span class="keywordflow">else</span> {
<a name="l05349"></a>05349                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;Neither _SERVER nor HTTP_SERVER_VARS is available&quot;</span>);
<a name="l05350"></a>05350                 }
<a name="l05351"></a>05351 
<a name="l05352"></a>05352                 $b = <span class="stringliteral">&#39;</span>
<a name="l05353"></a>05353 <span class="stringliteral">                &lt;html&gt;&lt;head&gt;&lt;title&gt;NuSOAP: &#39;</span>.$this-&gt;serviceName.<span class="stringliteral">&#39;&lt;/title&gt;</span>
<a name="l05354"></a>05354 <span class="stringliteral">                &lt;style type=&quot;text/css&quot;&gt;</span>
<a name="l05355"></a>05355 <span class="stringliteral">                    body    { font-family: arial; color: #000000; background-color: #ffffff; margin: 0px 0px 0px 0px; }</span>
<a name="l05356"></a>05356 <span class="stringliteral">                    p       { font-family: arial; color: #000000; margin-top: 0px; margin-bottom: 12px; }</span>
<a name="l05357"></a>05357 <span class="stringliteral">                    pre { background-color: silver; padding: 5px; font-family: Courier New; font-size: x-small; color: #000000;}</span>
<a name="l05358"></a>05358 <span class="stringliteral">                    ul      { margin-top: 10px; margin-left: 20px; }</span>
<a name="l05359"></a>05359 <span class="stringliteral">                    li      { list-style-type: none; margin-top: 10px; color: #000000; }</span>
<a name="l05360"></a>05360 <span class="stringliteral">                    .content{</span>
<a name="l05361"></a>05361 <span class="stringliteral">                        margin-left: 0px; padding-bottom: 2em; }</span>
<a name="l05362"></a>05362 <span class="stringliteral">                    .nav {</span>
<a name="l05363"></a>05363 <span class="stringliteral">                        padding-top: 10px; padding-bottom: 10px; padding-left: 15px; font-size: .70em;</span>
<a name="l05364"></a>05364 <span class="stringliteral">                        margin-top: 10px; margin-left: 0px; color: #000000;</span>
<a name="l05365"></a>05365 <span class="stringliteral">                        background-color: #ccccff; width: 20%; margin-left: 20px; margin-top: 20px; }</span>
<a name="l05366"></a>05366 <span class="stringliteral">                    .title {</span>
<a name="l05367"></a>05367 <span class="stringliteral">                        font-family: arial; font-size: 26px; color: #ffffff;</span>
<a name="l05368"></a>05368 <span class="stringliteral">                        background-color: #999999; width: 100%;</span>
<a name="l05369"></a>05369 <span class="stringliteral">                        margin-left: 0px; margin-right: 0px;</span>
<a name="l05370"></a>05370 <span class="stringliteral">                        padding-top: 10px; padding-bottom: 10px;}</span>
<a name="l05371"></a>05371 <span class="stringliteral">                    .hidden {</span>
<a name="l05372"></a>05372 <span class="stringliteral">                        position: absolute; visibility: hidden; z-index: 200; left: 250px; top: 100px;</span>
<a name="l05373"></a>05373 <span class="stringliteral">                        font-family: arial; overflow: hidden; width: 600;</span>
<a name="l05374"></a>05374 <span class="stringliteral">                        padding: 20px; font-size: 10px; background-color: #999999;</span>
<a name="l05375"></a>05375 <span class="stringliteral">                        layer-background-color:#FFFFFF; }</span>
<a name="l05376"></a>05376 <span class="stringliteral">                    a,a:active  { color: charcoal; font-weight: bold; }</span>
<a name="l05377"></a>05377 <span class="stringliteral">                    a:visited   { color: #666666; font-weight: bold; }</span>
<a name="l05378"></a>05378 <span class="stringliteral">                    a:hover     { color: cc3300; font-weight: bold; }</span>
<a name="l05379"></a>05379 <span class="stringliteral">                &lt;/style&gt;</span>
<a name="l05380"></a>05380 <span class="stringliteral">                &lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;</span>
<a name="l05381"></a>05381 <span class="stringliteral">                &lt;!--</span>
<a name="l05382"></a>05382 <span class="stringliteral">                // POP-UP CAPTIONS...</span>
<a name="l05383"></a>05383 <span class="stringliteral">                function lib_bwcheck(){ //Browsercheck (needed)</span>
<a name="l05384"></a>05384 <span class="stringliteral">                    this.ver=navigator.appVersion</span>
<a name="l05385"></a>05385 <span class="stringliteral">                    this.agent=navigator.userAgent</span>
<a name="l05386"></a>05386 <span class="stringliteral">                    this.dom=document.getElementById?1:0</span>
<a name="l05387"></a>05387 <span class="stringliteral">                    this.opera5=this.agent.indexOf(&quot;Opera 5&quot;)&gt;-1</span>
<a name="l05388"></a>05388 <span class="stringliteral">                    this.ie5=(this.ver.indexOf(&quot;MSIE 5&quot;)&gt;-1 &amp;&amp; this.dom &amp;&amp; !this.opera5)?1:0;</span>
<a name="l05389"></a>05389 <span class="stringliteral">                    this.ie6=(this.ver.indexOf(&quot;MSIE 6&quot;)&gt;-1 &amp;&amp; this.dom &amp;&amp; !this.opera5)?1:0;</span>
<a name="l05390"></a>05390 <span class="stringliteral">                    this.ie4=(document.all &amp;&amp; !this.dom &amp;&amp; !this.opera5)?1:0;</span>
<a name="l05391"></a>05391 <span class="stringliteral">                    this.ie=this.ie4||this.ie5||this.ie6</span>
<a name="l05392"></a>05392 <span class="stringliteral">                    this.mac=this.agent.indexOf(&quot;Mac&quot;)&gt;-1</span>
<a name="l05393"></a>05393 <span class="stringliteral">                    this.ns6=(this.dom &amp;&amp; parseInt(this.ver) &gt;= 5) ?1:0;</span>
<a name="l05394"></a>05394 <span class="stringliteral">                    this.ns4=(document.layers &amp;&amp; !this.dom)?1:0;</span>
<a name="l05395"></a>05395 <span class="stringliteral">                    this.bw=(this.ie6 || this.ie5 || this.ie4 || this.ns4 || this.ns6 || this.opera5)</span>
<a name="l05396"></a>05396 <span class="stringliteral">                    return this</span>
<a name="l05397"></a>05397 <span class="stringliteral">                }</span>
<a name="l05398"></a>05398 <span class="stringliteral">                var bw = new lib_bwcheck()</span>
<a name="l05399"></a>05399 <span class="stringliteral">                //Makes crossbrowser object.</span>
<a name="l05400"></a>05400 <span class="stringliteral">                function makeObj(obj){</span>
<a name="l05401"></a>05401 <span class="stringliteral">                    this.evnt=bw.dom? document.getElementById(obj):bw.ie4?document.all[obj]:bw.ns4?document.layers[obj]:0;</span>
<a name="l05402"></a>05402 <span class="stringliteral">                    if(!this.evnt) return false</span>
<a name="l05403"></a>05403 <span class="stringliteral">                    this.css=bw.dom||bw.ie4?this.evnt.style:bw.ns4?this.evnt:0;</span>
<a name="l05404"></a>05404 <span class="stringliteral">                    this.wref=bw.dom||bw.ie4?this.evnt:bw.ns4?this.css.document:0;</span>
<a name="l05405"></a>05405 <span class="stringliteral">                    this.writeIt=b_writeIt;</span>
<a name="l05406"></a>05406 <span class="stringliteral">                    return this</span>
<a name="l05407"></a>05407 <span class="stringliteral">                }</span>
<a name="l05408"></a>05408 <span class="stringliteral">                // A unit of measure that will be added when setting the position of a layer.</span>
<a name="l05409"></a>05409 <span class="stringliteral">                //var px = bw.ns4||window.opera?&quot;&quot;:&quot;px&quot;;</span>
<a name="l05410"></a>05410 <span class="stringliteral">                function b_writeIt(text){</span>
<a name="l05411"></a>05411 <span class="stringliteral">                    if (bw.ns4){this.wref.write(text);this.wref.close()}</span>
<a name="l05412"></a>05412 <span class="stringliteral">                    else this.wref.innerHTML = text</span>
<a name="l05413"></a>05413 <span class="stringliteral">                }</span>
<a name="l05414"></a>05414 <span class="stringliteral">                //Shows the messages</span>
<a name="l05415"></a>05415 <span class="stringliteral">                var oDesc;</span>
<a name="l05416"></a>05416 <span class="stringliteral">                function popup(divid){</span>
<a name="l05417"></a>05417 <span class="stringliteral">                    if(oDesc = new makeObj(divid)){</span>
<a name="l05418"></a>05418 <span class="stringliteral">                        oDesc.css.visibility = &quot;visible&quot;</span>
<a name="l05419"></a>05419 <span class="stringliteral">                    }</span>
<a name="l05420"></a>05420 <span class="stringliteral">                }</span>
<a name="l05421"></a>05421 <span class="stringliteral">                function popout(){ // Hides message</span>
<a name="l05422"></a>05422 <span class="stringliteral">                    if(oDesc) oDesc.css.visibility = &quot;hidden&quot;</span>
<a name="l05423"></a>05423 <span class="stringliteral">                }</span>
<a name="l05424"></a>05424 <span class="stringliteral">                //--&gt;</span>
<a name="l05425"></a>05425 <span class="stringliteral">                &lt;/script&gt;</span>
<a name="l05426"></a>05426 <span class="stringliteral">                &lt;/head&gt;</span>
<a name="l05427"></a>05427 <span class="stringliteral">                &lt;body&gt;</span>
<a name="l05428"></a>05428 <span class="stringliteral">                &lt;div class=content&gt;</span>
<a name="l05429"></a>05429 <span class="stringliteral">                        &lt;br&gt;&lt;br&gt;</span>
<a name="l05430"></a>05430 <span class="stringliteral">                        &lt;div class=title&gt;&#39;</span>.$this-&gt;serviceName.<span class="stringliteral">&#39;&lt;/div&gt;</span>
<a name="l05431"></a>05431 <span class="stringliteral">                        &lt;div class=nav&gt;</span>
<a name="l05432"></a>05432 <span class="stringliteral">                                &lt;p&gt;View the &lt;a href=&quot;&#39;</span>.$PHP_SELF.<span class="stringliteral">&#39;?wsdl&quot;&gt;WSDL&lt;/a&gt; for the service.</span>
<a name="l05433"></a>05433 <span class="stringliteral">                                Click on an operation name to view it&amp;apos;s details.&lt;/p&gt;</span>
<a name="l05434"></a>05434 <span class="stringliteral">                                &lt;ul&gt;&#39;</span>;
<a name="l05435"></a>05435                                 <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="classwsdl.html#a96c36ce86df41e3b054eafb16b184cbd">getOperations</a>() as $op =&gt; $data){
<a name="l05436"></a>05436                                     $b .= <span class="stringliteral">&quot;&lt;li&gt;&lt;a href=&#39;#&#39; onclick=\&quot;popout();popup(&#39;$op&#39;)\&quot;&gt;$op&lt;/a&gt;&lt;/li&gt;&quot;</span>;
<a name="l05437"></a>05437                                     <span class="comment">// create hidden div</span>
<a name="l05438"></a>05438                                     $b .= <span class="stringliteral">&quot;&lt;div id=&#39;$op&#39; class=&#39;hidden&#39;&gt;</span>
<a name="l05439"></a>05439 <span class="stringliteral">                                    &lt;a href=&#39;#&#39; onclick=&#39;popout()&#39;&gt;&lt;font color=&#39;#ffffff&#39;&gt;Close&lt;/font&gt;&lt;/a&gt;&lt;br&gt;&lt;br&gt;&quot;</span>;
<a name="l05440"></a>05440                                     <span class="keywordflow">foreach</span>($data as $donnie =&gt; $marie){ <span class="comment">// loop through opdata</span>
<a name="l05441"></a>05441                                                 <span class="keywordflow">if</span>($donnie == <span class="stringliteral">&#39;input&#39;</span> || $donnie == <span class="stringliteral">&#39;output&#39;</span>){ <span class="comment">// show input/output data</span>
<a name="l05442"></a>05442                                                     $b .= <span class="stringliteral">&quot;&lt;font color=&#39;white&#39;&gt;&quot;</span>.ucfirst($donnie).<span class="stringliteral">&#39;:&lt;/font&gt;&lt;br&gt;&#39;</span>;
<a name="l05443"></a>05443                                                     <span class="keywordflow">foreach</span>($marie as $captain =&gt; $tenille){ <span class="comment">// loop through data</span>
<a name="l05444"></a>05444                                                                 <span class="keywordflow">if</span>($captain == <span class="stringliteral">&#39;parts&#39;</span>){ <span class="comment">// loop thru parts</span>
<a name="l05445"></a>05445                                                                     $b .= <span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;$captain:&lt;br&gt;&quot;</span>;
<a name="l05446"></a>05446                                                         <span class="comment">//if(is_array($tenille)){</span>
<a name="l05447"></a>05447                                                                         <span class="keywordflow">foreach</span>($tenille as $joanie =&gt; $chachi){
<a name="l05448"></a>05448                                                                                         $b .= <span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$joanie: $chachi&lt;br&gt;&quot;</span>;
<a name="l05449"></a>05449                                                                         }
<a name="l05450"></a>05450                                                                 <span class="comment">//}</span>
<a name="l05451"></a>05451                                                                 } <span class="keywordflow">else</span> {
<a name="l05452"></a>05452                                                                     $b .= <span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;$captain: $tenille&lt;br&gt;&quot;</span>;
<a name="l05453"></a>05453                                                                 }
<a name="l05454"></a>05454                                                     }
<a name="l05455"></a>05455                                                 } <span class="keywordflow">else</span> {
<a name="l05456"></a>05456                                                     $b .= <span class="stringliteral">&quot;&lt;font color=&#39;white&#39;&gt;&quot;</span>.ucfirst($donnie).<span class="stringliteral">&quot;:&lt;/font&gt; $marie&lt;br&gt;&quot;</span>;
<a name="l05457"></a>05457                                                 }
<a name="l05458"></a>05458                                     }
<a name="l05459"></a>05459                                         $b .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;
<a name="l05460"></a>05460                                 }
<a name="l05461"></a>05461                                 $b .= <span class="stringliteral">&#39;</span>
<a name="l05462"></a>05462 <span class="stringliteral">                                &lt;ul&gt;</span>
<a name="l05463"></a>05463 <span class="stringliteral">                        &lt;/div&gt;</span>
<a name="l05464"></a>05464 <span class="stringliteral">                &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span>;
<a name="l05465"></a>05465                 <span class="keywordflow">return</span> $b;
<a name="l05466"></a>05466     }
<a name="l05467"></a>05467 
<a name="l05475"></a><a class="code" href="classwsdl.html#a76a90258f66d3c465af1290abf687343">05475</a>         function <a class="code" href="classwsdl.html#a76a90258f66d3c465af1290abf687343">serialize</a>($debug = 0)
<a name="l05476"></a>05476         {
<a name="l05477"></a>05477                 $xml = <span class="stringliteral">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&#39;</span>;
<a name="l05478"></a>05478                 $xml .= <span class="stringliteral">&quot;\n&lt;definitions&quot;</span>;
<a name="l05479"></a>05479                 <span class="keywordflow">foreach</span>($this-&gt;namespaces as $k =&gt; $v) {
<a name="l05480"></a>05480                         $xml .= <span class="stringliteral">&quot; xmlns:$k=\&quot;$v\&quot;&quot;</span>;
<a name="l05481"></a>05481                 } 
<a name="l05482"></a>05482                 <span class="comment">// 10.9.02 - add poulter fix for wsdl and tns declarations</span>
<a name="l05483"></a>05483                 <span class="keywordflow">if</span> (isset($this-&gt;namespaces[<span class="stringliteral">&#39;wsdl&#39;</span>])) {
<a name="l05484"></a>05484                         $xml .= <span class="stringliteral">&quot; xmlns=\&quot;&quot;</span> . $this-&gt;namespaces[<span class="stringliteral">&#39;wsdl&#39;</span>] . <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l05485"></a>05485                 } 
<a name="l05486"></a>05486                 <span class="keywordflow">if</span> (isset($this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>])) {
<a name="l05487"></a>05487                         $xml .= <span class="stringliteral">&quot; targetNamespace=\&quot;&quot;</span> . $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>] . <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l05488"></a>05488                 } 
<a name="l05489"></a>05489                 $xml .= <span class="charliteral">&#39;&gt;&#39;</span>; 
<a name="l05490"></a>05490                 <span class="comment">// imports</span>
<a name="l05491"></a>05491                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>($this-&gt;<span class="keyword">import</span>) &gt; 0) {
<a name="l05492"></a>05492                         <span class="keywordflow">foreach</span>($this-&gt;<span class="keyword">import</span> as $ns =&gt; $list) {
<a name="l05493"></a>05493                                 <span class="keywordflow">foreach</span> ($list as $ii) {
<a name="l05494"></a>05494                                         <span class="keywordflow">if</span> ($ii[<span class="stringliteral">&#39;location&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l05495"></a>05495                                                 $xml .= <span class="stringliteral">&#39;&lt;import location=&quot;&#39;</span> . $ii[<span class="stringliteral">&#39;location&#39;</span>] . <span class="stringliteral">&#39;&quot; namespace=&quot;&#39;</span> . $ns . <span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;
<a name="l05496"></a>05496                                         } <span class="keywordflow">else</span> {
<a name="l05497"></a>05497                                                 $xml .= <span class="stringliteral">&#39;&lt;import namespace=&quot;&#39;</span> . $ns . <span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;
<a name="l05498"></a>05498                                         }
<a name="l05499"></a>05499                                 }
<a name="l05500"></a>05500                         } 
<a name="l05501"></a>05501                 } 
<a name="l05502"></a>05502                 <span class="comment">// types</span>
<a name="l05503"></a>05503                 <span class="keywordflow">if</span> (count($this-&gt;schemas)&gt;=1) {
<a name="l05504"></a>05504                         $xml .= <span class="stringliteral">&quot;\n&lt;types&gt;\n&quot;</span>;
<a name="l05505"></a>05505                         <span class="keywordflow">foreach</span> ($this-&gt;schemas as $ns =&gt; $list) {
<a name="l05506"></a>05506                                 <span class="keywordflow">foreach</span> ($list as $xs) {
<a name="l05507"></a>05507                                         $xml .= $xs-&gt;serializeSchema();
<a name="l05508"></a>05508                                 }
<a name="l05509"></a>05509                         }
<a name="l05510"></a>05510                         $xml .= <span class="stringliteral">&#39;&lt;/types&gt;&#39;</span>;
<a name="l05511"></a>05511                 } 
<a name="l05512"></a>05512                 <span class="comment">// messages</span>
<a name="l05513"></a>05513                 <span class="keywordflow">if</span> (count($this-&gt;messages) &gt;= 1) {
<a name="l05514"></a>05514                         <span class="keywordflow">foreach</span>($this-&gt;messages as $msgName =&gt; $msgParts) {
<a name="l05515"></a>05515                                 $xml .= <span class="stringliteral">&quot;\n&lt;message name=\&quot;&quot;</span> . $msgName . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l05516"></a>05516                                 <span class="keywordflow">if</span>(is_array($msgParts)){
<a name="l05517"></a>05517                                         <span class="keywordflow">foreach</span>($msgParts as $partName =&gt; $partType) {
<a name="l05518"></a>05518                                                 <span class="comment">// print &#39;serializing &#39;.$partType.&#39;, sv: &#39;.$this-&gt;XMLSchemaVersion.&#39;&lt;br&gt;&#39;;</span>
<a name="l05519"></a>05519                                                 <span class="keywordflow">if</span> (strpos($partType, <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l05520"></a>05520                                                     $typePrefix = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($partType));
<a name="l05521"></a>05521                                                 } elseif (isset($this-&gt;typemap[$this-&gt;namespaces[<span class="stringliteral">&#39;xsd&#39;</span>]][$partType])) {
<a name="l05522"></a>05522                                                     <span class="comment">// print &#39;checking typemap: &#39;.$this-&gt;XMLSchemaVersion.&#39;&lt;br&gt;&#39;;</span>
<a name="l05523"></a>05523                                                     $typePrefix = <span class="stringliteral">&#39;xsd&#39;</span>;
<a name="l05524"></a>05524                                                 } <span class="keywordflow">else</span> {
<a name="l05525"></a>05525                                                     <span class="keywordflow">foreach</span>($this-&gt;typemap as $ns =&gt; $types) {
<a name="l05526"></a>05526                                                         <span class="keywordflow">if</span> (isset($types[$partType])) {
<a name="l05527"></a>05527                                                             $typePrefix = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns);
<a name="l05528"></a>05528                                                         } 
<a name="l05529"></a>05529                                                     } 
<a name="l05530"></a>05530                                                     <span class="keywordflow">if</span> (!isset($typePrefix)) {
<a name="l05531"></a>05531                                                         die(<span class="stringliteral">&quot;$partType has no namespace!&quot;</span>);
<a name="l05532"></a>05532                                                     } 
<a name="l05533"></a>05533                                                 }
<a name="l05534"></a>05534                                                 $ns = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($typePrefix);
<a name="l05535"></a>05535                                                 $localPart = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($partType);
<a name="l05536"></a>05536                                                 $typeDef = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($localPart, $ns);
<a name="l05537"></a>05537                                                 <span class="keywordflow">if</span> ($typeDef[<span class="stringliteral">&#39;typeClass&#39;</span>] == <span class="stringliteral">&#39;element&#39;</span>) {
<a name="l05538"></a>05538                                                         $elementortype = <span class="stringliteral">&#39;element&#39;</span>;
<a name="l05539"></a>05539                                                         <span class="keywordflow">if</span> (substr($localPart, -1) == <span class="charliteral">&#39;^&#39;</span>) {
<a name="l05540"></a>05540                                                                 $localPart = substr($localPart, 0, -1);
<a name="l05541"></a>05541                                                         }
<a name="l05542"></a>05542                                                 } <span class="keywordflow">else</span> {
<a name="l05543"></a>05543                                                         $elementortype = <span class="stringliteral">&#39;type&#39;</span>;
<a name="l05544"></a>05544                                                 }
<a name="l05545"></a>05545                                                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;part name=&quot;&#39;</span> . $partName . <span class="stringliteral">&#39;&quot; &#39;</span> . $elementortype . <span class="stringliteral">&#39;=&quot;&#39;</span> . $typePrefix . <span class="charliteral">&#39;:&#39;</span> . $localPart . <span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;
<a name="l05546"></a>05546                                         }
<a name="l05547"></a>05547                                 }
<a name="l05548"></a>05548                                 $xml .= <span class="stringliteral">&#39;&lt;/message&gt;&#39;</span>;
<a name="l05549"></a>05549                         } 
<a name="l05550"></a>05550                 } 
<a name="l05551"></a>05551                 <span class="comment">// bindings &amp; porttypes</span>
<a name="l05552"></a>05552                 <span class="keywordflow">if</span> (count($this-&gt;bindings) &gt;= 1) {
<a name="l05553"></a>05553                         $binding_xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05554"></a>05554                         $portType_xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05555"></a>05555                         <span class="keywordflow">foreach</span>($this-&gt;bindings as $bindingName =&gt; $attrs) {
<a name="l05556"></a>05556                                 $binding_xml .= <span class="stringliteral">&quot;\n&lt;binding name=\&quot;&quot;</span> . $bindingName . <span class="stringliteral">&#39;&quot; type=&quot;tns:&#39;</span> . $attrs[<span class="stringliteral">&#39;portType&#39;</span>] . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l05557"></a>05557                                 $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;soap:binding style=&quot;&#39;</span> . $attrs[<span class="stringliteral">&#39;style&#39;</span>] . <span class="stringliteral">&#39;&quot; transport=&quot;&#39;</span> . $attrs[<span class="stringliteral">&#39;transport&#39;</span>] . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l05558"></a>05558                                 $portType_xml .= <span class="stringliteral">&quot;\n&lt;portType name=\&quot;&quot;</span> . $attrs[<span class="stringliteral">&#39;portType&#39;</span>] . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l05559"></a>05559                                 <span class="keywordflow">foreach</span>($attrs[<span class="stringliteral">&#39;operations&#39;</span>] as $opName =&gt; $opParts) {
<a name="l05560"></a>05560                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;operation name=&quot;&#39;</span> . $opName . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l05561"></a>05561                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;soap:operation soapAction=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;soapAction&#39;</span>] . <span class="stringliteral">&#39;&quot; style=&quot;&#39;</span>. $opParts[<span class="stringliteral">&#39;style&#39;</span>] . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l05562"></a>05562                                         <span class="keywordflow">if</span> (isset($opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l05563"></a>05563                                                 $enc_style = <span class="stringliteral">&#39; encodingStyle=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l05564"></a>05564                                         } <span class="keywordflow">else</span> {
<a name="l05565"></a>05565                                                 $enc_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05566"></a>05566                                         }
<a name="l05567"></a>05567                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;input&gt;&lt;soap:body use=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;use&#39;</span>] . <span class="stringliteral">&#39;&quot; namespace=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;namespace&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span> . $enc_style . <span class="stringliteral">&#39;/&gt;&lt;/input&gt;&#39;</span>;
<a name="l05568"></a>05568                                         <span class="keywordflow">if</span> (isset($opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l05569"></a>05569                                                 $enc_style = <span class="stringliteral">&#39; encodingStyle=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l05570"></a>05570                                         } <span class="keywordflow">else</span> {
<a name="l05571"></a>05571                                                 $enc_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05572"></a>05572                                         }
<a name="l05573"></a>05573                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;output&gt;&lt;soap:body use=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;use&#39;</span>] . <span class="stringliteral">&#39;&quot; namespace=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;namespace&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span> . $enc_style . <span class="stringliteral">&#39;/&gt;&lt;/output&gt;&#39;</span>;
<a name="l05574"></a>05574                                         $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;/operation&gt;&#39;</span>;
<a name="l05575"></a>05575                                         $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;operation name=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;name&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l05576"></a>05576                                         <span class="keywordflow">if</span> (isset($opParts[<span class="stringliteral">&#39;parameterOrder&#39;</span>])) {
<a name="l05577"></a>05577                                             $portType_xml .= <span class="stringliteral">&#39; parameterOrder=&quot;&#39;</span> . $opParts[<span class="stringliteral">&#39;parameterOrder&#39;</span>] . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l05578"></a>05578                                         } 
<a name="l05579"></a>05579                                         $portType_xml .= <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l05580"></a>05580                                         <span class="keywordflow">if</span>(isset($opParts[<span class="stringliteral">&#39;documentation&#39;</span>]) &amp;&amp; $opParts[<span class="stringliteral">&#39;documentation&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l05581"></a>05581                                                 $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;documentation&gt;&#39;</span> . htmlspecialchars($opParts[<span class="stringliteral">&#39;documentation&#39;</span>]) . <span class="stringliteral">&#39;&lt;/documentation&gt;&#39;</span>;
<a name="l05582"></a>05582                                         }
<a name="l05583"></a>05583                                         $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;input message=&quot;tns:&#39;</span> . $opParts[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l05584"></a>05584                                         $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;output message=&quot;tns:&#39;</span> . $opParts[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>] . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l05585"></a>05585                                         $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;/operation&gt;&#39;</span>;
<a name="l05586"></a>05586                                 } 
<a name="l05587"></a>05587                                 $portType_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;&lt;/portType&gt;&#39;</span>;
<a name="l05588"></a>05588                                 $binding_xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;&lt;/binding&gt;&#39;</span>;
<a name="l05589"></a>05589                         } 
<a name="l05590"></a>05590                         $xml .= $portType_xml . $binding_xml;
<a name="l05591"></a>05591                 } 
<a name="l05592"></a>05592                 <span class="comment">// services</span>
<a name="l05593"></a>05593                 $xml .= <span class="stringliteral">&quot;\n&lt;service name=\&quot;&quot;</span> . $this-&gt;serviceName . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l05594"></a>05594                 <span class="keywordflow">if</span> (count($this-&gt;ports) &gt;= 1) {
<a name="l05595"></a>05595                         <span class="keywordflow">foreach</span>($this-&gt;ports as $pName =&gt; $attrs) {
<a name="l05596"></a>05596                                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;port name=&quot;&#39;</span> . $pName . <span class="stringliteral">&#39;&quot; binding=&quot;tns:&#39;</span> . $attrs[<span class="stringliteral">&#39;binding&#39;</span>] . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l05597"></a>05597                                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;    &lt;soap:address location=&quot;&#39;</span> . $attrs[<span class="stringliteral">&#39;location&#39;</span>] . ($debug ? <span class="stringliteral">&#39;?debug=1&#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . <span class="stringliteral">&#39;&quot;/&gt;&#39;</span>;
<a name="l05598"></a>05598                                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;  &lt;/port&gt;&#39;</span>;
<a name="l05599"></a>05599                         } 
<a name="l05600"></a>05600                 } 
<a name="l05601"></a>05601                 $xml .= <span class="stringliteral">&quot;\n&quot;</span> . <span class="stringliteral">&#39;&lt;/service&gt;&#39;</span>;
<a name="l05602"></a>05602                 <span class="keywordflow">return</span> $xml . <span class="stringliteral">&quot;\n&lt;/definitions&gt;&quot;</span>;
<a name="l05603"></a>05603         } 
<a name="l05604"></a>05604 
<a name="l05614"></a><a class="code" href="classwsdl.html#aa84db420c2c8b34a2c148ea69bd02322">05614</a>         function <a class="code" href="classwsdl.html#aa84db420c2c8b34a2c148ea69bd02322">parametersMatchWrapped</a>($type, &amp;$parameters) {
<a name="l05615"></a>05615                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped type=$type, parameters=&quot;</span>);
<a name="l05616"></a>05616                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($parameters));
<a name="l05617"></a>05617 
<a name="l05618"></a>05618                 <span class="comment">// split type into namespace:unqualified-type</span>
<a name="l05619"></a>05619                 <span class="keywordflow">if</span> (strpos($type, <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l05620"></a>05620                         $uqType = substr($type, strrpos($type, <span class="charliteral">&#39;:&#39;</span>) + 1);
<a name="l05621"></a>05621                         $ns = substr($type, 0, strrpos($type, <span class="charliteral">&#39;:&#39;</span>));
<a name="l05622"></a>05622                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: got a prefixed type: $uqType, $ns&quot;</span>);
<a name="l05623"></a>05623                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($ns)) {
<a name="l05624"></a>05624                                 $ns = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($ns);
<a name="l05625"></a>05625                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: expanded prefixed type: $uqType, $ns&quot;</span>);
<a name="l05626"></a>05626                         }
<a name="l05627"></a>05627                 } <span class="keywordflow">else</span> {
<a name="l05628"></a>05628                         <span class="comment">// TODO: should the type be compared to types in XSD, and the namespace</span>
<a name="l05629"></a>05629                         <span class="comment">// set to XSD if the type matches?</span>
<a name="l05630"></a>05630                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: No namespace for type $type&quot;</span>);
<a name="l05631"></a>05631                         $ns = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05632"></a>05632                         $uqType = $type;
<a name="l05633"></a>05633                 }
<a name="l05634"></a>05634 
<a name="l05635"></a>05635                 <span class="comment">// get the type information</span>
<a name="l05636"></a>05636                 <span class="keywordflow">if</span> (!$typeDef = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqType, $ns)) {
<a name="l05637"></a>05637                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: $type ($uqType) is not a supported type.&quot;</span>);
<a name="l05638"></a>05638                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05639"></a>05639                 }
<a name="l05640"></a>05640                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: found typeDef=&quot;</span>);
<a name="l05641"></a>05641                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($typeDef));
<a name="l05642"></a>05642                 <span class="keywordflow">if</span> (substr($uqType, -1) == <span class="charliteral">&#39;^&#39;</span>) {
<a name="l05643"></a>05643                         $uqType = substr($uqType, 0, -1);
<a name="l05644"></a>05644                 }
<a name="l05645"></a>05645                 $phpType = $typeDef[<span class="stringliteral">&#39;phpType&#39;</span>];
<a name="l05646"></a>05646                 $arrayType = (isset($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]) ? $typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l05647"></a>05647                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: uqType: $uqType, ns: $ns, phptype: $phpType, arrayType: $arrayType&quot;</span>);
<a name="l05648"></a>05648                 
<a name="l05649"></a>05649                 <span class="comment">// we expect a complexType or element of complexType</span>
<a name="l05650"></a>05650                 <span class="keywordflow">if</span> ($phpType != <span class="stringliteral">&#39;struct&#39;</span>) {
<a name="l05651"></a>05651                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: not a struct&quot;</span>);
<a name="l05652"></a>05652                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05653"></a>05653                 }
<a name="l05654"></a>05654 
<a name="l05655"></a>05655                 <span class="comment">// see whether the parameter names match the elements</span>
<a name="l05656"></a>05656                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;elements&#39;</span>]) &amp;&amp; is_array($typeDef[<span class="stringliteral">&#39;elements&#39;</span>])) {
<a name="l05657"></a>05657                         $elements = 0;
<a name="l05658"></a>05658                         $matches = 0;
<a name="l05659"></a>05659                         <span class="keywordflow">foreach</span> ($typeDef[<span class="stringliteral">&#39;elements&#39;</span>] as $name =&gt; $attrs) {
<a name="l05660"></a>05660                                 <span class="keywordflow">if</span> (isset($parameters[$name])) {
<a name="l05661"></a>05661                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: have parameter named $name&quot;</span>);
<a name="l05662"></a>05662                                         $matches++;
<a name="l05663"></a>05663                                 } <span class="keywordflow">else</span> {
<a name="l05664"></a>05664                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: do not have parameter named $name&quot;</span>);
<a name="l05665"></a>05665                                 }
<a name="l05666"></a>05666                                 $elements++;
<a name="l05667"></a>05667                         }
<a name="l05668"></a>05668 
<a name="l05669"></a>05669                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: $matches parameter names match $elements wrapped parameter names&quot;</span>);
<a name="l05670"></a>05670                         <span class="keywordflow">if</span> ($matches == 0) {
<a name="l05671"></a>05671                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05672"></a>05672                         }
<a name="l05673"></a>05673                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l05674"></a>05674                 }
<a name="l05675"></a>05675 
<a name="l05676"></a>05676                 <span class="comment">// since there are no elements for the type, if the user passed no</span>
<a name="l05677"></a>05677                 <span class="comment">// parameters, the parameters match wrapped.</span>
<a name="l05678"></a>05678                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in parametersMatchWrapped: no elements type $ns:$uqType&quot;</span>);
<a name="l05679"></a>05679                 <span class="keywordflow">return</span> count($parameters) == 0;
<a name="l05680"></a>05680         }
<a name="l05681"></a>05681 
<a name="l05697"></a><a class="code" href="classwsdl.html#a172cd927fe399da9285a022aad8b47b7">05697</a>         function <a class="code" href="classwsdl.html#a172cd927fe399da9285a022aad8b47b7">serializeRPCParameters</a>($operation, $direction, $parameters, $bindingType = <span class="stringliteral">&#39;soap&#39;</span>) {
<a name="l05698"></a>05698                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeRPCParameters: operation=$operation, direction=$direction, XMLSchemaVersion=$this-&gt;XMLSchemaVersion, bindingType=$bindingType&quot;</span>);
<a name="l05699"></a>05699                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;parameters=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($parameters));
<a name="l05700"></a>05700                 
<a name="l05701"></a>05701                 <span class="keywordflow">if</span> ($direction != <span class="stringliteral">&#39;input&#39;</span> &amp;&amp; $direction != <span class="stringliteral">&#39;output&#39;</span>) {
<a name="l05702"></a>05702                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The value of the \$direction argument needs to be either &quot;input&quot; or &quot;output&quot;&#39;</span>);
<a name="l05703"></a>05703                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;The value of the \$direction argument needs to be either &quot;input&quot; or &quot;output&quot;&#39;</span>);
<a name="l05704"></a>05704                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05705"></a>05705                 } 
<a name="l05706"></a>05706                 <span class="keywordflow">if</span> (!<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a> = $this-&gt;<a class="code" href="classwsdl.html#a67a91d9d9f62574149c609c62849664d">getOperationData</a>($operation, $bindingType)) {
<a name="l05707"></a>05707                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Unable to retrieve WSDL data for operation: &#39;</span> . $operation . <span class="stringliteral">&#39; bindingType: &#39;</span> . $bindingType);
<a name="l05708"></a>05708                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Unable to retrieve WSDL data for operation: &#39;</span> . $operation . <span class="stringliteral">&#39; bindingType: &#39;</span> . $bindingType);
<a name="l05709"></a>05709                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05710"></a>05710                 }
<a name="l05711"></a>05711                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeRPCParameters: opData:&#39;</span>);
<a name="l05712"></a>05712                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>));
<a name="l05713"></a>05713 
<a name="l05714"></a>05714                 <span class="comment">// Get encoding style for output and set to current</span>
<a name="l05715"></a>05715                 $encodingStyle = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>;
<a name="l05716"></a>05716                 <span class="keywordflow">if</span>(($direction == <span class="stringliteral">&#39;input&#39;</span>) &amp;&amp; isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; (<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] != $encodingStyle)) {
<a name="l05717"></a>05717                         $encodingStyle = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>];
<a name="l05718"></a>05718                         $enc_style = $encodingStyle;
<a name="l05719"></a>05719                 }
<a name="l05720"></a>05720 
<a name="l05721"></a>05721                 <span class="comment">// set input params</span>
<a name="l05722"></a>05722                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05723"></a>05723                 <span class="keywordflow">if</span> (isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) &amp;&amp; <span class="keyword">sizeof</span>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) &gt; 0) {
<a name="l05724"></a>05724                         $parts = &amp;<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>];
<a name="l05725"></a>05725                         $part_count = <span class="keyword">sizeof</span>($parts);
<a name="l05726"></a>05726                         $style = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;style&#39;</span>];
<a name="l05727"></a>05727                         $use = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;use&#39;</span>];
<a name="l05728"></a>05728                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;have $part_count part(s) to serialize using $style/$use&quot;</span>);
<a name="l05729"></a>05729                         <span class="keywordflow">if</span> (is_array($parameters)) {
<a name="l05730"></a>05730                                 $parametersArrayType = $this-&gt;<a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">isArraySimpleOrStruct</a>($parameters);
<a name="l05731"></a>05731                                 $parameter_count = count($parameters);
<a name="l05732"></a>05732                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;have $parameter_count parameter(s) provided as $parametersArrayType to serialize&quot;</span>);
<a name="l05733"></a>05733                                 <span class="comment">// check for Microsoft-style wrapped parameters</span>
<a name="l05734"></a>05734                                 <span class="keywordflow">if</span> ($style == <span class="stringliteral">&#39;document&#39;</span> &amp;&amp; $use == <span class="stringliteral">&#39;literal&#39;</span> &amp;&amp; $part_count == 1 &amp;&amp; isset($parts[<span class="stringliteral">&#39;parameters&#39;</span>])) {
<a name="l05735"></a>05735                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;check whether the caller has wrapped the parameters&#39;</span>);
<a name="l05736"></a>05736                                         <span class="keywordflow">if</span> ($direction == <span class="stringliteral">&#39;output&#39;</span> &amp;&amp; $parametersArrayType == <span class="stringliteral">&#39;arraySimple&#39;</span> &amp;&amp; $parameter_count == 1) {
<a name="l05737"></a>05737                                                 <span class="comment">// TODO: consider checking here for double-wrapping, when</span>
<a name="l05738"></a>05738                                                 <span class="comment">// service function wraps, then NuSOAP wraps again</span>
<a name="l05739"></a>05739                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;change simple array to associative with &#39;parameters&#39; element&quot;</span>);
<a name="l05740"></a>05740                                                 $parameters[<span class="stringliteral">&#39;parameters&#39;</span>] = $parameters[0];
<a name="l05741"></a>05741                                                 unset($parameters[0]);
<a name="l05742"></a>05742                                         }
<a name="l05743"></a>05743                                         <span class="keywordflow">if</span> (($parametersArrayType == <span class="stringliteral">&#39;arrayStruct&#39;</span> || $parameter_count == 0) &amp;&amp; !isset($parameters[<span class="stringliteral">&#39;parameters&#39;</span>])) {
<a name="l05744"></a>05744                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;check whether caller\&#39;s parameters match the wrapped ones&#39;</span>);
<a name="l05745"></a>05745                                                 <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classwsdl.html#aa84db420c2c8b34a2c148ea69bd02322">parametersMatchWrapped</a>($parts[<span class="stringliteral">&#39;parameters&#39;</span>], $parameters)) {
<a name="l05746"></a>05746                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;wrap the parameters for the caller&#39;</span>);
<a name="l05747"></a>05747                                                         $parameters = array(<span class="stringliteral">&#39;parameters&#39;</span> =&gt; $parameters);
<a name="l05748"></a>05748                                                         $parameter_count = 1;
<a name="l05749"></a>05749                                                 }
<a name="l05750"></a>05750                                         }
<a name="l05751"></a>05751                                 }
<a name="l05752"></a>05752                                 <span class="keywordflow">foreach</span> ($parts as $name =&gt; $type) {
<a name="l05753"></a>05753                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing part $name of type $type&quot;</span>);
<a name="l05754"></a>05754                                         <span class="comment">// Track encoding style</span>
<a name="l05755"></a>05755                                         <span class="keywordflow">if</span> (isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; $encodingStyle != <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) {
<a name="l05756"></a>05756                                                 $encodingStyle = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>];                  
<a name="l05757"></a>05757                                                 $enc_style = $encodingStyle;
<a name="l05758"></a>05758                                         } <span class="keywordflow">else</span> {
<a name="l05759"></a>05759                                                 $enc_style = <span class="keyword">false</span>;
<a name="l05760"></a>05760                                         }
<a name="l05761"></a>05761                                         <span class="comment">// NOTE: add error handling here</span>
<a name="l05762"></a>05762                                         <span class="comment">// if serializeType returns false, then catch global error and fault</span>
<a name="l05763"></a>05763                                         <span class="keywordflow">if</span> ($parametersArrayType == <span class="stringliteral">&#39;arraySimple&#39;</span>) {
<a name="l05764"></a>05764                                                 $p = array_shift($parameters);
<a name="l05765"></a>05765                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/indexed param&#39;</span>);
<a name="l05766"></a>05766                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $p, $use, $enc_style);
<a name="l05767"></a>05767                                         } elseif (isset($parameters[$name])) {
<a name="l05768"></a>05768                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/named param&#39;</span>);
<a name="l05769"></a>05769                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $parameters[$name], $use, $enc_style);
<a name="l05770"></a>05770                                         } <span class="keywordflow">else</span> {
<a name="l05771"></a>05771                                                 <span class="comment">// TODO: only send nillable</span>
<a name="l05772"></a>05772                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/null param&#39;</span>);
<a name="l05773"></a>05773                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, null, $use, $enc_style);
<a name="l05774"></a>05774                                         }
<a name="l05775"></a>05775                                 }
<a name="l05776"></a>05776                         } <span class="keywordflow">else</span> {
<a name="l05777"></a>05777                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no parameters passed.&#39;</span>);
<a name="l05778"></a>05778                         }
<a name="l05779"></a>05779                 }
<a name="l05780"></a>05780                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializeRPCParameters returning: $xml&quot;</span>);
<a name="l05781"></a>05781                 <span class="keywordflow">return</span> $xml;
<a name="l05782"></a>05782         } 
<a name="l05783"></a>05783         
<a name="l05798"></a><a class="code" href="classwsdl.html#a5de2338b860901c2c5c1a6cf726b1d7f">05798</a>         function <a class="code" href="classwsdl.html#a5de2338b860901c2c5c1a6cf726b1d7f">serializeParameters</a>($operation, $direction, $parameters)
<a name="l05799"></a>05799         {
<a name="l05800"></a>05800                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeParameters: operation=$operation, direction=$direction, XMLSchemaVersion=$this-&gt;XMLSchemaVersion&quot;</span>); 
<a name="l05801"></a>05801                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;parameters=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($parameters));
<a name="l05802"></a>05802                 
<a name="l05803"></a>05803                 <span class="keywordflow">if</span> ($direction != <span class="stringliteral">&#39;input&#39;</span> &amp;&amp; $direction != <span class="stringliteral">&#39;output&#39;</span>) {
<a name="l05804"></a>05804                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;The value of the \$direction argument needs to be either &quot;input&quot; or &quot;output&quot;&#39;</span>);
<a name="l05805"></a>05805                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;The value of the \$direction argument needs to be either &quot;input&quot; or &quot;output&quot;&#39;</span>);
<a name="l05806"></a>05806                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05807"></a>05807                 } 
<a name="l05808"></a>05808                 <span class="keywordflow">if</span> (!<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a> = $this-&gt;<a class="code" href="classwsdl.html#a67a91d9d9f62574149c609c62849664d">getOperationData</a>($operation)) {
<a name="l05809"></a>05809                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Unable to retrieve WSDL data for operation: &#39;</span> . $operation);
<a name="l05810"></a>05810                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Unable to retrieve WSDL data for operation: &#39;</span> . $operation);
<a name="l05811"></a>05811                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05812"></a>05812                 }
<a name="l05813"></a>05813                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;opData:&#39;</span>);
<a name="l05814"></a>05814                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>));
<a name="l05815"></a>05815                 
<a name="l05816"></a>05816                 <span class="comment">// Get encoding style for output and set to current</span>
<a name="l05817"></a>05817                 $encodingStyle = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>;
<a name="l05818"></a>05818                 <span class="keywordflow">if</span>(($direction == <span class="stringliteral">&#39;input&#39;</span>) &amp;&amp; isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; (<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>] != $encodingStyle)) {
<a name="l05819"></a>05819                         $encodingStyle = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[<span class="stringliteral">&#39;output&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>];
<a name="l05820"></a>05820                         $enc_style = $encodingStyle;
<a name="l05821"></a>05821                 }
<a name="l05822"></a>05822                 
<a name="l05823"></a>05823                 <span class="comment">// set input params</span>
<a name="l05824"></a>05824                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05825"></a>05825                 <span class="keywordflow">if</span> (isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) &amp;&amp; <span class="keyword">sizeof</span>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) &gt; 0) {
<a name="l05826"></a>05826                         
<a name="l05827"></a>05827                         $use = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;use&#39;</span>];
<a name="l05828"></a>05828                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;use=$use&quot;</span>);
<a name="l05829"></a>05829                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got &#39;</span> . count(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>]) . <span class="stringliteral">&#39; part(s)&#39;</span>);
<a name="l05830"></a>05830                         <span class="keywordflow">if</span> (is_array($parameters)) {
<a name="l05831"></a>05831                                 $parametersArrayType = $this-&gt;<a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">isArraySimpleOrStruct</a>($parameters);
<a name="l05832"></a>05832                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;have &#39;</span> . $parametersArrayType . <span class="stringliteral">&#39; parameters&#39;</span>);
<a name="l05833"></a>05833                                 <span class="keywordflow">foreach</span>(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;parts&#39;</span>] as $name =&gt; $type) {
<a name="l05834"></a>05834                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;serializing part &quot;&#39;</span>.$name.<span class="stringliteral">&#39;&quot; of type &quot;&#39;</span>.$type.<span class="charliteral">&#39;&quot;&#39;</span>);
<a name="l05835"></a>05835                                         <span class="comment">// Track encoding style</span>
<a name="l05836"></a>05836                                         <span class="keywordflow">if</span>(isset(<a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) &amp;&amp; $encodingStyle != <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>]) {
<a name="l05837"></a>05837                                                 $encodingStyle = <a class="code" href="classwsdl.html#a17369444956ca3658ebc9e1e8fb1c909">$opData</a>[$direction][<span class="stringliteral">&#39;encodingStyle&#39;</span>];                  
<a name="l05838"></a>05838                                                 $enc_style = $encodingStyle;
<a name="l05839"></a>05839                                         } <span class="keywordflow">else</span> {
<a name="l05840"></a>05840                                                 $enc_style = <span class="keyword">false</span>;
<a name="l05841"></a>05841                                         }
<a name="l05842"></a>05842                                         <span class="comment">// NOTE: add error handling here</span>
<a name="l05843"></a>05843                                         <span class="comment">// if serializeType returns false, then catch global error and fault</span>
<a name="l05844"></a>05844                                         <span class="keywordflow">if</span> ($parametersArrayType == <span class="stringliteral">&#39;arraySimple&#39;</span>) {
<a name="l05845"></a>05845                                                 $p = array_shift($parameters);
<a name="l05846"></a>05846                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/indexed param&#39;</span>);
<a name="l05847"></a>05847                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $p, $use, $enc_style);
<a name="l05848"></a>05848                                         } elseif (isset($parameters[$name])) {
<a name="l05849"></a>05849                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/named param&#39;</span>);
<a name="l05850"></a>05850                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $parameters[$name], $use, $enc_style);
<a name="l05851"></a>05851                                         } <span class="keywordflow">else</span> {
<a name="l05852"></a>05852                                                 <span class="comment">// TODO: only send nillable</span>
<a name="l05853"></a>05853                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;calling serializeType w/null param&#39;</span>);
<a name="l05854"></a>05854                                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, null, $use, $enc_style);
<a name="l05855"></a>05855                                         }
<a name="l05856"></a>05856                                 }
<a name="l05857"></a>05857                         } <span class="keywordflow">else</span> {
<a name="l05858"></a>05858                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;no parameters passed.&#39;</span>);
<a name="l05859"></a>05859                         }
<a name="l05860"></a>05860                 }
<a name="l05861"></a>05861                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializeParameters returning: $xml&quot;</span>);
<a name="l05862"></a>05862                 <span class="keywordflow">return</span> $xml;
<a name="l05863"></a>05863         } 
<a name="l05864"></a>05864         
<a name="l05877"></a><a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">05877</a>         function <a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($name, $type, $value, $use=<span class="stringliteral">&#39;encoded&#39;</span>, $encodingStyle=<span class="keyword">false</span>, $unqualified=<span class="keyword">false</span>)
<a name="l05878"></a>05878         {
<a name="l05879"></a>05879                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: name=$name, type=$type, use=$use, encodingStyle=$encodingStyle, unqualified=&quot;</span> . ($unqualified ? <span class="stringliteral">&quot;unqualified&quot;</span> : <span class="stringliteral">&quot;qualified&quot;</span>));
<a name="l05880"></a>05880                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&quot;value=&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($value));
<a name="l05881"></a>05881                 <span class="keywordflow">if</span>($use == <span class="stringliteral">&#39;encoded&#39;</span> &amp;&amp; $encodingStyle) {
<a name="l05882"></a>05882                         $encodingStyle = <span class="stringliteral">&#39; SOAP-ENV:encodingStyle=&quot;&#39;</span> . $encodingStyle . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l05883"></a>05883                 }
<a name="l05884"></a>05884 
<a name="l05885"></a>05885                 <span class="comment">// if a soapval has been supplied, let its type override the WSDL</span>
<a name="l05886"></a>05886         <span class="keywordflow">if</span> (is_object($value) &amp;&amp; get_class($value) == <span class="stringliteral">&#39;soapval&#39;</span>) {
<a name="l05887"></a>05887                 <span class="keywordflow">if</span> ($value-&gt;type_ns) {
<a name="l05888"></a>05888                         $type = $value-&gt;type_ns . <span class="charliteral">&#39;:&#39;</span> . $value-&gt;type;
<a name="l05889"></a>05889                         $forceType = <span class="keyword">true</span>;
<a name="l05890"></a>05890                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval overrides type to $type&quot;</span>);
<a name="l05891"></a>05891                 } elseif ($value-&gt;type) {
<a name="l05892"></a>05892                         $type = $value-&gt;type;
<a name="l05893"></a>05893                         $forceType = <span class="keyword">true</span>;
<a name="l05894"></a>05894                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval overrides type to $type&quot;</span>);
<a name="l05895"></a>05895                 } <span class="keywordflow">else</span> {
<a name="l05896"></a>05896                         $forceType = <span class="keyword">false</span>;
<a name="l05897"></a>05897                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval does not override type&quot;</span>);
<a name="l05898"></a>05898                 }
<a name="l05899"></a>05899                 $attrs = $value-&gt;attributes;
<a name="l05900"></a>05900                 $value = $value-&gt;value;
<a name="l05901"></a>05901                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval overrides value to $value&quot;</span>);
<a name="l05902"></a>05902                 <span class="keywordflow">if</span> ($attrs) {
<a name="l05903"></a>05903                         <span class="keywordflow">if</span> (!is_array($value)) {
<a name="l05904"></a>05904                                 $value[<span class="charliteral">&#39;!&#39;</span>] = $value;
<a name="l05905"></a>05905                         }
<a name="l05906"></a>05906                         <span class="keywordflow">foreach</span> ($attrs as $n =&gt; $v) {
<a name="l05907"></a>05907                                 $value[<span class="charliteral">&#39;!&#39;</span> . $n] = $v;
<a name="l05908"></a>05908                         }
<a name="l05909"></a>05909                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: soapval provides attributes&quot;</span>);
<a name="l05910"></a>05910                     }
<a name="l05911"></a>05911         } <span class="keywordflow">else</span> {
<a name="l05912"></a>05912                 $forceType = <span class="keyword">false</span>;
<a name="l05913"></a>05913         }
<a name="l05914"></a>05914 
<a name="l05915"></a>05915                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05916"></a>05916                 <span class="keywordflow">if</span> (strpos($type, <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l05917"></a>05917                         $uqType = substr($type, strrpos($type, <span class="charliteral">&#39;:&#39;</span>) + 1);
<a name="l05918"></a>05918                         $ns = substr($type, 0, strrpos($type, <span class="charliteral">&#39;:&#39;</span>));
<a name="l05919"></a>05919                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: got a prefixed type: $uqType, $ns&quot;</span>);
<a name="l05920"></a>05920                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($ns)) {
<a name="l05921"></a>05921                                 $ns = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($ns);
<a name="l05922"></a>05922                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: expanded prefixed type: $uqType, $ns&quot;</span>);
<a name="l05923"></a>05923                         }
<a name="l05924"></a>05924 
<a name="l05925"></a>05925                         <span class="keywordflow">if</span>($ns == $this-&gt;XMLSchemaVersion || $ns == <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>){
<a name="l05926"></a>05926                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeType: type namespace indicates XML Schema or SOAP Encoding type&#39;</span>);
<a name="l05927"></a>05927                                 <span class="keywordflow">if</span> ($unqualified &amp;&amp; $use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l05928"></a>05928                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l05929"></a>05929                                 } <span class="keywordflow">else</span> {
<a name="l05930"></a>05930                                         $elementNS = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05931"></a>05931                                 }
<a name="l05932"></a>05932                                 <span class="keywordflow">if</span> (is_null($value)) {
<a name="l05933"></a>05933                                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l05934"></a>05934                                                 <span class="comment">// TODO: depends on minOccurs</span>
<a name="l05935"></a>05935                                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS/&gt;&quot;</span>;
<a name="l05936"></a>05936                                         } <span class="keywordflow">else</span> {
<a name="l05937"></a>05937                                                 <span class="comment">// TODO: depends on nillable, which should be checked before calling this method</span>
<a name="l05938"></a>05938                                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:nil=\&quot;true\&quot; xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;/&gt;&quot;</span>;
<a name="l05939"></a>05939                                         }
<a name="l05940"></a>05940                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l05941"></a>05941                                         <span class="keywordflow">return</span> $xml;
<a name="l05942"></a>05942                                 }
<a name="l05943"></a>05943                                 <span class="keywordflow">if</span> ($uqType == <span class="stringliteral">&#39;Array&#39;</span>) {
<a name="l05944"></a>05944                                         <span class="comment">// JBoss/Axis does this sometimes</span>
<a name="l05945"></a>05945                                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($value, $name, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, $use);
<a name="l05946"></a>05946                                 }
<a name="l05947"></a>05947                         <span class="keywordflow">if</span> ($uqType == <span class="stringliteral">&#39;boolean&#39;</span>) {
<a name="l05948"></a>05948                                 <span class="keywordflow">if</span> ((is_string($value) &amp;&amp; $value == <span class="stringliteral">&#39;false&#39;</span>) || (! $value)) {
<a name="l05949"></a>05949                                                 $value = <span class="stringliteral">&#39;false&#39;</span>;
<a name="l05950"></a>05950                                         } <span class="keywordflow">else</span> {
<a name="l05951"></a>05951                                                 $value = <span class="stringliteral">&#39;true&#39;</span>;
<a name="l05952"></a>05952                                         }
<a name="l05953"></a>05953                                 } 
<a name="l05954"></a>05954                                 <span class="keywordflow">if</span> ($uqType == <span class="stringliteral">&#39;string&#39;</span> &amp;&amp; gettype($value) == <span class="stringliteral">&#39;string&#39;</span>) {
<a name="l05955"></a>05955                                         $value = $this-&gt;<a class="code" href="classnusoap__base.html#aa05581a9628de0f46b30dd67b5578cef">expandEntities</a>($value);
<a name="l05956"></a>05956                                 }
<a name="l05957"></a>05957                                 <span class="keywordflow">if</span> (($uqType == <span class="stringliteral">&#39;long&#39;</span> || $uqType == <span class="stringliteral">&#39;unsignedLong&#39;</span>) &amp;&amp; gettype($value) == <span class="stringliteral">&#39;double&#39;</span>) {
<a name="l05958"></a>05958                                         $value = sprintf(<span class="stringliteral">&quot;%.0lf&quot;</span>, $value);
<a name="l05959"></a>05959                                 }
<a name="l05960"></a>05960                                 <span class="comment">// it&#39;s a scalar</span>
<a name="l05961"></a>05961                                 <span class="comment">// TODO: what about null/nil values?</span>
<a name="l05962"></a>05962                                 <span class="comment">// check type isn&#39;t a custom type extending xmlschema namespace</span>
<a name="l05963"></a>05963                                 <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqType, $ns)) {
<a name="l05964"></a>05964                                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l05965"></a>05965                                                 <span class="keywordflow">if</span> ($forceType) {
<a name="l05966"></a>05966                                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l05967"></a>05967                                                 } <span class="keywordflow">else</span> {
<a name="l05968"></a>05968                                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l05969"></a>05969                                                 }
<a name="l05970"></a>05970                                         } <span class="keywordflow">else</span> {
<a name="l05971"></a>05971                                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;$encodingStyle&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l05972"></a>05972                                         }
<a name="l05973"></a>05973                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l05974"></a>05974                                         <span class="keywordflow">return</span> $xml;
<a name="l05975"></a>05975                                 }
<a name="l05976"></a>05976                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;custom type extends XML Schema or SOAP Encoding namespace (yuck)&#39;</span>);
<a name="l05977"></a>05977                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($ns == <span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>) {
<a name="l05978"></a>05978                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeType: appears to be Apache SOAP type&#39;</span>);
<a name="l05979"></a>05979                                 <span class="keywordflow">if</span> ($uqType == <span class="stringliteral">&#39;Map&#39;</span>) {
<a name="l05980"></a>05980                                         $tt_prefix = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>);
<a name="l05981"></a>05981                                         <span class="keywordflow">if</span> (! $tt_prefix) {
<a name="l05982"></a>05982                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeType: Add namespace for Apache SOAP type&#39;</span>);
<a name="l05983"></a>05983                                                 $tt_prefix = <span class="stringliteral">&#39;ns&#39;</span> . rand(1000, 9999);
<a name="l05984"></a>05984                                                 $this-&gt;namespaces[$tt_prefix] = <span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>;
<a name="l05985"></a>05985                                                 <span class="comment">// force this to be added to usedNamespaces</span>
<a name="l05986"></a>05986                                                 $tt_prefix = $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>);
<a name="l05987"></a>05987                                         }
<a name="l05988"></a>05988                                         $contents = <span class="stringliteral">&#39;&#39;</span>;
<a name="l05989"></a>05989                                         <span class="keywordflow">foreach</span>($value as $k =&gt; $v) {
<a name="l05990"></a>05990                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing map element: key $k, value $v&quot;</span>);
<a name="l05991"></a>05991                                                 $contents .= <span class="stringliteral">&#39;&lt;item&gt;&#39;</span>;
<a name="l05992"></a>05992                                                 $contents .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($k,<span class="stringliteral">&#39;key&#39;</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l05993"></a>05993                                                 $contents .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v,<span class="stringliteral">&#39;value&#39;</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l05994"></a>05994                                                 $contents .= <span class="stringliteral">&#39;&lt;/item&gt;&#39;</span>;
<a name="l05995"></a>05995                                         }
<a name="l05996"></a>05996                                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l05997"></a>05997                                                 <span class="keywordflow">if</span> ($forceType) {
<a name="l05998"></a>05998                                                         $xml = <span class="stringliteral">&quot;&lt;$name xsi:type=\&quot;&quot;</span> . $tt_prefix . <span class="stringliteral">&quot;:$uqType\&quot;&gt;$contents&lt;/$name&gt;&quot;</span>;
<a name="l05999"></a>05999                                                 } <span class="keywordflow">else</span> {
<a name="l06000"></a>06000                                                         $xml = <span class="stringliteral">&quot;&lt;$name&gt;$contents&lt;/$name&gt;&quot;</span>;
<a name="l06001"></a>06001                                                 }
<a name="l06002"></a>06002                                         } <span class="keywordflow">else</span> {
<a name="l06003"></a>06003                                                 $xml = <span class="stringliteral">&quot;&lt;$name xsi:type=\&quot;&quot;</span> . $tt_prefix . <span class="stringliteral">&quot;:$uqType\&quot;$encodingStyle&gt;$contents&lt;/$name&gt;&quot;</span>;
<a name="l06004"></a>06004                                         }
<a name="l06005"></a>06005                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l06006"></a>06006                                         <span class="keywordflow">return</span> $xml;
<a name="l06007"></a>06007                                 }
<a name="l06008"></a>06008                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in serializeType: Apache SOAP type, but only support Map&#39;</span>);
<a name="l06009"></a>06009                         }
<a name="l06010"></a>06010                 } <span class="keywordflow">else</span> {
<a name="l06011"></a>06011                         <span class="comment">// TODO: should the type be compared to types in XSD, and the namespace</span>
<a name="l06012"></a>06012                         <span class="comment">// set to XSD if the type matches?</span>
<a name="l06013"></a>06013                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: No namespace for type $type&quot;</span>);
<a name="l06014"></a>06014                         $ns = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06015"></a>06015                         $uqType = $type;
<a name="l06016"></a>06016                 }
<a name="l06017"></a>06017                 <span class="keywordflow">if</span>(!$typeDef = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqType, $ns)){
<a name="l06018"></a>06018                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;$type ($uqType) is not a supported type.&quot;</span>);
<a name="l06019"></a>06019                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: $type ($uqType) is not a supported type.&quot;</span>);
<a name="l06020"></a>06020                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06021"></a>06021                 } <span class="keywordflow">else</span> {
<a name="l06022"></a>06022                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: found typeDef&quot;</span>);
<a name="l06023"></a>06023                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;typeDef=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($typeDef));
<a name="l06024"></a>06024                         <span class="keywordflow">if</span> (substr($uqType, -1) == <span class="charliteral">&#39;^&#39;</span>) {
<a name="l06025"></a>06025                                 $uqType = substr($uqType, 0, -1);
<a name="l06026"></a>06026                         }
<a name="l06027"></a>06027                 }
<a name="l06028"></a>06028                 <span class="keywordflow">if</span> (!isset($typeDef[<span class="stringliteral">&#39;phpType&#39;</span>])) {
<a name="l06029"></a>06029                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;$type ($uqType) has no phpType.&quot;</span>);
<a name="l06030"></a>06030                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: $type ($uqType) has no phpType.&quot;</span>);
<a name="l06031"></a>06031                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06032"></a>06032                 }
<a name="l06033"></a>06033                 $phpType = $typeDef[<span class="stringliteral">&#39;phpType&#39;</span>];
<a name="l06034"></a>06034                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: uqType: $uqType, ns: $ns, phptype: $phpType, arrayType: &quot;</span> . (isset($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]) ? $typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>) ); 
<a name="l06035"></a>06035                 <span class="comment">// if php type == struct, map value to the &lt;all&gt; element names</span>
<a name="l06036"></a>06036                 <span class="keywordflow">if</span> ($phpType == <span class="stringliteral">&#39;struct&#39;</span>) {
<a name="l06037"></a>06037                         <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;typeClass&#39;</span>]) &amp;&amp; $typeDef[<span class="stringliteral">&#39;typeClass&#39;</span>] == <span class="stringliteral">&#39;element&#39;</span>) {
<a name="l06038"></a>06038                                 $elementName = $uqType;
<a name="l06039"></a>06039                                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;form&#39;</span>]) &amp;&amp; ($typeDef[<span class="stringliteral">&#39;form&#39;</span>] == <span class="stringliteral">&#39;qualified&#39;</span>)) {
<a name="l06040"></a>06040                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;$ns\&quot;&quot;</span>;
<a name="l06041"></a>06041                                 } <span class="keywordflow">else</span> {
<a name="l06042"></a>06042                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l06043"></a>06043                                 }
<a name="l06044"></a>06044                         } <span class="keywordflow">else</span> {
<a name="l06045"></a>06045                                 $elementName = $name;
<a name="l06046"></a>06046                                 <span class="keywordflow">if</span> ($unqualified) {
<a name="l06047"></a>06047                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l06048"></a>06048                                 } <span class="keywordflow">else</span> {
<a name="l06049"></a>06049                                         $elementNS = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06050"></a>06050                                 }
<a name="l06051"></a>06051                         }
<a name="l06052"></a>06052                         <span class="keywordflow">if</span> (is_null($value)) {
<a name="l06053"></a>06053                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l06054"></a>06054                                         <span class="comment">// TODO: depends on minOccurs and nillable</span>
<a name="l06055"></a>06055                                         $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS/&gt;&quot;</span>;
<a name="l06056"></a>06056                                 } <span class="keywordflow">else</span> {
<a name="l06057"></a>06057                                         $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS xsi:nil=\&quot;true\&quot; xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;/&gt;&quot;</span>;
<a name="l06058"></a>06058                                 }
<a name="l06059"></a>06059                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l06060"></a>06060                                 <span class="keywordflow">return</span> $xml;
<a name="l06061"></a>06061                         }
<a name="l06062"></a>06062                         <span class="keywordflow">if</span> (is_object($value)) {
<a name="l06063"></a>06063                                 $value = get_object_vars($value);
<a name="l06064"></a>06064                         }
<a name="l06065"></a>06065                         <span class="keywordflow">if</span> (is_array($value)) {
<a name="l06066"></a>06066                                 $elementAttrs = $this-&gt;<a class="code" href="classwsdl.html#a1462b76a3892e9e088da94720b19c4cb">serializeComplexTypeAttributes</a>($typeDef, $value, $ns, $uqType);
<a name="l06067"></a>06067                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l06068"></a>06068                                         <span class="keywordflow">if</span> ($forceType) {
<a name="l06069"></a>06069                                                 $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS$elementAttrs xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;&gt;&quot;</span>;
<a name="l06070"></a>06070                                         } <span class="keywordflow">else</span> {
<a name="l06071"></a>06071                                                 $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS$elementAttrs&gt;&quot;</span>;
<a name="l06072"></a>06072                                         }
<a name="l06073"></a>06073                                 } <span class="keywordflow">else</span> {
<a name="l06074"></a>06074                                         $xml = <span class="stringliteral">&quot;&lt;$elementName$elementNS$elementAttrs xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;$encodingStyle&gt;&quot;</span>;
<a name="l06075"></a>06075                                 }
<a name="l06076"></a>06076 
<a name="l06077"></a>06077                                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;simpleContent&#39;</span>]) &amp;&amp; $typeDef[<span class="stringliteral">&#39;simpleContent&#39;</span>] == <span class="stringliteral">&#39;true&#39;</span>) {
<a name="l06078"></a>06078                                         <span class="keywordflow">if</span> (isset($value[<span class="charliteral">&#39;!&#39;</span>])) {
<a name="l06079"></a>06079                                                 $xml .= $value[<span class="charliteral">&#39;!&#39;</span>];
<a name="l06080"></a>06080                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: serialized simpleContent for type $type&quot;</span>);
<a name="l06081"></a>06081                                         } <span class="keywordflow">else</span> {
<a name="l06082"></a>06082                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: no simpleContent to serialize for type $type&quot;</span>);
<a name="l06083"></a>06083                                         }
<a name="l06084"></a>06084                                 } <span class="keywordflow">else</span> {
<a name="l06085"></a>06085                                         <span class="comment">// complexContent</span>
<a name="l06086"></a>06086                                         $xml .= $this-&gt;<a class="code" href="classwsdl.html#aca47f23c5d0405f4b8d860c3ea125445">serializeComplexTypeElements</a>($typeDef, $value, $ns, $uqType, $use, $encodingStyle);
<a name="l06087"></a>06087                                 }
<a name="l06088"></a>06088                                 $xml .= <span class="stringliteral">&quot;&lt;/$elementName&gt;&quot;</span>;
<a name="l06089"></a>06089                         } <span class="keywordflow">else</span> {
<a name="l06090"></a>06090                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: phpType is struct, but value is not an array&quot;</span>);
<a name="l06091"></a>06091                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&quot;phpType is struct, but value is not an array: see debug output for details&quot;</span>);
<a name="l06092"></a>06092                                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06093"></a>06093                         }
<a name="l06094"></a>06094                 } elseif ($phpType == <span class="stringliteral">&#39;array&#39;</span>) {
<a name="l06095"></a>06095                         <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;form&#39;</span>]) &amp;&amp; ($typeDef[<span class="stringliteral">&#39;form&#39;</span>] == <span class="stringliteral">&#39;qualified&#39;</span>)) {
<a name="l06096"></a>06096                                 $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;$ns\&quot;&quot;</span>;
<a name="l06097"></a>06097                         } <span class="keywordflow">else</span> {
<a name="l06098"></a>06098                                 <span class="keywordflow">if</span> ($unqualified) {
<a name="l06099"></a>06099                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l06100"></a>06100                                 } <span class="keywordflow">else</span> {
<a name="l06101"></a>06101                                         $elementNS = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06102"></a>06102                                 }
<a name="l06103"></a>06103                         }
<a name="l06104"></a>06104                         <span class="keywordflow">if</span> (is_null($value)) {
<a name="l06105"></a>06105                                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l06106"></a>06106                                         <span class="comment">// TODO: depends on minOccurs</span>
<a name="l06107"></a>06107                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS/&gt;&quot;</span>;
<a name="l06108"></a>06108                                 } <span class="keywordflow">else</span> {
<a name="l06109"></a>06109                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:nil=\&quot;true\&quot; xsi:type=\&quot;&quot;</span> .
<a name="l06110"></a>06110                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>) .
<a name="l06111"></a>06111                                                 <span class="stringliteral">&quot;:Array\&quot; &quot;</span> .
<a name="l06112"></a>06112                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>) .
<a name="l06113"></a>06113                                                 <span class="stringliteral">&#39;:arrayType=&quot;&#39;</span> .
<a name="l06114"></a>06114                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>])) .
<a name="l06115"></a>06115                                                 <span class="charliteral">&#39;:&#39;</span> .
<a name="l06116"></a>06116                                                 $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]).<span class="stringliteral">&quot;[0]\&quot;/&gt;&quot;</span>;
<a name="l06117"></a>06117                                 }
<a name="l06118"></a>06118                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l06119"></a>06119                                 <span class="keywordflow">return</span> $xml;
<a name="l06120"></a>06120                         }
<a name="l06121"></a>06121                         <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;multidimensional&#39;</span>])) {
<a name="l06122"></a>06122                                 $nv = array();
<a name="l06123"></a>06123                                 <span class="keywordflow">foreach</span>($value as $v) {
<a name="l06124"></a>06124                                         $cols = <span class="charliteral">&#39;,&#39;</span> . <span class="keyword">sizeof</span>($v);
<a name="l06125"></a>06125                                         $nv = array_merge($nv, $v);
<a name="l06126"></a>06126                                 } 
<a name="l06127"></a>06127                                 $value = $nv;
<a name="l06128"></a>06128                         } <span class="keywordflow">else</span> {
<a name="l06129"></a>06129                                 $cols = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06130"></a>06130                         } 
<a name="l06131"></a>06131                         <span class="keywordflow">if</span> (is_array($value) &amp;&amp; <span class="keyword">sizeof</span>($value) &gt;= 1) {
<a name="l06132"></a>06132                                 $rows = <span class="keyword">sizeof</span>($value);
<a name="l06133"></a>06133                                 $contents = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06134"></a>06134                                 <span class="keywordflow">foreach</span>($value as $k =&gt; $v) {
<a name="l06135"></a>06135                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing array element: $k, $v of type: $typeDef[arrayType]&quot;</span>);
<a name="l06136"></a>06136                                         <span class="comment">//if (strpos($typeDef[&#39;arrayType&#39;], &#39;:&#39;) ) {</span>
<a name="l06137"></a>06137                                         <span class="keywordflow">if</span> (!in_array($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>],$this-&gt;typemap[<span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span>])) {
<a name="l06138"></a>06138                                             $contents .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>(<span class="stringliteral">&#39;item&#39;</span>, $typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>], $v, $use);
<a name="l06139"></a>06139                                         } <span class="keywordflow">else</span> {
<a name="l06140"></a>06140                                             $contents .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v, <span class="stringliteral">&#39;item&#39;</span>, $typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>], null, $this-&gt;XMLSchemaVersion, <span class="keyword">false</span>, $use);
<a name="l06141"></a>06141                                         } 
<a name="l06142"></a>06142                                 }
<a name="l06143"></a>06143                         } <span class="keywordflow">else</span> {
<a name="l06144"></a>06144                                 $rows = 0;
<a name="l06145"></a>06145                                 $contents = null;
<a name="l06146"></a>06146                         }
<a name="l06147"></a>06147                         <span class="comment">// TODO: for now, an empty value will be serialized as a zero element</span>
<a name="l06148"></a>06148                         <span class="comment">// array.  Revisit this when coding the handling of null/nil values.</span>
<a name="l06149"></a>06149                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l06150"></a>06150                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS&gt;&quot;</span>
<a name="l06151"></a>06151                                         .$contents
<a name="l06152"></a>06152                                         .<span class="stringliteral">&quot;&lt;/$name&gt;&quot;</span>;
<a name="l06153"></a>06153                         } <span class="keywordflow">else</span> {
<a name="l06154"></a>06154                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span>.$this-&gt;getPrefixFromNamespace(<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>).<span class="stringliteral">&#39;:Array&quot; &#39;</span>.
<a name="l06155"></a>06155                                         $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>(<span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>)
<a name="l06156"></a>06156                                         .<span class="stringliteral">&#39;:arrayType=&quot;&#39;</span>
<a name="l06157"></a>06157                                         .$this-&gt;getPrefixFromNamespace($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]))
<a name="l06158"></a>06158                                         .<span class="stringliteral">&quot;:&quot;</span>.$this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($typeDef[<span class="stringliteral">&#39;arrayType&#39;</span>]).<span class="stringliteral">&quot;[$rows$cols]\&quot;&gt;&quot;</span>
<a name="l06159"></a>06159                                         .$contents
<a name="l06160"></a>06160                                         .<span class="stringliteral">&quot;&lt;/$name&gt;&quot;</span>;
<a name="l06161"></a>06161                         }
<a name="l06162"></a>06162                 } elseif ($phpType == <span class="stringliteral">&#39;scalar&#39;</span>) {
<a name="l06163"></a>06163                         <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;form&#39;</span>]) &amp;&amp; ($typeDef[<span class="stringliteral">&#39;form&#39;</span>] == <span class="stringliteral">&#39;qualified&#39;</span>)) {
<a name="l06164"></a>06164                                 $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;$ns\&quot;&quot;</span>;
<a name="l06165"></a>06165                         } <span class="keywordflow">else</span> {
<a name="l06166"></a>06166                                 <span class="keywordflow">if</span> ($unqualified) {
<a name="l06167"></a>06167                                         $elementNS = <span class="stringliteral">&quot; xmlns=\&quot;\&quot;&quot;</span>;
<a name="l06168"></a>06168                                 } <span class="keywordflow">else</span> {
<a name="l06169"></a>06169                                         $elementNS = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06170"></a>06170                                 }
<a name="l06171"></a>06171                         }
<a name="l06172"></a>06172                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l06173"></a>06173                                 <span class="keywordflow">if</span> ($forceType) {
<a name="l06174"></a>06174                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l06175"></a>06175                                 } <span class="keywordflow">else</span> {
<a name="l06176"></a>06176                                         $xml = <span class="stringliteral">&quot;&lt;$name$elementNS&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l06177"></a>06177                                 }
<a name="l06178"></a>06178                         } <span class="keywordflow">else</span> {
<a name="l06179"></a>06179                                 $xml = <span class="stringliteral">&quot;&lt;$name$elementNS xsi:type=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#a5db1f5554874f5bd987760ab50d621ad">getPrefixFromNamespace</a>($ns) . <span class="stringliteral">&quot;:$uqType\&quot;$encodingStyle&gt;$value&lt;/$name&gt;&quot;</span>;
<a name="l06180"></a>06180                         }
<a name="l06181"></a>06181                 }
<a name="l06182"></a>06182                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeType: returning: $xml&quot;</span>);
<a name="l06183"></a>06183                 <span class="keywordflow">return</span> $xml;
<a name="l06184"></a>06184         }
<a name="l06185"></a>06185         
<a name="l06196"></a><a class="code" href="classwsdl.html#a1462b76a3892e9e088da94720b19c4cb">06196</a>         function <a class="code" href="classwsdl.html#a1462b76a3892e9e088da94720b19c4cb">serializeComplexTypeAttributes</a>($typeDef, $value, $ns, $uqType) {
<a name="l06197"></a>06197                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializeComplexTypeAttributes for XML Schema type $ns:$uqType&quot;</span>);
<a name="l06198"></a>06198                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06199"></a>06199                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>])) {
<a name="l06200"></a>06200                         $nsx = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>]);
<a name="l06201"></a>06201                         $uqTypex = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>]);
<a name="l06202"></a>06202                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($nsx)) {
<a name="l06203"></a>06203                                 $nsx = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($nsx);
<a name="l06204"></a>06204                         }
<a name="l06205"></a>06205                         <span class="keywordflow">if</span> ($typeDefx = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqTypex, $nsx)) {
<a name="l06206"></a>06206                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize attributes for extension base $nsx:$uqTypex&quot;</span>);
<a name="l06207"></a>06207                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#a1462b76a3892e9e088da94720b19c4cb">serializeComplexTypeAttributes</a>($typeDefx, $value, $nsx, $uqTypex);
<a name="l06208"></a>06208                         } <span class="keywordflow">else</span> {
<a name="l06209"></a>06209                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;extension base $nsx:$uqTypex is not a supported type&quot;</span>);
<a name="l06210"></a>06210                         }
<a name="l06211"></a>06211                 }
<a name="l06212"></a>06212                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;attrs&#39;</span>]) &amp;&amp; is_array($typeDef[<span class="stringliteral">&#39;attrs&#39;</span>])) {
<a name="l06213"></a>06213                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize attributes for XML Schema type $ns:$uqType&quot;</span>);
<a name="l06214"></a>06214                         <span class="keywordflow">if</span> (is_array($value)) {
<a name="l06215"></a>06215                                 $xvalue = $value;
<a name="l06216"></a>06216                         } elseif (is_object($value)) {
<a name="l06217"></a>06217                                 $xvalue = get_object_vars($value);
<a name="l06218"></a>06218                         } <span class="keywordflow">else</span> {
<a name="l06219"></a>06219                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;value is neither an array nor an object for XML Schema type $ns:$uqType&quot;</span>);
<a name="l06220"></a>06220                                 $xvalue = array();
<a name="l06221"></a>06221                         }
<a name="l06222"></a>06222                         <span class="keywordflow">foreach</span> ($typeDef[<span class="stringliteral">&#39;attrs&#39;</span>] as $aName =&gt; $attrs) {
<a name="l06223"></a>06223                                 <span class="keywordflow">if</span> (isset($xvalue[<span class="charliteral">&#39;!&#39;</span> . $aName])) {
<a name="l06224"></a>06224                                         $xname = <span class="charliteral">&#39;!&#39;</span> . $aName;
<a name="l06225"></a>06225                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;value provided for attribute $aName with key $xname&quot;</span>);
<a name="l06226"></a>06226                                 } elseif (isset($xvalue[$aName])) {
<a name="l06227"></a>06227                                         $xname = $aName;
<a name="l06228"></a>06228                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;value provided for attribute $aName with key $xname&quot;</span>);
<a name="l06229"></a>06229                                 } elseif (isset($attrs[<span class="stringliteral">&#39;default&#39;</span>])) {
<a name="l06230"></a>06230                                         $xname = <span class="charliteral">&#39;!&#39;</span> . $aName;
<a name="l06231"></a>06231                                         $xvalue[$xname] = $attrs[<span class="stringliteral">&#39;default&#39;</span>];
<a name="l06232"></a>06232                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;use default value of &#39;</span> . $xvalue[$aName] . <span class="stringliteral">&#39; for attribute &#39;</span> . $aName);
<a name="l06233"></a>06233                                 } <span class="keywordflow">else</span> {
<a name="l06234"></a>06234                                         $xname = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06235"></a>06235                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;no value provided for attribute $aName&quot;</span>);
<a name="l06236"></a>06236                                 }
<a name="l06237"></a>06237                                 <span class="keywordflow">if</span> ($xname) {
<a name="l06238"></a>06238                                         $xml .=  <span class="stringliteral">&quot; $aName=\&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#aa05581a9628de0f46b30dd67b5578cef">expandEntities</a>($xvalue[$xname]) . <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l06239"></a>06239                                 }
<a name="l06240"></a>06240                         } 
<a name="l06241"></a>06241                 } <span class="keywordflow">else</span> {
<a name="l06242"></a>06242                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;no attributes to serialize for XML Schema type $ns:$uqType&quot;</span>);
<a name="l06243"></a>06243                 }
<a name="l06244"></a>06244                 <span class="keywordflow">return</span> $xml;
<a name="l06245"></a>06245         }
<a name="l06246"></a>06246 
<a name="l06259"></a><a class="code" href="classwsdl.html#aca47f23c5d0405f4b8d860c3ea125445">06259</a>         function <a class="code" href="classwsdl.html#aca47f23c5d0405f4b8d860c3ea125445">serializeComplexTypeElements</a>($typeDef, $value, $ns, $uqType, $use=<span class="stringliteral">&#39;encoded&#39;</span>, $encodingStyle=<span class="keyword">false</span>) {
<a name="l06260"></a>06260                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeComplexTypeElements for XML Schema type $ns:$uqType&quot;</span>);
<a name="l06261"></a>06261                 $xml = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06262"></a>06262                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>])) {
<a name="l06263"></a>06263                         $nsx = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>]);
<a name="l06264"></a>06264                         $uqTypex = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($typeDef[<span class="stringliteral">&#39;extensionBase&#39;</span>]);
<a name="l06265"></a>06265                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($nsx)) {
<a name="l06266"></a>06266                                 $nsx = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($nsx);
<a name="l06267"></a>06267                         }
<a name="l06268"></a>06268                         <span class="keywordflow">if</span> ($typeDefx = $this-&gt;<a class="code" href="classwsdl.html#a39e43dc3480a79ca01b59998c00c753b">getTypeDef</a>($uqTypex, $nsx)) {
<a name="l06269"></a>06269                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serialize elements for extension base $nsx:$uqTypex&quot;</span>);
<a name="l06270"></a>06270                                 $xml .= $this-&gt;<a class="code" href="classwsdl.html#aca47f23c5d0405f4b8d860c3ea125445">serializeComplexTypeElements</a>($typeDefx, $value, $nsx, $uqTypex, $use, $encodingStyle);
<a name="l06271"></a>06271                         } <span class="keywordflow">else</span> {
<a name="l06272"></a>06272                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;extension base $nsx:$uqTypex is not a supported type&quot;</span>);
<a name="l06273"></a>06273                         }
<a name="l06274"></a>06274                 }
<a name="l06275"></a>06275                 <span class="keywordflow">if</span> (isset($typeDef[<span class="stringliteral">&#39;elements&#39;</span>]) &amp;&amp; is_array($typeDef[<span class="stringliteral">&#39;elements&#39;</span>])) {
<a name="l06276"></a>06276                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in serializeComplexTypeElements, serialize elements for XML Schema type $ns:$uqType&quot;</span>);
<a name="l06277"></a>06277                         <span class="keywordflow">if</span> (is_array($value)) {
<a name="l06278"></a>06278                                 $xvalue = $value;
<a name="l06279"></a>06279                         } elseif (is_object($value)) {
<a name="l06280"></a>06280                                 $xvalue = get_object_vars($value);
<a name="l06281"></a>06281                         } <span class="keywordflow">else</span> {
<a name="l06282"></a>06282                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;value is neither an array nor an object for XML Schema type $ns:$uqType&quot;</span>);
<a name="l06283"></a>06283                                 $xvalue = array();
<a name="l06284"></a>06284                         }
<a name="l06285"></a>06285                         <span class="comment">// toggle whether all elements are present - ideally should validate against schema</span>
<a name="l06286"></a>06286                         <span class="keywordflow">if</span> (count($typeDef[<span class="stringliteral">&#39;elements&#39;</span>]) != count($xvalue)){
<a name="l06287"></a>06287                                 $optionals = <span class="keyword">true</span>;
<a name="l06288"></a>06288                         }
<a name="l06289"></a>06289                         <span class="keywordflow">foreach</span> ($typeDef[<span class="stringliteral">&#39;elements&#39;</span>] as $eName =&gt; $attrs) {
<a name="l06290"></a>06290                                 <span class="keywordflow">if</span> (!isset($xvalue[$eName])) {
<a name="l06291"></a>06291                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;default&#39;</span>])) {
<a name="l06292"></a>06292                                                 $xvalue[$eName] = $attrs[<span class="stringliteral">&#39;default&#39;</span>];
<a name="l06293"></a>06293                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;use default value of &#39;</span> . $xvalue[$eName] . <span class="stringliteral">&#39; for element &#39;</span> . $eName);
<a name="l06294"></a>06294                                         }
<a name="l06295"></a>06295                                 }
<a name="l06296"></a>06296                                 <span class="comment">// if user took advantage of a minOccurs=0, then only serialize named parameters</span>
<a name="l06297"></a>06297                                 <span class="keywordflow">if</span> (isset($optionals)
<a name="l06298"></a>06298                                     &amp;&amp; (!isset($xvalue[$eName])) 
<a name="l06299"></a>06299                                         &amp;&amp; ( (!isset($attrs[<span class="stringliteral">&#39;nillable&#39;</span>])) || $attrs[<span class="stringliteral">&#39;nillable&#39;</span>] != <span class="stringliteral">&#39;true&#39;</span>)
<a name="l06300"></a>06300                                         ){
<a name="l06301"></a>06301                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>]) &amp;&amp; $attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>] &lt;&gt; <span class="charliteral">&#39;0&#39;</span>) {
<a name="l06302"></a>06302                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;apparent error: no value provided for element $eName with minOccurs=&quot;</span> . $attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>]);
<a name="l06303"></a>06303                                         }
<a name="l06304"></a>06304                                         <span class="comment">// do nothing</span>
<a name="l06305"></a>06305                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;no value provided for complexType element $eName and element is not nillable, so serialize nothing&quot;</span>);
<a name="l06306"></a>06306                                 } <span class="keywordflow">else</span> {
<a name="l06307"></a>06307                                         <span class="comment">// get value</span>
<a name="l06308"></a>06308                                         <span class="keywordflow">if</span> (isset($xvalue[$eName])) {
<a name="l06309"></a>06309                                             $v = $xvalue[$eName];
<a name="l06310"></a>06310                                         } <span class="keywordflow">else</span> {
<a name="l06311"></a>06311                                             $v = null;
<a name="l06312"></a>06312                                         }
<a name="l06313"></a>06313                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;form&#39;</span>])) {
<a name="l06314"></a>06314                                                 $unqualified = ($attrs[<span class="stringliteral">&#39;form&#39;</span>] == <span class="stringliteral">&#39;unqualified&#39;</span>);
<a name="l06315"></a>06315                                         } <span class="keywordflow">else</span> {
<a name="l06316"></a>06316                                                 $unqualified = <span class="keyword">false</span>;
<a name="l06317"></a>06317                                         }
<a name="l06318"></a>06318                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;maxOccurs&#39;</span>]) &amp;&amp; ($attrs[<span class="stringliteral">&#39;maxOccurs&#39;</span>] == <span class="stringliteral">&#39;unbounded&#39;</span> || $attrs[<span class="stringliteral">&#39;maxOccurs&#39;</span>] &gt; 1) &amp;&amp; isset($v) &amp;&amp; is_array($v) &amp;&amp; $this-&gt;<a class="code" href="classnusoap__base.html#ae592e8f651298d6b648590cf5eeafac9">isArraySimpleOrStruct</a>($v) == <span class="stringliteral">&#39;arraySimple&#39;</span>) {
<a name="l06319"></a>06319                                                 $vv = $v;
<a name="l06320"></a>06320                                                 <span class="keywordflow">foreach</span> ($vv as $k =&gt; $v) {
<a name="l06321"></a>06321                                                         <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) || isset($attrs[<span class="stringliteral">&#39;ref&#39;</span>])) {
<a name="l06322"></a>06322                                                                 <span class="comment">// serialize schema-defined type</span>
<a name="l06323"></a>06323                                                             $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($eName, isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) ? $attrs[<span class="stringliteral">&#39;type&#39;</span>] : $attrs[<span class="stringliteral">&#39;ref&#39;</span>], $v, $use, $encodingStyle, $unqualified);
<a name="l06324"></a>06324                                                         } <span class="keywordflow">else</span> {
<a name="l06325"></a>06325                                                                 <span class="comment">// serialize generic type (can this ever really happen?)</span>
<a name="l06326"></a>06326                                                             $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;calling serialize_val() for $v, $eName, false, false, false, false, $use&quot;</span>);
<a name="l06327"></a>06327                                                             $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v, $eName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, $use);
<a name="l06328"></a>06328                                                         }
<a name="l06329"></a>06329                                                 }
<a name="l06330"></a>06330                                         } <span class="keywordflow">else</span> {
<a name="l06331"></a>06331                                                 <span class="keywordflow">if</span> (is_null($v) &amp;&amp; isset($attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>]) &amp;&amp; $attrs[<span class="stringliteral">&#39;minOccurs&#39;</span>] == <span class="charliteral">&#39;0&#39;</span>) {
<a name="l06332"></a>06332                                                         <span class="comment">// do nothing</span>
<a name="l06333"></a>06333                                                 } elseif (is_null($v) &amp;&amp; isset($attrs[<span class="stringliteral">&#39;nillable&#39;</span>]) &amp;&amp; $attrs[<span class="stringliteral">&#39;nillable&#39;</span>] == <span class="stringliteral">&#39;true&#39;</span>) {
<a name="l06334"></a>06334                                                         <span class="comment">// TODO: serialize a nil correctly, but for now serialize schema-defined type</span>
<a name="l06335"></a>06335                                                     $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($eName, isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) ? $attrs[<span class="stringliteral">&#39;type&#39;</span>] : $attrs[<span class="stringliteral">&#39;ref&#39;</span>], $v, $use, $encodingStyle, $unqualified);
<a name="l06336"></a>06336                                                 } elseif (isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) || isset($attrs[<span class="stringliteral">&#39;ref&#39;</span>])) {
<a name="l06337"></a>06337                                                         <span class="comment">// serialize schema-defined type</span>
<a name="l06338"></a>06338                                                     $xml .= $this-&gt;<a class="code" href="classwsdl.html#a997a6bcf542a72d1ad0c79a6c3f0c4ee">serializeType</a>($eName, isset($attrs[<span class="stringliteral">&#39;type&#39;</span>]) ? $attrs[<span class="stringliteral">&#39;type&#39;</span>] : $attrs[<span class="stringliteral">&#39;ref&#39;</span>], $v, $use, $encodingStyle, $unqualified);
<a name="l06339"></a>06339                                                 } <span class="keywordflow">else</span> {
<a name="l06340"></a>06340                                                         <span class="comment">// serialize generic type (can this ever really happen?)</span>
<a name="l06341"></a>06341                                                     $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;calling serialize_val() for $v, $eName, false, false, false, false, $use&quot;</span>);
<a name="l06342"></a>06342                                                     $xml .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v, $eName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, $use);
<a name="l06343"></a>06343                                                 }
<a name="l06344"></a>06344                                         }
<a name="l06345"></a>06345                                 }
<a name="l06346"></a>06346                         } 
<a name="l06347"></a>06347                 } <span class="keywordflow">else</span> {
<a name="l06348"></a>06348                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;no elements to serialize for XML Schema type $ns:$uqType&quot;</span>);
<a name="l06349"></a>06349                 }
<a name="l06350"></a>06350                 <span class="keywordflow">return</span> $xml;
<a name="l06351"></a>06351         }
<a name="l06352"></a>06352 
<a name="l06367"></a><a class="code" href="classwsdl.html#ae5a20be9e2b68cca5a1425f905340ceb">06367</a>         function <a class="code" href="classwsdl.html#ae5a20be9e2b68cca5a1425f905340ceb">addComplexType</a>($name,$typeClass=<span class="stringliteral">&#39;complexType&#39;</span>,$phpType=<span class="stringliteral">&#39;array&#39;</span>,$compositor=<span class="stringliteral">&#39;&#39;</span>,$restrictionBase=<span class="stringliteral">&#39;&#39;</span>,$elements=array(),$attrs=array(),$arrayType=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l06368"></a>06368                 <span class="keywordflow">if</span> (count($elements) &gt; 0) {
<a name="l06369"></a>06369                         $eElements = array();
<a name="l06370"></a>06370                 <span class="keywordflow">foreach</span>($elements as $n =&gt; $e){
<a name="l06371"></a>06371                     <span class="comment">// expand each element</span>
<a name="l06372"></a>06372                     $ee = array();
<a name="l06373"></a>06373                     <span class="keywordflow">foreach</span> ($e as $k =&gt; $v) {
<a name="l06374"></a>06374                             $k = strpos($k,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($k) : $k;
<a name="l06375"></a>06375                             $v = strpos($v,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($v) : $v;
<a name="l06376"></a>06376                             $ee[$k] = $v;
<a name="l06377"></a>06377                         }
<a name="l06378"></a>06378                         $eElements[$n] = $ee;
<a name="l06379"></a>06379                 }
<a name="l06380"></a>06380                 $elements = $eElements;
<a name="l06381"></a>06381                 }
<a name="l06382"></a>06382                 
<a name="l06383"></a>06383                 <span class="keywordflow">if</span> (count($attrs) &gt; 0) {
<a name="l06384"></a>06384                 <span class="keywordflow">foreach</span>($attrs as $n =&gt; $a){
<a name="l06385"></a>06385                     <span class="comment">// expand each attribute</span>
<a name="l06386"></a>06386                     <span class="keywordflow">foreach</span> ($a as $k =&gt; $v) {
<a name="l06387"></a>06387                             $k = strpos($k,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($k) : $k;
<a name="l06388"></a>06388                             $v = strpos($v,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($v) : $v;
<a name="l06389"></a>06389                             $aa[$k] = $v;
<a name="l06390"></a>06390                         }
<a name="l06391"></a>06391                         $eAttrs[$n] = $aa;
<a name="l06392"></a>06392                 }
<a name="l06393"></a>06393                 $attrs = $eAttrs;
<a name="l06394"></a>06394                 }
<a name="l06395"></a>06395 
<a name="l06396"></a>06396                 $restrictionBase = strpos($restrictionBase,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($restrictionBase) : $restrictionBase;
<a name="l06397"></a>06397                 $arrayType = strpos($arrayType,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($arrayType) : $arrayType;
<a name="l06398"></a>06398 
<a name="l06399"></a>06399                 $typens = isset($this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>]) ? $this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>] : $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>];
<a name="l06400"></a>06400                 $this-&gt;schemas[$typens][0]-&gt;addComplexType($name,$typeClass,$phpType,$compositor,$restrictionBase,$elements,$attrs,$arrayType);
<a name="l06401"></a>06401         }
<a name="l06402"></a>06402 
<a name="l06414"></a><a class="code" href="classwsdl.html#a68cb89426925948d7364741d925eb3ad">06414</a>         function <a class="code" href="classwsdl.html#a68cb89426925948d7364741d925eb3ad">addSimpleType</a>($name, $restrictionBase=<span class="stringliteral">&#39;&#39;</span>, $typeClass=<span class="stringliteral">&#39;simpleType&#39;</span>, $phpType=<span class="stringliteral">&#39;scalar&#39;</span>, $enumeration=array()) {
<a name="l06415"></a>06415                 $restrictionBase = strpos($restrictionBase,<span class="charliteral">&#39;:&#39;</span>) ? $this-&gt;<a class="code" href="classnusoap__base.html#aaaec19feb99e1ddb9bb81fe8c49e74cb">expandQname</a>($restrictionBase) : $restrictionBase;
<a name="l06416"></a>06416 
<a name="l06417"></a>06417                 $typens = isset($this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>]) ? $this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>] : $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>];
<a name="l06418"></a>06418                 $this-&gt;schemas[$typens][0]-&gt;addSimpleType($name, $restrictionBase, $typeClass, $phpType, $enumeration);
<a name="l06419"></a>06419         }
<a name="l06420"></a>06420 
<a name="l06428"></a><a class="code" href="classwsdl.html#a3216aae8de447e692223d256db744e37">06428</a>         function <a class="code" href="classwsdl.html#a3216aae8de447e692223d256db744e37">addElement</a>($attrs) {
<a name="l06429"></a>06429                 $typens = isset($this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>]) ? $this-&gt;namespaces[<span class="stringliteral">&#39;types&#39;</span>] : $this-&gt;namespaces[<span class="stringliteral">&#39;tns&#39;</span>];
<a name="l06430"></a>06430                 $this-&gt;schemas[$typens][0]-&gt;addElement($attrs);
<a name="l06431"></a>06431         }
<a name="l06432"></a>06432 
<a name="l06447"></a><a class="code" href="classwsdl.html#a1cd01992e1d4bacaf47e728df2b8bd84">06447</a>         function <a class="code" href="classwsdl.html#a1cd01992e1d4bacaf47e728df2b8bd84">addOperation</a>($name, $in = <span class="keyword">false</span>, $out = <span class="keyword">false</span>, $namespace = <span class="keyword">false</span>, $soapaction = <span class="keyword">false</span>, $style = <span class="stringliteral">&#39;rpc&#39;</span>, $use = <span class="stringliteral">&#39;encoded&#39;</span>, <a class="code" href="classwsdl.html#a90e868755e79fd7f8c37ec8345167952">$documentation</a> = <span class="stringliteral">&#39;&#39;</span>, $encodingStyle = <span class="stringliteral">&#39;&#39;</span>){
<a name="l06448"></a>06448                 <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;encoded&#39;</span> &amp;&amp; $encodingStyle == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l06449"></a>06449                         $encodingStyle = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>;
<a name="l06450"></a>06450                 }
<a name="l06451"></a>06451 
<a name="l06452"></a>06452                 <span class="keywordflow">if</span> ($style == <span class="stringliteral">&#39;document&#39;</span>) {
<a name="l06453"></a>06453                         $elements = array();
<a name="l06454"></a>06454                         <span class="keywordflow">foreach</span> ($in as $n =&gt; $t) {
<a name="l06455"></a>06455                                 $elements[$n] = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $n, <span class="stringliteral">&#39;type&#39;</span> =&gt; $t, <span class="stringliteral">&#39;form&#39;</span> =&gt; <span class="stringliteral">&#39;unqualified&#39;</span>);
<a name="l06456"></a>06456                         }
<a name="l06457"></a>06457                         $this-&gt;<a class="code" href="classwsdl.html#ae5a20be9e2b68cca5a1425f905340ceb">addComplexType</a>($name . <span class="stringliteral">&#39;RequestType&#39;</span>, <span class="stringliteral">&#39;complexType&#39;</span>, <span class="stringliteral">&#39;struct&#39;</span>, <span class="stringliteral">&#39;all&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $elements);
<a name="l06458"></a>06458                         $this-&gt;<a class="code" href="classwsdl.html#a3216aae8de447e692223d256db744e37">addElement</a>(array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $name, <span class="stringliteral">&#39;type&#39;</span> =&gt; $name . <span class="stringliteral">&#39;RequestType&#39;</span>));
<a name="l06459"></a>06459                         $in = array(<span class="stringliteral">&#39;parameters&#39;</span> =&gt; <span class="stringliteral">&#39;tns:&#39;</span> . $name . <span class="charliteral">&#39;^&#39;</span>);
<a name="l06460"></a>06460 
<a name="l06461"></a>06461                         $elements = array();
<a name="l06462"></a>06462                         <span class="keywordflow">foreach</span> ($out as $n =&gt; $t) {
<a name="l06463"></a>06463                                 $elements[$n] = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $n, <span class="stringliteral">&#39;type&#39;</span> =&gt; $t, <span class="stringliteral">&#39;form&#39;</span> =&gt; <span class="stringliteral">&#39;unqualified&#39;</span>);
<a name="l06464"></a>06464                         }
<a name="l06465"></a>06465                         $this-&gt;<a class="code" href="classwsdl.html#ae5a20be9e2b68cca5a1425f905340ceb">addComplexType</a>($name . <span class="stringliteral">&#39;ResponseType&#39;</span>, <span class="stringliteral">&#39;complexType&#39;</span>, <span class="stringliteral">&#39;struct&#39;</span>, <span class="stringliteral">&#39;all&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $elements);
<a name="l06466"></a>06466                         $this-&gt;<a class="code" href="classwsdl.html#a3216aae8de447e692223d256db744e37">addElement</a>(array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $name . <span class="stringliteral">&#39;Response&#39;</span>, <span class="stringliteral">&#39;type&#39;</span> =&gt; $name . <span class="stringliteral">&#39;ResponseType&#39;</span>, <span class="stringliteral">&#39;form&#39;</span> =&gt; <span class="stringliteral">&#39;qualified&#39;</span>));
<a name="l06467"></a>06467                         $out = array(<span class="stringliteral">&#39;parameters&#39;</span> =&gt; <span class="stringliteral">&#39;tns:&#39;</span> . $name . <span class="stringliteral">&#39;Response&#39;</span> . <span class="charliteral">&#39;^&#39;</span>);
<a name="l06468"></a>06468                 }
<a name="l06469"></a>06469 
<a name="l06470"></a>06470                 <span class="comment">// get binding</span>
<a name="l06471"></a>06471                 $this-&gt;bindings[ $this-&gt;serviceName . <span class="stringliteral">&#39;Binding&#39;</span> ][<span class="stringliteral">&#39;operations&#39;</span>][$name] =
<a name="l06472"></a>06472                 array(
<a name="l06473"></a>06473                 <span class="stringliteral">&#39;name&#39;</span> =&gt; $name,
<a name="l06474"></a>06474                 <span class="stringliteral">&#39;binding&#39;</span> =&gt; $this-&gt;serviceName . <span class="stringliteral">&#39;Binding&#39;</span>,
<a name="l06475"></a>06475                 <span class="stringliteral">&#39;endpoint&#39;</span> =&gt; $this-&gt;endpoint,
<a name="l06476"></a>06476                 <span class="stringliteral">&#39;soapAction&#39;</span> =&gt; $soapaction,
<a name="l06477"></a>06477                 <span class="stringliteral">&#39;style&#39;</span> =&gt; $style,
<a name="l06478"></a>06478                 <span class="stringliteral">&#39;input&#39;</span> =&gt; array(
<a name="l06479"></a>06479                         <span class="stringliteral">&#39;use&#39;</span> =&gt; $use,
<a name="l06480"></a>06480                         <span class="stringliteral">&#39;namespace&#39;</span> =&gt; $namespace,
<a name="l06481"></a>06481                         <span class="stringliteral">&#39;encodingStyle&#39;</span> =&gt; $encodingStyle,
<a name="l06482"></a>06482                         <span class="stringliteral">&#39;message&#39;</span> =&gt; $name . <span class="stringliteral">&#39;Request&#39;</span>,
<a name="l06483"></a>06483                         <span class="stringliteral">&#39;parts&#39;</span> =&gt; $in),
<a name="l06484"></a>06484                 <span class="stringliteral">&#39;output&#39;</span> =&gt; array(
<a name="l06485"></a>06485                         <span class="stringliteral">&#39;use&#39;</span> =&gt; $use,
<a name="l06486"></a>06486                         <span class="stringliteral">&#39;namespace&#39;</span> =&gt; $namespace,
<a name="l06487"></a>06487                         <span class="stringliteral">&#39;encodingStyle&#39;</span> =&gt; $encodingStyle,
<a name="l06488"></a>06488                         <span class="stringliteral">&#39;message&#39;</span> =&gt; $name . <span class="stringliteral">&#39;Response&#39;</span>,
<a name="l06489"></a>06489                         <span class="stringliteral">&#39;parts&#39;</span> =&gt; $out),
<a name="l06490"></a>06490                 <span class="stringliteral">&#39;namespace&#39;</span> =&gt; $namespace,
<a name="l06491"></a>06491                 <span class="stringliteral">&#39;transport&#39;</span> =&gt; <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/http&#39;</span>,
<a name="l06492"></a>06492                 <span class="stringliteral">&#39;documentation&#39;</span> =&gt; <a class="code" href="classwsdl.html#a90e868755e79fd7f8c37ec8345167952">$documentation</a>); 
<a name="l06493"></a>06493                 <span class="comment">// add portTypes</span>
<a name="l06494"></a>06494                 <span class="comment">// add messages</span>
<a name="l06495"></a>06495                 <span class="keywordflow">if</span>($in)
<a name="l06496"></a>06496                 {
<a name="l06497"></a>06497                         <span class="keywordflow">foreach</span>($in as $pName =&gt; $pType)
<a name="l06498"></a>06498                         {
<a name="l06499"></a>06499                                 <span class="keywordflow">if</span>(strpos($pType,<span class="charliteral">&#39;:&#39;</span>)) {
<a name="l06500"></a>06500                                         $pType = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($pType)).<span class="stringliteral">&quot;:&quot;</span>.$this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($pType);
<a name="l06501"></a>06501                                 }
<a name="l06502"></a>06502                                 $this-&gt;messages[$name.<span class="stringliteral">&#39;Request&#39;</span>][$pName] = $pType;
<a name="l06503"></a>06503                         }
<a name="l06504"></a>06504                 } <span class="keywordflow">else</span> {
<a name="l06505"></a>06505             $this-&gt;messages[$name.<span class="stringliteral">&#39;Request&#39;</span>]= <span class="charliteral">&#39;0&#39;</span>;
<a name="l06506"></a>06506         }
<a name="l06507"></a>06507                 <span class="keywordflow">if</span>($out)
<a name="l06508"></a>06508                 {
<a name="l06509"></a>06509                         <span class="keywordflow">foreach</span>($out as $pName =&gt; $pType)
<a name="l06510"></a>06510                         {
<a name="l06511"></a>06511                                 <span class="keywordflow">if</span>(strpos($pType,<span class="charliteral">&#39;:&#39;</span>)) {
<a name="l06512"></a>06512                                         $pType = $this-&gt;<a class="code" href="classnusoap__base.html#a22bf4736eaf3260f6616d8927342a724">getNamespaceFromPrefix</a>($this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($pType)).<span class="stringliteral">&quot;:&quot;</span>.$this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($pType);
<a name="l06513"></a>06513                                 }
<a name="l06514"></a>06514                                 $this-&gt;messages[$name.<span class="stringliteral">&#39;Response&#39;</span>][$pName] = $pType;
<a name="l06515"></a>06515                         }
<a name="l06516"></a>06516                 } <span class="keywordflow">else</span> {
<a name="l06517"></a>06517             $this-&gt;messages[$name.<span class="stringliteral">&#39;Response&#39;</span>]= <span class="charliteral">&#39;0&#39;</span>;
<a name="l06518"></a>06518         }
<a name="l06519"></a>06519                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06520"></a>06520         } 
<a name="l06521"></a>06521 }
<a name="l06522"></a>06522 ?&gt;&lt;?php
<a name="l06523"></a>06523 
<a name="l06524"></a>06524 
<a name="l06525"></a>06525 
<a name="l06535"></a>06535 <span class="keyword">class </span><a class="code" href="classnusoap__parser.html">nusoap_parser</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__base.html">nusoap_base</a> {
<a name="l06536"></a>06536 
<a name="l06537"></a>06537         var <a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06538"></a>06538         var <a class="code" href="classnusoap__parser.html#a4bff1d77860985cd4687104afe912b35">$xml_encoding</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06539"></a>06539         var <a class="code" href="classnusoap__parser.html#aeec9dd0b8cf29f235a9783e00ea38d44">$method</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06540"></a>06540         var <a class="code" href="classnusoap__parser.html#ae11c592f63e1abde8b9c63c25c16f808">$root_struct</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06541"></a>06541         var <a class="code" href="classnusoap__parser.html#a04d68e494a36e924876fedc0097b4959">$root_struct_name</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06542"></a>06542         var <a class="code" href="classnusoap__parser.html#a0534c3222943d39df67ff4638599d1cb">$root_struct_namespace</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06543"></a>06543         var <a class="code" href="classnusoap__parser.html#a7b391b28a73db9c1349be6fd8f8f7814">$root_header</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06544"></a>06544     var <a class="code" href="classnusoap__parser.html#ad7064b352b0e94398d5c4b1c154b968f">$document</a> = <span class="stringliteral">&#39;&#39;</span>;                 <span class="comment">// incoming SOAP body (text)</span>
<a name="l06545"></a>06545         <span class="comment">// determines where in the message we are (envelope,header,body,method)</span>
<a name="l06546"></a>06546         var <a class="code" href="classnusoap__parser.html#addf855ab91b6ca4d79baa852f080ac30">$status</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06547"></a>06547         var <a class="code" href="classnusoap__parser.html#a079ac092239789c174366d73e733f081">$position</a> = 0;
<a name="l06548"></a>06548         var <a class="code" href="classnusoap__parser.html#a796d8725f2faebee38093efbe896e71b">$depth</a> = 0;
<a name="l06549"></a>06549         var <a class="code" href="classnusoap__parser.html#afa9d8d51ed7be548337cdd80e3308b32">$default_namespace</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06550"></a>06550         var <a class="code" href="classnusoap__parser.html#a074023e68e1fad559140dcea10cbfd20">$namespaces</a> = array();
<a name="l06551"></a>06551         var <a class="code" href="classnusoap__parser.html#a9df207e0cc1095531b972aec8f47bb7a">$message</a> = array();
<a name="l06552"></a>06552     var <a class="code" href="classnusoap__parser.html#ac48271fa16f9be370c5de165a82b5d7b">$parent</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06553"></a>06553         var <a class="code" href="classnusoap__parser.html#a9dcf4e7bad1186993836eff3988f951a">$fault</a> = <span class="keyword">false</span>;
<a name="l06554"></a>06554         var <a class="code" href="classnusoap__parser.html#a462add75990d668f6e12582b80ab1f1b">$fault_code</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06555"></a>06555         var <a class="code" href="classnusoap__parser.html#a5b33c03f057274ad583ca4520a5e6c71">$fault_str</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06556"></a>06556         var <a class="code" href="classnusoap__parser.html#a494ac54573cc2c08cb2d3f8c09a92f53">$fault_detail</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06557"></a>06557         var <a class="code" href="classnusoap__parser.html#a42ac71fcf12627082377580455d37f09">$depth_array</a> = array();
<a name="l06558"></a>06558         var <a class="code" href="classnusoap__parser.html#afce7053b2655cf7c3d62736755069152">$debug_flag</a> = <span class="keyword">true</span>;
<a name="l06559"></a>06559         var <a class="code" href="classnusoap__parser.html#ae7b12febacce73ac64f5d93736050b9b">$soapresponse</a> = NULL;       <span class="comment">// parsed SOAP Body</span>
<a name="l06560"></a>06560         var <a class="code" href="classnusoap__parser.html#a38afd688ebae7e9e8e11b7e451dcc62a">$soapheader</a> = NULL;         <span class="comment">// parsed SOAP Header</span>
<a name="l06561"></a>06561         var <a class="code" href="classnusoap__parser.html#ad841266d2e033ec84344025420ca6012">$responseHeaders</a> = <span class="stringliteral">&#39;&#39;</span>;      <span class="comment">// incoming SOAP headers (text)</span>
<a name="l06562"></a>06562         var <a class="code" href="classnusoap__parser.html#acf9fb9b35eaad0620a401ece6bfb815c">$body_position</a> = 0;
<a name="l06563"></a>06563         <span class="comment">// for multiref parsing:</span>
<a name="l06564"></a>06564         <span class="comment">// array of id =&gt; pos</span>
<a name="l06565"></a>06565         var <a class="code" href="classnusoap__parser.html#a8f7ccf551a0aa97d8b36e57dccf64632">$ids</a> = array();
<a name="l06566"></a>06566         <span class="comment">// array of id =&gt; hrefs =&gt; pos</span>
<a name="l06567"></a>06567         var <a class="code" href="classnusoap__parser.html#af26bca3995267b435ea9d059a15a3ae9">$multirefs</a> = array();
<a name="l06568"></a>06568         <span class="comment">// toggle for auto-decoding element content</span>
<a name="l06569"></a>06569         var <a class="code" href="classnusoap__parser.html#aaeea14215dd37a3f5a673779abfcf2ea">$decode_utf8</a> = <span class="keyword">true</span>;
<a name="l06570"></a>06570 
<a name="l06580"></a><a class="code" href="classnusoap__parser.html#a4acf97ea62060e271ec616af03242d56">06580</a>         function <a class="code" href="classnusoap__parser.html#a4acf97ea62060e271ec616af03242d56">nusoap_parser</a>(<a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a>,$encoding=<span class="stringliteral">&#39;UTF-8&#39;</span>,<a class="code" href="classnusoap__parser.html#aeec9dd0b8cf29f235a9783e00ea38d44">$method</a>=<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="classnusoap__parser.html#aaeea14215dd37a3f5a673779abfcf2ea">$decode_utf8</a>=<span class="keyword">true</span>){
<a name="l06581"></a>06581                 <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">parent::nusoap_base</a>();
<a name="l06582"></a>06582                 $this-&gt;xml = <a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a>;
<a name="l06583"></a>06583                 $this-&gt;xml_encoding = $encoding;
<a name="l06584"></a>06584                 $this-&gt;method = <a class="code" href="classnusoap__parser.html#aeec9dd0b8cf29f235a9783e00ea38d44">$method</a>;
<a name="l06585"></a>06585                 $this-&gt;decode_utf8 = <a class="code" href="classnusoap__parser.html#aaeea14215dd37a3f5a673779abfcf2ea">$decode_utf8</a>;
<a name="l06586"></a>06586 
<a name="l06587"></a>06587                 <span class="comment">// Check whether content has been read.</span>
<a name="l06588"></a>06588                 <span class="keywordflow">if</span>(!empty(<a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a>)){
<a name="l06589"></a>06589                         <span class="comment">// Check XML encoding</span>
<a name="l06590"></a>06590                         $pos_xml = strpos(<a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a>, <span class="stringliteral">&#39;&lt;?xml&#39;</span>);
<a name="l06591"></a>06591                         <span class="keywordflow">if</span> ($pos_xml !== FALSE) {
<a name="l06592"></a>06592                                 $xml_decl = substr(<a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a>, $pos_xml, strpos(<a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a>, <span class="stringliteral">&#39;?&gt;&#39;</span>, $pos_xml + 2) - $pos_xml + 1);
<a name="l06593"></a>06593                                 <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;/encoding=[\&quot;&#39;]([^\&quot;&#39;]*)[\&quot;&#39;]/&quot;</span>, $xml_decl, $res)) {
<a name="l06594"></a>06594                                         <a class="code" href="classnusoap__parser.html#a4bff1d77860985cd4687104afe912b35">$xml_encoding</a> = $res[1];
<a name="l06595"></a>06595                                         <span class="keywordflow">if</span> (strtoupper(<a class="code" href="classnusoap__parser.html#a4bff1d77860985cd4687104afe912b35">$xml_encoding</a>) != $encoding) {
<a name="l06596"></a>06596                                                 <a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a> = <span class="stringliteral">&quot;Charset from HTTP Content-Type &#39;&quot;</span> . $encoding . <span class="stringliteral">&quot;&#39; does not match encoding from XML declaration &#39;&quot;</span> . <a class="code" href="classnusoap__parser.html#a4bff1d77860985cd4687104afe912b35">$xml_encoding</a> . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l06597"></a>06597                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a>);
<a name="l06598"></a>06598                                                 <span class="keywordflow">if</span> ($encoding != <span class="stringliteral">&#39;ISO-8859-1&#39;</span> || strtoupper(<a class="code" href="classnusoap__parser.html#a4bff1d77860985cd4687104afe912b35">$xml_encoding</a>) != <span class="stringliteral">&#39;UTF-8&#39;</span>) {
<a name="l06599"></a>06599                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a>);
<a name="l06600"></a>06600                                                         <span class="keywordflow">return</span>;
<a name="l06601"></a>06601                                                 }
<a name="l06602"></a>06602                                                 <span class="comment">// when HTTP says ISO-8859-1 (the default) and XML says UTF-8 (the typical), assume the other endpoint is just sloppy and proceed</span>
<a name="l06603"></a>06603                                         } <span class="keywordflow">else</span> {
<a name="l06604"></a>06604                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Charset from HTTP Content-Type matches encoding from XML declaration&#39;</span>);
<a name="l06605"></a>06605                                         }
<a name="l06606"></a>06606                                 } <span class="keywordflow">else</span> {
<a name="l06607"></a>06607                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;No encoding specified in XML declaration&#39;</span>);
<a name="l06608"></a>06608                                 }
<a name="l06609"></a>06609                         } <span class="keywordflow">else</span> {
<a name="l06610"></a>06610                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;No XML declaration&#39;</span>);
<a name="l06611"></a>06611                         }
<a name="l06612"></a>06612                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Entering nusoap_parser(), length=&#39;</span>.strlen(<a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a>).<span class="stringliteral">&#39;, encoding=&#39;</span>.$encoding);
<a name="l06613"></a>06613                         <span class="comment">// Create an XML parser - why not xml_parser_create_ns?</span>
<a name="l06614"></a>06614                         $this-&gt;parser = xml_parser_create($this-&gt;xml_encoding);
<a name="l06615"></a>06615                         <span class="comment">// Set the options for parsing the XML data.</span>
<a name="l06616"></a>06616                         <span class="comment">//xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);</span>
<a name="l06617"></a>06617                         xml_parser_set_option($this-&gt;parser, XML_OPTION_CASE_FOLDING, 0);
<a name="l06618"></a>06618                         xml_parser_set_option($this-&gt;parser, XML_OPTION_TARGET_ENCODING, $this-&gt;xml_encoding);
<a name="l06619"></a>06619                         <span class="comment">// Set the object for the parser.</span>
<a name="l06620"></a>06620                         xml_set_object($this-&gt;parser, $this);
<a name="l06621"></a>06621                         <span class="comment">// Set the element handlers for the parser.</span>
<a name="l06622"></a>06622                         xml_set_element_handler($this-&gt;parser, <span class="stringliteral">&#39;start_element&#39;</span>,<span class="stringliteral">&#39;end_element&#39;</span>);
<a name="l06623"></a>06623                         xml_set_character_data_handler($this-&gt;parser,<span class="stringliteral">&#39;character_data&#39;</span>);
<a name="l06624"></a>06624 
<a name="l06625"></a>06625                         <span class="comment">// Parse the XML file.</span>
<a name="l06626"></a>06626                         <span class="keywordflow">if</span>(!xml_parse($this-&gt;parser,<a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a>,<span class="keyword">true</span>)){
<a name="l06627"></a>06627                             <span class="comment">// Display an error message.</span>
<a name="l06628"></a>06628                             <a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a> = sprintf(<span class="stringliteral">&#39;XML error parsing SOAP payload on line %d: %s&#39;</span>,
<a name="l06629"></a>06629                             xml_get_current_line_number($this-&gt;parser),
<a name="l06630"></a>06630                             xml_error_string(xml_get_error_code($this-&gt;parser)));
<a name="l06631"></a>06631                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a>);
<a name="l06632"></a>06632                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;XML payload:\n&quot;</span> . <a class="code" href="classnusoap__parser.html#a1f0212e44a339031d7db0b459b939c8e">$xml</a>);
<a name="l06633"></a>06633                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a>);
<a name="l06634"></a>06634                         } <span class="keywordflow">else</span> {
<a name="l06635"></a>06635                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in nusoap_parser ctor, message:&#39;</span>);
<a name="l06636"></a>06636                                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;message));
<a name="l06637"></a>06637                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;parsed successfully, found root struct: &#39;</span>.$this-&gt;root_struct.<span class="stringliteral">&#39; of name &#39;</span>.$this-&gt;root_struct_name);
<a name="l06638"></a>06638                                 <span class="comment">// get final value</span>
<a name="l06639"></a>06639                                 $this-&gt;soapresponse = $this-&gt;message[$this-&gt;root_struct][<span class="stringliteral">&#39;result&#39;</span>];
<a name="l06640"></a>06640                                 <span class="comment">// get header value</span>
<a name="l06641"></a>06641                                 <span class="keywordflow">if</span>($this-&gt;root_header != <span class="stringliteral">&#39;&#39;</span> &amp;&amp; isset($this-&gt;message[$this-&gt;root_header][<span class="stringliteral">&#39;result&#39;</span>])){
<a name="l06642"></a>06642                                         $this-&gt;soapheader = $this-&gt;message[$this-&gt;root_header][<span class="stringliteral">&#39;result&#39;</span>];
<a name="l06643"></a>06643                                 }
<a name="l06644"></a>06644                                 <span class="comment">// resolve hrefs/ids</span>
<a name="l06645"></a>06645                                 <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($this-&gt;multirefs) &gt; 0){
<a name="l06646"></a>06646                                         <span class="keywordflow">foreach</span>($this-&gt;multirefs as $id =&gt; $hrefs){
<a name="l06647"></a>06647                                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;resolving multirefs for id: &#39;</span>.$id);
<a name="l06648"></a>06648                                                 $idVal = $this-&gt;<a class="code" href="classnusoap__parser.html#ae8c8c826b69331b9842652203073cc91">buildVal</a>($this-&gt;ids[$id]);
<a name="l06649"></a>06649                                                 <span class="keywordflow">if</span> (is_array($idVal) &amp;&amp; isset($idVal[<span class="stringliteral">&#39;!id&#39;</span>])) {
<a name="l06650"></a>06650                                                         unset($idVal[<span class="stringliteral">&#39;!id&#39;</span>]);
<a name="l06651"></a>06651                                                 }
<a name="l06652"></a>06652                                                 <span class="keywordflow">foreach</span>($hrefs as $refPos =&gt; $ref){
<a name="l06653"></a>06653                                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;resolving href at pos &#39;</span>.$refPos);
<a name="l06654"></a>06654                                                         $this-&gt;multirefs[$id][$refPos] = $idVal;
<a name="l06655"></a>06655                                                 }
<a name="l06656"></a>06656                                         }
<a name="l06657"></a>06657                                 }
<a name="l06658"></a>06658                         }
<a name="l06659"></a>06659                         xml_parser_free($this-&gt;parser);
<a name="l06660"></a>06660                 } <span class="keywordflow">else</span> {
<a name="l06661"></a>06661                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;xml was empty, didn\&#39;t parse!&#39;</span>);
<a name="l06662"></a>06662                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;xml was empty, didn\&#39;t parse!&#39;</span>);
<a name="l06663"></a>06663                 }
<a name="l06664"></a>06664         }
<a name="l06665"></a>06665 
<a name="l06674"></a><a class="code" href="classnusoap__parser.html#a9ecd514386d5d88171d4df23f949c57e">06674</a>         function <a class="code" href="classnusoap__parser.html#a9ecd514386d5d88171d4df23f949c57e">start_element</a>($parser, $name, $attrs) {
<a name="l06675"></a>06675                 <span class="comment">// position in a total number of elements, starting from 0</span>
<a name="l06676"></a>06676                 <span class="comment">// update class level pos</span>
<a name="l06677"></a>06677                 $pos = $this-&gt;position++;
<a name="l06678"></a>06678                 <span class="comment">// and set mine</span>
<a name="l06679"></a>06679                 $this-&gt;message[$pos] = array(<span class="stringliteral">&#39;pos&#39;</span> =&gt; $pos,<span class="stringliteral">&#39;children&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;cdata&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>);
<a name="l06680"></a>06680                 <span class="comment">// depth = how many levels removed from root?</span>
<a name="l06681"></a>06681                 <span class="comment">// set mine as current global depth and increment global depth value</span>
<a name="l06682"></a>06682                 $this-&gt;message[$pos][<span class="stringliteral">&#39;depth&#39;</span>] = $this-&gt;depth++;
<a name="l06683"></a>06683 
<a name="l06684"></a>06684                 <span class="comment">// else add self as child to whoever the current parent is</span>
<a name="l06685"></a>06685                 <span class="keywordflow">if</span>($pos != 0){
<a name="l06686"></a>06686                         $this-&gt;message[$this-&gt;parent][<span class="stringliteral">&#39;children&#39;</span>] .= <span class="charliteral">&#39;|&#39;</span>.$pos;
<a name="l06687"></a>06687                 }
<a name="l06688"></a>06688                 <span class="comment">// set my parent</span>
<a name="l06689"></a>06689                 $this-&gt;message[$pos][<span class="stringliteral">&#39;parent&#39;</span>] = $this-&gt;parent;
<a name="l06690"></a>06690                 <span class="comment">// set self as current parent</span>
<a name="l06691"></a>06691                 $this-&gt;parent = $pos;
<a name="l06692"></a>06692                 <span class="comment">// set self as current value for this depth</span>
<a name="l06693"></a>06693                 $this-&gt;depth_array[$this-&gt;depth] = $pos;
<a name="l06694"></a>06694                 <span class="comment">// get element prefix</span>
<a name="l06695"></a>06695                 <span class="keywordflow">if</span>(strpos($name,<span class="charliteral">&#39;:&#39;</span>)){
<a name="l06696"></a>06696                         <span class="comment">// get ns prefix</span>
<a name="l06697"></a>06697                         $prefix = substr($name,0,strpos($name,<span class="charliteral">&#39;:&#39;</span>));
<a name="l06698"></a>06698                         <span class="comment">// get unqualified name</span>
<a name="l06699"></a>06699                         $name = substr(strstr($name,<span class="charliteral">&#39;:&#39;</span>),1);
<a name="l06700"></a>06700                 }
<a name="l06701"></a>06701                 <span class="comment">// set status</span>
<a name="l06702"></a>06702                 <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;Envelope&#39;</span> &amp;&amp; $this-&gt;status == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l06703"></a>06703                         $this-&gt;status = <span class="stringliteral">&#39;envelope&#39;</span>;
<a name="l06704"></a>06704                 } elseif ($name == <span class="stringliteral">&#39;Header&#39;</span> &amp;&amp; $this-&gt;status == <span class="stringliteral">&#39;envelope&#39;</span>) {
<a name="l06705"></a>06705                         $this-&gt;root_header = $pos;
<a name="l06706"></a>06706                         $this-&gt;status = <span class="stringliteral">&#39;header&#39;</span>;
<a name="l06707"></a>06707                 } elseif ($name == <span class="stringliteral">&#39;Body&#39;</span> &amp;&amp; $this-&gt;status == <span class="stringliteral">&#39;envelope&#39;</span>){
<a name="l06708"></a>06708                         $this-&gt;status = <span class="stringliteral">&#39;body&#39;</span>;
<a name="l06709"></a>06709                         $this-&gt;body_position = $pos;
<a name="l06710"></a>06710                 <span class="comment">// set method</span>
<a name="l06711"></a>06711                 } elseif($this-&gt;status == <span class="stringliteral">&#39;body&#39;</span> &amp;&amp; $pos == ($this-&gt;body_position+1)) {
<a name="l06712"></a>06712                         $this-&gt;status = <span class="stringliteral">&#39;method&#39;</span>;
<a name="l06713"></a>06713                         $this-&gt;root_struct_name = $name;
<a name="l06714"></a>06714                         $this-&gt;root_struct = $pos;
<a name="l06715"></a>06715                         $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;struct&#39;</span>;
<a name="l06716"></a>06716                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;found root struct $this-&gt;root_struct_name, pos $this-&gt;root_struct&quot;</span>);
<a name="l06717"></a>06717                 }
<a name="l06718"></a>06718                 <span class="comment">// set my status</span>
<a name="l06719"></a>06719                 $this-&gt;message[$pos][<span class="stringliteral">&#39;status&#39;</span>] = $this-&gt;status;
<a name="l06720"></a>06720                 <span class="comment">// set name</span>
<a name="l06721"></a>06721                 $this-&gt;message[$pos][<span class="stringliteral">&#39;name&#39;</span>] = htmlspecialchars($name);
<a name="l06722"></a>06722                 <span class="comment">// set attrs</span>
<a name="l06723"></a>06723                 $this-&gt;message[$pos][<span class="stringliteral">&#39;attrs&#39;</span>] = $attrs;
<a name="l06724"></a>06724 
<a name="l06725"></a>06725                 <span class="comment">// loop through atts, logging ns and type declarations</span>
<a name="l06726"></a>06726         $attstr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06727"></a>06727                 <span class="keywordflow">foreach</span>($attrs as $key =&gt; $value){
<a name="l06728"></a>06728                 $key_prefix = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($key);
<a name="l06729"></a>06729                         $key_localpart = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($key);
<a name="l06730"></a>06730                         <span class="comment">// if ns declarations, add to class level array of valid namespaces</span>
<a name="l06731"></a>06731             <span class="keywordflow">if</span>($key_prefix == <span class="stringliteral">&#39;xmlns&#39;</span>){
<a name="l06732"></a>06732                                 <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/^http:\/\/www.w3.org\/[0-9]{4}\/XMLSchema$/&#39;</span>,$value)){
<a name="l06733"></a>06733                                         $this-&gt;XMLSchemaVersion = $value;
<a name="l06734"></a>06734                                         $this-&gt;namespaces[<span class="stringliteral">&#39;xsd&#39;</span>] = $this-&gt;XMLSchemaVersion;
<a name="l06735"></a>06735                                         $this-&gt;namespaces[<span class="stringliteral">&#39;xsi&#39;</span>] = $this-&gt;XMLSchemaVersion.<span class="stringliteral">&#39;-instance&#39;</span>;
<a name="l06736"></a>06736                                 }
<a name="l06737"></a>06737                 $this-&gt;namespaces[$key_localpart] = $value;
<a name="l06738"></a>06738                                 <span class="comment">// set method namespace</span>
<a name="l06739"></a>06739                                 <span class="keywordflow">if</span>($name == $this-&gt;root_struct_name){
<a name="l06740"></a>06740                                         $this-&gt;methodNamespace = $value;
<a name="l06741"></a>06741                                 }
<a name="l06742"></a>06742                         <span class="comment">// if it&#39;s a type declaration, set type</span>
<a name="l06743"></a>06743         } elseif($key_localpart == <span class="stringliteral">&#39;type&#39;</span>){
<a name="l06744"></a>06744                         <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;array&#39;</span>) {
<a name="l06745"></a>06745                                 <span class="comment">// do nothing: already processed arrayType</span>
<a name="l06746"></a>06746                         } <span class="keywordflow">else</span> {
<a name="l06747"></a>06747                         $value_prefix = $this-&gt;<a class="code" href="classnusoap__base.html#a03702b78e998ebfcd3522f5c2966e135">getPrefix</a>($value);
<a name="l06748"></a>06748                         $value_localpart = $this-&gt;<a class="code" href="classnusoap__base.html#ac9572b3c91c4c4830a678e8ac6d65495">getLocalPart</a>($value);
<a name="l06749"></a>06749                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>] = $value_localpart;
<a name="l06750"></a>06750                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;typePrefix&#39;</span>] = $value_prefix;
<a name="l06751"></a>06751                         <span class="keywordflow">if</span>(isset($this-&gt;namespaces[$value_prefix])){
<a name="l06752"></a>06752                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>] = $this-&gt;namespaces[$value_prefix];
<a name="l06753"></a>06753                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($attrs[<span class="stringliteral">&#39;xmlns:&#39;</span>.$value_prefix])) {
<a name="l06754"></a>06754                                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>] = $attrs[<span class="stringliteral">&#39;xmlns:&#39;</span>.$value_prefix];
<a name="l06755"></a>06755                         }
<a name="l06756"></a>06756                                         <span class="comment">// should do something here with the namespace of specified type?</span>
<a name="l06757"></a>06757                                 }
<a name="l06758"></a>06758                         } elseif($key_localpart == <span class="stringliteral">&#39;arrayType&#39;</span>){
<a name="l06759"></a>06759                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;array&#39;</span>;
<a name="l06760"></a>06760                                 <span class="comment">/* do arrayType ereg here</span>
<a name="l06761"></a>06761 <span class="comment">                                [1]    arrayTypeValue    ::=    atype asize</span>
<a name="l06762"></a>06762 <span class="comment">                                [2]    atype    ::=    QName rank*</span>
<a name="l06763"></a>06763 <span class="comment">                                [3]    rank    ::=    &#39;[&#39; (&#39;,&#39;)* &#39;]&#39;</span>
<a name="l06764"></a>06764 <span class="comment">                                [4]    asize    ::=    &#39;[&#39; length~ &#39;]&#39;</span>
<a name="l06765"></a>06765 <span class="comment">                                [5]    length    ::=    nextDimension* Digit+</span>
<a name="l06766"></a>06766 <span class="comment">                                [6]    nextDimension    ::=    Digit+ &#39;,&#39;</span>
<a name="l06767"></a>06767 <span class="comment">                                */</span>
<a name="l06768"></a>06768                                 $expr = <span class="stringliteral">&#39;/([A-Za-z0-9_]+):([A-Za-z]+[A-Za-z0-9_]+)\[([0-9]+),?([0-9]*)\]/&#39;</span>;
<a name="l06769"></a>06769                                 <span class="keywordflow">if</span>(preg_match($expr,$value,$regs)){
<a name="l06770"></a>06770                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;typePrefix&#39;</span>] = $regs[1];
<a name="l06771"></a>06771                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;arrayTypePrefix&#39;</span>] = $regs[1];
<a name="l06772"></a>06772                         <span class="keywordflow">if</span> (isset($this-&gt;namespaces[$regs[1]])) {
<a name="l06773"></a>06773                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>] = $this-&gt;namespaces[$regs[1]];
<a name="l06774"></a>06774                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($attrs[<span class="stringliteral">&#39;xmlns:&#39;</span>.$regs[1]])) {
<a name="l06775"></a>06775                                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>] = $attrs[<span class="stringliteral">&#39;xmlns:&#39;</span>.$regs[1]];
<a name="l06776"></a>06776                         }
<a name="l06777"></a>06777                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;arrayType&#39;</span>] = $regs[2];
<a name="l06778"></a>06778                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;arraySize&#39;</span>] = $regs[3];
<a name="l06779"></a>06779                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;arrayCols&#39;</span>] = $regs[4];
<a name="l06780"></a>06780                                 }
<a name="l06781"></a>06781                         <span class="comment">// specifies nil value (or not)</span>
<a name="l06782"></a>06782                         } elseif ($key_localpart == <span class="stringliteral">&#39;nil&#39;</span>){
<a name="l06783"></a>06783                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;nil&#39;</span>] = ($value == <span class="stringliteral">&#39;true&#39;</span> || $value == <span class="charliteral">&#39;1&#39;</span>);
<a name="l06784"></a>06784                         <span class="comment">// some other attribute</span>
<a name="l06785"></a>06785                         } elseif ($key != <span class="stringliteral">&#39;href&#39;</span> &amp;&amp; $key != <span class="stringliteral">&#39;xmlns&#39;</span> &amp;&amp; $key_localpart != <span class="stringliteral">&#39;encodingStyle&#39;</span> &amp;&amp; $key_localpart != <span class="stringliteral">&#39;root&#39;</span>) {
<a name="l06786"></a>06786                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>][<span class="charliteral">&#39;!&#39;</span> . $key] = $value;
<a name="l06787"></a>06787                         }
<a name="l06788"></a>06788 
<a name="l06789"></a>06789                         <span class="keywordflow">if</span> ($key == <span class="stringliteral">&#39;xmlns&#39;</span>) {
<a name="l06790"></a>06790                                 $this-&gt;default_namespace = $value;
<a name="l06791"></a>06791                         }
<a name="l06792"></a>06792                         <span class="comment">// log id</span>
<a name="l06793"></a>06793                         <span class="keywordflow">if</span>($key == <span class="stringliteral">&#39;id&#39;</span>){
<a name="l06794"></a>06794                                 $this-&gt;ids[$value] = $pos;
<a name="l06795"></a>06795                         }
<a name="l06796"></a>06796                         <span class="comment">// root</span>
<a name="l06797"></a>06797                         <span class="keywordflow">if</span>($key_localpart == <span class="stringliteral">&#39;root&#39;</span> &amp;&amp; $value == 1){
<a name="l06798"></a>06798                                 $this-&gt;status = <span class="stringliteral">&#39;method&#39;</span>;
<a name="l06799"></a>06799                                 $this-&gt;root_struct_name = $name;
<a name="l06800"></a>06800                                 $this-&gt;root_struct = $pos;
<a name="l06801"></a>06801                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;found root struct $this-&gt;root_struct_name, pos $pos&quot;</span>);
<a name="l06802"></a>06802                         }
<a name="l06803"></a>06803             <span class="comment">// for doclit</span>
<a name="l06804"></a>06804             $attstr .= <span class="stringliteral">&quot; $key=\&quot;$value\&quot;&quot;</span>;
<a name="l06805"></a>06805                 }
<a name="l06806"></a>06806         <span class="comment">// get namespace - must be done after namespace atts are processed</span>
<a name="l06807"></a>06807                 <span class="keywordflow">if</span>(isset($prefix)){
<a name="l06808"></a>06808                         $this-&gt;message[$pos][<span class="stringliteral">&#39;namespace&#39;</span>] = $this-&gt;namespaces[$prefix];
<a name="l06809"></a>06809                         $this-&gt;default_namespace = $this-&gt;namespaces[$prefix];
<a name="l06810"></a>06810                 } <span class="keywordflow">else</span> {
<a name="l06811"></a>06811                         $this-&gt;message[$pos][<span class="stringliteral">&#39;namespace&#39;</span>] = $this-&gt;default_namespace;
<a name="l06812"></a>06812                 }
<a name="l06813"></a>06813         <span class="keywordflow">if</span>($this-&gt;status == <span class="stringliteral">&#39;header&#39;</span>){
<a name="l06814"></a>06814                 <span class="keywordflow">if</span> ($this-&gt;root_header != $pos) {
<a name="l06815"></a>06815                         $this-&gt;responseHeaders .= <span class="stringliteral">&quot;&lt;&quot;</span> . (isset($prefix) ? $prefix . <span class="charliteral">&#39;:&#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . <span class="stringliteral">&quot;$name$attstr&gt;&quot;</span>;
<a name="l06816"></a>06816                 }
<a name="l06817"></a>06817         } elseif($this-&gt;root_struct_name != <span class="stringliteral">&#39;&#39;</span>){
<a name="l06818"></a>06818                 $this-&gt;document .= <span class="stringliteral">&quot;&lt;&quot;</span> . (isset($prefix) ? $prefix . <span class="charliteral">&#39;:&#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . <span class="stringliteral">&quot;$name$attstr&gt;&quot;</span>;
<a name="l06819"></a>06819         }
<a name="l06820"></a>06820         }
<a name="l06821"></a>06821 
<a name="l06829"></a><a class="code" href="classnusoap__parser.html#a3f12f9adb477d7b2b5672d02e5f36675">06829</a>         function <a class="code" href="classnusoap__parser.html#a3f12f9adb477d7b2b5672d02e5f36675">end_element</a>($parser, $name) {
<a name="l06830"></a>06830                 <span class="comment">// position of current element is equal to the last value left in depth_array for my depth</span>
<a name="l06831"></a>06831                 $pos = $this-&gt;depth_array[$this-&gt;depth--];
<a name="l06832"></a>06832 
<a name="l06833"></a>06833         <span class="comment">// get element prefix</span>
<a name="l06834"></a>06834                 <span class="keywordflow">if</span>(strpos($name,<span class="charliteral">&#39;:&#39;</span>)){
<a name="l06835"></a>06835                         <span class="comment">// get ns prefix</span>
<a name="l06836"></a>06836                         $prefix = substr($name,0,strpos($name,<span class="charliteral">&#39;:&#39;</span>));
<a name="l06837"></a>06837                         <span class="comment">// get unqualified name</span>
<a name="l06838"></a>06838                         $name = substr(strstr($name,<span class="charliteral">&#39;:&#39;</span>),1);
<a name="l06839"></a>06839                 }
<a name="l06840"></a>06840                 
<a name="l06841"></a>06841                 <span class="comment">// build to native type</span>
<a name="l06842"></a>06842                 <span class="keywordflow">if</span>(isset($this-&gt;body_position) &amp;&amp; $pos &gt; $this-&gt;body_position){
<a name="l06843"></a>06843                         <span class="comment">// deal w/ multirefs</span>
<a name="l06844"></a>06844                         <span class="keywordflow">if</span>(isset($this-&gt;message[$pos][<span class="stringliteral">&#39;attrs&#39;</span>][<span class="stringliteral">&#39;href&#39;</span>])){
<a name="l06845"></a>06845                                 <span class="comment">// get id</span>
<a name="l06846"></a>06846                                 $id = substr($this-&gt;message[$pos][<span class="stringliteral">&#39;attrs&#39;</span>][<span class="stringliteral">&#39;href&#39;</span>],1);
<a name="l06847"></a>06847                                 <span class="comment">// add placeholder to href array</span>
<a name="l06848"></a>06848                                 $this-&gt;multirefs[$id][$pos] = <span class="stringliteral">&#39;placeholder&#39;</span>;
<a name="l06849"></a>06849                                 <span class="comment">// add set a reference to it as the result value</span>
<a name="l06850"></a>06850                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;result&#39;</span>] =&amp; $this-&gt;multirefs[$id][$pos];
<a name="l06851"></a>06851             <span class="comment">// build complexType values</span>
<a name="l06852"></a>06852                         } elseif($this-&gt;message[$pos][<span class="stringliteral">&#39;children&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>){
<a name="l06853"></a>06853                                 <span class="comment">// if result has already been generated (struct/array)</span>
<a name="l06854"></a>06854                                 <span class="keywordflow">if</span>(!isset($this-&gt;message[$pos][<span class="stringliteral">&#39;result&#39;</span>])){
<a name="l06855"></a>06855                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;result&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__parser.html#ae8c8c826b69331b9842652203073cc91">buildVal</a>($pos);
<a name="l06856"></a>06856                                 }
<a name="l06857"></a>06857                         <span class="comment">// build complexType values of attributes and possibly simpleContent</span>
<a name="l06858"></a>06858                         } elseif (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>])) {
<a name="l06859"></a>06859                                 <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;nil&#39;</span>]) &amp;&amp; $this-&gt;message[$pos][<span class="stringliteral">&#39;nil&#39;</span>]) {
<a name="l06860"></a>06860                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>][<span class="charliteral">&#39;!&#39;</span>] = null;
<a name="l06861"></a>06861                                 } elseif (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>]) &amp;&amp; trim($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>]) != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l06862"></a>06862                         <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l06863"></a>06863                                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>][<span class="charliteral">&#39;!&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">decodeSimple</a>($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>], $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>], isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>]) ? $this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l06864"></a>06864                                         } <span class="keywordflow">else</span> {
<a name="l06865"></a>06865                                                 <a class="code" href="classnusoap__parser.html#ac48271fa16f9be370c5de165a82b5d7b">$parent</a> = $this-&gt;message[$pos][<span class="stringliteral">&#39;parent&#39;</span>];
<a name="l06866"></a>06866                                                 <span class="keywordflow">if</span> (isset($this-&gt;message[<a class="code" href="classnusoap__parser.html#ac48271fa16f9be370c5de165a82b5d7b">$parent</a>][<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; ($this-&gt;message[$parent][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;array&#39;</span>) &amp;&amp; isset($this-&gt;message[$parent][<span class="stringliteral">&#39;arrayType&#39;</span>])) {
<a name="l06867"></a>06867                                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>][<span class="charliteral">&#39;!&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">decodeSimple</a>($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>], $this-&gt;message[$parent][<span class="stringliteral">&#39;arrayType&#39;</span>], isset($this-&gt;message[$parent][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>]) ? $this-&gt;message[$parent][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l06868"></a>06868                                                 } <span class="keywordflow">else</span> {
<a name="l06869"></a>06869                                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>][<span class="charliteral">&#39;!&#39;</span>] = $this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>];
<a name="l06870"></a>06870                                                 }
<a name="l06871"></a>06871                                         }
<a name="l06872"></a>06872                                 }
<a name="l06873"></a>06873                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;result&#39;</span>] = $this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>];
<a name="l06874"></a>06874                         <span class="comment">// set value of simpleType (or nil complexType)</span>
<a name="l06875"></a>06875                         } <span class="keywordflow">else</span> {
<a name="l06876"></a>06876                 <span class="comment">//$this-&gt;debug(&#39;adding data for scalar value &#39;.$this-&gt;message[$pos][&#39;name&#39;].&#39; of value &#39;.$this-&gt;message[$pos][&#39;cdata&#39;]);</span>
<a name="l06877"></a>06877                                 <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;nil&#39;</span>]) &amp;&amp; $this-&gt;message[$pos][<span class="stringliteral">&#39;nil&#39;</span>]) {
<a name="l06878"></a>06878                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>][<span class="charliteral">&#39;!&#39;</span>] = null;
<a name="l06879"></a>06879                                 } elseif (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l06880"></a>06880                                         $this-&gt;message[$pos][<span class="stringliteral">&#39;result&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">decodeSimple</a>($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>], $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>], isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>]) ? $this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l06881"></a>06881                                 } <span class="keywordflow">else</span> {
<a name="l06882"></a>06882                                         <a class="code" href="classnusoap__parser.html#ac48271fa16f9be370c5de165a82b5d7b">$parent</a> = $this-&gt;message[$pos][<span class="stringliteral">&#39;parent&#39;</span>];
<a name="l06883"></a>06883                                         <span class="keywordflow">if</span> (isset($this-&gt;message[<a class="code" href="classnusoap__parser.html#ac48271fa16f9be370c5de165a82b5d7b">$parent</a>][<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; ($this-&gt;message[$parent][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;array&#39;</span>) &amp;&amp; isset($this-&gt;message[$parent][<span class="stringliteral">&#39;arrayType&#39;</span>])) {
<a name="l06884"></a>06884                                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;result&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">decodeSimple</a>($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>], $this-&gt;message[$parent][<span class="stringliteral">&#39;arrayType&#39;</span>], isset($this-&gt;message[$parent][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>]) ? $this-&gt;message[$parent][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l06885"></a>06885                                         } <span class="keywordflow">else</span> {
<a name="l06886"></a>06886                                                 $this-&gt;message[$pos][<span class="stringliteral">&#39;result&#39;</span>] = $this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>];
<a name="l06887"></a>06887                                         }
<a name="l06888"></a>06888                                 }
<a name="l06889"></a>06889 
<a name="l06890"></a>06890                                 <span class="comment">/* add value to parent&#39;s result, if parent is struct/array</span>
<a name="l06891"></a>06891 <span class="comment">                                $parent = $this-&gt;message[$pos][&#39;parent&#39;];</span>
<a name="l06892"></a>06892 <span class="comment">                                if($this-&gt;message[$parent][&#39;type&#39;] != &#39;map&#39;){</span>
<a name="l06893"></a>06893 <span class="comment">                                        if(strtolower($this-&gt;message[$parent][&#39;type&#39;]) == &#39;array&#39;){</span>
<a name="l06894"></a>06894 <span class="comment">                                                $this-&gt;message[$parent][&#39;result&#39;][] = $this-&gt;message[$pos][&#39;result&#39;];</span>
<a name="l06895"></a>06895 <span class="comment">                                        } else {</span>
<a name="l06896"></a>06896 <span class="comment">                                                $this-&gt;message[$parent][&#39;result&#39;][$this-&gt;message[$pos][&#39;name&#39;]] = $this-&gt;message[$pos][&#39;result&#39;];</span>
<a name="l06897"></a>06897 <span class="comment">                                        }</span>
<a name="l06898"></a>06898 <span class="comment">                                }</span>
<a name="l06899"></a>06899 <span class="comment">                                */</span>
<a name="l06900"></a>06900                         }
<a name="l06901"></a>06901                 }
<a name="l06902"></a>06902                 
<a name="l06903"></a>06903         <span class="comment">// for doclit</span>
<a name="l06904"></a>06904         <span class="keywordflow">if</span>($this-&gt;status == <span class="stringliteral">&#39;header&#39;</span>){
<a name="l06905"></a>06905                 <span class="keywordflow">if</span> ($this-&gt;root_header != $pos) {
<a name="l06906"></a>06906                         $this-&gt;responseHeaders .= <span class="stringliteral">&quot;&lt;/&quot;</span> . (isset($prefix) ? $prefix . <span class="charliteral">&#39;:&#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . <span class="stringliteral">&quot;$name&gt;&quot;</span>;
<a name="l06907"></a>06907                 }
<a name="l06908"></a>06908         } elseif($pos &gt;= $this-&gt;root_struct){
<a name="l06909"></a>06909                 $this-&gt;document .= <span class="stringliteral">&quot;&lt;/&quot;</span> . (isset($prefix) ? $prefix . <span class="charliteral">&#39;:&#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . <span class="stringliteral">&quot;$name&gt;&quot;</span>;
<a name="l06910"></a>06910         }
<a name="l06911"></a>06911                 <span class="comment">// switch status</span>
<a name="l06912"></a>06912                 <span class="keywordflow">if</span> ($pos == $this-&gt;root_struct){
<a name="l06913"></a>06913                         $this-&gt;status = <span class="stringliteral">&#39;body&#39;</span>;
<a name="l06914"></a>06914                         $this-&gt;root_struct_namespace = $this-&gt;message[$pos][<span class="stringliteral">&#39;namespace&#39;</span>];
<a name="l06915"></a>06915                 } elseif ($pos == $this-&gt;root_header) {
<a name="l06916"></a>06916                         $this-&gt;status = <span class="stringliteral">&#39;envelope&#39;</span>;
<a name="l06917"></a>06917                 } elseif ($name == <span class="stringliteral">&#39;Body&#39;</span> &amp;&amp; $this-&gt;status == <span class="stringliteral">&#39;body&#39;</span>) {
<a name="l06918"></a>06918                         $this-&gt;status = <span class="stringliteral">&#39;envelope&#39;</span>;
<a name="l06919"></a>06919                 } elseif ($name == <span class="stringliteral">&#39;Header&#39;</span> &amp;&amp; $this-&gt;status == <span class="stringliteral">&#39;header&#39;</span>) { <span class="comment">// will never happen</span>
<a name="l06920"></a>06920                         $this-&gt;status = <span class="stringliteral">&#39;envelope&#39;</span>;
<a name="l06921"></a>06921                 } elseif ($name == <span class="stringliteral">&#39;Envelope&#39;</span> &amp;&amp; $this-&gt;status == <span class="stringliteral">&#39;envelope&#39;</span>) {
<a name="l06922"></a>06922                         $this-&gt;status = <span class="stringliteral">&#39;&#39;</span>;
<a name="l06923"></a>06923                 }
<a name="l06924"></a>06924                 <span class="comment">// set parent back to my parent</span>
<a name="l06925"></a>06925                 $this-&gt;parent = $this-&gt;message[$pos][<span class="stringliteral">&#39;parent&#39;</span>];
<a name="l06926"></a>06926         }
<a name="l06927"></a>06927 
<a name="l06935"></a><a class="code" href="classnusoap__parser.html#a0535afdb7a01f1990824dbd9c44fcdb6">06935</a>         function <a class="code" href="classnusoap__parser.html#a0535afdb7a01f1990824dbd9c44fcdb6">character_data</a>($parser, $data){
<a name="l06936"></a>06936                 $pos = $this-&gt;depth_array[$this-&gt;depth];
<a name="l06937"></a>06937                 <span class="keywordflow">if</span> ($this-&gt;xml_encoding==<span class="stringliteral">&#39;UTF-8&#39;</span>){
<a name="l06938"></a>06938                         <span class="comment">// TODO: add an option to disable this for folks who want</span>
<a name="l06939"></a>06939                         <span class="comment">// raw UTF-8 that, e.g., might not map to iso-8859-1</span>
<a name="l06940"></a>06940                         <span class="comment">// TODO: this can also be handled with xml_parser_set_option($this-&gt;parser, XML_OPTION_TARGET_ENCODING, &quot;ISO-8859-1&quot;);</span>
<a name="l06941"></a>06941                         <span class="keywordflow">if</span>($this-&gt;decode_utf8){
<a name="l06942"></a>06942                                 $data = utf8_decode($data);
<a name="l06943"></a>06943                         }
<a name="l06944"></a>06944                 }
<a name="l06945"></a>06945         $this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>] .= $data;
<a name="l06946"></a>06946         <span class="comment">// for doclit</span>
<a name="l06947"></a>06947         <span class="keywordflow">if</span>($this-&gt;status == <span class="stringliteral">&#39;header&#39;</span>){
<a name="l06948"></a>06948                 $this-&gt;responseHeaders .= $data;
<a name="l06949"></a>06949         } <span class="keywordflow">else</span> {
<a name="l06950"></a>06950                 $this-&gt;document .= $data;
<a name="l06951"></a>06951         }
<a name="l06952"></a>06952         }
<a name="l06953"></a>06953 
<a name="l06961"></a><a class="code" href="classnusoap__parser.html#a59939cab691f2d1675248cbffab9ff1f">06961</a>         function <a class="code" href="classnusoap__parser.html#a59939cab691f2d1675248cbffab9ff1f">get_response</a>(){
<a name="l06962"></a>06962                 <span class="keywordflow">return</span> $this-&gt;soapresponse;
<a name="l06963"></a>06963         }
<a name="l06964"></a>06964 
<a name="l06971"></a><a class="code" href="classnusoap__parser.html#a07ee83fcc5873f073eeddf5f8d6cd125">06971</a>         function <a class="code" href="classnusoap__parser.html#a07ee83fcc5873f073eeddf5f8d6cd125">get_soapbody</a>(){
<a name="l06972"></a>06972                 <span class="keywordflow">return</span> $this-&gt;soapresponse;
<a name="l06973"></a>06973         }
<a name="l06974"></a>06974 
<a name="l06981"></a><a class="code" href="classnusoap__parser.html#a892f39a2c91b38a229e9cd2a1b1d5fb2">06981</a>         function <a class="code" href="classnusoap__parser.html#a892f39a2c91b38a229e9cd2a1b1d5fb2">get_soapheader</a>(){
<a name="l06982"></a>06982                 <span class="keywordflow">return</span> $this-&gt;soapheader;
<a name="l06983"></a>06983         }
<a name="l06984"></a>06984 
<a name="l06991"></a><a class="code" href="classnusoap__parser.html#a4c41cf6f051f73a371e9b00a233c320c">06991</a>         function <a class="code" href="classnusoap__parser.html#a4c41cf6f051f73a371e9b00a233c320c">getHeaders</a>(){
<a name="l06992"></a>06992             <span class="keywordflow">return</span> $this-&gt;responseHeaders;
<a name="l06993"></a>06993         }
<a name="l06994"></a>06994 
<a name="l07004"></a><a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">07004</a>         function <a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">decodeSimple</a>($value, $type, $typens) {
<a name="l07005"></a>07005                 <span class="comment">// TODO: use the namespace!</span>
<a name="l07006"></a>07006                 <span class="keywordflow">if</span> ((!isset($type)) || $type == <span class="stringliteral">&#39;string&#39;</span> || $type == <span class="stringliteral">&#39;long&#39;</span> || $type == <span class="stringliteral">&#39;unsignedLong&#39;</span>) {
<a name="l07007"></a>07007                         <span class="keywordflow">return</span> (<span class="keywordtype">string</span>) $value;
<a name="l07008"></a>07008                 }
<a name="l07009"></a>07009                 <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;int&#39;</span> || $type == <span class="stringliteral">&#39;integer&#39;</span> || $type == <span class="stringliteral">&#39;short&#39;</span> || $type == <span class="stringliteral">&#39;byte&#39;</span>) {
<a name="l07010"></a>07010                         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) $value;
<a name="l07011"></a>07011                 }
<a name="l07012"></a>07012                 <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;float&#39;</span> || $type == <span class="stringliteral">&#39;double&#39;</span> || $type == <span class="stringliteral">&#39;decimal&#39;</span>) {
<a name="l07013"></a>07013                         <span class="keywordflow">return</span> (<span class="keywordtype">double</span>) $value;
<a name="l07014"></a>07014                 }
<a name="l07015"></a>07015                 <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;boolean&#39;</span>) {
<a name="l07016"></a>07016                         <span class="keywordflow">if</span> (strtolower($value) == <span class="stringliteral">&#39;false&#39;</span> || strtolower($value) == <span class="charliteral">&#39;f&#39;</span>) {
<a name="l07017"></a>07017                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07018"></a>07018                         }
<a name="l07019"></a>07019                         <span class="keywordflow">return</span> (<span class="keywordtype">boolean</span>) $value;
<a name="l07020"></a>07020                 }
<a name="l07021"></a>07021                 <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;base64&#39;</span> || $type == <span class="stringliteral">&#39;base64Binary&#39;</span>) {
<a name="l07022"></a>07022                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Decode base64 value&#39;</span>);
<a name="l07023"></a>07023                         <span class="keywordflow">return</span> base64_decode($value);
<a name="l07024"></a>07024                 }
<a name="l07025"></a>07025                 <span class="comment">// obscure numeric types</span>
<a name="l07026"></a>07026                 <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;nonPositiveInteger&#39;</span> || $type == <span class="stringliteral">&#39;negativeInteger&#39;</span>
<a name="l07027"></a>07027                         || $type == <span class="stringliteral">&#39;nonNegativeInteger&#39;</span> || $type == <span class="stringliteral">&#39;positiveInteger&#39;</span>
<a name="l07028"></a>07028                         || $type == <span class="stringliteral">&#39;unsignedInt&#39;</span>
<a name="l07029"></a>07029                         || $type == <span class="stringliteral">&#39;unsignedShort&#39;</span> || $type == <span class="stringliteral">&#39;unsignedByte&#39;</span>) {
<a name="l07030"></a>07030                         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) $value;
<a name="l07031"></a>07031                 }
<a name="l07032"></a>07032                 <span class="comment">// bogus: parser treats array with no elements as a simple type</span>
<a name="l07033"></a>07033                 <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;array&#39;</span>) {
<a name="l07034"></a>07034                         <span class="keywordflow">return</span> array();
<a name="l07035"></a>07035                 }
<a name="l07036"></a>07036                 <span class="comment">// everything else</span>
<a name="l07037"></a>07037                 <span class="keywordflow">return</span> (<span class="keywordtype">string</span>) $value;
<a name="l07038"></a>07038         }
<a name="l07039"></a>07039 
<a name="l07048"></a><a class="code" href="classnusoap__parser.html#ae8c8c826b69331b9842652203073cc91">07048</a>         function <a class="code" href="classnusoap__parser.html#ae8c8c826b69331b9842652203073cc91">buildVal</a>($pos){
<a name="l07049"></a>07049                 <span class="keywordflow">if</span>(!isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>])){
<a name="l07050"></a>07050                         $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07051"></a>07051                 }
<a name="l07052"></a>07052                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in buildVal() for &#39;</span>.$this-&gt;message[$pos][<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;(pos $pos) of type &quot;</span>.$this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l07053"></a>07053                 <span class="comment">// if there are children...</span>
<a name="l07054"></a>07054                 <span class="keywordflow">if</span>($this-&gt;message[$pos][<span class="stringliteral">&#39;children&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>){
<a name="l07055"></a>07055                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in buildVal, there are children&#39;</span>);
<a name="l07056"></a>07056                         $children = explode(<span class="charliteral">&#39;|&#39;</span>,$this-&gt;message[$pos][<span class="stringliteral">&#39;children&#39;</span>]);
<a name="l07057"></a>07057                         array_shift($children); <span class="comment">// knock off empty</span>
<a name="l07058"></a>07058                         <span class="comment">// md array</span>
<a name="l07059"></a>07059                         <span class="keywordflow">if</span>(isset($this-&gt;message[$pos][<span class="stringliteral">&#39;arrayCols&#39;</span>]) &amp;&amp; $this-&gt;message[$pos][<span class="stringliteral">&#39;arrayCols&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>){
<a name="l07060"></a>07060                 $r=0; <span class="comment">// rowcount</span>
<a name="l07061"></a>07061                 $c=0; <span class="comment">// colcount</span>
<a name="l07062"></a>07062                 <span class="keywordflow">foreach</span>($children as $child_pos){
<a name="l07063"></a>07063                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in buildVal, got an MD array element: $r, $c&quot;</span>);
<a name="l07064"></a>07064                                         $params[$r][] = $this-&gt;message[$child_pos][<span class="stringliteral">&#39;result&#39;</span>];
<a name="l07065"></a>07065                                     $c++;
<a name="l07066"></a>07066                                     <span class="keywordflow">if</span>($c == $this-&gt;message[$pos][<span class="stringliteral">&#39;arrayCols&#39;</span>]){
<a name="l07067"></a>07067                                         $c = 0;
<a name="l07068"></a>07068                                                 $r++;
<a name="l07069"></a>07069                                     }
<a name="l07070"></a>07070                 }
<a name="l07071"></a>07071             <span class="comment">// array</span>
<a name="l07072"></a>07072                         } elseif($this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;array&#39;</span> || $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;Array&#39;</span>){
<a name="l07073"></a>07073                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in buildVal, adding array &#39;</span>.$this-&gt;message[$pos][<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l07074"></a>07074                 <span class="keywordflow">foreach</span>($children as $child_pos){
<a name="l07075"></a>07075                         $params[] = &amp;$this-&gt;message[$child_pos][<span class="stringliteral">&#39;result&#39;</span>];
<a name="l07076"></a>07076                 }
<a name="l07077"></a>07077             <span class="comment">// apache Map type: java hashtable</span>
<a name="l07078"></a>07078             } elseif($this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;Map&#39;</span> &amp;&amp; $this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>] == <span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>){
<a name="l07079"></a>07079                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in buildVal, Java Map &#39;</span>.$this-&gt;message[$pos][<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l07080"></a>07080                 <span class="keywordflow">foreach</span>($children as $child_pos){
<a name="l07081"></a>07081                         $kv = explode(<span class="stringliteral">&quot;|&quot;</span>,$this-&gt;message[$child_pos][<span class="stringliteral">&#39;children&#39;</span>]);
<a name="l07082"></a>07082                         $params[$this-&gt;message[$kv[1]][<span class="stringliteral">&#39;result&#39;</span>]] = &amp;$this-&gt;message[$kv[2]][<span class="stringliteral">&#39;result&#39;</span>];
<a name="l07083"></a>07083                 }
<a name="l07084"></a>07084             <span class="comment">// generic compound type</span>
<a name="l07085"></a>07085             <span class="comment">//} elseif($this-&gt;message[$pos][&#39;type&#39;] == &#39;SOAPStruct&#39; || $this-&gt;message[$pos][&#39;type&#39;] == &#39;struct&#39;) {</span>
<a name="l07086"></a>07086                     } <span class="keywordflow">else</span> {
<a name="l07087"></a>07087                         <span class="comment">// Apache Vector type: treat as an array</span>
<a name="l07088"></a>07088                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in buildVal, adding Java Vector or generic compound type &#39;</span>.$this-&gt;message[$pos][<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l07089"></a>07089                                 <span class="keywordflow">if</span> ($this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;Vector&#39;</span> &amp;&amp; $this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>] == <span class="stringliteral">&#39;http://xml.apache.org/xml-soap&#39;</span>) {
<a name="l07090"></a>07090                                         $notstruct = 1;
<a name="l07091"></a>07091                                 } <span class="keywordflow">else</span> {
<a name="l07092"></a>07092                                         $notstruct = 0;
<a name="l07093"></a>07093                     }
<a name="l07094"></a>07094                 <span class="comment">//</span>
<a name="l07095"></a>07095                 <span class="keywordflow">foreach</span>($children as $child_pos){
<a name="l07096"></a>07096                         <span class="keywordflow">if</span>($notstruct){
<a name="l07097"></a>07097                                 $params[] = &amp;$this-&gt;message[$child_pos][<span class="stringliteral">&#39;result&#39;</span>];
<a name="l07098"></a>07098                         } <span class="keywordflow">else</span> {
<a name="l07099"></a>07099                                 <span class="keywordflow">if</span> (isset($params[$this-&gt;message[$child_pos][<span class="stringliteral">&#39;name&#39;</span>]])) {
<a name="l07100"></a>07100                                         <span class="comment">// de-serialize repeated element name into an array</span>
<a name="l07101"></a>07101                                         <span class="keywordflow">if</span> ((!is_array($params[$this-&gt;message[$child_pos][<span class="stringliteral">&#39;name&#39;</span>]])) || (!isset($params[$this-&gt;message[$child_pos][<span class="stringliteral">&#39;name&#39;</span>]][0]))) {
<a name="l07102"></a>07102                                                 $params[$this-&gt;message[$child_pos][<span class="stringliteral">&#39;name&#39;</span>]] = array($params[$this-&gt;message[$child_pos][<span class="stringliteral">&#39;name&#39;</span>]]);
<a name="l07103"></a>07103                                         }
<a name="l07104"></a>07104                                         $params[$this-&gt;message[$child_pos][<span class="stringliteral">&#39;name&#39;</span>]][] = &amp;$this-&gt;message[$child_pos][<span class="stringliteral">&#39;result&#39;</span>];
<a name="l07105"></a>07105                                 } <span class="keywordflow">else</span> {
<a name="l07106"></a>07106                                                 $params[$this-&gt;message[$child_pos][<span class="stringliteral">&#39;name&#39;</span>]] = &amp;$this-&gt;message[$child_pos][<span class="stringliteral">&#39;result&#39;</span>];
<a name="l07107"></a>07107                                             }
<a name="l07108"></a>07108                         }
<a name="l07109"></a>07109                 }
<a name="l07110"></a>07110                         }
<a name="l07111"></a>07111                         <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>])) {
<a name="l07112"></a>07112                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in buildVal, handling attributes&#39;</span>);
<a name="l07113"></a>07113                                 <span class="keywordflow">foreach</span> ($this-&gt;message[$pos][<span class="stringliteral">&#39;xattrs&#39;</span>] as $n =&gt; $v) {
<a name="l07114"></a>07114                                         $params[$n] = $v;
<a name="l07115"></a>07115                                 }
<a name="l07116"></a>07116                         }
<a name="l07117"></a>07117                         <span class="comment">// handle simpleContent</span>
<a name="l07118"></a>07118                         <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>]) &amp;&amp; trim($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>]) != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l07119"></a>07119                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in buildVal, handling simpleContent&#39;</span>);
<a name="l07120"></a>07120                 <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l07121"></a>07121                                         $params[<span class="charliteral">&#39;!&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">decodeSimple</a>($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>], $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>], isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>]) ? $this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l07122"></a>07122                                 } <span class="keywordflow">else</span> {
<a name="l07123"></a>07123                                         <a class="code" href="classnusoap__parser.html#ac48271fa16f9be370c5de165a82b5d7b">$parent</a> = $this-&gt;message[$pos][<span class="stringliteral">&#39;parent&#39;</span>];
<a name="l07124"></a>07124                                         <span class="keywordflow">if</span> (isset($this-&gt;message[<a class="code" href="classnusoap__parser.html#ac48271fa16f9be370c5de165a82b5d7b">$parent</a>][<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; ($this-&gt;message[$parent][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;array&#39;</span>) &amp;&amp; isset($this-&gt;message[$parent][<span class="stringliteral">&#39;arrayType&#39;</span>])) {
<a name="l07125"></a>07125                                                 $params[<span class="charliteral">&#39;!&#39;</span>] = $this-&gt;<a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">decodeSimple</a>($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>], $this-&gt;message[$parent][<span class="stringliteral">&#39;arrayType&#39;</span>], isset($this-&gt;message[$parent][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>]) ? $this-&gt;message[$parent][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l07126"></a>07126                                         } <span class="keywordflow">else</span> {
<a name="l07127"></a>07127                                                 $params[<span class="charliteral">&#39;!&#39;</span>] = $this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>];
<a name="l07128"></a>07128                                         }
<a name="l07129"></a>07129                                 }
<a name="l07130"></a>07130                         }
<a name="l07131"></a>07131                         $ret = is_array($params) ? $params : array();
<a name="l07132"></a>07132                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in buildVal, return:&#39;</span>);
<a name="l07133"></a>07133                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($ret));
<a name="l07134"></a>07134                         <span class="keywordflow">return</span> $ret;
<a name="l07135"></a>07135                 } <span class="keywordflow">else</span> {
<a name="l07136"></a>07136                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;in buildVal, no children, building scalar&#39;</span>);
<a name="l07137"></a>07137                         $cdata = isset($this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>]) ? $this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l07138"></a>07138                 <span class="keywordflow">if</span> (isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l07139"></a>07139                                 $ret = $this-&gt;<a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">decodeSimple</a>($cdata, $this-&gt;message[$pos][<span class="stringliteral">&#39;type&#39;</span>], isset($this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>]) ? $this-&gt;message[$pos][<span class="stringliteral">&#39;type_namespace&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l07140"></a>07140                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in buildVal, return: $ret&quot;</span>);
<a name="l07141"></a>07141                                 <span class="keywordflow">return</span> $ret;
<a name="l07142"></a>07142                         }
<a name="l07143"></a>07143                         <a class="code" href="classnusoap__parser.html#ac48271fa16f9be370c5de165a82b5d7b">$parent</a> = $this-&gt;message[$pos][<span class="stringliteral">&#39;parent&#39;</span>];
<a name="l07144"></a>07144                         <span class="keywordflow">if</span> (isset($this-&gt;message[<a class="code" href="classnusoap__parser.html#ac48271fa16f9be370c5de165a82b5d7b">$parent</a>][<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; ($this-&gt;message[$parent][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;array&#39;</span>) &amp;&amp; isset($this-&gt;message[$parent][<span class="stringliteral">&#39;arrayType&#39;</span>])) {
<a name="l07145"></a>07145                                 $ret = $this-&gt;<a class="code" href="classnusoap__parser.html#a891908b630b028a15f20ef7c264d8c83">decodeSimple</a>($cdata, $this-&gt;message[$parent][<span class="stringliteral">&#39;arrayType&#39;</span>], isset($this-&gt;message[$parent][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>]) ? $this-&gt;message[$parent][<span class="stringliteral">&#39;arrayTypeNamespace&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l07146"></a>07146                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in buildVal, return: $ret&quot;</span>);
<a name="l07147"></a>07147                                 <span class="keywordflow">return</span> $ret;
<a name="l07148"></a>07148                         }
<a name="l07149"></a>07149                 $ret = $this-&gt;message[$pos][<span class="stringliteral">&#39;cdata&#39;</span>];
<a name="l07150"></a>07150                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in buildVal, return: $ret&quot;</span>);
<a name="l07151"></a>07151                 <span class="keywordflow">return</span> $ret;
<a name="l07152"></a>07152                 }
<a name="l07153"></a>07153         }
<a name="l07154"></a>07154 }
<a name="l07155"></a>07155 
<a name="l07159"></a>07159 <span class="keyword">class </span><a class="code" href="classsoap__parser.html">soap_parser</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__parser.html">nusoap_parser</a> {
<a name="l07160"></a>07160 }
<a name="l07161"></a>07161 
<a name="l07162"></a>07162 ?&gt;&lt;?php
<a name="l07163"></a>07163 
<a name="l07164"></a>07164 
<a name="l07165"></a>07165 
<a name="l07186"></a>07186 <span class="keyword">class </span><a class="code" href="classnusoap__client.html">nusoap_client</a> <span class="keyword">extends</span> <a class="code" href="classnusoap__base.html">nusoap_base</a>  {
<a name="l07187"></a>07187 
<a name="l07188"></a>07188         var <a class="code" href="classnusoap__client.html#a5a6e502b71a3d980d0d5b4f78a3836b2">$username</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// Username for HTTP authentication</span>
<a name="l07189"></a>07189         var <a class="code" href="classnusoap__client.html#a28db01da63367bdca6f6be2518c12548">$password</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// Password for HTTP authentication</span>
<a name="l07190"></a>07190         var <a class="code" href="classnusoap__client.html#a53330860c9fb44f860900eea3db67770">$authtype</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// Type of HTTP authentication</span>
<a name="l07191"></a>07191         var <a class="code" href="classnusoap__client.html#af9f9e6aca1a464fae03b4bcfe6be85d1">$certRequest</a> = array();             <span class="comment">// Certificate for HTTP SSL authentication</span>
<a name="l07192"></a>07192         var <a class="code" href="classnusoap__client.html#ad320cab74dd4ce0f0464c4d956b5aa57">$requestHeaders</a> = <span class="keyword">false</span>;    <span class="comment">// SOAP headers in request (text)</span>
<a name="l07193"></a>07193         var <a class="code" href="classnusoap__client.html#a7fee8ad0f5d6ce94517476ec88633a96">$responseHeaders</a> = <span class="stringliteral">&#39;&#39;</span>;              <span class="comment">// SOAP headers from response (incomplete namespace resolution) (text)</span>
<a name="l07194"></a>07194         var <a class="code" href="classnusoap__client.html#ae1fff303aa9712aed09e1c7c47a1acb3">$responseHeader</a> = NULL;             <span class="comment">// SOAP Header from response (parsed)</span>
<a name="l07195"></a>07195         var <a class="code" href="classnusoap__client.html#a3573f7decf2dad4d382c8eadede55feb">$document</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// SOAP body response portion (incomplete namespace resolution) (text)</span>
<a name="l07196"></a>07196         var <a class="code" href="classnusoap__client.html#abc466379a93a1d6e6a612d901863c3b5">$endpoint</a>;
<a name="l07197"></a>07197         var <a class="code" href="classnusoap__client.html#a162a547fc8450f869106630e5c36d4b0">$forceEndpoint</a> = <span class="stringliteral">&#39;&#39;</span>;                <span class="comment">// overrides WSDL endpoint</span>
<a name="l07198"></a>07198     var <a class="code" href="classnusoap__client.html#aa338793644c3c11e9f26b037183edcb4">$proxyhost</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07199"></a>07199     var <a class="code" href="classnusoap__client.html#a0ec7742ef4e60957bb2434e4ae1687b9">$proxyport</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07200"></a>07200         var <a class="code" href="classnusoap__client.html#a7cd6d5a82fb6497a40aab27e1912cfea">$proxyusername</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07201"></a>07201         var <a class="code" href="classnusoap__client.html#abba1ff96c63993ea3e2cc3ce50679d30">$proxypassword</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07202"></a>07202         var <a class="code" href="classnusoap__client.html#a7ec0d9a68da32080cead7a60731d8e4c">$portName</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// port name to use in WSDL</span>
<a name="l07203"></a>07203     var <a class="code" href="classnusoap__client.html#acf04b75f2d49f60a1ac82874716f9679">$xml_encoding</a> = <span class="stringliteral">&#39;&#39;</span>;                     <span class="comment">// character set encoding of incoming (response) messages</span>
<a name="l07204"></a>07204         var <a class="code" href="classnusoap__client.html#a54703a12701fae9afb140eabe3d1e4db">$http_encoding</a> = <span class="keyword">false</span>;
<a name="l07205"></a>07205         var <a class="code" href="classnusoap__client.html#aba5ca2d7e6c45a4773cddec256c9a192">$timeout</a> = 0;                               <span class="comment">// HTTP connection timeout</span>
<a name="l07206"></a>07206         var <a class="code" href="classnusoap__client.html#a41b0366193fea3a46ac06dd3d794429f">$response_timeout</a> = 30;             <span class="comment">// HTTP response timeout</span>
<a name="l07207"></a>07207         var <a class="code" href="classnusoap__client.html#ae3547ad69cc1ff7bde5c5ef5de87227a">$endpointType</a> = <span class="stringliteral">&#39;&#39;</span>;                 <span class="comment">// soap|wsdl, empty for WSDL initialization error</span>
<a name="l07208"></a>07208         var <a class="code" href="classnusoap__client.html#aa593f779ab668b831a03cf94ceba32ab">$persistentConnection</a> = <span class="keyword">false</span>;
<a name="l07209"></a>07209         var <a class="code" href="classnusoap__client.html#a1e0f4fe64cbcf6b2a3d006c369f92d94">$defaultRpcParams</a> = <span class="keyword">false</span>;  <span class="comment">// This is no longer used</span>
<a name="l07210"></a>07210         var <a class="code" href="classnusoap__client.html#ab417cda4f1b025788de6687b390826fe">$request</a> = <span class="stringliteral">&#39;&#39;</span>;                              <span class="comment">// HTTP request</span>
<a name="l07211"></a>07211         var <a class="code" href="classnusoap__client.html#a7e876745b5c4171d6dc444567a01eefe">$response</a> = <span class="stringliteral">&#39;&#39;</span>;                             <span class="comment">// HTTP response</span>
<a name="l07212"></a>07212         var <a class="code" href="classnusoap__client.html#a299b06904e689a23a5d75aed67889b4b">$responseData</a> = <span class="stringliteral">&#39;&#39;</span>;                 <span class="comment">// SOAP payload of response</span>
<a name="l07213"></a>07213         var <a class="code" href="classnusoap__client.html#a488524f98da3cb0b016d393d39f48720">$cookies</a> = array();                 <span class="comment">// Cookies from response or for request</span>
<a name="l07214"></a>07214     var <a class="code" href="classnusoap__client.html#a42f9ed3ac5f161b03390790ec5240738">$decode_utf8</a> = <span class="keyword">true</span>;            <span class="comment">// toggles whether the parser decodes element content w/ utf8_decode()</span>
<a name="l07215"></a>07215         var <a class="code" href="classnusoap__client.html#a40f85bac1d2155f301c0c2c5edc4193e">$operations</a> = array();              <span class="comment">// WSDL operations, empty for WSDL initialization error</span>
<a name="l07216"></a>07216         var <a class="code" href="classnusoap__client.html#a148143e9835ef9704d78f65b6170d731">$curl_options</a> = array();    <span class="comment">// User-specified cURL options</span>
<a name="l07217"></a>07217         var <a class="code" href="classnusoap__client.html#a3feacea870c1a4b8cba123e958d7f932">$bindingType</a> = <span class="stringliteral">&#39;&#39;</span>;                  <span class="comment">// WSDL operation binding type</span>
<a name="l07218"></a>07218         var <a class="code" href="classnusoap__client.html#a30f8422d6d223166575d68dd4674d65b">$use_curl</a> = <span class="keyword">false</span>;                  <span class="comment">// whether to always try to use cURL</span>
<a name="l07219"></a>07219 
<a name="l07220"></a>07220         <span class="comment">/*</span>
<a name="l07221"></a>07221 <span class="comment">         * fault related variables</span>
<a name="l07222"></a>07222 <span class="comment">         */</span>
<a name="l07227"></a>07227         var <a class="code" href="classnusoap__client.html#adf3ebb9ddbb9430ccecb42b1d8956bbd">$fault</a>;
<a name="l07232"></a>07232         var <a class="code" href="classnusoap__client.html#a78c615b04a77b7b01d4c37ccf25d4693">$faultcode</a>;
<a name="l07237"></a>07237         var <a class="code" href="classnusoap__client.html#a162a031f2ef0cbe0eb6006016f25b389">$faultstring</a>;
<a name="l07242"></a>07242         var <a class="code" href="classnusoap__client.html#a4503a687b0a0ec31d3be9f73d58a9ca7">$faultdetail</a>;
<a name="l07243"></a>07243 
<a name="l07258"></a><a class="code" href="classnusoap__client.html#aa9b69fa44881ef612b83e263c0918179">07258</a>         function <a class="code" href="classnusoap__client.html#aa9b69fa44881ef612b83e263c0918179">nusoap_client</a>(<a class="code" href="classnusoap__client.html#abc466379a93a1d6e6a612d901863c3b5">$endpoint</a>,<a class="code" href="soap__server__test_8php.html#a8b3fb8293ad64e3dc0b814fedf24c5dd">$wsdl</a> = <span class="keyword">false</span>,<a class="code" href="classnusoap__client.html#aa338793644c3c11e9f26b037183edcb4">$proxyhost</a> = <span class="keyword">false</span>,<a class="code" href="classnusoap__client.html#a0ec7742ef4e60957bb2434e4ae1687b9">$proxyport</a> = <span class="keyword">false</span>,<a class="code" href="classnusoap__client.html#a7cd6d5a82fb6497a40aab27e1912cfea">$proxyusername</a> = <span class="keyword">false</span>, <a class="code" href="classnusoap__client.html#abba1ff96c63993ea3e2cc3ce50679d30">$proxypassword</a> = <span class="keyword">false</span>, <a class="code" href="classnusoap__client.html#aba5ca2d7e6c45a4773cddec256c9a192">$timeout</a> = 0, <a class="code" href="classnusoap__client.html#a41b0366193fea3a46ac06dd3d794429f">$response_timeout</a> = 30, <a class="code" href="classnusoap__client.html#a7ec0d9a68da32080cead7a60731d8e4c">$portName</a> = <span class="stringliteral">&#39;&#39;</span>){
<a name="l07259"></a>07259                 <a class="code" href="classnusoap__base.html#a236c7ba11817473af2af447e11fba3b0">parent::nusoap_base</a>();
<a name="l07260"></a>07260                 $this-&gt;endpoint = <a class="code" href="classnusoap__client.html#abc466379a93a1d6e6a612d901863c3b5">$endpoint</a>;
<a name="l07261"></a>07261                 $this-&gt;proxyhost = <a class="code" href="classnusoap__client.html#aa338793644c3c11e9f26b037183edcb4">$proxyhost</a>;
<a name="l07262"></a>07262                 $this-&gt;proxyport = <a class="code" href="classnusoap__client.html#a0ec7742ef4e60957bb2434e4ae1687b9">$proxyport</a>;
<a name="l07263"></a>07263                 $this-&gt;proxyusername = <a class="code" href="classnusoap__client.html#a7cd6d5a82fb6497a40aab27e1912cfea">$proxyusername</a>;
<a name="l07264"></a>07264                 $this-&gt;proxypassword = <a class="code" href="classnusoap__client.html#abba1ff96c63993ea3e2cc3ce50679d30">$proxypassword</a>;
<a name="l07265"></a>07265                 $this-&gt;timeout = <a class="code" href="classnusoap__client.html#aba5ca2d7e6c45a4773cddec256c9a192">$timeout</a>;
<a name="l07266"></a>07266                 $this-&gt;response_timeout = <a class="code" href="classnusoap__client.html#a41b0366193fea3a46ac06dd3d794429f">$response_timeout</a>;
<a name="l07267"></a>07267                 $this-&gt;portName = <a class="code" href="classnusoap__client.html#a7ec0d9a68da32080cead7a60731d8e4c">$portName</a>;
<a name="l07268"></a>07268 
<a name="l07269"></a>07269                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;ctor wsdl=$wsdl timeout=$timeout response_timeout=$response_timeout&quot;</span>);
<a name="l07270"></a>07270                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;endpoint=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classnusoap__client.html#abc466379a93a1d6e6a612d901863c3b5">$endpoint</a>));
<a name="l07271"></a>07271 
<a name="l07272"></a>07272                 <span class="comment">// make values</span>
<a name="l07273"></a>07273                 <span class="keywordflow">if</span>(<a class="code" href="soap__server__test_8php.html#a8b3fb8293ad64e3dc0b814fedf24c5dd">$wsdl</a>){
<a name="l07274"></a>07274                         <span class="keywordflow">if</span> (is_object(<a class="code" href="classnusoap__client.html#abc466379a93a1d6e6a612d901863c3b5">$endpoint</a>) &amp;&amp; (get_class(<a class="code" href="classnusoap__client.html#abc466379a93a1d6e6a612d901863c3b5">$endpoint</a>) == <span class="stringliteral">&#39;wsdl&#39;</span>)) {
<a name="l07275"></a>07275                                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a> = <a class="code" href="classnusoap__client.html#abc466379a93a1d6e6a612d901863c3b5">$endpoint</a>;
<a name="l07276"></a>07276                                 $this-&gt;endpoint = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;wsdl;
<a name="l07277"></a>07277                                 $this-&gt;wsdlFile = $this-&gt;endpoint;
<a name="l07278"></a>07278                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;existing wsdl instance created from &#39;</span> . $this-&gt;endpoint);
<a name="l07279"></a>07279                                 $this-&gt;<a class="code" href="classnusoap__client.html#a9df6a7844a1a356eba2d3486c7afb429">checkWSDL</a>();
<a name="l07280"></a>07280                         } <span class="keywordflow">else</span> {
<a name="l07281"></a>07281                                 $this-&gt;wsdlFile = $this-&gt;endpoint;
<a name="l07282"></a>07282                                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a> = null;
<a name="l07283"></a>07283                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;will use lazy evaluation of wsdl from &#39;</span> . $this-&gt;endpoint);
<a name="l07284"></a>07284                         }
<a name="l07285"></a>07285                         $this-&gt;endpointType = <span class="stringliteral">&#39;wsdl&#39;</span>;
<a name="l07286"></a>07286                 } <span class="keywordflow">else</span> {
<a name="l07287"></a>07287                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;instantiate SOAP with endpoint at $endpoint&quot;</span>);
<a name="l07288"></a>07288                         $this-&gt;endpointType = <span class="stringliteral">&#39;soap&#39;</span>;
<a name="l07289"></a>07289                 }
<a name="l07290"></a>07290         }
<a name="l07291"></a>07291 
<a name="l07317"></a><a class="code" href="classnusoap__client.html#a4518fdf7c9d1939722e8cf1cd67a5028">07317</a>         function <a class="code" href="classnusoap__client.html#a4518fdf7c9d1939722e8cf1cd67a5028">call</a>($operation,$params=array(),$namespace=<span class="stringliteral">&#39;http://tempuri.org&#39;</span>,$soapAction=<span class="stringliteral">&#39;&#39;</span>,$headers=<span class="keyword">false</span>,$rpcParams=null,$style=<span class="stringliteral">&#39;rpc&#39;</span>,$use=<span class="stringliteral">&#39;encoded&#39;</span>){
<a name="l07318"></a>07318                 $this-&gt;operation = $operation;
<a name="l07319"></a>07319                 $this-&gt;fault = <span class="keyword">false</span>;
<a name="l07320"></a>07320                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;&#39;</span>);
<a name="l07321"></a>07321                 $this-&gt;request = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07322"></a>07322                 $this-&gt;response = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07323"></a>07323                 $this-&gt;responseData = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07324"></a>07324                 $this-&gt;faultstring = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07325"></a>07325                 $this-&gt;faultcode = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07326"></a>07326                 $this-&gt;opData = array();
<a name="l07327"></a>07327                 
<a name="l07328"></a>07328                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;call: operation=$operation, namespace=$namespace, soapAction=$soapAction, rpcParams=$rpcParams, style=$style, use=$use, endpointType=$this-&gt;endpointType&quot;</span>);
<a name="l07329"></a>07329                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;params=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($params));
<a name="l07330"></a>07330                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;headers=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($headers));
<a name="l07331"></a>07331                 <span class="keywordflow">if</span> ($headers) {
<a name="l07332"></a>07332                         $this-&gt;requestHeaders = $headers;
<a name="l07333"></a>07333                 }
<a name="l07334"></a>07334                 <span class="keywordflow">if</span> ($this-&gt;endpointType == <span class="stringliteral">&#39;wsdl&#39;</span> &amp;&amp; is_null($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>)) {
<a name="l07335"></a>07335                         $this-&gt;<a class="code" href="classnusoap__client.html#aa71b9cdc567fc894b85891235f0028c5">loadWSDL</a>();
<a name="l07336"></a>07336                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>())
<a name="l07337"></a>07337                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07338"></a>07338                 }
<a name="l07339"></a>07339                 <span class="comment">// serialize parameters</span>
<a name="l07340"></a>07340                 <span class="keywordflow">if</span>($this-&gt;endpointType == <span class="stringliteral">&#39;wsdl&#39;</span> &amp;&amp; $opData = $this-&gt;<a class="code" href="classnusoap__client.html#a8596422939874a9ed4bc5d1715807869">getOperationData</a>($operation)){
<a name="l07341"></a>07341                         <span class="comment">// use WSDL for operation</span>
<a name="l07342"></a>07342                         $this-&gt;opData = $opData;
<a name="l07343"></a>07343                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;found operation&quot;</span>);
<a name="l07344"></a>07344                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;opData=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($opData));
<a name="l07345"></a>07345                         <span class="keywordflow">if</span> (isset($opData[<span class="stringliteral">&#39;soapAction&#39;</span>])) {
<a name="l07346"></a>07346                                 $soapAction = $opData[<span class="stringliteral">&#39;soapAction&#39;</span>];
<a name="l07347"></a>07347                         }
<a name="l07348"></a>07348                         <span class="keywordflow">if</span> (! $this-&gt;forceEndpoint) {
<a name="l07349"></a>07349                                 $this-&gt;endpoint = $opData[<span class="stringliteral">&#39;endpoint&#39;</span>];
<a name="l07350"></a>07350                         } <span class="keywordflow">else</span> {
<a name="l07351"></a>07351                                 $this-&gt;endpoint = $this-&gt;forceEndpoint;
<a name="l07352"></a>07352                         }
<a name="l07353"></a>07353                         $namespace = isset($opData[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;namespace&#39;</span>]) ? $opData[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;namespace&#39;</span>] :     $namespace;
<a name="l07354"></a>07354                         $style = $opData[<span class="stringliteral">&#39;style&#39;</span>];
<a name="l07355"></a>07355                         $use = $opData[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;use&#39;</span>];
<a name="l07356"></a>07356                         <span class="comment">// add ns to ns array</span>
<a name="l07357"></a>07357                         <span class="keywordflow">if</span>($namespace != <span class="stringliteral">&#39;&#39;</span> &amp;&amp; !isset($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;namespaces[$namespace])){
<a name="l07358"></a>07358                                 $nsPrefix = <span class="stringliteral">&#39;ns&#39;</span> . rand(1000, 9999);
<a name="l07359"></a>07359                                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;namespaces[$nsPrefix] = $namespace;
<a name="l07360"></a>07360                         }
<a name="l07361"></a>07361             $nsPrefix = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getPrefixFromNamespace($namespace);
<a name="l07362"></a>07362                         <span class="comment">// serialize payload</span>
<a name="l07363"></a>07363                         <span class="keywordflow">if</span> (is_string($params)) {
<a name="l07364"></a>07364                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing param string for WSDL operation $operation&quot;</span>);
<a name="l07365"></a>07365                                 $payload = $params;
<a name="l07366"></a>07366                         } elseif (is_array($params)) {
<a name="l07367"></a>07367                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing param array for WSDL operation $operation&quot;</span>);
<a name="l07368"></a>07368                                 $payload = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;serializeRPCParameters($operation,<span class="stringliteral">&#39;input&#39;</span>,$params,$this-&gt;bindingType);
<a name="l07369"></a>07369                         } <span class="keywordflow">else</span> {
<a name="l07370"></a>07370                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;params must be array or string&#39;</span>);
<a name="l07371"></a>07371                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;params must be array or string&#39;</span>);
<a name="l07372"></a>07372                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07373"></a>07373                         }
<a name="l07374"></a>07374             <a class="code" href="classnusoap__base.html#aa00bbae327f1af845ce260e23e43fdb6">$usedNamespaces</a> = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;usedNamespaces;
<a name="l07375"></a>07375                         <span class="keywordflow">if</span> (isset($opData[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>])) {
<a name="l07376"></a>07376                                 $encodingStyle = $opData[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;encodingStyle&#39;</span>];
<a name="l07377"></a>07377                         } <span class="keywordflow">else</span> {
<a name="l07378"></a>07378                                 $encodingStyle = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07379"></a>07379                         }
<a name="l07380"></a>07380                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l07381"></a>07381                         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;clearDebug();
<a name="l07382"></a>07382                         <span class="keywordflow">if</span> ($errstr = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getError()) {
<a name="l07383"></a>07383                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got wsdl error: &#39;</span>.$errstr);
<a name="l07384"></a>07384                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;wsdl error: &#39;</span>.$errstr);
<a name="l07385"></a>07385                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07386"></a>07386                         }
<a name="l07387"></a>07387                 } elseif($this-&gt;endpointType == <span class="stringliteral">&#39;wsdl&#39;</span>) {
<a name="l07388"></a>07388                         <span class="comment">// operation not in WSDL</span>
<a name="l07389"></a>07389                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l07390"></a>07390                         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;clearDebug();
<a name="l07391"></a>07391                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;operation &#39;</span>.$operation.<span class="stringliteral">&#39; not present in WSDL.&#39;</span>);
<a name="l07392"></a>07392                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;operation &#39;$operation&#39; not present in WSDL.&quot;</span>);
<a name="l07393"></a>07393                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07394"></a>07394                 } <span class="keywordflow">else</span> {
<a name="l07395"></a>07395                         <span class="comment">// no WSDL</span>
<a name="l07396"></a>07396                         <span class="comment">//$this-&gt;namespaces[&#39;ns1&#39;] = $namespace;</span>
<a name="l07397"></a>07397                         $nsPrefix = <span class="stringliteral">&#39;ns&#39;</span> . rand(1000, 9999);
<a name="l07398"></a>07398                         <span class="comment">// serialize </span>
<a name="l07399"></a>07399                         $payload = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07400"></a>07400                         <span class="keywordflow">if</span> (is_string($params)) {
<a name="l07401"></a>07401                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing param string for operation $operation&quot;</span>);
<a name="l07402"></a>07402                                 $payload = $params;
<a name="l07403"></a>07403                         } elseif (is_array($params)) {
<a name="l07404"></a>07404                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;serializing param array for operation $operation&quot;</span>);
<a name="l07405"></a>07405                                 <span class="keywordflow">foreach</span>($params as $k =&gt; $v){
<a name="l07406"></a>07406                                         $payload .= $this-&gt;<a class="code" href="classnusoap__base.html#a60ee09e022c9270ea717783c32083d74">serialize_val</a>($v,$k,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,$use);
<a name="l07407"></a>07407                                 }
<a name="l07408"></a>07408                         } <span class="keywordflow">else</span> {
<a name="l07409"></a>07409                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;params must be array or string&#39;</span>);
<a name="l07410"></a>07410                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;params must be array or string&#39;</span>);
<a name="l07411"></a>07411                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07412"></a>07412                         }
<a name="l07413"></a>07413                         <a class="code" href="classnusoap__base.html#aa00bbae327f1af845ce260e23e43fdb6">$usedNamespaces</a> = array();
<a name="l07414"></a>07414                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;encoded&#39;</span>) {
<a name="l07415"></a>07415                                 $encodingStyle = <span class="stringliteral">&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;</span>;
<a name="l07416"></a>07416                         } <span class="keywordflow">else</span> {
<a name="l07417"></a>07417                                 $encodingStyle = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07418"></a>07418                         }
<a name="l07419"></a>07419                 }
<a name="l07420"></a>07420                 <span class="comment">// wrap RPC calls with method element</span>
<a name="l07421"></a>07421                 <span class="keywordflow">if</span> ($style == <span class="stringliteral">&#39;rpc&#39;</span>) {
<a name="l07422"></a>07422                         <span class="keywordflow">if</span> ($use == <span class="stringliteral">&#39;literal&#39;</span>) {
<a name="l07423"></a>07423                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;wrapping RPC request with literal method element&quot;</span>);
<a name="l07424"></a>07424                                 <span class="keywordflow">if</span> ($namespace) {
<a name="l07425"></a>07425                                         <span class="comment">// http://www.ws-i.org/Profiles/BasicProfile-1.1-2004-08-24.html R2735 says rpc/literal accessor elements should not be in a namespace</span>
<a name="l07426"></a>07426                                         $payload = <span class="stringliteral">&quot;&lt;$nsPrefix:$operation xmlns:$nsPrefix=\&quot;$namespace\&quot;&gt;&quot;</span> .
<a name="l07427"></a>07427                                                                 $payload .
<a name="l07428"></a>07428                                                                 <span class="stringliteral">&quot;&lt;/$nsPrefix:$operation&gt;&quot;</span>;
<a name="l07429"></a>07429                                 } <span class="keywordflow">else</span> {
<a name="l07430"></a>07430                                         $payload = <span class="stringliteral">&quot;&lt;$operation&gt;&quot;</span> . $payload . <span class="stringliteral">&quot;&lt;/$operation&gt;&quot;</span>;
<a name="l07431"></a>07431                                 }
<a name="l07432"></a>07432                         } <span class="keywordflow">else</span> {
<a name="l07433"></a>07433                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;wrapping RPC request with encoded method element&quot;</span>);
<a name="l07434"></a>07434                                 <span class="keywordflow">if</span> ($namespace) {
<a name="l07435"></a>07435                                         $payload = <span class="stringliteral">&quot;&lt;$nsPrefix:$operation xmlns:$nsPrefix=\&quot;$namespace\&quot;&gt;&quot;</span> .
<a name="l07436"></a>07436                                                                 $payload .
<a name="l07437"></a>07437                                                                 <span class="stringliteral">&quot;&lt;/$nsPrefix:$operation&gt;&quot;</span>;
<a name="l07438"></a>07438                                 } <span class="keywordflow">else</span> {
<a name="l07439"></a>07439                                         $payload = <span class="stringliteral">&quot;&lt;$operation&gt;&quot;</span> .
<a name="l07440"></a>07440                                                                 $payload .
<a name="l07441"></a>07441                                                                 <span class="stringliteral">&quot;&lt;/$operation&gt;&quot;</span>;
<a name="l07442"></a>07442                                 }
<a name="l07443"></a>07443                         }
<a name="l07444"></a>07444                 }
<a name="l07445"></a>07445                 <span class="comment">// serialize envelope</span>
<a name="l07446"></a>07446                 $soapmsg = $this-&gt;<a class="code" href="classnusoap__base.html#a8940fff9aa5bc728be4fee5c5d319d5e">serializeEnvelope</a>($payload,$this-&gt;requestHeaders,<a class="code" href="classnusoap__base.html#aa00bbae327f1af845ce260e23e43fdb6">$usedNamespaces</a>,$style,$use,$encodingStyle);
<a name="l07447"></a>07447                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;endpoint=$this-&gt;endpoint, soapAction=$soapAction, namespace=$namespace, style=$style, use=$use, encodingStyle=$encodingStyle&quot;</span>);
<a name="l07448"></a>07448                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;SOAP message length=&#39;</span> . strlen($soapmsg) . <span class="stringliteral">&#39; contents (max 1000 bytes)=&#39;</span> . substr($soapmsg, 0, 1000));
<a name="l07449"></a>07449                 <span class="comment">// send</span>
<a name="l07450"></a>07450                 $return = $this-&gt;<a class="code" href="classnusoap__client.html#a1a9ee5485589e291619da192324f70bc">send</a>($this-&gt;<a class="code" href="classnusoap__client.html#aa7d92aba4e7fd910b55f68b43e72eda9">getHTTPBody</a>($soapmsg),$soapAction,$this-&gt;timeout,$this-&gt;response_timeout);
<a name="l07451"></a>07451                 <span class="keywordflow">if</span>($errstr = $this-&gt;<a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>()){
<a name="l07452"></a>07452                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Error: &#39;</span>.$errstr);
<a name="l07453"></a>07453                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07454"></a>07454                 } <span class="keywordflow">else</span> {
<a name="l07455"></a>07455                         $this-&gt;<span class="keywordflow">return</span> = $return;
<a name="l07456"></a>07456                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;sent message successfully and got a(n) &#39;</span>.gettype($return));
<a name="l07457"></a>07457                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&#39;return=&#39;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($return));
<a name="l07458"></a>07458                         
<a name="l07459"></a>07459                         <span class="comment">// fault?</span>
<a name="l07460"></a>07460                         <span class="keywordflow">if</span>(is_array($return) &amp;&amp; isset($return[<span class="stringliteral">&#39;faultcode&#39;</span>])){
<a name="l07461"></a>07461                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got fault&#39;</span>);
<a name="l07462"></a>07462                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($return[<span class="stringliteral">&#39;faultcode&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>.$return[<span class="stringliteral">&#39;faultstring&#39;</span>]);
<a name="l07463"></a>07463                                 $this-&gt;fault = <span class="keyword">true</span>;
<a name="l07464"></a>07464                                 <span class="keywordflow">foreach</span>($return as $k =&gt; $v){
<a name="l07465"></a>07465                                         $this-&gt;$k = $v;
<a name="l07466"></a>07466                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;$k = $v&lt;br&gt;&quot;</span>);
<a name="l07467"></a>07467                                 }
<a name="l07468"></a>07468                                 <span class="keywordflow">return</span> $return;
<a name="l07469"></a>07469                         } elseif ($style == <span class="stringliteral">&#39;document&#39;</span>) {
<a name="l07470"></a>07470                                 <span class="comment">// NOTE: if the response is defined to have multiple parts (i.e. unwrapped),</span>
<a name="l07471"></a>07471                                 <span class="comment">// we are only going to return the first part here...sorry about that</span>
<a name="l07472"></a>07472                                 <span class="keywordflow">return</span> $return;
<a name="l07473"></a>07473                         } <span class="keywordflow">else</span> {
<a name="l07474"></a>07474                                 <span class="comment">// array of return values</span>
<a name="l07475"></a>07475                                 <span class="keywordflow">if</span>(is_array($return)){
<a name="l07476"></a>07476                                         <span class="comment">// multiple &#39;out&#39; parameters, which we return wrapped up</span>
<a name="l07477"></a>07477                                         <span class="comment">// in the array</span>
<a name="l07478"></a>07478                                         <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($return) &gt; 1){
<a name="l07479"></a>07479                                                 <span class="keywordflow">return</span> $return;
<a name="l07480"></a>07480                                         }
<a name="l07481"></a>07481                                         <span class="comment">// single &#39;out&#39; parameter (normally the return value)</span>
<a name="l07482"></a>07482                                         $return = array_shift($return);
<a name="l07483"></a>07483                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;return shifted value: &#39;</span>);
<a name="l07484"></a>07484                                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($return));
<a name="l07485"></a>07485                                 <span class="keywordflow">return</span> $return;
<a name="l07486"></a>07486                                 <span class="comment">// nothing returned (ie, echoVoid)</span>
<a name="l07487"></a>07487                                 } <span class="keywordflow">else</span> {
<a name="l07488"></a>07488                                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07489"></a>07489                                 }
<a name="l07490"></a>07490                         }
<a name="l07491"></a>07491                 }
<a name="l07492"></a>07492         }
<a name="l07493"></a>07493 
<a name="l07499"></a><a class="code" href="classnusoap__client.html#a9df6a7844a1a356eba2d3486c7afb429">07499</a>         function <a class="code" href="classnusoap__client.html#a9df6a7844a1a356eba2d3486c7afb429">checkWSDL</a>() {
<a name="l07500"></a>07500                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l07501"></a>07501                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;clearDebug();
<a name="l07502"></a>07502                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;checkWSDL&#39;</span>);
<a name="l07503"></a>07503                 <span class="comment">// catch errors</span>
<a name="l07504"></a>07504                 <span class="keywordflow">if</span> ($errstr = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getError()) {
<a name="l07505"></a>07505                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l07506"></a>07506                         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;clearDebug();
<a name="l07507"></a>07507                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got wsdl error: &#39;</span>.$errstr);
<a name="l07508"></a>07508                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;wsdl error: &#39;</span>.$errstr);
<a name="l07509"></a>07509                 } elseif ($this-&gt;operations = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getOperations($this-&gt;portName, <span class="stringliteral">&#39;soap&#39;</span>)) {
<a name="l07510"></a>07510                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l07511"></a>07511                         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;clearDebug();
<a name="l07512"></a>07512                         $this-&gt;bindingType = <span class="stringliteral">&#39;soap&#39;</span>;
<a name="l07513"></a>07513                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got &#39;</span>.count($this-&gt;operations).<span class="stringliteral">&#39; operations from wsdl &#39;</span>.$this-&gt;wsdlFile.<span class="stringliteral">&#39; for binding type &#39;</span>.$this-&gt;bindingType);
<a name="l07514"></a>07514                 } elseif ($this-&gt;operations = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getOperations($this-&gt;portName, <span class="stringliteral">&#39;soap12&#39;</span>)) {
<a name="l07515"></a>07515                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l07516"></a>07516                         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;clearDebug();
<a name="l07517"></a>07517                         $this-&gt;bindingType = <span class="stringliteral">&#39;soap12&#39;</span>;
<a name="l07518"></a>07518                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got &#39;</span>.count($this-&gt;operations).<span class="stringliteral">&#39; operations from wsdl &#39;</span>.$this-&gt;wsdlFile.<span class="stringliteral">&#39; for binding type &#39;</span>.$this-&gt;bindingType);
<a name="l07519"></a>07519                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;**************** WARNING: SOAP 1.2 BINDING *****************&#39;</span>);
<a name="l07520"></a>07520                 } <span class="keywordflow">else</span> {
<a name="l07521"></a>07521                         $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;getDebug());
<a name="l07522"></a>07522                         $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;clearDebug();
<a name="l07523"></a>07523                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;getOperations returned false&#39;</span>);
<a name="l07524"></a>07524                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;no operations defined in the WSDL document!&#39;</span>);
<a name="l07525"></a>07525                 }
<a name="l07526"></a>07526         }
<a name="l07527"></a>07527 
<a name="l07533"></a><a class="code" href="classnusoap__client.html#aa71b9cdc567fc894b85891235f0028c5">07533</a>         function <a class="code" href="classnusoap__client.html#aa71b9cdc567fc894b85891235f0028c5">loadWSDL</a>() {
<a name="l07534"></a>07534                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;instantiating wsdl class with doc: &#39;</span>.$this-&gt;wsdlFile);
<a name="l07535"></a>07535                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a> = <span class="keyword">new</span> <a class="code" href="classwsdl.html">wsdl</a>(<span class="stringliteral">&#39;&#39;</span>,$this-&gt;proxyhost,$this-&gt;proxyport,$this-&gt;proxyusername,$this-&gt;proxypassword,$this-&gt;timeout,$this-&gt;response_timeout,$this-&gt;curl_options,$this-&gt;use_curl);
<a name="l07536"></a>07536                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;setCredentials($this-&gt;username, $this-&gt;password, $this-&gt;authtype, $this-&gt;certRequest);
<a name="l07537"></a>07537                 $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>-&gt;fetchWSDL($this-&gt;wsdlFile);
<a name="l07538"></a>07538                 $this-&gt;<a class="code" href="classnusoap__client.html#a9df6a7844a1a356eba2d3486c7afb429">checkWSDL</a>();
<a name="l07539"></a>07539         }
<a name="l07540"></a>07540 
<a name="l07548"></a><a class="code" href="classnusoap__client.html#a8596422939874a9ed4bc5d1715807869">07548</a>         function <a class="code" href="classnusoap__client.html#a8596422939874a9ed4bc5d1715807869">getOperationData</a>($operation){
<a name="l07549"></a>07549                 <span class="keywordflow">if</span> ($this-&gt;endpointType == <span class="stringliteral">&#39;wsdl&#39;</span> &amp;&amp; is_null($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>)) {
<a name="l07550"></a>07550                         $this-&gt;<a class="code" href="classnusoap__client.html#aa71b9cdc567fc894b85891235f0028c5">loadWSDL</a>();
<a name="l07551"></a>07551                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>())
<a name="l07552"></a>07552                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07553"></a>07553                 }
<a name="l07554"></a>07554                 <span class="keywordflow">if</span>(isset($this-&gt;operations[$operation])){
<a name="l07555"></a>07555                         <span class="keywordflow">return</span> $this-&gt;operations[$operation];
<a name="l07556"></a>07556                 }
<a name="l07557"></a>07557                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;No data for operation: $operation&quot;</span>);
<a name="l07558"></a>07558         }
<a name="l07559"></a>07559 
<a name="l07574"></a><a class="code" href="classnusoap__client.html#a1a9ee5485589e291619da192324f70bc">07574</a>         function <a class="code" href="classnusoap__client.html#a1a9ee5485589e291619da192324f70bc">send</a>($msg, $soapaction = <span class="stringliteral">&#39;&#39;</span>, <a class="code" href="classnusoap__client.html#aba5ca2d7e6c45a4773cddec256c9a192">$timeout</a>=0, <a class="code" href="classnusoap__client.html#a41b0366193fea3a46ac06dd3d794429f">$response_timeout</a>=30) {
<a name="l07575"></a>07575                 $this-&gt;<a class="code" href="classnusoap__client.html#a4817f0dfd72202fcee4527e398919ae1">checkCookies</a>();
<a name="l07576"></a>07576                 <span class="comment">// detect transport</span>
<a name="l07577"></a>07577                 <span class="keywordflow">switch</span>(<span class="keyword">true</span>){
<a name="l07578"></a>07578                         <span class="comment">// http(s)</span>
<a name="l07579"></a>07579                         <span class="keywordflow">case</span> preg_match(<span class="stringliteral">&#39;/^http/&#39;</span>,$this-&gt;endpoint):
<a name="l07580"></a>07580                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;transporting via HTTP&#39;</span>);
<a name="l07581"></a>07581                                 <span class="keywordflow">if</span>($this-&gt;persistentConnection == <span class="keyword">true</span> &amp;&amp; is_object($this-&gt;persistentConnection)){
<a name="l07582"></a>07582                                         $http =&amp; $this-&gt;persistentConnection;
<a name="l07583"></a>07583                                 } <span class="keywordflow">else</span> {
<a name="l07584"></a>07584                                         $http = <span class="keyword">new</span> <a class="code" href="classsoap__transport__http.html">soap_transport_http</a>($this-&gt;endpoint, $this-&gt;curl_options, $this-&gt;use_curl);
<a name="l07585"></a>07585                                         <span class="keywordflow">if</span> ($this-&gt;persistentConnection) {
<a name="l07586"></a>07586                                                 $http-&gt;usePersistentConnection();
<a name="l07587"></a>07587                                         }
<a name="l07588"></a>07588                                 }
<a name="l07589"></a>07589                                 $http-&gt;setContentType($this-&gt;<a class="code" href="classnusoap__client.html#a6698e90874e2e7f14f29eeefe0216e0e">getHTTPContentType</a>(), $this-&gt;<a class="code" href="classnusoap__client.html#a80414bfbaf2d76036be7681b31db890a">getHTTPContentTypeCharset</a>());
<a name="l07590"></a>07590                                 $http-&gt;setSOAPAction($soapaction);
<a name="l07591"></a>07591                                 <span class="keywordflow">if</span>($this-&gt;proxyhost &amp;&amp; $this-&gt;proxyport){
<a name="l07592"></a>07592                                         $http-&gt;setProxy($this-&gt;proxyhost,$this-&gt;proxyport,$this-&gt;proxyusername,$this-&gt;proxypassword);
<a name="l07593"></a>07593                                 }
<a name="l07594"></a>07594                 <span class="keywordflow">if</span>($this-&gt;authtype != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l07595"></a>07595                                         $http-&gt;setCredentials($this-&gt;username, $this-&gt;password, $this-&gt;authtype, array(), $this-&gt;certRequest);
<a name="l07596"></a>07596                                 }
<a name="l07597"></a>07597                                 <span class="keywordflow">if</span>($this-&gt;http_encoding != <span class="stringliteral">&#39;&#39;</span>){
<a name="l07598"></a>07598                                         $http-&gt;setEncoding($this-&gt;http_encoding);
<a name="l07599"></a>07599                                 }
<a name="l07600"></a>07600                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;sending message, length=&#39;</span>.strlen($msg));
<a name="l07601"></a>07601                                 <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/^http:/&#39;</span>,$this-&gt;endpoint)){
<a name="l07602"></a>07602                                 <span class="comment">//if(strpos($this-&gt;endpoint,&#39;http:&#39;)){</span>
<a name="l07603"></a>07603                                         $this-&gt;responseData = $http-&gt;send($msg,<a class="code" href="classnusoap__client.html#aba5ca2d7e6c45a4773cddec256c9a192">$timeout</a>,<a class="code" href="classnusoap__client.html#a41b0366193fea3a46ac06dd3d794429f">$response_timeout</a>,$this-&gt;cookies);
<a name="l07604"></a>07604                                 } elseif(preg_match(<span class="stringliteral">&#39;/^https/&#39;</span>,$this-&gt;endpoint)){
<a name="l07605"></a>07605                                 <span class="comment">//} elseif(strpos($this-&gt;endpoint,&#39;https:&#39;)){</span>
<a name="l07606"></a>07606                                         <span class="comment">//if(phpversion() == &#39;4.3.0-dev&#39;){</span>
<a name="l07607"></a>07607                                                 <span class="comment">//$response = $http-&gt;send($msg,$timeout,$response_timeout);</span>
<a name="l07608"></a>07608                                 <span class="comment">//$this-&gt;request = $http-&gt;outgoing_payload;</span>
<a name="l07609"></a>07609                                                 <span class="comment">//$this-&gt;response = $http-&gt;incoming_payload;</span>
<a name="l07610"></a>07610                                         <span class="comment">//} else</span>
<a name="l07611"></a>07611                                         $this-&gt;responseData = $http-&gt;sendHTTPS($msg,<a class="code" href="classnusoap__client.html#aba5ca2d7e6c45a4773cddec256c9a192">$timeout</a>,<a class="code" href="classnusoap__client.html#a41b0366193fea3a46ac06dd3d794429f">$response_timeout</a>,$this-&gt;cookies);
<a name="l07612"></a>07612                                 } <span class="keywordflow">else</span> {
<a name="l07613"></a>07613                                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;no http/s in endpoint url&#39;</span>);
<a name="l07614"></a>07614                                 }
<a name="l07615"></a>07615                                 $this-&gt;request = $http-&gt;outgoing_payload;
<a name="l07616"></a>07616                                 $this-&gt;response = $http-&gt;incoming_payload;
<a name="l07617"></a>07617                                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($http-&gt;getDebug());
<a name="l07618"></a>07618                                 $this-&gt;<a class="code" href="classnusoap__client.html#ad0fbe30e4c04c3803fd1abb894a29d8a">UpdateCookies</a>($http-&gt;incoming_cookies);
<a name="l07619"></a>07619 
<a name="l07620"></a>07620                                 <span class="comment">// save transport object if using persistent connections</span>
<a name="l07621"></a>07621                                 <span class="keywordflow">if</span> ($this-&gt;persistentConnection) {
<a name="l07622"></a>07622                                         $http-&gt;clearDebug();
<a name="l07623"></a>07623                                         <span class="keywordflow">if</span> (!is_object($this-&gt;persistentConnection)) {
<a name="l07624"></a>07624                                                 $this-&gt;persistentConnection = $http;
<a name="l07625"></a>07625                                         }
<a name="l07626"></a>07626                                 }
<a name="l07627"></a>07627                                 
<a name="l07628"></a>07628                                 <span class="keywordflow">if</span>(<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a> = $http-&gt;getError()){
<a name="l07629"></a>07629                                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;HTTP Error: &#39;</span>.<a class="code" href="client_8php.html#acfc00bd4a41804552c630950bf61a51f">$err</a>);
<a name="l07630"></a>07630                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07631"></a>07631                                 } elseif($this-&gt;<a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>()){
<a name="l07632"></a>07632                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07633"></a>07633                                 } <span class="keywordflow">else</span> {
<a name="l07634"></a>07634                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;got response, length=&#39;</span>. strlen($this-&gt;responseData).<span class="stringliteral">&#39; type=&#39;</span>.$http-&gt;incoming_headers[<span class="stringliteral">&#39;content-type&#39;</span>]);
<a name="l07635"></a>07635                                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classnusoap__client.html#af8a932742c466b9f2e53ff56ddd64608">parseResponse</a>($http-&gt;incoming_headers, $this-&gt;responseData);
<a name="l07636"></a>07636                                 }
<a name="l07637"></a>07637                         <span class="keywordflow">break</span>;
<a name="l07638"></a>07638                         <span class="keywordflow">default</span>:
<a name="l07639"></a>07639                                 $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;no transport found, or selected transport is not yet supported!&#39;</span>);
<a name="l07640"></a>07640                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07641"></a>07641                         <span class="keywordflow">break</span>;
<a name="l07642"></a>07642                 }
<a name="l07643"></a>07643         }
<a name="l07644"></a>07644 
<a name="l07653"></a><a class="code" href="classnusoap__client.html#af8a932742c466b9f2e53ff56ddd64608">07653</a>     function <a class="code" href="classnusoap__client.html#af8a932742c466b9f2e53ff56ddd64608">parseResponse</a>($headers, $data) {
<a name="l07654"></a>07654                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Entering parseResponse() for data of length &#39;</span> . strlen($data) . <span class="stringliteral">&#39; headers:&#39;</span>);
<a name="l07655"></a>07655                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($headers));
<a name="l07656"></a>07656         <span class="keywordflow">if</span> (!isset($headers[<span class="stringliteral">&#39;content-type&#39;</span>])) {
<a name="l07657"></a>07657                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Response not of type text/xml (no content-type header)&#39;</span>);
<a name="l07658"></a>07658                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07659"></a>07659         }
<a name="l07660"></a>07660                 <span class="keywordflow">if</span> (!strstr($headers[<span class="stringliteral">&#39;content-type&#39;</span>], <span class="stringliteral">&#39;text/xml&#39;</span>)) {
<a name="l07661"></a>07661                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>(<span class="stringliteral">&#39;Response not of type text/xml: &#39;</span> . $headers[<span class="stringliteral">&#39;content-type&#39;</span>]);
<a name="l07662"></a>07662                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07663"></a>07663                 }
<a name="l07664"></a>07664                 <span class="keywordflow">if</span> (strpos($headers[<span class="stringliteral">&#39;content-type&#39;</span>], <span class="charliteral">&#39;=&#39;</span>)) {
<a name="l07665"></a>07665                         $enc = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, substr(strstr($headers[<span class="stringliteral">&quot;content-type&quot;</span>], <span class="charliteral">&#39;=&#39;</span>), 1));
<a name="l07666"></a>07666                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Got response encoding: &#39;</span> . $enc);
<a name="l07667"></a>07667                         <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/^(ISO-8859-1|US-ASCII|UTF-8)$/i&#39;</span>,$enc)){
<a name="l07668"></a>07668                                 $this-&gt;xml_encoding = strtoupper($enc);
<a name="l07669"></a>07669                         } <span class="keywordflow">else</span> {
<a name="l07670"></a>07670                                 $this-&gt;xml_encoding = <span class="stringliteral">&#39;US-ASCII&#39;</span>;
<a name="l07671"></a>07671                         }
<a name="l07672"></a>07672                 } <span class="keywordflow">else</span> {
<a name="l07673"></a>07673                         <span class="comment">// should be US-ASCII for HTTP 1.0 or ISO-8859-1 for HTTP 1.1</span>
<a name="l07674"></a>07674                         $this-&gt;xml_encoding = <span class="stringliteral">&#39;ISO-8859-1&#39;</span>;
<a name="l07675"></a>07675                 }
<a name="l07676"></a>07676                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Use encoding: &#39;</span> . $this-&gt;xml_encoding . <span class="stringliteral">&#39; when creating nusoap_parser&#39;</span>);
<a name="l07677"></a>07677                 $parser = <span class="keyword">new</span> <a class="code" href="classnusoap__parser.html">nusoap_parser</a>($data,$this-&gt;xml_encoding,$this-&gt;operation,$this-&gt;decode_utf8);
<a name="l07678"></a>07678                 <span class="comment">// add parser debug data to our debug</span>
<a name="l07679"></a>07679                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($parser-&gt;getDebug());
<a name="l07680"></a>07680                 <span class="comment">// if parse errors</span>
<a name="l07681"></a>07681                 <span class="keywordflow">if</span>($errstr = $parser-&gt;getError()){
<a name="l07682"></a>07682                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>( $errstr);
<a name="l07683"></a>07683                         <span class="comment">// destroy the parser object</span>
<a name="l07684"></a>07684                         unset($parser);
<a name="l07685"></a>07685                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07686"></a>07686                 } <span class="keywordflow">else</span> {
<a name="l07687"></a>07687                         <span class="comment">// get SOAP headers</span>
<a name="l07688"></a>07688                         $this-&gt;responseHeaders = $parser-&gt;getHeaders();
<a name="l07689"></a>07689                         <span class="comment">// get SOAP headers</span>
<a name="l07690"></a>07690                         $this-&gt;responseHeader = $parser-&gt;get_soapheader();
<a name="l07691"></a>07691                         <span class="comment">// get decoded message</span>
<a name="l07692"></a>07692                         $return = $parser-&gt;get_soapbody();
<a name="l07693"></a>07693             <span class="comment">// add document for doclit support</span>
<a name="l07694"></a>07694             $this-&gt;document = $parser-&gt;document;
<a name="l07695"></a>07695                         <span class="comment">// destroy the parser object</span>
<a name="l07696"></a>07696                         unset($parser);
<a name="l07697"></a>07697                         <span class="comment">// return decode message</span>
<a name="l07698"></a>07698                         <span class="keywordflow">return</span> $return;
<a name="l07699"></a>07699                 }
<a name="l07700"></a>07700          }
<a name="l07701"></a>07701 
<a name="l07709"></a><a class="code" href="classnusoap__client.html#a043a65055dbe46a8fff19fe100a1bb10">07709</a>         function <a class="code" href="classnusoap__client.html#a043a65055dbe46a8fff19fe100a1bb10">setCurlOption</a>($option, $value) {
<a name="l07710"></a>07710                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setCurlOption option=$option, value=&quot;</span>);
<a name="l07711"></a>07711                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($value));
<a name="l07712"></a>07712                 $this-&gt;curl_options[$option] = $value;
<a name="l07713"></a>07713         }
<a name="l07714"></a>07714 
<a name="l07721"></a><a class="code" href="classnusoap__client.html#ad0007907a3dbae33082c976a4f5f17ab">07721</a>         function <a class="code" href="classnusoap__client.html#ad0007907a3dbae33082c976a4f5f17ab">setEndpoint</a>(<a class="code" href="classnusoap__client.html#abc466379a93a1d6e6a612d901863c3b5">$endpoint</a>) {
<a name="l07722"></a>07722                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setEndpoint(\&quot;$endpoint\&quot;)&quot;</span>);
<a name="l07723"></a>07723                 $this-&gt;forceEndpoint = <a class="code" href="classnusoap__client.html#abc466379a93a1d6e6a612d901863c3b5">$endpoint</a>;
<a name="l07724"></a>07724         }
<a name="l07725"></a>07725 
<a name="l07732"></a><a class="code" href="classnusoap__client.html#aa2b4f40aae98c76c53ab60d4d8759d09">07732</a>         function <a class="code" href="classnusoap__client.html#aa2b4f40aae98c76c53ab60d4d8759d09">setHeaders</a>($headers){
<a name="l07733"></a>07733                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setHeaders headers=&quot;</span>);
<a name="l07734"></a>07734                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($headers));
<a name="l07735"></a>07735                 $this-&gt;requestHeaders = $headers;
<a name="l07736"></a>07736         }
<a name="l07737"></a>07737 
<a name="l07744"></a><a class="code" href="classnusoap__client.html#ad8a47892c2094f54c1e3508e5a4b3100">07744</a>         function <a class="code" href="classnusoap__client.html#ad8a47892c2094f54c1e3508e5a4b3100">getHeaders</a>(){
<a name="l07745"></a>07745                 <span class="keywordflow">return</span> $this-&gt;responseHeaders;
<a name="l07746"></a>07746         }
<a name="l07747"></a>07747 
<a name="l07754"></a><a class="code" href="classnusoap__client.html#a6eefe0d355d0b99e2f0edd5d6e9370d5">07754</a>         function <a class="code" href="classnusoap__client.html#a6eefe0d355d0b99e2f0edd5d6e9370d5">getHeader</a>(){
<a name="l07755"></a>07755                 <span class="keywordflow">return</span> $this-&gt;responseHeader;
<a name="l07756"></a>07756         }
<a name="l07757"></a>07757 
<a name="l07767"></a><a class="code" href="classnusoap__client.html#a5ebe55a79be3122d427f6621c74f97aa">07767</a>         function <a class="code" href="classnusoap__client.html#a5ebe55a79be3122d427f6621c74f97aa">setHTTPProxy</a>(<a class="code" href="classnusoap__client.html#aa338793644c3c11e9f26b037183edcb4">$proxyhost</a>, <a class="code" href="classnusoap__client.html#a0ec7742ef4e60957bb2434e4ae1687b9">$proxyport</a>, <a class="code" href="classnusoap__client.html#a7cd6d5a82fb6497a40aab27e1912cfea">$proxyusername</a> = <span class="stringliteral">&#39;&#39;</span>, <a class="code" href="classnusoap__client.html#abba1ff96c63993ea3e2cc3ce50679d30">$proxypassword</a> = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l07768"></a>07768                 $this-&gt;proxyhost = <a class="code" href="classnusoap__client.html#aa338793644c3c11e9f26b037183edcb4">$proxyhost</a>;
<a name="l07769"></a>07769                 $this-&gt;proxyport = <a class="code" href="classnusoap__client.html#a0ec7742ef4e60957bb2434e4ae1687b9">$proxyport</a>;
<a name="l07770"></a>07770                 $this-&gt;proxyusername = <a class="code" href="classnusoap__client.html#a7cd6d5a82fb6497a40aab27e1912cfea">$proxyusername</a>;
<a name="l07771"></a>07771                 $this-&gt;proxypassword = <a class="code" href="classnusoap__client.html#abba1ff96c63993ea3e2cc3ce50679d30">$proxypassword</a>;
<a name="l07772"></a>07772         }
<a name="l07773"></a>07773 
<a name="l07783"></a><a class="code" href="classnusoap__client.html#a9d6f466251630b7efe89768352275876">07783</a>         function <a class="code" href="classnusoap__client.html#a9d6f466251630b7efe89768352275876">setCredentials</a>(<a class="code" href="classnusoap__client.html#a5a6e502b71a3d980d0d5b4f78a3836b2">$username</a>, <a class="code" href="classnusoap__client.html#a28db01da63367bdca6f6be2518c12548">$password</a>, <a class="code" href="classnusoap__client.html#a53330860c9fb44f860900eea3db67770">$authtype</a> = <span class="stringliteral">&#39;basic&#39;</span>, <a class="code" href="classnusoap__client.html#af9f9e6aca1a464fae03b4bcfe6be85d1">$certRequest</a> = array()) {
<a name="l07784"></a>07784                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setCredentials username=$username authtype=$authtype certRequest=&quot;</span>);
<a name="l07785"></a>07785                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>($this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>(<a class="code" href="classnusoap__client.html#af9f9e6aca1a464fae03b4bcfe6be85d1">$certRequest</a>));
<a name="l07786"></a>07786                 $this-&gt;username = <a class="code" href="classnusoap__client.html#a5a6e502b71a3d980d0d5b4f78a3836b2">$username</a>;
<a name="l07787"></a>07787                 $this-&gt;password = <a class="code" href="classnusoap__client.html#a28db01da63367bdca6f6be2518c12548">$password</a>;
<a name="l07788"></a>07788                 $this-&gt;authtype = <a class="code" href="classnusoap__client.html#a53330860c9fb44f860900eea3db67770">$authtype</a>;
<a name="l07789"></a>07789                 $this-&gt;certRequest = <a class="code" href="classnusoap__client.html#af9f9e6aca1a464fae03b4bcfe6be85d1">$certRequest</a>;
<a name="l07790"></a>07790         }
<a name="l07791"></a>07791         
<a name="l07798"></a><a class="code" href="classnusoap__client.html#a695cd916a7d06fd60588d7dcc0bfd557">07798</a>         function <a class="code" href="classnusoap__client.html#a695cd916a7d06fd60588d7dcc0bfd557">setHTTPEncoding</a>($enc=<span class="stringliteral">&#39;gzip, deflate&#39;</span>){
<a name="l07799"></a>07799                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setHTTPEncoding(\&quot;$enc\&quot;)&quot;</span>);
<a name="l07800"></a>07800                 $this-&gt;http_encoding = $enc;
<a name="l07801"></a>07801         }
<a name="l07802"></a>07802         
<a name="l07809"></a><a class="code" href="classnusoap__client.html#a3bf6b7946af9797836d91c6b85763856">07809</a>         function <a class="code" href="classnusoap__client.html#a3bf6b7946af9797836d91c6b85763856">setUseCURL</a>($use) {
<a name="l07810"></a>07810                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;setUseCURL($use)&quot;</span>);
<a name="l07811"></a>07811                 $this-&gt;use_curl = $use;
<a name="l07812"></a>07812         }
<a name="l07813"></a>07813 
<a name="l07819"></a><a class="code" href="classnusoap__client.html#a7a5ab2a0e6332054d1e74206cb252be1">07819</a>         function <a class="code" href="classnusoap__client.html#a7a5ab2a0e6332054d1e74206cb252be1">useHTTPPersistentConnection</a>(){
<a name="l07820"></a>07820                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;useHTTPPersistentConnection&quot;</span>);
<a name="l07821"></a>07821                 $this-&gt;persistentConnection = <span class="keyword">true</span>;
<a name="l07822"></a>07822         }
<a name="l07823"></a>07823         
<a name="l07835"></a><a class="code" href="classnusoap__client.html#a8f9b4ffb43d6d072cb52291d67389267">07835</a>         function <a class="code" href="classnusoap__client.html#a8f9b4ffb43d6d072cb52291d67389267">getDefaultRpcParams</a>() {
<a name="l07836"></a>07836                 <span class="keywordflow">return</span> $this-&gt;defaultRpcParams;
<a name="l07837"></a>07837         }
<a name="l07838"></a>07838 
<a name="l07850"></a><a class="code" href="classnusoap__client.html#acd44b4ae1f29ac0a4a77669535028a6e">07850</a>         function <a class="code" href="classnusoap__client.html#acd44b4ae1f29ac0a4a77669535028a6e">setDefaultRpcParams</a>($rpcParams) {
<a name="l07851"></a>07851                 $this-&gt;defaultRpcParams = $rpcParams;
<a name="l07852"></a>07852         }
<a name="l07853"></a>07853         
<a name="l07861"></a><a class="code" href="classnusoap__client.html#a23efadf7ba2999206ed94f8aee0458bc">07861</a>         function <a class="code" href="classnusoap__client.html#a23efadf7ba2999206ed94f8aee0458bc">getProxy</a>() {
<a name="l07862"></a>07862                 $r = rand();
<a name="l07863"></a>07863                 $evalStr = $this-&gt;<a class="code" href="classnusoap__client.html#ae3ef98298aab2e47d840a6640a502dc7">_getProxyClassCode</a>($r);
<a name="l07864"></a>07864                 <span class="comment">//$this-&gt;debug(&quot;proxy class: $evalStr&quot;);</span>
<a name="l07865"></a>07865                 <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>()) {
<a name="l07866"></a>07866                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;Error from _getProxyClassCode, so return NULL&quot;</span>);
<a name="l07867"></a>07867                         <span class="keywordflow">return</span> null;
<a name="l07868"></a>07868                 }
<a name="l07869"></a>07869                 <span class="comment">// eval the class</span>
<a name="l07870"></a>07870                 eval($evalStr);
<a name="l07871"></a>07871                 <span class="comment">// instantiate proxy object</span>
<a name="l07872"></a>07872                 eval(<span class="stringliteral">&quot;\$proxy = new nusoap_proxy_$r(&#39;&#39;);&quot;</span>);
<a name="l07873"></a>07873                 <span class="comment">// transfer current wsdl data to the proxy thereby avoiding parsing the wsdl twice</span>
<a name="l07874"></a>07874                 $proxy-&gt;endpointType = <span class="stringliteral">&#39;wsdl&#39;</span>;
<a name="l07875"></a>07875                 $proxy-&gt;wsdlFile = $this-&gt;wsdlFile;
<a name="l07876"></a>07876                 $proxy-&gt;wsdl = $this-&gt;<a class="code" href="classwsdl.html">wsdl</a>;
<a name="l07877"></a>07877                 $proxy-&gt;operations = $this-&gt;operations;
<a name="l07878"></a>07878                 $proxy-&gt;defaultRpcParams = $this-&gt;defaultRpcParams;
<a name="l07879"></a>07879                 <span class="comment">// transfer other state</span>
<a name="l07880"></a>07880                 $proxy-&gt;soap_defencoding = $this-&gt;soap_defencoding;
<a name="l07881"></a>07881                 $proxy-&gt;username = $this-&gt;username;
<a name="l07882"></a>07882                 $proxy-&gt;password = $this-&gt;password;
<a name="l07883"></a>07883                 $proxy-&gt;authtype = $this-&gt;authtype;
<a name="l07884"></a>07884                 $proxy-&gt;certRequest = $this-&gt;certRequest;
<a name="l07885"></a>07885                 $proxy-&gt;requestHeaders = $this-&gt;requestHeaders;
<a name="l07886"></a>07886                 $proxy-&gt;endpoint = $this-&gt;endpoint;
<a name="l07887"></a>07887                 $proxy-&gt;forceEndpoint = $this-&gt;forceEndpoint;
<a name="l07888"></a>07888                 $proxy-&gt;proxyhost = $this-&gt;proxyhost;
<a name="l07889"></a>07889                 $proxy-&gt;proxyport = $this-&gt;proxyport;
<a name="l07890"></a>07890                 $proxy-&gt;proxyusername = $this-&gt;proxyusername;
<a name="l07891"></a>07891                 $proxy-&gt;proxypassword = $this-&gt;proxypassword;
<a name="l07892"></a>07892                 $proxy-&gt;http_encoding = $this-&gt;http_encoding;
<a name="l07893"></a>07893                 $proxy-&gt;timeout = $this-&gt;timeout;
<a name="l07894"></a>07894                 $proxy-&gt;response_timeout = $this-&gt;response_timeout;
<a name="l07895"></a>07895                 $proxy-&gt;persistentConnection = &amp;$this-&gt;persistentConnection;
<a name="l07896"></a>07896                 $proxy-&gt;decode_utf8 = $this-&gt;decode_utf8;
<a name="l07897"></a>07897                 $proxy-&gt;curl_options = $this-&gt;curl_options;
<a name="l07898"></a>07898                 $proxy-&gt;bindingType = $this-&gt;bindingType;
<a name="l07899"></a>07899                 $proxy-&gt;use_curl = $this-&gt;use_curl;
<a name="l07900"></a>07900                 <span class="keywordflow">return</span> $proxy;
<a name="l07901"></a>07901         }
<a name="l07902"></a>07902 
<a name="l07909"></a><a class="code" href="classnusoap__client.html#ae3ef98298aab2e47d840a6640a502dc7">07909</a>         function <a class="code" href="classnusoap__client.html#ae3ef98298aab2e47d840a6640a502dc7">_getProxyClassCode</a>($r) {
<a name="l07910"></a>07910                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&quot;in getProxy endpointType=$this-&gt;endpointType&quot;</span>);
<a name="l07911"></a>07911                 $this-&gt;<a class="code" href="classnusoap__base.html#ac8304fa5d607d52124496ee242043f24">appendDebug</a>(<span class="stringliteral">&quot;wsdl=&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#ab5511c6c0e6767b3e8b0ee9cad826641">varDump</a>($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>));
<a name="l07912"></a>07912                 <span class="keywordflow">if</span> ($this-&gt;endpointType != <span class="stringliteral">&#39;wsdl&#39;</span>) {
<a name="l07913"></a>07913                         $evalStr = <span class="stringliteral">&#39;A proxy can only be created for a WSDL client&#39;</span>;
<a name="l07914"></a>07914                         $this-&gt;<a class="code" href="classnusoap__base.html#a1be4ce561772039b0b84c423948f1f60">setError</a>($evalStr);
<a name="l07915"></a>07915                         $evalStr = <span class="stringliteral">&quot;echo \&quot;$evalStr\&quot;;&quot;</span>;
<a name="l07916"></a>07916                         <span class="keywordflow">return</span> $evalStr;
<a name="l07917"></a>07917                 }
<a name="l07918"></a>07918                 <span class="keywordflow">if</span> ($this-&gt;endpointType == <span class="stringliteral">&#39;wsdl&#39;</span> &amp;&amp; is_null($this-&gt;<a class="code" href="classwsdl.html">wsdl</a>)) {
<a name="l07919"></a>07919                         $this-&gt;<a class="code" href="classnusoap__client.html#aa71b9cdc567fc894b85891235f0028c5">loadWSDL</a>();
<a name="l07920"></a>07920                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>()) {
<a name="l07921"></a>07921                                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;echo \&quot;&quot;</span> . $this-&gt;<a class="code" href="classnusoap__base.html#abf5c6d6bc06a33b7e201e24e2fb089eb">getError</a>() . <span class="stringliteral">&quot;\&quot;;&quot;</span>;
<a name="l07922"></a>07922                         }
<a name="l07923"></a>07923                 }
<a name="l07924"></a>07924                 $evalStr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07925"></a>07925                 <span class="keywordflow">foreach</span> ($this-&gt;operations as $operation =&gt; $opData) {
<a name="l07926"></a>07926                         <span class="keywordflow">if</span> ($operation != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l07927"></a>07927                                 <span class="comment">// create param string and param comment string</span>
<a name="l07928"></a>07928                                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>($opData[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;parts&#39;</span>]) &gt; 0) {
<a name="l07929"></a>07929                                         $paramStr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07930"></a>07930                                         $paramArrayStr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07931"></a>07931                                         $paramCommentStr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07932"></a>07932                                         <span class="keywordflow">foreach</span> ($opData[<span class="stringliteral">&#39;input&#39;</span>][<span class="stringliteral">&#39;parts&#39;</span>] as $name =&gt; $type) {
<a name="l07933"></a>07933                                                 $paramStr .= <span class="stringliteral">&quot;\$$name, &quot;</span>;
<a name="l07934"></a>07934                                                 $paramArrayStr .= <span class="stringliteral">&quot;&#39;$name&#39; =&gt; \$$name, &quot;</span>;
<a name="l07935"></a>07935                                                 $paramCommentStr .= <span class="stringliteral">&quot;$type \$$name, &quot;</span>;
<a name="l07936"></a>07936                                         }
<a name="l07937"></a>07937                                         $paramStr = substr($paramStr, 0, strlen($paramStr)-2);
<a name="l07938"></a>07938                                         $paramArrayStr = substr($paramArrayStr, 0, strlen($paramArrayStr)-2);
<a name="l07939"></a>07939                                         $paramCommentStr = substr($paramCommentStr, 0, strlen($paramCommentStr)-2);
<a name="l07940"></a>07940                                 } <span class="keywordflow">else</span> {
<a name="l07941"></a>07941                                         $paramStr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07942"></a>07942                                         $paramArrayStr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l07943"></a>07943                                         $paramCommentStr = <span class="stringliteral">&#39;void&#39;</span>;
<a name="l07944"></a>07944                                 }
<a name="l07945"></a>07945                                 $opData[<span class="stringliteral">&#39;namespace&#39;</span>] = !isset($opData[<span class="stringliteral">&#39;namespace&#39;</span>]) ? <span class="stringliteral">&#39;http://testuri.com&#39;</span> : $opData[<span class="stringliteral">&#39;namespace&#39;</span>];
<a name="l07946"></a>07946                                 $evalStr .= <span class="stringliteral">&quot;// $paramCommentStr</span>
<a name="l07947"></a>07947 <span class="stringliteral">        function &quot;</span> . str_replace(<span class="charliteral">&#39;.&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $operation) . <span class="stringliteral">&quot;($paramStr) {</span>
<a name="l07948"></a>07948 <span class="stringliteral">                \$params = array($paramArrayStr);</span>
<a name="l07949"></a>07949 <span class="stringliteral">                return \$this-&gt;call(&#39;$operation&#39;, \$params, &#39;&quot;</span>.$opData[<span class="stringliteral">&#39;namespace&#39;</span>].<span class="stringliteral">&quot;&#39;, &#39;&quot;</span>.(isset($opData[<span class="stringliteral">&#39;soapAction&#39;</span>]) ? $opData[<span class="stringliteral">&#39;soapAction&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&quot;&#39;);</span>
<a name="l07950"></a>07950 <span class="stringliteral">        }</span>
<a name="l07951"></a>07951 <span class="stringliteral">        &quot;</span>;
<a name="l07952"></a>07952                                 unset($paramStr);
<a name="l07953"></a>07953                                 unset($paramCommentStr);
<a name="l07954"></a>07954                         }
<a name="l07955"></a>07955                 }
<a name="l07956"></a>07956                 $evalStr = <span class="stringliteral">&#39;class nusoap_proxy_&#39;</span>.$r.<span class="stringliteral">&#39; extends nusoap_client {</span>
<a name="l07957"></a>07957 <span class="stringliteral">        &#39;</span>.$evalStr.<span class="stringliteral">&#39;</span>
<a name="l07958"></a>07958 <span class="stringliteral">}&#39;</span>;
<a name="l07959"></a>07959                 <span class="keywordflow">return</span> $evalStr;
<a name="l07960"></a>07960         }
<a name="l07961"></a>07961 
<a name="l07968"></a><a class="code" href="classnusoap__client.html#a478ed950c0b8dba6f9f5fcde3ff0d362">07968</a>         function <a class="code" href="classnusoap__client.html#a478ed950c0b8dba6f9f5fcde3ff0d362">getProxyClassCode</a>() {
<a name="l07969"></a>07969                 $r = rand();
<a name="l07970"></a>07970                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classnusoap__client.html#ae3ef98298aab2e47d840a6640a502dc7">_getProxyClassCode</a>($r);
<a name="l07971"></a>07971         }
<a name="l07972"></a>07972 
<a name="l07980"></a><a class="code" href="classnusoap__client.html#aa7d92aba4e7fd910b55f68b43e72eda9">07980</a>         function <a class="code" href="classnusoap__client.html#aa7d92aba4e7fd910b55f68b43e72eda9">getHTTPBody</a>($soapmsg) {
<a name="l07981"></a>07981                 <span class="keywordflow">return</span> $soapmsg;
<a name="l07982"></a>07982         }
<a name="l07983"></a>07983         
<a name="l07992"></a><a class="code" href="classnusoap__client.html#a6698e90874e2e7f14f29eeefe0216e0e">07992</a>         function <a class="code" href="classnusoap__client.html#a6698e90874e2e7f14f29eeefe0216e0e">getHTTPContentType</a>() {
<a name="l07993"></a>07993                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;text/xml&#39;</span>;
<a name="l07994"></a>07994         }
<a name="l07995"></a>07995         
<a name="l08005"></a><a class="code" href="classnusoap__client.html#a80414bfbaf2d76036be7681b31db890a">08005</a>         function <a class="code" href="classnusoap__client.html#a80414bfbaf2d76036be7681b31db890a">getHTTPContentTypeCharset</a>() {
<a name="l08006"></a>08006                 <span class="keywordflow">return</span> $this-&gt;soap_defencoding;
<a name="l08007"></a>08007         }
<a name="l08008"></a>08008 
<a name="l08009"></a>08009         <span class="comment">/*</span>
<a name="l08010"></a>08010 <span class="comment">        * whether or not parser should decode utf8 element content</span>
<a name="l08011"></a>08011 <span class="comment">    *</span>
<a name="l08012"></a>08012 <span class="comment">    * @return   always returns true</span>
<a name="l08013"></a>08013 <span class="comment">    * @access   public</span>
<a name="l08014"></a>08014 <span class="comment">    */</span>
<a name="l08015"></a><a class="code" href="classnusoap__client.html#a71d85331b5730e2860ddb4fe364ba2c0">08015</a>     function <a class="code" href="classnusoap__client.html#a71d85331b5730e2860ddb4fe364ba2c0">decodeUTF8</a>($bool){
<a name="l08016"></a>08016                 $this-&gt;decode_utf8 = $bool;
<a name="l08017"></a>08017                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l08018"></a>08018     }
<a name="l08019"></a>08019 
<a name="l08028"></a><a class="code" href="classnusoap__client.html#a7c985069b20c8e945c7358f07a289c83">08028</a>         function <a class="code" href="classnusoap__client.html#a7c985069b20c8e945c7358f07a289c83">setCookie</a>($name, $value) {
<a name="l08029"></a>08029                 <span class="keywordflow">if</span> (strlen($name) == 0) {
<a name="l08030"></a>08030                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08031"></a>08031                 }
<a name="l08032"></a>08032                 $this-&gt;cookies[] = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $name, <span class="stringliteral">&#39;value&#39;</span> =&gt; $value);
<a name="l08033"></a>08033                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l08034"></a>08034         }
<a name="l08035"></a>08035 
<a name="l08042"></a><a class="code" href="classnusoap__client.html#aed3add6ccef87db1fa8f1dfa98edf8e8">08042</a>         function <a class="code" href="classnusoap__client.html#aed3add6ccef87db1fa8f1dfa98edf8e8">getCookies</a>() {
<a name="l08043"></a>08043                 <span class="keywordflow">return</span> $this-&gt;cookies;
<a name="l08044"></a>08044         }
<a name="l08045"></a>08045 
<a name="l08052"></a><a class="code" href="classnusoap__client.html#a4817f0dfd72202fcee4527e398919ae1">08052</a>         function <a class="code" href="classnusoap__client.html#a4817f0dfd72202fcee4527e398919ae1">checkCookies</a>() {
<a name="l08053"></a>08053                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>($this-&gt;cookies) == 0) {
<a name="l08054"></a>08054                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l08055"></a>08055                 }
<a name="l08056"></a>08056                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;checkCookie: check &#39;</span> . <span class="keyword">sizeof</span>($this-&gt;cookies) . <span class="stringliteral">&#39; cookies&#39;</span>);
<a name="l08057"></a>08057                 $curr_cookies = $this-&gt;cookies;
<a name="l08058"></a>08058                 $this-&gt;cookies = array();
<a name="l08059"></a>08059                 <span class="keywordflow">foreach</span> ($curr_cookies as $cookie) {
<a name="l08060"></a>08060                         <span class="keywordflow">if</span> (! is_array($cookie)) {
<a name="l08061"></a>08061                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Remove cookie that is not an array&#39;</span>);
<a name="l08062"></a>08062                                 <span class="keywordflow">continue</span>;
<a name="l08063"></a>08063                         }
<a name="l08064"></a>08064                         <span class="keywordflow">if</span> ((isset($cookie[<span class="stringliteral">&#39;expires&#39;</span>])) &amp;&amp; (! empty($cookie[<span class="stringliteral">&#39;expires&#39;</span>]))) {
<a name="l08065"></a>08065                                 <span class="keywordflow">if</span> (strtotime($cookie[<span class="stringliteral">&#39;expires&#39;</span>]) &gt; time()) {
<a name="l08066"></a>08066                                         $this-&gt;cookies[] = $cookie;
<a name="l08067"></a>08067                                 } <span class="keywordflow">else</span> {
<a name="l08068"></a>08068                                         $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Remove expired cookie &#39;</span> . $cookie[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l08069"></a>08069                                 }
<a name="l08070"></a>08070                         } <span class="keywordflow">else</span> {
<a name="l08071"></a>08071                                 $this-&gt;cookies[] = $cookie;
<a name="l08072"></a>08072                         }
<a name="l08073"></a>08073                 }
<a name="l08074"></a>08074                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;checkCookie: &#39;</span>.<span class="keyword">sizeof</span>($this-&gt;cookies).<span class="stringliteral">&#39; cookies left in array&#39;</span>);
<a name="l08075"></a>08075                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l08076"></a>08076         }
<a name="l08077"></a>08077 
<a name="l08085"></a><a class="code" href="classnusoap__client.html#ad0fbe30e4c04c3803fd1abb894a29d8a">08085</a>         function <a class="code" href="classnusoap__client.html#ad0fbe30e4c04c3803fd1abb894a29d8a">UpdateCookies</a>(<a class="code" href="classnusoap__client.html#a488524f98da3cb0b016d393d39f48720">$cookies</a>) {
<a name="l08086"></a>08086                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>($this-&gt;cookies) == 0) {
<a name="l08087"></a>08087                         <span class="comment">// no existing cookies: take whatever is new</span>
<a name="l08088"></a>08088                         <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(<a class="code" href="classnusoap__client.html#a488524f98da3cb0b016d393d39f48720">$cookies</a>) &gt; 0) {
<a name="l08089"></a>08089                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Setting new cookie(s)&#39;</span>);
<a name="l08090"></a>08090                                 $this-&gt;cookies = <a class="code" href="classnusoap__client.html#a488524f98da3cb0b016d393d39f48720">$cookies</a>;
<a name="l08091"></a>08091                         }
<a name="l08092"></a>08092                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l08093"></a>08093                 }
<a name="l08094"></a>08094                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(<a class="code" href="classnusoap__client.html#a488524f98da3cb0b016d393d39f48720">$cookies</a>) == 0) {
<a name="l08095"></a>08095                         <span class="comment">// no new cookies: keep what we&#39;ve got</span>
<a name="l08096"></a>08096                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l08097"></a>08097                 }
<a name="l08098"></a>08098                 <span class="comment">// merge</span>
<a name="l08099"></a>08099                 <span class="keywordflow">foreach</span> (<a class="code" href="classnusoap__client.html#a488524f98da3cb0b016d393d39f48720">$cookies</a> as $newCookie) {
<a name="l08100"></a>08100                         <span class="keywordflow">if</span> (!is_array($newCookie)) {
<a name="l08101"></a>08101                                 <span class="keywordflow">continue</span>;
<a name="l08102"></a>08102                         }
<a name="l08103"></a>08103                         <span class="keywordflow">if</span> ((!isset($newCookie[<span class="stringliteral">&#39;name&#39;</span>])) || (!isset($newCookie[<span class="stringliteral">&#39;value&#39;</span>]))) {
<a name="l08104"></a>08104                                 <span class="keywordflow">continue</span>;
<a name="l08105"></a>08105                         }
<a name="l08106"></a>08106                         $newName = $newCookie[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l08107"></a>08107 
<a name="l08108"></a>08108                         $found = <span class="keyword">false</span>;
<a name="l08109"></a>08109                         <span class="keywordflow">for</span> (<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0; <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt; count($this-&gt;cookies); <a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {
<a name="l08110"></a>08110                                 $cookie = $this-&gt;cookies[<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>];
<a name="l08111"></a>08111                                 <span class="keywordflow">if</span> (!is_array($cookie)) {
<a name="l08112"></a>08112                                         <span class="keywordflow">continue</span>;
<a name="l08113"></a>08113                                 }
<a name="l08114"></a>08114                                 <span class="keywordflow">if</span> (!isset($cookie[<span class="stringliteral">&#39;name&#39;</span>])) {
<a name="l08115"></a>08115                                         <span class="keywordflow">continue</span>;
<a name="l08116"></a>08116                                 }
<a name="l08117"></a>08117                                 <span class="keywordflow">if</span> ($newName != $cookie[<span class="stringliteral">&#39;name&#39;</span>]) {
<a name="l08118"></a>08118                                         <span class="keywordflow">continue</span>;
<a name="l08119"></a>08119                                 }
<a name="l08120"></a>08120                                 $newDomain = isset($newCookie[<span class="stringliteral">&#39;domain&#39;</span>]) ? $newCookie[<span class="stringliteral">&#39;domain&#39;</span>] : <span class="stringliteral">&#39;NODOMAIN&#39;</span>;
<a name="l08121"></a>08121                                 $domain = isset($cookie[<span class="stringliteral">&#39;domain&#39;</span>]) ? $cookie[<span class="stringliteral">&#39;domain&#39;</span>] : <span class="stringliteral">&#39;NODOMAIN&#39;</span>;
<a name="l08122"></a>08122                                 <span class="keywordflow">if</span> ($newDomain != $domain) {
<a name="l08123"></a>08123                                         <span class="keywordflow">continue</span>;
<a name="l08124"></a>08124                                 }
<a name="l08125"></a>08125                                 $newPath = isset($newCookie[<span class="stringliteral">&#39;path&#39;</span>]) ? $newCookie[<span class="stringliteral">&#39;path&#39;</span>] : <span class="stringliteral">&#39;NOPATH&#39;</span>;
<a name="l08126"></a>08126                                 $path = isset($cookie[<span class="stringliteral">&#39;path&#39;</span>]) ? $cookie[<span class="stringliteral">&#39;path&#39;</span>] : <span class="stringliteral">&#39;NOPATH&#39;</span>;
<a name="l08127"></a>08127                                 <span class="keywordflow">if</span> ($newPath != $path) {
<a name="l08128"></a>08128                                         <span class="keywordflow">continue</span>;
<a name="l08129"></a>08129                                 }
<a name="l08130"></a>08130                                 $this-&gt;cookies[<a class="code" href="ocrad_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = $newCookie;
<a name="l08131"></a>08131                                 $found = <span class="keyword">true</span>;
<a name="l08132"></a>08132                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Update cookie &#39;</span> . $newName . <span class="charliteral">&#39;=&#39;</span> . $newCookie[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l08133"></a>08133                                 <span class="keywordflow">break</span>;
<a name="l08134"></a>08134                         }
<a name="l08135"></a>08135                         <span class="keywordflow">if</span> (! $found) {
<a name="l08136"></a>08136                                 $this-&gt;<a class="code" href="classnusoap__base.html#a2ff2869a93609f3f282863a7273c26c1">debug</a>(<span class="stringliteral">&#39;Add cookie &#39;</span> . $newName . <span class="charliteral">&#39;=&#39;</span> . $newCookie[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l08137"></a>08137                                 $this-&gt;cookies[] = $newCookie;
<a name="l08138"></a>08138                         }
<a name="l08139"></a>08139                 }
<a name="l08140"></a>08140                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l08141"></a>08141         }
<a name="l08142"></a>08142 }
<a name="l08143"></a>08143 
<a name="l08144"></a>08144 <span class="keywordflow">if</span> (!extension_loaded(<span class="stringliteral">&#39;soap&#39;</span>)) {
<a name="l08148"></a>08148         <span class="keyword">class </span>soapclient <span class="keyword">extends</span> <a class="code" href="classnusoap__client.html">nusoap_client</a> {
<a name="l08149"></a>08149         }
<a name="l08150"></a>08150 }
<a name="l08151"></a>08151 ?&gt;
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Dec 9 09:36:44 2010 for DAEDrupalInterface by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
